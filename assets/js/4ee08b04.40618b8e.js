"use strict";(self.webpackChunkdocument=self.webpackChunkdocument||[]).push([[7939],{6400:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>s});const o=JSON.parse('{"id":"tutorials/core-webcomponent/core-webcomponent-sample-project","title":"sample-project","description":"Sample Project:","source":"@site/docs/tutorials/core-webcomponent/sample-project.md","sourceDirName":"tutorials/core-webcomponent","slug":"/tutorials/core-webcomponent/core-webcomponent-sample-project","permalink":"/PivotHead/docs/tutorials/core-webcomponent/core-webcomponent-sample-project","draft":false,"unlisted":false,"editUrl":"https://github.com/mindfiredigital/PivotHead/tree/main/documentation/docs/tutorials/core-webcomponent/sample-project.md","tags":[],"version":"current","frontMatter":{"id":"core-webcomponent-sample-project","title":"sample-project","sidebar_label":"Sample Project"},"sidebar":"tutorialSidebar","previous":{"title":"Why Use PivotHead","permalink":"/PivotHead/docs/getting-started/Why-we-use-pivothead"},"next":{"title":"setup-for-user-project","permalink":"/PivotHead/docs/tutorials/core-webcomponent/setup-for-user-project"}}');var a=t(4848),r=t(8453);const l={id:"core-webcomponent-sample-project",title:"sample-project",sidebar_label:"Sample Project"},i=void 0,d={},s=[{value:"Project Structure",id:"project-structure",level:2}];function c(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Sample Project:"}),"\nBasic Pivot Table (Runnable Demo)\nThis guide provides the full code for a sample project that demonstrates how to use the core-webcomponent to create a basic pivot table. You can create the following files and copy the code to run the demo on your local machine."]}),"\n",(0,a.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,a.jsx)(n.p,{children:"The sample project has the following structure:\nsample-project/"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"sample-project/\n\u251c\u2500\u2500 app.js\n\u251c\u2500\u2500 index.html\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 style.css\n\u251c\u2500\u2500 config/\n\u2502   \u2514\u2500\u2500 config.js\n\u2514\u2500\u2500 data/\n    \u2514\u2500\u2500 raw_data.json\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"2. File Content"}),"\nNext, add the following code to the corresponding files."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"package.json"}),"\nThis file includes the necessary dependencies and a script to run a simple local server."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'\n{\n  "name": "sample-project",\n  "version": "1.0.0",\n  "description": "A sample project for the core-webcomponent pivot table.",\n  "main": "app.js",\n  "scripts": {\n    "start": "http-server ."\n  },\n  "dependencies": {\n    "core-webcomponent": "latest"\n  },\n  "devDependencies": {\n    "http-server": "^14.1.1"\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"index.html:"})," This is the main entry point of your application."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'\n<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Pivot Table Demo</title>\n    <link rel="stylesheet" href="style.css">\n</head>\n<body>\n    <h1>Core Webcomponent Pivot Table</h1>\n    <pivot-head\n        data-url="data/raw_data.json"\n        options-url="config/config.js">\n    </pivot-head>\n    <script type="module" src="app.js"><\/script>\n</body>\n</html>\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"style.css:"})," Basic styling for the pivot table."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"body {\n    font-family: sans-serif;\n    margin: 2em;\n}\n\npivot-head {\n    display: block;\n    width: 100%;\n    height: 500px;\n    border: 1px solid #ccc;\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"app.js:"})," The main JavaScript file that initializes the pivot table and handles events."]}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:"Click to view the app.js example"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\n/\\* PivotHead Demo - Fixed Sorting Implementation\n\n-\n- This file demonstrates the usage of the PivotheadCore library to create an interactive pivot table.\n- Features include:\n- - Sorting (FIXED)\n- - Grouping\n- - Column resizing\n- - Column reordering (drag and drop)\n- - Row reordering (drag and drop)\n    \\*/\n\n// Import statements - Make sure these paths are correct\nimport { createHeader } from './header/header.js';\nimport { PivotEngine } from '@mindfiredigital/pivothead';\nimport { sampleData, config } from './config/config.js';\n\nimport { ConnectService } from '../../packages/core/src/engine/connectService.ts';\nimport { FieldService } from '../../packages/core/src/engine/fieldService.ts';\n\n// Create a single instance of PivotEngine that will be used throughout the app's lifecycle\nexport let pivotEngine;\n\n// Store the current full dataset being used (can be original or filtered)\nlet currentData = [...sampleData];\nlet showProcessedData = true;\nlet currentViewMode = 'processed'; // 'raw' or 'processed'\n\n// Manage pagination state locally\nlet paginationState = {\ncurrentPage: 1,\npageSize: 10,\ntotalPages: 1,\n};\n\n// Initialize filter fields\nfunction initializeFilters() {\nconst filterField = document.getElementById('filterField');\nif (!filterField) {\nconsole.error('Filter field element not found');\nreturn;\n}\n\n// Build field list dynamically from current engine data\nlet fields = [];\ntry {\nif (pivotEngine) {\nconst stateNow = pivotEngine.getState();\nconst sample = (stateNow.rawData && stateNow.rawData[0]) || null;\nif (sample) {\nfields = Object.keys(sample).filter(k => k !== '**all**');\n}\n}\n} catch (e) {\nconsole.warn('Unable to infer fields for filters from engine:', e);\n}\n\n// Fallback to defaults if no fields were detected\nif (!fields || fields.length === 0) {\nfields = ['country', 'category', 'price', 'discount'];\n}\n\nfilterField.innerHTML = fields\n.map(f => `<option value=\"${f}\">${getFieldDisplayName(f)}</option>`)\n.join('');\n\nconst filterOperator = document.getElementById('filterOperator');\nif (!filterOperator) {\nconsole.error('Filter operator element not found');\nreturn;\n}\n\nfilterOperator.innerHTML = `     <option value=\"equals\">Equals</option>\n    <option value=\"contains\">Contains</option>\n    <option value=\"greaterThan\">Greater Than</option>\n    <option value=\"lessThan\">Less Than</option>\n  `;\n}\n\n// Get paginated data\nfunction getPaginatedData(data, paginationState) {\nif (!data || !Array.isArray(data)) {\nconsole.warn('Invalid data provided to getPaginatedData');\nreturn [];\n}\n\nconst start = (paginationState.currentPage - 1) \\* paginationState.pageSize;\nconst end = start + paginationState.pageSize;\nreturn data.slice(start, end);\n}\n\n// FIXED: Helper function to create sort icons with proper state tracking\nfunction createSortIcon(field, currentSortConfig) {\nconst sortIcon = document.createElement('span');\nsortIcon.style.marginLeft = '5px';\nsortIcon.style.display = 'inline-block';\nsortIcon.style.cursor = 'pointer';\nsortIcon.style.fontSize = '12px';\nsortIcon.style.userSelect = 'none';\n\n// Check if this field is currently being sorted\nconst isCurrentlySorted =\ncurrentSortConfig && currentSortConfig.field === field;\n\nif (isCurrentlySorted) {\nif (currentSortConfig.direction === 'asc') {\nsortIcon.innerHTML = '\u25b2'; // Up triangle\nsortIcon.title = `Sorted by ${field} ascending - click to sort descending`;\nsortIcon.style.color = '#007bff';\n} else {\nsortIcon.innerHTML = '\u25bc'; // Down triangle\nsortIcon.title = `Sorted by ${field} descending - click to sort ascending`;\nsortIcon.style.color = '#007bff';\n}\n} else {\nsortIcon.innerHTML = '\u2195'; // Up/down arrow\nsortIcon.title = `Click to sort by ${field}`;\nsortIcon.style.color = '#6c757d';\nsortIcon.style.opacity = '0.7';\n}\n\n// Add hover effect\nsortIcon.addEventListener('mouseenter', () => {\nif (!isCurrentlySorted) {\nsortIcon.style.opacity = '1';\nsortIcon.style.color = '#007bff';\n}\n});\n\nsortIcon.addEventListener('mouseleave', () => {\nif (!isCurrentlySorted) {\nsortIcon.style.opacity = '0.7';\nsortIcon.style.color = '#6c757d';\n}\n});\n\nreturn sortIcon;\n}\n\nfunction sortRawDataByColumn(columnName, rawData) {\nconsole.log(`Sorting raw data by column: ${columnName}`);\n\n// Get current sort state\nconst currentSort = window.rawDataSort || {};\nconst direction =\ncurrentSort.column === columnName && currentSort.direction === 'asc'\n? 'desc'\n: 'asc';\n\n// Sort the data\nrawData.sort((a, b) => {\nlet aVal = a[columnName];\nlet bVal = b[columnName];\n\n    // Handle different data types\n    if (typeof aVal === 'string') aVal = aVal.toLowerCase();\n    if (typeof bVal === 'string') bVal = bVal.toLowerCase();\n\n    if (aVal < bVal) return direction === 'asc' ? -1 : 1;\n    if (aVal > bVal) return direction === 'asc' ? 1 : -1;\n    return 0;\n\n});\n\n// Store sort state\nwindow.rawDataSort = { column: columnName, direction };\n\n// Update the global data array to maintain sort\ncurrentData = [...rawData];\n\nconsole.log(`Sorted raw data by ${columnName} (${direction})`);\nrenderRawDataTable();\n}\n\nfunction swapRawDataRows(fromIndex, toIndex, rawData) {\nconsole.log('Swapping raw data rows:', fromIndex, '->', toIndex);\n\nif (\nfromIndex < 0 ||\ntoIndex < 0 ||\nfromIndex >= rawData.length ||\ntoIndex >= rawData.length\n) {\nconsole.error('Invalid row indices for raw data swap');\nreturn;\n}\n\n// Swap the rows in the raw data array\nconst temp = rawData[fromIndex];\nrawData[fromIndex] = rawData[toIndex];\nrawData[toIndex] = temp;\n\ncurrentData = [...rawData];\n\nconsole.log('Raw data rows swapped successfully');\n}\n\nfunction swapRawDataColumns(fromIndex, toIndex) {\nconsole.log('Swapping raw data columns:', fromIndex, '->', toIndex);\n\nif (currentData.length === 0) {\nconsole.error('No raw data available for column swap');\nreturn;\n}\n\n// Get current column order\nconst headers = Object.keys(currentData[0]);\n\nif (\nfromIndex < 0 ||\ntoIndex < 0 ||\nfromIndex >= headers.length ||\ntoIndex >= headers.length\n) {\nconsole.error(\n'Invalid column indices for raw data swap:',\nfromIndex,\ntoIndex,\n'Available columns:',\nheaders.length\n);\nreturn;\n}\n\n// Initialize or update the column order\nif (!window.rawDataColumnOrder) {\nwindow.rawDataColumnOrder = [...headers];\n}\n\n// Swap in the column order array\nconst temp = window.rawDataColumnOrder[fromIndex];\nwindow.rawDataColumnOrder[fromIndex] = window.rawDataColumnOrder[toIndex];\nwindow.rawDataColumnOrder[toIndex] = temp;\n\nconsole.log('Raw data column order updated:', window.rawDataColumnOrder);\n\n// Important: Re-render the table to show the new column order\nrenderRawDataTable();\n}\n\n// FIXED: Raw data table rendering with proper sort icons\nfunction renderRawDataTable() {\ntry {\nconsole.log('Rendering raw data table');\n\n    const rawDataToUse = pivotEngine.getState().rawData;\n\n    if (!rawDataToUse || rawDataToUse.length === 0) {\n      console.error('No raw data available');\n      const tableContainer = document.getElementById('myTable');\n      if (tableContainer) {\n        tableContainer.innerHTML =\n          '<div style=\"padding: 20px;\">No data available to display.</div>';\n      }\n      return;\n    }\n\n    console.log(\n      'Rendering raw data table with',\n      rawDataToUse.length,\n      'total items'\n    );\n\n    const tableContainer = document.getElementById('myTable');\n    if (!tableContainer) {\n      console.error('Table container not found');\n      return;\n    }\n\n    tableContainer.innerHTML = '';\n\n    const table = document.createElement('table');\n    table.style.width = '100%';\n    table.style.borderCollapse = 'collapse';\n    table.style.marginTop = '20px';\n    table.style.border = '1px solid #dee2e6';\n\n    // Get headers - use custom order if available\n    let headers;\n    if (window.rawDataColumnOrder && window.rawDataColumnOrder.length > 0) {\n      headers = window.rawDataColumnOrder;\n    } else {\n      headers = rawDataToUse.length > 0 ? Object.keys(rawDataToUse[0]) : [];\n    }\n\n    // Create table header\n    const thead = document.createElement('thead');\n    const headerRow = document.createElement('tr');\n\n    // Get current sort state for raw data\n    const currentSort = window.rawDataSort || {};\n\n    headers.forEach((headerText, index) => {\n      const th = document.createElement('th');\n      th.style.padding = '12px';\n      th.style.backgroundColor = '#f8f9fa';\n      th.style.borderBottom = '2px solid #dee2e6';\n      th.style.borderRight = '1px solid #dee2e6';\n      th.style.cursor = 'pointer';\n      th.style.position = 'relative';\n      th.style.userSelect = 'none';\n\n      th.setAttribute('draggable', 'true');\n      th.dataset.columnIndex = index;\n      th.dataset.columnName = headerText;\n      th.className = 'raw-data-header';\n\n      const headerContent = document.createElement('div');\n      headerContent.style.display = 'flex';\n      headerContent.style.alignItems = 'center';\n      headerContent.style.justifyContent = 'space-between';\n\n      const headerSpan = document.createElement('span');\n      headerSpan.textContent = getFieldDisplayName(headerText);\n      headerContent.appendChild(headerSpan);\n\n      // FIXED: Use the proper sort icon function with current state\n      const sortIcon = createSortIcon(headerText, {\n        field: currentSort.column,\n        direction: currentSort.direction,\n      });\n      headerContent.appendChild(sortIcon);\n\n      th.appendChild(headerContent);\n\n      // FIXED: Click handler for sorting\n      th.addEventListener('click', e => {\n        // Prevent drag when clicking on sort\n        e.stopPropagation();\n        sortRawDataByColumn(headerText, rawDataToUse);\n      });\n\n      headerRow.appendChild(th);\n    });\n\n    thead.appendChild(headerRow);\n    table.appendChild(thead);\n\n    // Update pagination\n    updateRawDataPagination(rawDataToUse);\n\n    // Get paginated data\n    const paginatedData = getPaginatedData(rawDataToUse, paginationState);\n\n    // Create table body - use the custom header order for cells too\n    const tbody = document.createElement('tbody');\n\n    paginatedData.forEach((rowData, rowIndex) => {\n      const tr = document.createElement('tr');\n      tr.dataset.rowIndex = rowIndex;\n      tr.dataset.globalIndex = rawDataToUse.indexOf(rowData);\n      tr.setAttribute('draggable', 'true');\n      tr.style.cursor = 'move';\n      tr.className = 'raw-data-row';\n\n      // Use the headers array (which respects custom order) for cell creation\n      headers.forEach(header => {\n        const td = document.createElement('td');\n        td.style.padding = '8px';\n        td.style.borderBottom = '1px solid #dee2e6';\n        td.style.borderRight = '1px solid #dee2e6';\n\n        let cellValue = rowData[header];\n        if (cellValue === null || cellValue === undefined) {\n          cellValue = '';\n        } else if (typeof cellValue === 'number') {\n          if (\n            header === 'price' ||\n            header === 'sales' ||\n            header === 'revenue' ||\n            header === 'discount'\n          ) {\n            cellValue = new Intl.NumberFormat('en-US', {\n              style: 'currency',\n              currency: 'USD',\n            }).format(cellValue);\n          } else if (typeof cellValue === 'number' && cellValue % 1 !== 0) {\n            cellValue = cellValue.toFixed(2);\n          }\n        }\n\n        td.textContent = cellValue;\n        tr.appendChild(td);\n      });\n\n      tbody.appendChild(tr);\n    });\n\n    table.appendChild(tbody);\n    tableContainer.appendChild(table);\n\n    // Update pagination info\n    updatePaginationInfo('Raw Data');\n\n    // Set up drag and drop\n    setupRawDataDragAndDrop(rawDataToUse);\n\n} catch (error) {\nconsole.error('Error rendering raw data table:', error);\nconst tableContainer = document.getElementById('myTable');\nif (tableContainer) {\ntableContainer.innerHTML = `<div style=\"color: red; padding: 20px;\">Error rendering raw data table: ${error.message}</div>`;\n}\n}\n}\n\nfunction updateRawDataPagination(rawData) {\nif (!rawData || !Array.isArray(rawData)) {\nconsole.warn('Invalid raw data for pagination');\nreturn;\n}\n\n// Get pageSize from the select element, with fallback\nconst pageSizeElement = document.getElementById('pageSize');\nconst pageSize = pageSizeElement ? Number(pageSizeElement.value) : 10;\nconst totalPages = Math.ceil(rawData.length / pageSize) || 1;\n\n// Check if current page is valid for new pagination\nif (paginationState.currentPage > totalPages) {\npaginationState.currentPage = Math.max(1, totalPages);\n}\n\npaginationState.pageSize = pageSize;\npaginationState.totalPages = totalPages;\n}\n\n// Generic function to get ordered column values\nfunction getOrderedColumnValues() {\nif (!pivotEngine) {\nconsole.warn('PivotEngine not initialized');\nreturn [];\n}\n\nconst state = pivotEngine.getState();\nconst columnFieldName = pivotEngine.getColumnFieldName();\nif (!columnFieldName) return [];\n\n// Prefer engine-provided custom order if available\ntry {\nconst customOrdered =\npivotEngine.getOrderedColumnValues &&\npivotEngine.getOrderedColumnValues();\nif (Array.isArray(customOrdered) && customOrdered.length > 0) {\nreturn customOrdered;\n}\n} catch (error) {\nconsole.warn('Could not get ordered column values from engine:', error);\n}\n\n// Fallback: compute unique values from current filtered data\nconst filteredRawData = state.rawData || [];\nconst uniqueColumnValues = [\n...new Set(filteredRawData.map(item => item[columnFieldName])),\n];\nreturn uniqueColumnValues;\n}\n\n// Generic function to get ordered row values\nfunction getOrderedRowValues() {\nif (!pivotEngine) {\nconsole.warn('PivotEngine not initialized');\nreturn [];\n}\n\nconst state = pivotEngine.getState();\nconst rowFieldName = pivotEngine.getRowFieldName();\nif (!rowFieldName) return [];\n\n// Prefer engine-provided custom order if available\ntry {\nconst customOrdered =\npivotEngine.getOrderedRowValues && pivotEngine.getOrderedRowValues();\nif (Array.isArray(customOrdered) && customOrdered.length > 0) {\nreturn customOrdered;\n}\n} catch (error) {\nconsole.warn('Could not get ordered row values from engine:', error);\n}\n\n// Fallback: compute unique values from current filtered data\nconst filteredRawData = state.rawData || [];\nconst uniqueRowValues = [\n...new Set(filteredRawData.map(item => item[rowFieldName])),\n];\nreturn uniqueRowValues;\n}\n\nfunction getSortedRowValuesByMeasure(\nrowFieldName,\ncolumnFieldName,\nsortConfig\n) {\nconst state = pivotEngine.getState();\nconst uniqueRowValues = pivotEngine.getUniqueFieldValues(rowFieldName);\nconst uniqueColumnValues = pivotEngine.getUniqueFieldValues(columnFieldName);\n\nconsole.log(\n'Sorting rows by measure:',\nsortConfig.field,\n'direction:',\nsortConfig.direction\n);\n\n// Find the measure configuration\nconst measure = state.measures.find(m => m.uniqueName === sortConfig.field);\nif (!measure) {\nconsole.error('Measure not found:', sortConfig.field);\nreturn uniqueRowValues;\n}\n\n// Calculate total aggregated value for each row across all columns\nconst rowTotals = uniqueRowValues.map(rowValue => {\nlet total = 0;\n\n    // Sum the measure values across all columns for this row\n    uniqueColumnValues.forEach(columnValue => {\n      const cellValue = pivotEngine.calculateCellValue(\n        rowValue,\n        columnValue,\n        measure,\n        rowFieldName,\n        columnFieldName\n      );\n      total += cellValue || 0;\n    });\n\n    return {\n      rowValue,\n      total,\n    };\n\n});\n\nconsole.log('Row totals before sorting:', rowTotals.slice(0, 3));\n\n// Sort by total\nrowTotals.sort((a, b) => {\nconst result = a.total - b.total;\nreturn sortConfig.direction === 'asc' ? result : -result;\n});\n\nconsole.log('Row totals after sorting:', rowTotals.slice(0, 3));\n\n// Return just the sorted row values\nreturn rowTotals.map(item => item.rowValue);\n}\n\nfunction setupRawDataDragAndDrop(rawData) {\nconsole.log(\n'Setting up raw data drag and drop with',\nrawData.length,\n'items'\n);\n\n// Column drag and drop for raw data\nconst headers = document.querySelectorAll(\n'.raw-data-header[draggable=\"true\"]'\n);\nlet draggedColumnIndex = null;\n\nheaders.forEach(header => {\nconst columnIndex = parseInt(header.dataset.columnIndex);\nconst columnName = header.dataset.columnName;\n\n    header.addEventListener('dragstart', e => {\n      draggedColumnIndex = columnIndex;\n      e.dataTransfer.setData('text/plain', columnName);\n      setTimeout(() => header.classList.add('dragging'), 0);\n    });\n\n    header.addEventListener('dragend', () => {\n      header.classList.remove('dragging');\n      draggedColumnIndex = null;\n    });\n\n    header.addEventListener('dragover', e => e.preventDefault());\n    header.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedColumnIndex !== null && draggedColumnIndex !== columnIndex) {\n        header.classList.add('drag-over');\n      }\n    });\n    header.addEventListener('dragleave', () =>\n      header.classList.remove('drag-over')\n    );\n    header.addEventListener('drop', e => {\n      e.preventDefault();\n      header.classList.remove('drag-over');\n\n      const targetColumnIndex = columnIndex;\n\n      if (\n        draggedColumnIndex !== null &&\n        draggedColumnIndex !== targetColumnIndex\n      ) {\n        swapRawDataColumns(draggedColumnIndex, targetColumnIndex);\n        renderRawDataTable();\n      }\n    });\n\n});\n\n// Row drag and drop for raw data\nconst rows = document.querySelectorAll('.raw-data-row[draggable=\"true\"]');\nlet draggedRowIndex = null;\n\nrows.forEach(row => {\nconst rowIndex = parseInt(row.dataset.rowIndex);\nconst globalIndex = parseInt(row.dataset.globalIndex);\n\n    row.addEventListener('dragstart', e => {\n      draggedRowIndex = globalIndex;\n      e.dataTransfer.setData('text/plain', rowIndex.toString());\n      setTimeout(() => row.classList.add('dragging'), 0);\n    });\n\n    row.addEventListener('dragend', () => {\n      row.classList.remove('dragging');\n      draggedRowIndex = null;\n    });\n\n    row.addEventListener('dragover', e => e.preventDefault());\n    row.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedRowIndex !== null && draggedRowIndex !== globalIndex) {\n        row.classList.add('drag-over');\n      }\n    });\n    row.addEventListener('dragleave', () => row.classList.remove('drag-over'));\n    row.addEventListener('drop', e => {\n      e.preventDefault();\n      row.classList.remove('drag-over');\n\n      const targetRowIndex = globalIndex;\n\n      if (draggedRowIndex !== null && draggedRowIndex !== targetRowIndex) {\n        swapRawDataRows(draggedRowIndex, targetRowIndex, rawData);\n        renderRawDataTable();\n      }\n    });\n\n});\n}\n\n// FIXED: Main table rendering function with proper pivot engine sorting\nfunction renderTable() {\n// Check current view mode\nif (currentViewMode === 'raw') {\nconsole.log('Rendering raw data view');\nrenderRawDataTable();\nreturn;\n}\n\nif (!pivotEngine) {\nconsole.error('PivotEngine not initialized');\nreturn;\n}\n\ntry {\nconst state = pivotEngine.getState();\nconsole.log('Current Engine State:', state);\n\n    if (!state.processedData) {\n      console.error('No processed data available');\n      return;\n    }\n\n    // Get field names from configuration\n    const rowFieldName = pivotEngine.getRowFieldName();\n    const columnFieldName = pivotEngine.getColumnFieldName();\n\n    if (!rowFieldName || !columnFieldName) {\n      console.error('Row or column field not configured');\n      return;\n    }\n\n    const tableContainer = document.getElementById('myTable');\n    if (!tableContainer) {\n      console.error('Table container not found');\n      return;\n    }\n\n    // Clear previous content\n    tableContainer.innerHTML = '';\n\n    // Create table element\n    const table = document.createElement('table');\n    table.style.width = '100%';\n    table.style.borderCollapse = 'collapse';\n    table.style.marginTop = '20px';\n    table.style.border = '1px solid #dee2e6';\n\n    // Create table header\n    const thead = document.createElement('thead');\n    const columnHeaderRow = document.createElement('tr');\n\n    // Add empty cell for top-left corner\n    const cornerCell = document.createElement('th');\n    cornerCell.style.padding = '12px';\n    cornerCell.style.backgroundColor = '#f8f9fa';\n    cornerCell.style.borderBottom = '2px solid #dee2e6';\n    cornerCell.style.borderRight = '1px solid #dee2e6';\n    // Hide the column axis label when using synthesized '__all__'\n    if (columnFieldName === '__all__') {\n      cornerCell.textContent = `${getFieldDisplayName(rowFieldName)}`;\n    } else {\n      cornerCell.textContent = `${getFieldDisplayName(rowFieldName)} / ${getFieldDisplayName(columnFieldName)}`;\n    }\n    columnHeaderRow.appendChild(cornerCell);\n\n    // Get unique column values in their correct order\n    let uniqueColumnValues = getOrderedColumnValues();\n\n    // Fix: Use custom order from pivotEngine state if available\n    if (state.customColumnOrder && state.customColumnOrder.length > 0) {\n      uniqueColumnValues = state.customColumnOrder;\n    }\n\n    uniqueColumnValues.forEach((columnValue, index) => {\n      const th = document.createElement('th');\n      // Optionally hide the 'All' header label for synthesized column axis\n      th.textContent = columnFieldName === '__all__' ? '' : columnValue;\n      th.colSpan = state.measures.length;\n      th.style.padding = '12px';\n      th.style.backgroundColor = '#f8f9fa';\n      th.style.borderBottom = '2px solid #dee2e6';\n      th.style.borderRight = '1px solid #dee2e6';\n      th.style.textAlign = 'center';\n      th.dataset.fieldName = columnFieldName;\n      th.dataset.fieldValue = columnValue;\n      th.dataset.columnIndex = index;\n      th.setAttribute('draggable', 'true');\n      th.style.cursor = 'move';\n      th.className = 'column-header';\n      columnHeaderRow.appendChild(th);\n    });\n    thead.appendChild(columnHeaderRow);\n\n    const measureHeaderRow = document.createElement('tr');\n\n    // FIXED: Get current sort configuration from the engine\n    const currentSortConfig =\n      state.sortConfig && state.sortConfig.length > 0\n        ? state.sortConfig[0]\n        : null;\n\n    const rowHeader = document.createElement('th');\n    rowHeader.style.padding = '12px';\n    rowHeader.style.backgroundColor = '#f8f9fa';\n    rowHeader.style.borderBottom = '2px solid #dee2e6';\n    rowHeader.style.borderRight = '1px solid #dee2e6';\n    rowHeader.style.cursor = 'pointer';\n    rowHeader.style.userSelect = 'none';\n\n    const rowHeaderContent = document.createElement('div');\n    rowHeaderContent.style.display = 'flex';\n    rowHeaderContent.style.alignItems = 'center';\n    rowHeaderContent.style.justifyContent = 'space-between';\n\n    const rowText = document.createElement('span');\n    rowText.textContent = getFieldDisplayName(rowFieldName);\n    rowHeaderContent.appendChild(rowText);\n\n    // FIXED: Use the proper sort icon function\n    const rowSortIcon = createSortIcon(rowFieldName, currentSortConfig);\n    rowHeaderContent.appendChild(rowSortIcon);\n    rowHeader.appendChild(rowHeaderContent);\n\n    // FIXED: Proper sort event handler with drag interference prevention\n    rowHeader.addEventListener('click', e => {\n      e.stopPropagation(); // Prevent drag event interference\n\n      const stateNow = pivotEngine.getState();\n      const current =\n        stateNow.sortConfig && stateNow.sortConfig.length > 0\n          ? stateNow.sortConfig[0]\n          : null;\n      const nextDir =\n        current && current.field === rowFieldName && current.direction === 'asc'\n          ? 'desc'\n          : 'asc';\n\n      // In processed mode, set custom alphabetical order for row values\n      if (currentViewMode !== 'raw') {\n        try {\n          const filteredRawData = stateNow.rawData;\n          const uniqueRowValues = [\n            ...new Set(filteredRawData.map(item => item[rowFieldName])),\n          ];\n          const sortedRows = [...uniqueRowValues].sort((a, b) => {\n            const result = a.localeCompare(b);\n            return nextDir === 'asc' ? result : -result;\n          });\n          if (sortedRows.length > 0) {\n            pivotEngine.setCustomFieldOrder(rowFieldName, sortedRows, true);\n          }\n        } catch (err) {\n          console.error(\n            'Failed to set custom row order for dimension sort:',\n            err\n          );\n        }\n      }\n\n      pivotEngine.sort(rowFieldName, nextDir);\n    });\n    measureHeaderRow.appendChild(rowHeader);\n\n    uniqueColumnValues.forEach(columnValue => {\n      state.measures.forEach((measure, measureIndex) => {\n        const th = document.createElement('th');\n        th.style.padding = '12px';\n        th.style.backgroundColor = '#f8f9fa';\n        th.style.borderBottom = '2px solid #dee2e6';\n        th.style.borderRight = '1px solid #dee2e6';\n        th.style.cursor = 'pointer';\n        th.style.userSelect = 'none';\n\n        const headerContent = document.createElement('div');\n        headerContent.style.display = 'flex';\n        headerContent.style.alignItems = 'center';\n        headerContent.style.justifyContent = 'space-between';\n\n        const measureText = document.createElement('span');\n        measureText.textContent = measure.caption;\n        headerContent.appendChild(measureText);\n\n        // FIXED: Use the proper sort icon function\n        const sortIcon = createSortIcon(measure.uniqueName, currentSortConfig);\n        headerContent.appendChild(sortIcon);\n        th.appendChild(headerContent);\n\n        th.dataset.columnValue = String(columnValue);\n        th.dataset.measureIndex = String(measureIndex);\n\n        // FIXED: Proper sort event handler for measures\n        th.addEventListener('click', e => {\n          const stateNow = pivotEngine.getState();\n          const current =\n            stateNow.sortConfig && stateNow.sortConfig.length > 0\n              ? stateNow.sortConfig[0]\n              : null;\n          const nextDir =\n            current &&\n            current.field === measure.uniqueName &&\n            current.direction === 'asc'\n              ? 'desc'\n              : 'asc';\n\n          // console.log('Applying sort direction:', direction);\n          if (currentViewMode !== 'raw') {\n            try {\n              // Determine aggregation key for the selected measure\n              const measureCfg = stateNow.measures.find(\n                m => m.uniqueName === measure.uniqueName\n              );\n              const aggregation =\n                (measureCfg && measureCfg.aggregation) || 'sum';\n              const aggKey = `${aggregation}_${measure.uniqueName}`;\n\n              const groups = pivotEngine.getGroupedData();\n\n              // Build full set of row values across groups (ensures rows with 0 are included)\n              const allRowSet = new Set();\n              groups.forEach(g => {\n                const keys = g.key ? g.key.split('|') : [];\n                if (keys[0]) allRowSet.add(keys[0]);\n              });\n              const allRowValues = Array.from(allRowSet);\n\n              // Compute values for the selected column\n              const pairs = allRowValues.map(rv => {\n                const grp = groups.find(gr => {\n                  const keys = gr.key ? gr.key.split('|') : [];\n                  return keys[0] === rv && keys[1] === columnValue;\n                });\n                const aggregates = (grp && grp.aggregates) || {};\n                const val = Number(aggregates[aggKey] ?? 0);\n                return { row: rv, val: isFinite(val) ? val : 0 };\n              });\n\n              // Sort rows by the computed values in the chosen direction\n              pairs.sort((a, b) =>\n                nextDir === 'asc' ? a.val - b.val : b.val - a.val\n              );\n              const orderedRows = pairs.map(p => p.row);\n\n              const rowFieldNameNow = pivotEngine.getRowFieldName();\n              if (rowFieldNameNow && orderedRows.length > 0) {\n                pivotEngine.setCustomFieldOrder(\n                  rowFieldNameNow,\n                  orderedRows,\n                  true\n                );\n              }\n            } catch (err) {\n              console.error(\n                'Failed to compute/set custom row order for processed sort:',\n                err\n              );\n            }\n          }\n\n          // Always call engine.sort to update sort state (icons) and internal groups\n          pivotEngine.sort(measure.uniqueName, nextDir);\n        });\n        measureHeaderRow.appendChild(th);\n      });\n    });\n    thead.appendChild(measureHeaderRow);\n    table.appendChild(thead);\n\n    const tbody = document.createElement('tbody');\n    const allUniqueRowValues = getOrderedRowValues();\n\n    // Check if no data matches the current filters\n    if (!allUniqueRowValues || allUniqueRowValues.length === 0) {\n      console.log('No data matches the current filters');\n      const tableContainer = document.getElementById('myTable');\n      if (tableContainer) {\n        tableContainer.innerHTML =\n          '<div style=\"padding: 20px; text-align: center; color: #666;\">No data matches the current filters. Try adjusting your filter criteria.</div>';\n      }\n      return;\n    }\n\n    updatePagination(allUniqueRowValues, false);\n    const paginatedRowValues = getPaginatedData(\n      allUniqueRowValues,\n      paginationState\n    );\n\n    paginatedRowValues.forEach((rowValue, rowIndex) => {\n      const tr = document.createElement('tr');\n      tr.dataset.fieldName = rowFieldName;\n      tr.dataset.fieldValue = rowValue;\n      tr.setAttribute('draggable', 'true');\n      tr.style.cursor = 'move';\n\n      const rowCell = document.createElement('td');\n      rowCell.textContent = rowValue;\n      rowCell.style.fontWeight = 'bold';\n      rowCell.style.padding = '8px';\n      rowCell.style.borderBottom = '1px solid #dee2e6';\n      rowCell.style.borderRight = '1px solid #dee2e6';\n      rowCell.className = 'row-cell';\n      // Make the cell itself draggable for better browser compatibility\n      rowCell.setAttribute('draggable', 'true');\n      // Store dataset on the draggable element as well\n      rowCell.dataset.fieldName = rowFieldName;\n      rowCell.dataset.fieldValue = rowValue;\n      tr.appendChild(rowCell);\n\n      uniqueColumnValues.forEach(columnValue => {\n        state.measures.forEach(measure => {\n          const td = document.createElement('td');\n          td.style.padding = '8px';\n          td.style.borderBottom = '1px solid #dee2e6';\n          td.style.borderRight = '1px solid #dee2e6';\n\n          // Use engine's calculateCellValue method\n          const value = pivotEngine.calculateCellValue(\n            rowValue,\n            columnValue,\n            measure,\n            rowFieldName,\n            columnFieldName\n          );\n\n          // Use engine's formatValue method\n          const formattedValue = pivotEngine.formatValue(\n            value,\n            measure.uniqueName\n          );\n\n          // Apply text alignment from engine\n          td.style.textAlign = pivotEngine.getFieldAlignment(\n            measure.uniqueName\n          );\n\n          // Set the formatted value\n          td.textContent = formattedValue;\n\n          // Add drilldown functionality\n          addDrillDownToDataCell(\n            td,\n            rowValue,\n            columnValue,\n            measure,\n            value,\n            formattedValue,\n            rowFieldName,\n            columnFieldName\n          );\n\n          tr.appendChild(td);\n        });\n      });\n      tbody.appendChild(tr);\n    });\n\n    table.appendChild(tbody);\n    tableContainer.appendChild(table);\n\n    updatePaginationInfo('Processed Data');\n    setupDragAndDrop();\n\n} catch (error) {\nconsole.error('Error rendering table:', error);\nconst tableContainer = document.getElementById('myTable');\nif (tableContainer) {\ntableContainer.innerHTML = `<div style=\"color: red; padding: 20px;\">Error rendering table: ${error.message}</div>`;\n}\n}\n}\n\nfunction setupColumnDragAndDropFixed(columnFieldName) {\nconst columnHeaders = document.querySelectorAll(\n'.column-header[draggable=\"true\"]'\n);\nlet draggedColumnValue = null;\nlet draggedColumnIndex = null;\n\nif (!pivotEngine) {\nconsole.error('PivotEngine not initialized for column drag and drop');\nreturn;\n}\n\nconsole.log('Setting up column drag and drop for field:', columnFieldName);\n\ncolumnHeaders.forEach(header => {\nconst fieldValue = header.dataset.fieldValue;\nconst columnIndex = parseInt(header.dataset.columnIndex);\n\n    console.log(\n      'Setting up drag for column:',\n      fieldValue,\n      'at index:',\n      columnIndex\n    );\n\n    header.addEventListener('dragstart', e => {\n      draggedColumnValue = fieldValue;\n      draggedColumnIndex = columnIndex;\n      e.dataTransfer.setData('text/plain', fieldValue);\n      e.dataTransfer.effectAllowed = 'move';\n      setTimeout(() => header.classList.add('dragging'), 0);\n      console.log(\n        'Drag started for column:',\n        fieldValue,\n        'index:',\n        columnIndex\n      );\n    });\n\n    header.addEventListener('dragend', e => {\n      header.classList.remove('dragging');\n      console.log('Drag ended for column:', fieldValue);\n      draggedColumnValue = null;\n      draggedColumnIndex = null;\n    });\n\n    header.addEventListener('dragover', e => {\n      e.preventDefault();\n      e.dataTransfer.dropEffect = 'move';\n    });\n\n    header.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedColumnValue && draggedColumnValue !== fieldValue) {\n        header.classList.add('drag-over');\n      }\n    });\n\n    header.addEventListener('dragleave', e => {\n      header.classList.remove('drag-over');\n    });\n\n    header.addEventListener('drop', e => {\n      e.preventDefault();\n      header.classList.remove('drag-over');\n\n      const targetColumnValue = fieldValue;\n      const targetColumnIndex = columnIndex;\n\n      console.log('Drop event:', {\n        draggedValue: draggedColumnValue,\n        draggedIndex: draggedColumnIndex,\n        targetValue: targetColumnValue,\n        targetIndex: targetColumnIndex,\n      });\n\n      if (\n        draggedColumnValue &&\n        draggedColumnIndex !== null &&\n        draggedColumnValue !== targetColumnValue &&\n        draggedColumnIndex !== targetColumnIndex\n      ) {\n        console.log(\n          'Executing column swap:',\n          draggedColumnIndex,\n          '->',\n          targetColumnIndex\n        );\n\n        try {\n          // Use the PivotEngine's swapDataColumns method\n          const result = pivotEngine.swapDataColumns(\n            draggedColumnIndex,\n            targetColumnIndex\n          );\n          console.log('Column swap result:', result);\n\n          // Force a re-render after the swap\n          setTimeout(() => {\n            console.log('Re-rendering after column swap');\n            renderTable();\n          }, 50);\n        } catch (error) {\n          console.error('Error during column swap:', error);\n          // Fallback: manual re-render\n          renderTable();\n        }\n      }\n    });\n\n});\n\nconsole.log(\n'Column drag and drop setup completed for',\ncolumnHeaders.length,\n'headers'\n);\n}\n\nfunction createColumnHeaders(\nuniqueColumnValues,\ncolumnFieldName,\nstate,\ncolumnHeaderRow\n) {\nconsole.log('Creating column headers for values:', uniqueColumnValues);\n\nuniqueColumnValues.forEach((columnValue, index) => {\nconst th = document.createElement('th');\nth.textContent = columnValue;\nth.colSpan = state.measures.length;\nth.style.padding = '12px';\nth.style.backgroundColor = '#f8f9fa';\nth.style.borderBottom = '2px solid #dee2e6';\nth.style.borderRight = '1px solid #dee2e6';\nth.style.textAlign = 'center';\nth.style.position = 'relative';\nth.style.userSelect = 'none';\n\n    // Important: Set data attributes for drag and drop\n    th.dataset.fieldName = columnFieldName;\n    th.dataset.fieldValue = columnValue;\n    th.dataset.columnIndex = index.toString();\n\n    // Enable dragging\n    th.setAttribute('draggable', 'true');\n    th.style.cursor = 'move';\n    th.className = 'column-header';\n\n    // Add visual feedback for draggable state\n    th.addEventListener('mouseenter', () => {\n      th.style.backgroundColor = '#e3f2fd';\n    });\n\n    th.addEventListener('mouseleave', () => {\n      th.style.backgroundColor = '#f8f9fa';\n    });\n\n    columnHeaderRow.appendChild(th);\n    console.log('Created header for:', columnValue, 'at index:', index);\n\n});\n}\n\nfunction addEnhancedDragStyles() {\nconst existingStyle = document.querySelector('#enhanced-drag-styles');\nif (existingStyle) return;\n\nconst styleEl = document.createElement('style');\nstyleEl.id = 'enhanced-drag-styles';\nstyleEl.innerHTML = `\n.column-header[draggable=\"true\"] {\ntransition: all 0.2s ease;\n}\n\n    .column-header[draggable=\"true\"]:hover {\n      background-color: #e3f2fd !important;\n      border: 2px solid #2196f3 !important;\n      transform: translateY(-2px);\n      box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n    }\n\n    .column-header.dragging {\n      opacity: 0.6;\n      background-color: #ffecb3 !important;\n      border: 2px solid #ff9800 !important;\n      transform: rotate(3deg);\n    }\n\n    .column-header.drag-over {\n      border: 3px dashed #4caf50 !important;\n      background-color: #e8f5e8 !important;\n      animation: pulse 0.5s infinite;\n    }\n\n    @keyframes pulse {\n      0% { transform: scale(1); }\n      50% { transform: scale(1.05); }\n      100% { transform: scale(1); }\n    }\n\n    /* Drag cursor feedback */\n    .column-header[draggable=\"true\"]:active {\n      cursor: grabbing !important;\n    }\n\n`;\ndocument.head.appendChild(styleEl);\n}\n\nfunction setupRowDragAndDrop(rowFieldName) {\n// Prefer attaching drag to the first cell for broader browser support with table rows\nconst rowCells = document.querySelectorAll(\n'tbody td.row-cell[draggable=\"true\"]'\n);\nlet draggedRowValue = null;\n\nif (!pivotEngine) return;\nconst uniqueRowValues = pivotEngine.getOrderedUniqueFieldValues(\nrowFieldName,\ntrue\n);\n\nrowCells.forEach(cell => {\nconst fieldValue = cell.dataset.fieldValue;\nconst row = cell.parentElement;\n\n    cell.addEventListener('dragstart', e => {\n      draggedRowValue = fieldValue;\n      try {\n        e.dataTransfer.setData('text/plain', fieldValue);\n      } catch {}\n      setTimeout(() => row && row.classList.add('dragging'), 0);\n    });\n\n    cell.addEventListener('dragend', () => {\n      if (row) row.classList.remove('dragging');\n      draggedRowValue = null;\n    });\n\n    cell.addEventListener('dragover', e => e.preventDefault());\n    cell.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedRowValue && draggedRowValue !== fieldValue && row) {\n        row.classList.add('drag-over');\n      }\n    });\n    cell.addEventListener(\n      'dragleave',\n      () => row && row.classList.remove('drag-over')\n    );\n    cell.addEventListener('drop', e => {\n      e.preventDefault();\n      if (row) row.classList.remove('drag-over');\n\n      const targetRowValue = fieldValue;\n      const fromIndex = uniqueRowValues.indexOf(draggedRowValue);\n      const toIndex = uniqueRowValues.indexOf(targetRowValue);\n\n      if (fromIndex !== -1 && toIndex !== -1 && fromIndex !== toIndex) {\n        pivotEngine.swapDataRows(fromIndex, toIndex);\n        // Force re-render to reflect new order\n        setTimeout(renderTable, 0);\n      }\n    });\n\n});\n}\n\nfunction getFieldDisplayName(fieldName) {\nreturn fieldName.charAt(0).toUpperCase() + fieldName.slice(1);\n}\n\n// Reset filters\nfunction resetFilters() {\n// Use the engine's built-in method to clear filters\npivotEngine.applyFilters([]);\n\n// Reset filter inputs\nconst filterField = document.getElementById('filterField');\nconst filterOperator = document.getElementById('filterOperator');\nconst filterValue = document.getElementById('filterValue');\n\nif (filterField) filterField.selectedIndex = 0;\nif (filterOperator) filterOperator.selectedIndex = 0;\nif (filterValue) filterValue.value = '';\n}\n\n// Update pagination based on data size\nfunction updatePaginationInfo(viewType = 'Processed Data') {\nconst pageInfo = document.getElementById('pageInfo');\nif (pageInfo) {\npageInfo.textContent = `${viewType} - Page ${paginationState.currentPage} of ${paginationState.totalPages}`;\nconst prevButton = document.getElementById('prevPage');\nconst nextButton = document.getElementById('nextPage');\nif (prevButton) prevButton.disabled = paginationState.currentPage <= 1;\nif (nextButton)\nnextButton.disabled =\npaginationState.currentPage >= paginationState.totalPages;\n}\n}\n\n// Generic updatePagination function\nfunction updatePagination(data, resetPage = false) {\nconst pageSizeElement = document.getElementById('pageSize');\nconst pageSize = pageSizeElement ? Number(pageSizeElement.value) : 10;\nconst totalPages = Math.ceil(data.length / pageSize) || 1;\n\nif (resetPage) {\npaginationState.currentPage = 1;\n} else if (paginationState.currentPage > totalPages) {\npaginationState.currentPage = totalPages;\n}\n\npaginationState.pageSize = pageSize;\npaginationState.totalPages = totalPages;\n}\n\nexport function formatTable(newConfig) {\ntry {\nconst rowFields = (newConfig.rows || []).map(r => r.uniqueName);\nconst columnFields = (newConfig.columns || []).map(c => c.uniqueName);\nconst defaultGroupConfig =\nnewConfig.groupConfig ||\n(rowFields.length && columnFields.length\n? {\nrowFields,\ncolumnFields,\ngrouper: (item, fields) => fields.map(f => item[f]).join('|'),\n}\n: null);\n\n    // Re-initialize engine with new config but same data\n    pivotEngine = new PivotEngine({\n      ...newConfig,\n      groupConfig: defaultGroupConfig || undefined,\n      data: pivotEngine.getState().rawData,\n    });\n    pivotEngine.setPagination({\n      currentPage: 1,\n      pageSize: Number.MAX_SAFE_INTEGER,\n      totalPages: 1,\n    });\n    pivotEngine.setDataHandlingMode(\n      currentViewMode === 'processed' ? 'processed' : 'raw'\n    );\n\n    pivotEngine.subscribe(state => {\n      currentData = state.rawData; // Keep track of current data from engine\n      renderTable();\n    });\n    renderTable(); // Initial render with new format\n\n} catch (error) {\nconsole.error('Error formatting table:', error);\n}\n}\n\n// FIXED: Event Listeners with proper sorting integration\nfunction setupEventListeners() {\nconst switchButton = document.getElementById('switchView');\nif (switchButton) {\nswitchButton.addEventListener('click', () => {\ncurrentViewMode = currentViewMode === 'processed' ? 'raw' : 'processed';\nswitchButton.textContent =\ncurrentViewMode === 'processed'\n? 'Switch to Raw Data'\n: 'Switch to Processed Data';\npaginationState.currentPage = 1;\n\n      if (pivotEngine) {\n        pivotEngine.setDataHandlingMode(\n          currentViewMode === 'processed' ? 'processed' : 'raw'\n        );\n      }\n\n      // Also update pagination info label immediately for better UX\n      updatePaginationInfo(\n        currentViewMode === 'processed' ? 'Processed Data' : 'Raw Data'\n      );\n      renderTable();\n    });\n\n}\n\nconst pageSizeElement = document.getElementById('pageSize');\nif (pageSizeElement) {\npageSizeElement.addEventListener('change', e => {\nconst newPageSize = Number(e.target.value);\nconst currentFirstItem =\n(paginationState.currentPage - 1) \\* paginationState.pageSize;\npaginationState.currentPage =\nMath.floor(currentFirstItem / newPageSize) + 1;\nrenderTable();\n});\n}\n\nconst prevButton = document.getElementById('prevPage');\nif (prevButton) {\nprevButton.addEventListener('click', () => {\nif (paginationState.currentPage > 1) {\npaginationState.currentPage--;\nrenderTable();\n}\n});\n}\n\nconst nextButton = document.getElementById('nextPage');\nif (nextButton) {\nnextButton.addEventListener('click', () => {\nif (paginationState.currentPage < paginationState.totalPages) {\npaginationState.currentPage++;\nrenderTable();\n}\n});\n}\n\nconst applyFilterButton = document.getElementById('applyFilter');\nif (applyFilterButton) {\napplyFilterButton.addEventListener('click', () => {\nconst field = document.getElementById('filterField').value;\nconst operator = document.getElementById('filterOperator').value;\nconst value = document.getElementById('filterValue').value;\n\n      if (!value) {\n        alert('Please enter a filter value');\n        return;\n      }\n\n      // Infer type dynamically from current data for robust filtering after import\n      let parsedValue = value;\n      try {\n        const stateNow = pivotEngine.getState();\n        const dataNow = stateNow?.rawData || [];\n        const sampleVal = (dataNow.find(\n          r => r[field] !== null && r[field] !== undefined\n        ) || {})[field];\n        const isNumberField =\n          typeof sampleVal === 'number' && isFinite(sampleVal);\n        if (\n          isNumberField &&\n          (operator === 'equals' ||\n            operator === 'greaterThan' ||\n            operator === 'lessThan')\n        ) {\n          const numValue = parseFloat(String(value).trim());\n          if (isNaN(numValue)) {\n            alert('Please enter a valid number for ' + field);\n            return;\n          }\n          parsedValue = numValue;\n        }\n      } catch (e) {\n        // If inference fails, fall back to string-based filtering\n        parsedValue = value;\n      }\n\n      const filter = { field, operator, value: parsedValue };\n\n      // Use the engine's built-in filter method\n      pivotEngine.applyFilters([filter]);\n\n      // Reset to first page when applying a new filter\n      paginationState.currentPage = 1;\n    });\n\n}\n\nconst resetFilterButton = document.getElementById('resetFilter');\nif (resetFilterButton) {\nresetFilterButton.addEventListener('click', resetFilters);\n}\n}\n\n// FIXED: Enhanced draggable styles with better sort indicators\nfunction addDraggableStyles() {\nif (document.querySelector('#pivot-table-styles')) return;\n\nconst styleEl = document.createElement('style');\nstyleEl.id = 'pivot-table-styles';\nstyleEl.innerHTML = `\n.dragging { opacity: 0.5; background-color: #f0f0f0; }\n.drag-over { border: 2px dashed #666 !important; background-color: #e9ecef !important; }\nth[draggable=\"true\"], tr[draggable=\"true\"] { cursor: move; }\n.column-header[draggable=\"true\"] { cursor: move; transition: background-color 0.2s; }\n.column-header[draggable=\"true\"]:hover { background-color: #e3f2fd !important; border: 1px solid #2196f3 !important; }\n.column-header.dragging { opacity: 0.6; background-color: #ffecb3 !important; }\n.column-header.drag-over { border: 3px dashed #4caf50 !important; background-color: #e8f5e8 !important; }\n.controls-container { margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px; }\n.filter-container, .pagination-container { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }\n#myTable { overflow-x: auto; width: 100%; }\nbutton { padding: 5px 10px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }\nbutton:disabled { background-color: #cccccc; cursor: not-allowed; }\nselect, input { padding: 5px; border-radius: 4px; border: 1px solid #ddd; }\n.drill-down-cell { cursor: pointer; transition: background-color 0.2s; }\n.drill-down-cell:hover { background-color: #e3f2fd !important; border: 2px solid #2196f3 !important; }\n.drill-down-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; }\n.drill-down-content { background: white; border-radius: 8px; padding: 20px; width: 90%; max-width: 800px; max-height: 80%; overflow: auto; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); }\n.drill-down-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0; }\n.drill-down-title { font-size: 18px; font-weight: bold; color: #333; }\n.drill-down-close { background: #f44336; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }\n.drill-down-table { width: 100%; border-collapse: collapse; margin-top: 10px; }\n.drill-down-table th { background: #f8f9fa; padding: 8px; border: 1px solid #dee2e6; font-weight: bold; text-align: left; }\n.drill-down-table td { padding: 6px 8px; border: 1px solid #dee2e6; }\n\n        /* Enhanced sort icon styles */\n        th span[title*=\"sort\"], th span[title*=\"Sort\"] {\n            transition: all 0.2s ease;\n            display: inline-block;\n            padding: 2px 4px;\n            border-radius: 3px;\n        }\n\n        th span[title*=\"sort\"]:hover, th span[title*=\"Sort\"]:hover {\n            background-color: rgba(0, 123, 255, 0.1);\n            transform: scale(1.1);\n        }\n\n        th[style*=\"cursor: pointer\"]:hover {\n            background-color: #e9ecef !important;\n        }\n\n        /* Visual feedback for sortable headers */\n        th[style*=\"cursor: pointer\"] {\n            position: relative;\n            transition: background-color 0.2s ease;\n        }\n\n        th[style*=\"cursor: pointer\"]::after {\n            content: '';\n            position: absolute;\n            bottom: 0;\n            left: 50%;\n            width: 0;\n            height: 2px;\n            background-color: #007bff;\n            transition: width 0.3s ease;\n            transform: translateX(-50%);\n        }\n\n        th[style*=\"cursor: pointer\"]:hover::after {\n            width: 80%;\n        }\n    `;\n\ndocument.head.appendChild(styleEl);\n}\n\n// Create drill-down modal for any fields\nfunction createDrillDownModal(\nrowValue,\ncolumnValue,\nmeasure,\nrawDetails,\naggregatedValue,\nrowFieldName,\ncolumnFieldName\n) {\nconst existingModal = document.querySelector('.drill-down-modal');\nif (existingModal) existingModal.remove();\n\nconst modal = document.createElement('div');\nmodal.className = 'drill-down-modal';\n\nconst content = document.createElement('div');\ncontent.className = 'drill-down-content';\n\nconst header = document.createElement('div');\nheader.className = 'drill-down-header';\nconst title = document.createElement('div');\ntitle.className = 'drill-down-title';\ntitle.textContent = `Details: ${getFieldDisplayName(rowFieldName)} = ${rowValue}, ${getFieldDisplayName(columnFieldName)} = ${columnValue}`;\nconst closeButton = document.createElement('button');\ncloseButton.className = 'drill-down-close';\ncloseButton.innerHTML = '\xd7';\ncloseButton.addEventListener('click', () => modal.remove());\nheader.appendChild(title);\nheader.appendChild(closeButton);\n\nconst table = document.createElement('table');\ntable.className = 'drill-down-table';\nconst thead = document.createElement('thead');\nconst headerRow = document.createElement('tr');\nconst columns = rawDetails.length > 0 ? Object.keys(rawDetails[0]) : [];\ncolumns.forEach(col => {\nconst th = document.createElement('th');\nth.textContent = getFieldDisplayName(col);\nheaderRow.appendChild(th);\n});\nthead.appendChild(headerRow);\ntable.appendChild(thead);\n\nconst tbody = document.createElement('tbody');\nrawDetails.forEach(row => {\nconst tr = document.createElement('tr');\ncolumns.forEach(col => {\nconst td = document.createElement('td');\ntd.textContent = row[col];\ntr.appendChild(td);\n});\ntbody.appendChild(tr);\n});\ntable.appendChild(tbody);\n\ncontent.appendChild(header);\ncontent.appendChild(table);\nmodal.appendChild(content);\ndocument.body.appendChild(modal);\n\nmodal.addEventListener('click', e => {\nif (e.target === modal) modal.remove();\n});\n}\n\n// Generic getDrillDownData function\nfunction getDrillDownData(\nrowValue,\ncolumnValue,\nmeasure,\nrowFieldName,\ncolumnFieldName\n) {\nif (!pivotEngine) return [];\nconst state = pivotEngine.getState();\nreturn state.rawData.filter(\nitem =>\nitem[rowFieldName] === rowValue && item[columnFieldName] === columnValue\n);\n}\n\n// Generic addDrillDownToDataCell function\nfunction addDrillDownToDataCell(\ntd,\nrowValue,\ncolumnValue,\nmeasure,\nvalue,\nformattedValue,\nrowFieldName,\ncolumnFieldName\n) {\ntd.textContent = formattedValue;\ntd.className = 'drill-down-cell';\ntd.title = `Double-click to see details for ${rowFieldName}: ${rowValue} - ${columnFieldName}: ${columnValue}`;\ntd.addEventListener('dblclick', e => {\ne.preventDefault();\ne.stopPropagation();\nconst rawDetails = getDrillDownData(\nrowValue,\ncolumnValue,\nmeasure,\nrowFieldName,\ncolumnFieldName\n);\nif (rawDetails.length === 0) {\nalert(\n`No detailed data found for ${rowFieldName}: ${rowValue}, ${columnFieldName}: ${columnValue}`\n);\nreturn;\n}\ncreateDrillDownModal(\nrowValue,\ncolumnValue,\nmeasure,\nrawDetails,\nformattedValue,\nrowFieldName,\ncolumnFieldName\n);\n});\n}\n\n// Add HTML for filter and pagination controls\nfunction addControlsHTML() {\nif (document.querySelector('.controls-container')) return;\n\nconst container = document.createElement('div');\ncontainer.className = 'controls-container';\ncontainer.innerHTML = `     <div class=\"filter-container\">\n      <select id=\"filterField\"></select>\n      <select id=\"filterOperator\"></select>\n      <input type=\"text\" id=\"filterValue\" placeholder=\"Filter value\">\n      <button id=\"applyFilter\">Apply Filter</button>\n      <button id=\"resetFilter\">Reset</button>\n      <button id=\"switchView\">Switch to Raw Data</button>\n    </div>\n    <div class=\"pagination-container\">\n      <label>Items per page:</label>\n      <select id=\"pageSize\">\n        <option value=\"1\">1</option>\n        <option value=\"2\">2</option>\n        <option value=\"3\">3</option>\n        <option value=\"4\">4</option>\n        <option value=\"10\" selected>10</option>\n        <option value=\"25\">25</option>\n        <option value=\"50\">50</option>\n      </select>\n      <button id=\"prevPage\">Previous</button>\n      <span id=\"pageInfo\">Processed Data - Page 1 of 1</span>\n      <button id=\"nextPage\">Next</button>\n    </div>\n  `;\nconst myTable = document.getElementById('myTable');\nif (myTable?.parentNode) {\nmyTable.parentNode.insertBefore(container, myTable);\n}\n}\n\n// Set up drag and drop functionality\nfunction setupDragAndDrop() {\nif (!pivotEngine) return;\nconst rowFieldName = pivotEngine.getRowFieldName();\nconst columnFieldName = pivotEngine.getColumnFieldName();\nif (rowFieldName) setupRowDragAndDrop(rowFieldName);\nif (columnFieldName) setupColumnDragAndDropFixed(columnFieldName);\n}\n\n// Add this new function to handle file connections\nexport async function handleFileConnection(fileType) {\ntry {\nlet result;\n\n    // Show loading indicator\n    showLoadingIndicator('Connecting to file...');\n\n    switch (fileType) {\n      case 'CSV':\n\n        result = await ConnectService.connectToLocalCSV(pivotEngine, {\n          dimensions: [],\n          csv: {\n            delimiter: ',',\n            hasHeader: true,\n            skipEmptyLines: true,\n            trimValues: true,\n            dynamicTyping: false,\n          },\n          maxFileSize: 150 * 1024 * 1024, // 50MB\n          onProgress: progress => {\n            updateLoadingProgress(progress);\n          },\n        });\n        break;\n\n      case 'JSON':\n        result = await ConnectService.connectToLocalJSON(pivotEngine, {\n          json: {\n            arrayPath: null, // Will auto-detect\n            validateSchema: true,\n          },\n          maxFileSize: 150 * 1024 * 1024, // 50MB\n          onProgress: progress => {\n            updateLoadingProgress(progress);\n          },\n        });\n        break;\n\n      default:\n        result = await ConnectService.connectToLocalFile(pivotEngine, {\n          maxFileSize: 50 * 1024 * 1024, // 50MB\n          onProgress: progress => {\n            updateLoadingProgress(progress);\n          },\n        });\n    }\n\n    // Hide loading indicator\n    hideLoadingIndicator();\n\n    if (result.success) {\n      // Update current data reference\n      currentData = result.data;\n\n      // Reset pagination and filters\n      paginationState.currentPage = 1;\n      resetFilters();\n\n      // Update the config with new data structure\n      if (result.columns && result.columns.length > 0) {\n        updateConfigFromImportedData(result);\n      }\n\n      // Rebuild filter UI to reflect newly imported fields\n      initializeFilters();\n\n      // Show success notification\n      showImportNotification(result, true);\n\n      // Re-render the table\n      renderTable();\n\n      console.log(\n        'File connection successful:',\n        ConnectService.createImportSummary(result)\n      );\n    } else {\n      console.error('File connection failed:', result.error);\n      showImportNotification(result, false);\n    }\n\n} catch (error) {\nhideLoadingIndicator();\nconsole.error('Error during file connection:', error);\nshowImportNotification(\n{\nsuccess: false,\nerror: error.message || 'Unknown error occurred',\n},\nfalse\n);\n}\n}\n\n// Helper function to update config based on imported data\nfunction updateConfigFromImportedData(result) {\nif (!result.columns || result.columns.length === 0) return;\n\n// Try to intelligently map columns to pivot fields\nconst columns = result.columns;\nconst sampleData = result.data.slice(0, 5); // Look at first 5 rows\n\n// Detect potential measure fields (numeric data)\nconst measureFields = columns.filter(col => {\nconst sampleValues = sampleData\n.map(row => row[col])\n.filter(val => val != null);\nreturn (\nsampleValues.length > 0 &&\nsampleValues.every(val => typeof val === 'number' && !isNaN(val))\n);\n});\n\n// Detect potential dimension fields (text/categorical data only)\n// IMPORTANT: Exclude measure fields to avoid using numeric columns as dimensions\nconst measureSet = new Set(measureFields);\nconst dimensionFields = columns.filter(col => {\nif (measureSet.has(col)) return false; // never treat numeric as a dimension\nconst sampleValues = sampleData\n.map(row => row[col])\n.filter(val => val != null);\nconst uniqueValues = [...new Set(sampleValues)];\n// Consider it a dimension if it has text values OR has limited unique values\nreturn (\nsampleValues.some(val => typeof val === 'string') ||\nuniqueValues.length <= Math.max(10, sampleData.length \\* 0.5)\n);\n});\n\n// Respect engine's synthesized single column axis when appropriate\nconst engineHasAllColumn =\npivotEngine &&\npivotEngine.getColumnFieldName &&\npivotEngine.getColumnFieldName() === '**all**';\n\n// Auto-configure pivot table if we have good candidates\nif (dimensionFields.length >= 1 && measureFields.length >= 1) {\nconst newConfig = {\n...config,\nrows: dimensionFields.slice(0, 1).map(field => ({\nuniqueName: field,\ncaption: field,\n})),\n// If we only found a single dimension or engine already decided on '**all**',\n// keep a single synthesized column axis\ncolumns:\nengineHasAllColumn || dimensionFields.length < 2\n? [{ uniqueName: '__all__', caption: 'All' }]\n: dimensionFields.slice(1, 2).map(field => ({\nuniqueName: field,\ncaption: field,\n})),\nmeasures: measureFields.slice(0, 3).map(field => ({\nuniqueName: field,\ncaption: field,\naggregation: 'sum',\n})),\n};\n\n    // Apply the new configuration\n    formatTable(newConfig);\n\n    console.log('Auto-configured pivot table:', {\n      rows: newConfig.rows,\n      columns: newConfig.columns,\n      measures: newConfig.measures,\n    });\n\n}\n}\n\n// Loading indicator functions\nfunction showLoadingIndicator(message = 'Loading...') {\nlet loader = document.getElementById('file-loader');\n\nif (!loader) {\nloader = document.createElement('div');\nloader.id = 'file-loader';\nloader.style.cssText = `       position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      background: white;\n      padding: 30px;\n      border-radius: 10px;\n      box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n      z-index: 10000;\n      text-align: center;\n      min-width: 300px;\n    `;\n\n    loader.innerHTML = `\n      <div style=\"margin-bottom: 20px; font-size: 16px; font-weight: bold;\">\n        ${message}\n      </div>\n      <div style=\"background: #f0f0f0; height: 20px; border-radius: 10px; overflow: hidden;\">\n        <div id=\"progress-bar\" style=\"background: #4CAF50; height: 100%; width: 0%; transition: width 0.3s;\"></div>\n      </div>\n      <div id=\"progress-text\" style=\"margin-top: 10px; font-size: 14px; color: #666;\">\n        0%\n      </div>\n    `;\n\n    // Add backdrop\n    const backdrop = document.createElement('div');\n    backdrop.id = 'loader-backdrop';\n    backdrop.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0,0,0,0.5);\n      z-index: 9999;\n    `;\n\n    document.body.appendChild(backdrop);\n    document.body.appendChild(loader);\n\n}\n}\n\nfunction updateLoadingProgress(progress) {\nconst progressBar = document.getElementById('progress-bar');\nconst progressText = document.getElementById('progress-text');\n\nif (progressBar) {\nprogressBar.style.width = `${progress}%`;\n}\nif (progressText) {\nprogressText.textContent = `${Math.round(progress)}%`;\n}\n}\n\nfunction hideLoadingIndicator() {\nconst loader = document.getElementById('file-loader');\nconst backdrop = document.getElementById('loader-backdrop');\n\nif (loader) loader.remove();\nif (backdrop) backdrop.remove();\n}\n\n// Enhanced notification system\nfunction showImportNotification(result, isSuccess) {\nconst notification = document.createElement('div');\nnotification.style.cssText = `     position: fixed;\n    top: 20px;\n    right: 20px;\n    max-width: 400px;\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n    z-index: 10001;\n    font-family: Arial, sans-serif;\n    ${\n      isSuccess\n        ? 'background: #d4edda; border-left: 4px solid #28a745; color: #155724;'\n        : 'background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24;'\n    }\n  `;\n\nconst title = document.createElement('div');\ntitle.style.cssText =\n'font-weight: bold; margin-bottom: 10px; font-size: 16px;';\ntitle.textContent = isSuccess ? '\u2705 Import Successful' : '\u274c Import Failed';\n\nconst content = document.createElement('div');\ncontent.style.cssText = 'font-size: 14px; line-height: 1.4;';\n\nif (isSuccess) {\ncontent.innerHTML = `      <div><strong>File:</strong> ${result.fileName}</div>\n      <div><strong>Records:</strong> ${result.recordCount?.toLocaleString()}</div>\n      <div><strong>Size:</strong> ${formatFileSize(result.fileSize)}</div>\n      ${result.columns ?`<div><strong>Columns:</strong> ${result.columns.length}</div>` : ''}\n      ${\n        result.validationErrors?.length\n          ? `<div style=\"margin-top: 10px; color: #856404;\"><strong>Warnings:</strong><br>${result.validationErrors.map(w => `\u2022 ${w}`).join('<br>')}</div>`           : ''\n      }\n    `;\n} else {\ncontent.textContent = result.error || 'Unknown error occurred';\n}\n\nconst closeBtn = document.createElement('button');\ncloseBtn.textContent = '\xd7';\ncloseBtn.style.cssText = `     position: absolute;\n    top: 10px;\n    right: 10px;\n    background: none;\n    border: none;\n    font-size: 18px;\n    cursor: pointer;\n    width: 24px;\n    height: 24px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 12px;\n    opacity: 0.7;\n  `;\n\ncloseBtn.addEventListener('click', () => notification.remove());\n\nnotification.appendChild(title);\nnotification.appendChild(content);\nnotification.appendChild(closeBtn);\ndocument.body.appendChild(notification);\n\n// Auto-remove after 8 seconds for success, 12 seconds for error\nsetTimeout(\n() => {\nif (notification.parentNode) {\nnotification.remove();\n}\n},\nisSuccess ? 8000 : 12000\n);\n}\n\nfunction formatFileSize(bytes) {\nif (!bytes) return '0 Bytes';\nconst k = 1024;\nconst sizes = ['Bytes', 'KB', 'MB', 'GB'];\nconst i = Math.floor(Math.log(bytes) / Math.log(k));\nreturn parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\nexport function onSectionItemDrop(droppedFields) {\n// droppedFields.rows: Set<string>\n// droppedFields.columns: Set<string>\n// droppedFields.values: Map<string, AggregationType>\nconst selection = {\nrows: Array.from(droppedFields.rows || []),\ncolumns: Array.from(droppedFields.columns || []),\nvalues: Array.from(droppedFields.values || new Map()).map(\n([field, aggregation]) => ({ field, aggregation })\n),\n};\n\nconst layout = FieldService.buildLayout(selection);\n\nif (pivotEngine) {\nconst newConfig = {\n...config,\nrows: layout.rows,\ncolumns: layout.columns,\nmeasures: layout.measures,\n};\nformatTable(newConfig);\n}\n}\n\n// FIXED: Initialize everything when the DOM is loaded\ndocument.addEventListener('DOMContentLoaded', () => {\ntry {\nif (!sampleData || !Array.isArray(sampleData) || sampleData.length === 0) {\nconsole.error('Sample data is not available or empty');\nconst tableContainer = document.getElementById('myTable');\nif (tableContainer) {\ntableContainer.innerHTML =\n'<div style=\"color: red; padding: 20px;\">Error: Sample data not available.</div>';\n}\nreturn;\n}\n\n    const rowFields = (config.rows || []).map(r => r.uniqueName);\n    const columnFields = (config.columns || []).map(c => c.uniqueName);\n    const defaultGroupConfig =\n      config.groupConfig ||\n      (rowFields.length && columnFields.length\n        ? {\n            rowFields,\n            columnFields,\n            // Join row + column values with '|', same as web-component\n            grouper: (item, fields) => fields.map(f => item[f]).join('|'),\n          }\n        : null);\n\n    // Create a single PivotEngine instance\n    pivotEngine = new PivotEngine({\n      ...config,\n      groupConfig: defaultGroupConfig || undefined,\n\n      data: sampleData, // Initialize with the full dataset\n    });\n\n    pivotEngine.setPagination({\n      currentPage: 1,\n      pageSize: Number.MAX_SAFE_INTEGER,\n      totalPages: 1,\n    });\n    // Ensure processed mode on load\n    pivotEngine.setDataHandlingMode('processed');\n\n    // FIXED: Subscribe to state changes to re-render the UI automatically with proper sorting\n    pivotEngine.subscribe(state => {\n      console.log('PivotEngine state changed:', {\n        sortConfig: state.sortConfig,\n        dataHandlingMode: state.dataHandlingMode,\n        processedDataLength: state.processedData?.rows?.length || 0,\n      });\n\n      // The engine's state reflects the latest data after any operation (filtering, sorting, etc.)\n      currentData = state.rawData; // Keep track of the engine's current data view\n      renderTable();\n    });\n\n    // Initialize header if configured\n    if (config.toolbar && typeof createHeader === 'function') {\n      createHeader(config);\n    }\n\n    // Add UI elements\n    addDraggableStyles();\n    addControlsHTML();\n    initializeFilters();\n    setupEventListeners();\n\n    addEnhancedDragStyles();\n\n    // Initial render\n    renderTable();\n\n    console.log(\n      'Initialization completed successfully with sorting functionality'\n    );\n\n} catch (error) {\nconsole.error('Error during initialization:', error);\nconst tableContainer = document.getElementById('myTable');\nif (tableContainer) {\ntableContainer.innerHTML = `<div style=\"color: red; padding: 20px;\">Error during initialization: ${error.message}</div>`;\n}\n}\n});\n\nwindow.debugPivotState = function () {\nconst state = pivotEngine.getState();\nconsole.log('Sort config:', state.sortConfig);\nconsole.log('Groups count:', state.groups.length);\nconsole.log('Data handling mode:', state.dataHandlingMode);\n};\n\n"})})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"config/config.js:"}),"\nThis file defines the configuration for the pivot table's rows, columns, and measures."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'\nexport default {\n    "rows": [\n        { "uniqueName": "Country" }\n    ],\n    "columns": [\n        { "uniqueName": "Category" }\n    ],\n    "measures": [\n        { "uniqueName": "Price", "aggregation": "sum" },\n        { "uniqueName": "Quantity", "aggregation": "sum" }\n    ],\n    "options": {\n        "grid": {\n            "type": "classic",\n            "showTotals": true,\n            "showGrandTotals": "on"\n        }\n    }\n};\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"data/raw_data.json :"})}),"\n",(0,a.jsx)(n.p,{children:"This is the sample data that will be loaded into the pivot table."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-JSON",children:'\n[\n    {\n        "Category": "Accessories",\n        "Country": "USA",\n        "Price": 100,\n        "Quantity": 5\n    },\n    {\n        "Category": "Bikes",\n        "Country": "Canada",\n        "Price": 1200,\n        "Quantity": 2\n    },\n    {\n        "Category": "Clothing",\n        "Country": "USA",\n        "Price": 50,\n        "Quantity": 10\n    },\n    {\n        "Category": "Accessories",\n        "Country": "Canada",\n        "Price": 80,\n        "Quantity": 8\n    },\n    {\n        "Category": "Bikes",\n        "Country": "USA",\n        "Price": 1500,\n        "Quantity": 1\n    }\n]\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"3. How to Run the Demo :"}),"\nInstall Dependencies: Open your terminal in the sample-project directory and run:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\nnpm install\n"})}),"\n",(0,a.jsx)(n.p,{children:"Start the Server: Once the installation is complete, start the local development server:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\nnpm start\n"})}),"\n",(0,a.jsx)(n.p,{children:"View in Browser: Open your web browser and navigate to the URL provided by http-server."}),"\n",(0,a.jsx)(n.p,{children:"You should now see a functional pivot table rendered on the page."})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>i});var o=t(6540);const a={},r=o.createContext(a);function l(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);