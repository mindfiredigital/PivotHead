<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/core-webcomponent/core-webcomponent-sample-project" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">sample-project | PivotHead</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://mindfiredigital.github.io/PivotHead/img/pivothead.webp"><meta data-rh="true" name="twitter:image" content="https://mindfiredigital.github.io/PivotHead/img/pivothead.webp"><meta data-rh="true" property="og:url" content="https://mindfiredigital.github.io/PivotHead/docs/tutorials/core-webcomponent/core-webcomponent-sample-project"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="sample-project | PivotHead"><meta data-rh="true" name="description" content="Sample Project:"><meta data-rh="true" property="og:description" content="Sample Project:"><link data-rh="true" rel="icon" href="/PivotHead/img/logo.png"><link data-rh="true" rel="canonical" href="https://mindfiredigital.github.io/PivotHead/docs/tutorials/core-webcomponent/core-webcomponent-sample-project"><link data-rh="true" rel="alternate" href="https://mindfiredigital.github.io/PivotHead/docs/tutorials/core-webcomponent/core-webcomponent-sample-project" hreflang="en"><link data-rh="true" rel="alternate" href="https://mindfiredigital.github.io/PivotHead/docs/tutorials/core-webcomponent/core-webcomponent-sample-project" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Sample Project","item":"https://mindfiredigital.github.io/PivotHead/docs/tutorials/core-webcomponent/core-webcomponent-sample-project"}]}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@0.5.21/dist/vanta.net.min.js"></script><link rel="stylesheet" href="/PivotHead/assets/css/styles.5aee789f.css">
<script src="/PivotHead/assets/js/runtime~main.d0d1d51c.js" defer="defer"></script>
<script src="/PivotHead/assets/js/main.f8c2bae7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/PivotHead/img/logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/PivotHead/"><div class="navbar__logo"><img src="/PivotHead/img/logo.png" alt="PivotHead Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/PivotHead/img/logo.png" alt="PivotHead Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">PivotHead</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/PivotHead/docs/introduction">Documentation</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://www.npmjs.com/package/@mindfiredigital/pivothead" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">
              <a href="https://www.npmjs.com/package/@mindfiredigital/pivothead" style="display: flex; align-items: center;">
                <img src="https://img.shields.io/npm/v/@mindfiredigital/pivothead.svg" alt="npm version" style="vertical-align: middle; margin-right: 5px;">
                <img src="https://img.shields.io/npm/dt/@mindfiredigital/pivothead.svg" alt="total downloads" style="vertical-align: middle;">
              </a>
            </a><a href="https://github.com/mindfiredigital/PivotHead" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PivotHead/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PivotHead/docs/headless-architecture">Headless Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PivotHead/docs/getting-started/headless-quick-start">Headless Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PivotHead/docs/getting-started/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PivotHead/docs/getting-started/basic-setup">Basic Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PivotHead/docs/getting-started/Why-we-use-pivothead">Why Use PivotHead</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/PivotHead/docs/tutorials/core-webcomponent/core-webcomponent-sample-project">Tutorial</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/PivotHead/docs/tutorials/core-webcomponent/core-webcomponent-sample-project">Core Webcomponent</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/PivotHead/docs/tutorials/core-webcomponent/core-webcomponent-sample-project">Sample Project</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/PivotHead/docs/tutorials/core-webcomponent/setup-for-user-project">setup-for-user-project</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/PivotHead/docs/tutorials/react/react-sample-project">React</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/PivotHead/docs/tutorials/vue/vue-sample-project">Vue</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/PivotHead/docs/reference/conceptual-reference/core-webcomponent-conceptual-reference">Reference</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PivotHead/docs/tutorial-basics/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/PivotHead/docs/contributors/">Contribution Guide</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/PivotHead/docs/upcoming/">Upcoming Features</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/PivotHead/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorial</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Core Webcomponent</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Sample Project</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>sample-project</h1></header><p><strong>Sample Project:</strong>
Basic Pivot Table (Runnable Demo)
This guide provides the full code for a sample project that demonstrates how to use the core-webcomponent to create a basic pivot table. You can create the following files and copy the code to run the demo on your local machine.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="project-structure">Project Structure<a href="#project-structure" class="hash-link" aria-label="Direct link to Project Structure" title="Direct link to Project Structure">​</a></h2>
<p>The sample project has the following structure:
sample-project/</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sample-project/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── app.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── style.css</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── config/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── config.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── data/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── raw_data.json</span><br></span></code></pre></div></div>
<p><strong>2. File Content</strong>
Next, add the following code to the corresponding files.</p>
<p><strong>package.json</strong>
This file includes the necessary dependencies and a script to run a simple local server.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;sample-project&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;description&quot;: &quot;A sample project for the core-webcomponent pivot table.&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;main&quot;: &quot;app.js&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;scripts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;start&quot;: &quot;http-server .&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;dependencies&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;core-webcomponent&quot;: &quot;latest&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;devDependencies&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;http-server&quot;: &quot;^14.1.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>index.html:</strong> This is the main entry point of your application.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!DOCTYPE html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;html lang=&quot;en&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;title&gt;Pivot Table Demo&lt;/title&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;h1&gt;Core Webcomponent Pivot Table&lt;/h1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;pivot-head</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data-url=&quot;data/raw_data.json&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        options-url=&quot;config/config.js&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/pivot-head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;script type=&quot;module&quot; src=&quot;app.js&quot;&gt;&lt;/script&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/html&gt;</span><br></span></code></pre></div></div>
<p><strong>style.css:</strong> Basic styling for the pivot table.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">body {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    font-family: sans-serif;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    margin: 2em;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pivot-head {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display: block;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    width: 100%;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    height: 500px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    border: 1px solid #ccc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>app.js:</strong> The main JavaScript file that initializes the pivot table and handles events.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Click to view the app.js example</summary><div><div class="collapsibleContent_i85q"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/\* PivotHead Demo - Fixed Sorting Implementation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- This file demonstrates the usage of the PivotheadCore library to create an interactive pivot table.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Features include:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- - Sorting (FIXED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- - Grouping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- - Column resizing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- - Column reordering (drag and drop)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- - Row reordering (drag and drop)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    \*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Import statements - Make sure these paths are correct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { createHeader } from &#x27;./header/header.js&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { PivotEngine } from &#x27;@mindfiredigital/pivothead&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { sampleData, config } from &#x27;./config/config.js&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { ConnectService } from &#x27;../../packages/core/src/engine/connectService.ts&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { FieldService } from &#x27;../../packages/core/src/engine/fieldService.ts&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create a single instance of PivotEngine that will be used throughout the app&#x27;s lifecycle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export let pivotEngine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Store the current full dataset being used (can be original or filtered)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let currentData = [...sampleData];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let showProcessedData = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let currentViewMode = &#x27;processed&#x27;; // &#x27;raw&#x27; or &#x27;processed&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Manage pagination state locally</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let paginationState = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentPage: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pageSize: 10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">totalPages: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Initialize filter fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function initializeFilters() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const filterField = document.getElementById(&#x27;filterField&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!filterField) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;Filter field element not found&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Build field list dynamically from current engine data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let fields = [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (pivotEngine) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const stateNow = pivotEngine.getState();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const sample = (stateNow.rawData &amp;&amp; stateNow.rawData[0]) || null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (sample) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fields = Object.keys(sample).filter(k =&gt; k !== &#x27;**all**&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} catch (e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.warn(&#x27;Unable to infer fields for filters from engine:&#x27;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Fallback to defaults if no fields were detected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!fields || fields.length === 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fields = [&#x27;country&#x27;, &#x27;category&#x27;, &#x27;price&#x27;, &#x27;discount&#x27;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filterField.innerHTML = fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.map(f =&gt; `&lt;option value=&quot;${f}&quot;&gt;${getFieldDisplayName(f)}&lt;/option&gt;`)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.join(&#x27;&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const filterOperator = document.getElementById(&#x27;filterOperator&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!filterOperator) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;Filter operator element not found&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filterOperator.innerHTML = `     &lt;option value=&quot;equals&quot;&gt;Equals&lt;/option&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;option value=&quot;contains&quot;&gt;Contains&lt;/option&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;option value=&quot;greaterThan&quot;&gt;Greater Than&lt;/option&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;option value=&quot;lessThan&quot;&gt;Less Than&lt;/option&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get paginated data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function getPaginatedData(data, paginationState) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!data || !Array.isArray(data)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.warn(&#x27;Invalid data provided to getPaginatedData&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const start = (paginationState.currentPage - 1) \* paginationState.pageSize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const end = start + paginationState.pageSize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return data.slice(start, end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// FIXED: Helper function to create sort icons with proper state tracking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function createSortIcon(field, currentSortConfig) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const sortIcon = document.createElement(&#x27;span&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.marginLeft = &#x27;5px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.display = &#x27;inline-block&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.cursor = &#x27;pointer&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.fontSize = &#x27;12px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.userSelect = &#x27;none&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Check if this field is currently being sorted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const isCurrentlySorted =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentSortConfig &amp;&amp; currentSortConfig.field === field;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (isCurrentlySorted) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (currentSortConfig.direction === &#x27;asc&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.innerHTML = &#x27;▲&#x27;; // Up triangle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.title = `Sorted by ${field} ascending - click to sort descending`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.color = &#x27;#007bff&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.innerHTML = &#x27;▼&#x27;; // Down triangle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.title = `Sorted by ${field} descending - click to sort ascending`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.color = &#x27;#007bff&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.innerHTML = &#x27;↕&#x27;; // Up/down arrow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.title = `Click to sort by ${field}`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.color = &#x27;#6c757d&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.opacity = &#x27;0.7&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Add hover effect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.addEventListener(&#x27;mouseenter&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!isCurrentlySorted) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.opacity = &#x27;1&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.color = &#x27;#007bff&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.addEventListener(&#x27;mouseleave&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!isCurrentlySorted) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.opacity = &#x27;0.7&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortIcon.style.color = &#x27;#6c757d&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return sortIcon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function sortRawDataByColumn(columnName, rawData) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(`Sorting raw data by column: ${columnName}`);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get current sort state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const currentSort = window.rawDataSort || {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const direction =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentSort.column === columnName &amp;&amp; currentSort.direction === &#x27;asc&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? &#x27;desc&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &#x27;asc&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Sort the data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rawData.sort((a, b) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let aVal = a[columnName];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let bVal = b[columnName];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Handle different data types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (typeof aVal === &#x27;string&#x27;) aVal = aVal.toLowerCase();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (typeof bVal === &#x27;string&#x27;) bVal = bVal.toLowerCase();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (aVal &lt; bVal) return direction === &#x27;asc&#x27; ? -1 : 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (aVal &gt; bVal) return direction === &#x27;asc&#x27; ? 1 : -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Store sort state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">window.rawDataSort = { column: columnName, direction };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Update the global data array to maintain sort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentData = [...rawData];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(`Sorted raw data by ${columnName} (${direction})`);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">renderRawDataTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function swapRawDataRows(fromIndex, toIndex, rawData) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Swapping raw data rows:&#x27;, fromIndex, &#x27;-&gt;&#x27;, toIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fromIndex &lt; 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">toIndex &lt; 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fromIndex &gt;= rawData.length ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">toIndex &gt;= rawData.length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;Invalid row indices for raw data swap&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Swap the rows in the raw data array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const temp = rawData[fromIndex];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rawData[fromIndex] = rawData[toIndex];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rawData[toIndex] = temp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentData = [...rawData];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Raw data rows swapped successfully&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function swapRawDataColumns(fromIndex, toIndex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Swapping raw data columns:&#x27;, fromIndex, &#x27;-&gt;&#x27;, toIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (currentData.length === 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;No raw data available for column swap&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get current column order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const headers = Object.keys(currentData[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fromIndex &lt; 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">toIndex &lt; 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fromIndex &gt;= headers.length ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">toIndex &gt;= headers.length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;Invalid column indices for raw data swap:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fromIndex,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">toIndex,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;Available columns:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">headers.length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Initialize or update the column order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!window.rawDataColumnOrder) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">window.rawDataColumnOrder = [...headers];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Swap in the column order array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const temp = window.rawDataColumnOrder[fromIndex];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">window.rawDataColumnOrder[fromIndex] = window.rawDataColumnOrder[toIndex];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">window.rawDataColumnOrder[toIndex] = temp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Raw data column order updated:&#x27;, window.rawDataColumnOrder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Important: Re-render the table to show the new column order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">renderRawDataTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// FIXED: Raw data table rendering with proper sort icons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function renderRawDataTable() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Rendering raw data table&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const rawDataToUse = pivotEngine.getState().rawData;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!rawDataToUse || rawDataToUse.length === 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.error(&#x27;No raw data available&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const tableContainer = document.getElementById(&#x27;myTable&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (tableContainer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tableContainer.innerHTML =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &#x27;&lt;div style=&quot;padding: 20px;&quot;&gt;No data available to display.&lt;/div&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.log(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;Rendering raw data table with&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rawDataToUse.length,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;total items&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const tableContainer = document.getElementById(&#x27;myTable&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!tableContainer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.error(&#x27;Table container not found&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tableContainer.innerHTML = &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const table = document.createElement(&#x27;table&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.style.width = &#x27;100%&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.style.borderCollapse = &#x27;collapse&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.style.marginTop = &#x27;20px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.style.border = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Get headers - use custom order if available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let headers;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (window.rawDataColumnOrder &amp;&amp; window.rawDataColumnOrder.length &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      headers = window.rawDataColumnOrder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      headers = rawDataToUse.length &gt; 0 ? Object.keys(rawDataToUse[0]) : [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Create table header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const thead = document.createElement(&#x27;thead&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const headerRow = document.createElement(&#x27;tr&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Get current sort state for raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const currentSort = window.rawDataSort || {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    headers.forEach((headerText, index) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const th = document.createElement(&#x27;th&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.padding = &#x27;12px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.backgroundColor = &#x27;#f8f9fa&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.borderBottom = &#x27;2px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.borderRight = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.cursor = &#x27;pointer&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.position = &#x27;relative&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.userSelect = &#x27;none&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.setAttribute(&#x27;draggable&#x27;, &#x27;true&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.dataset.columnIndex = index;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.dataset.columnName = headerText;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.className = &#x27;raw-data-header&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const headerContent = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      headerContent.style.display = &#x27;flex&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      headerContent.style.alignItems = &#x27;center&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      headerContent.style.justifyContent = &#x27;space-between&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const headerSpan = document.createElement(&#x27;span&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      headerSpan.textContent = getFieldDisplayName(headerText);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      headerContent.appendChild(headerSpan);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // FIXED: Use the proper sort icon function with current state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const sortIcon = createSortIcon(headerText, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        field: currentSort.column,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        direction: currentSort.direction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      headerContent.appendChild(sortIcon);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.appendChild(headerContent);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // FIXED: Click handler for sorting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.addEventListener(&#x27;click&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Prevent drag when clicking on sort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        e.stopPropagation();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sortRawDataByColumn(headerText, rawDataToUse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      headerRow.appendChild(th);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    thead.appendChild(headerRow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.appendChild(thead);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Update pagination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    updateRawDataPagination(rawDataToUse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Get paginated data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const paginatedData = getPaginatedData(rawDataToUse, paginationState);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Create table body - use the custom header order for cells too</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const tbody = document.createElement(&#x27;tbody&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    paginatedData.forEach((rowData, rowIndex) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const tr = document.createElement(&#x27;tr&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tr.dataset.rowIndex = rowIndex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tr.dataset.globalIndex = rawDataToUse.indexOf(rowData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tr.setAttribute(&#x27;draggable&#x27;, &#x27;true&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tr.style.cursor = &#x27;move&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tr.className = &#x27;raw-data-row&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Use the headers array (which respects custom order) for cell creation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      headers.forEach(header =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const td = document.createElement(&#x27;td&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        td.style.padding = &#x27;8px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        td.style.borderBottom = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        td.style.borderRight = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let cellValue = rowData[header];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (cellValue === null || cellValue === undefined) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cellValue = &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (typeof cellValue === &#x27;number&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          if (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            header === &#x27;price&#x27; ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            header === &#x27;sales&#x27; ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            header === &#x27;revenue&#x27; ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            header === &#x27;discount&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cellValue = new Intl.NumberFormat(&#x27;en-US&#x27;, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              style: &#x27;currency&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              currency: &#x27;USD&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }).format(cellValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          } else if (typeof cellValue === &#x27;number&#x27; &amp;&amp; cellValue % 1 !== 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cellValue = cellValue.toFixed(2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        td.textContent = cellValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tr.appendChild(td);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tbody.appendChild(tr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.appendChild(tbody);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tableContainer.appendChild(table);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Update pagination info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    updatePaginationInfo(&#x27;Raw Data&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Set up drag and drop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setupRawDataDragAndDrop(rawDataToUse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} catch (error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;Error rendering raw data table:&#x27;, error);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const tableContainer = document.getElementById(&#x27;myTable&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (tableContainer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tableContainer.innerHTML = `&lt;div style=&quot;color: red; padding: 20px;&quot;&gt;Error rendering raw data table: ${error.message}&lt;/div&gt;`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function updateRawDataPagination(rawData) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!rawData || !Array.isArray(rawData)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.warn(&#x27;Invalid raw data for pagination&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Get pageSize from the select element, with fallback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const pageSizeElement = document.getElementById(&#x27;pageSize&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const pageSize = pageSizeElement ? Number(pageSizeElement.value) : 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const totalPages = Math.ceil(rawData.length / pageSize) || 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Check if current page is valid for new pagination</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (paginationState.currentPage &gt; totalPages) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.currentPage = Math.max(1, totalPages);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.pageSize = pageSize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.totalPages = totalPages;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Generic function to get ordered column values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function getOrderedColumnValues() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!pivotEngine) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.warn(&#x27;PivotEngine not initialized&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const state = pivotEngine.getState();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const columnFieldName = pivotEngine.getColumnFieldName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!columnFieldName) return [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Prefer engine-provided custom order if available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const customOrdered =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pivotEngine.getOrderedColumnValues &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pivotEngine.getOrderedColumnValues();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (Array.isArray(customOrdered) &amp;&amp; customOrdered.length &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return customOrdered;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} catch (error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.warn(&#x27;Could not get ordered column values from engine:&#x27;, error);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Fallback: compute unique values from current filtered data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const filteredRawData = state.rawData || [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const uniqueColumnValues = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...new Set(filteredRawData.map(item =&gt; item[columnFieldName])),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return uniqueColumnValues;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Generic function to get ordered row values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function getOrderedRowValues() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!pivotEngine) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.warn(&#x27;PivotEngine not initialized&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const state = pivotEngine.getState();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const rowFieldName = pivotEngine.getRowFieldName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!rowFieldName) return [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Prefer engine-provided custom order if available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const customOrdered =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pivotEngine.getOrderedRowValues &amp;&amp; pivotEngine.getOrderedRowValues();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (Array.isArray(customOrdered) &amp;&amp; customOrdered.length &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return customOrdered;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} catch (error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.warn(&#x27;Could not get ordered row values from engine:&#x27;, error);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Fallback: compute unique values from current filtered data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const filteredRawData = state.rawData || [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const uniqueRowValues = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...new Set(filteredRawData.map(item =&gt; item[rowFieldName])),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return uniqueRowValues;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function getSortedRowValuesByMeasure(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const state = pivotEngine.getState();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const uniqueRowValues = pivotEngine.getUniqueFieldValues(rowFieldName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const uniqueColumnValues = pivotEngine.getUniqueFieldValues(columnFieldName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;Sorting rows by measure:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortConfig.field,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;direction:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sortConfig.direction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Find the measure configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const measure = state.measures.find(m =&gt; m.uniqueName === sortConfig.field);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!measure) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;Measure not found:&#x27;, sortConfig.field);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return uniqueRowValues;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Calculate total aggregated value for each row across all columns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const rowTotals = uniqueRowValues.map(rowValue =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let total = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Sum the measure values across all columns for this row</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uniqueColumnValues.forEach(columnValue =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const cellValue = pivotEngine.calculateCellValue(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rowValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        columnValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        measure,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rowFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        columnFieldName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      total += cellValue || 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rowValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      total,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Row totals before sorting:&#x27;, rowTotals.slice(0, 3));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Sort by total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowTotals.sort((a, b) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const result = a.total - b.total;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return sortConfig.direction === &#x27;asc&#x27; ? result : -result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Row totals after sorting:&#x27;, rowTotals.slice(0, 3));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Return just the sorted row values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return rowTotals.map(item =&gt; item.rowValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function setupRawDataDragAndDrop(rawData) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;Setting up raw data drag and drop with&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rawData.length,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;items&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Column drag and drop for raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const headers = document.querySelectorAll(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;.raw-data-header[draggable=&quot;true&quot;]&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let draggedColumnIndex = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">headers.forEach(header =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const columnIndex = parseInt(header.dataset.columnIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const columnName = header.dataset.columnName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;dragstart&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      draggedColumnIndex = columnIndex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.dataTransfer.setData(&#x27;text/plain&#x27;, columnName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      setTimeout(() =&gt; header.classList.add(&#x27;dragging&#x27;), 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;dragend&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      header.classList.remove(&#x27;dragging&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      draggedColumnIndex = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;dragover&#x27;, e =&gt; e.preventDefault());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;dragenter&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.preventDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (draggedColumnIndex !== null &amp;&amp; draggedColumnIndex !== columnIndex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header.classList.add(&#x27;drag-over&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;dragleave&#x27;, () =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      header.classList.remove(&#x27;drag-over&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;drop&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.preventDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      header.classList.remove(&#x27;drag-over&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const targetColumnIndex = columnIndex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        draggedColumnIndex !== null &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        draggedColumnIndex !== targetColumnIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        swapRawDataColumns(draggedColumnIndex, targetColumnIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        renderRawDataTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Row drag and drop for raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const rows = document.querySelectorAll(&#x27;.raw-data-row[draggable=&quot;true&quot;]&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let draggedRowIndex = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rows.forEach(row =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const rowIndex = parseInt(row.dataset.rowIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const globalIndex = parseInt(row.dataset.globalIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    row.addEventListener(&#x27;dragstart&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      draggedRowIndex = globalIndex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.dataTransfer.setData(&#x27;text/plain&#x27;, rowIndex.toString());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      setTimeout(() =&gt; row.classList.add(&#x27;dragging&#x27;), 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    row.addEventListener(&#x27;dragend&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      row.classList.remove(&#x27;dragging&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      draggedRowIndex = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    row.addEventListener(&#x27;dragover&#x27;, e =&gt; e.preventDefault());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    row.addEventListener(&#x27;dragenter&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.preventDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (draggedRowIndex !== null &amp;&amp; draggedRowIndex !== globalIndex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        row.classList.add(&#x27;drag-over&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    row.addEventListener(&#x27;dragleave&#x27;, () =&gt; row.classList.remove(&#x27;drag-over&#x27;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    row.addEventListener(&#x27;drop&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.preventDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      row.classList.remove(&#x27;drag-over&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const targetRowIndex = globalIndex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (draggedRowIndex !== null &amp;&amp; draggedRowIndex !== targetRowIndex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        swapRawDataRows(draggedRowIndex, targetRowIndex, rawData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        renderRawDataTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// FIXED: Main table rendering function with proper pivot engine sorting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function renderTable() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Check current view mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (currentViewMode === &#x27;raw&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Rendering raw data view&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">renderRawDataTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!pivotEngine) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;PivotEngine not initialized&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const state = pivotEngine.getState();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Current Engine State:&#x27;, state);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!state.processedData) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.error(&#x27;No processed data available&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Get field names from configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const rowFieldName = pivotEngine.getRowFieldName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const columnFieldName = pivotEngine.getColumnFieldName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!rowFieldName || !columnFieldName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.error(&#x27;Row or column field not configured&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const tableContainer = document.getElementById(&#x27;myTable&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!tableContainer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.error(&#x27;Table container not found&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Clear previous content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tableContainer.innerHTML = &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Create table element</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const table = document.createElement(&#x27;table&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.style.width = &#x27;100%&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.style.borderCollapse = &#x27;collapse&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.style.marginTop = &#x27;20px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.style.border = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Create table header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const thead = document.createElement(&#x27;thead&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const columnHeaderRow = document.createElement(&#x27;tr&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Add empty cell for top-left corner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const cornerCell = document.createElement(&#x27;th&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cornerCell.style.padding = &#x27;12px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cornerCell.style.backgroundColor = &#x27;#f8f9fa&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cornerCell.style.borderBottom = &#x27;2px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cornerCell.style.borderRight = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Hide the column axis label when using synthesized &#x27;__all__&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (columnFieldName === &#x27;__all__&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cornerCell.textContent = `${getFieldDisplayName(rowFieldName)}`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cornerCell.textContent = `${getFieldDisplayName(rowFieldName)} / ${getFieldDisplayName(columnFieldName)}`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    columnHeaderRow.appendChild(cornerCell);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Get unique column values in their correct order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let uniqueColumnValues = getOrderedColumnValues();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Fix: Use custom order from pivotEngine state if available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (state.customColumnOrder &amp;&amp; state.customColumnOrder.length &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      uniqueColumnValues = state.customColumnOrder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uniqueColumnValues.forEach((columnValue, index) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const th = document.createElement(&#x27;th&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Optionally hide the &#x27;All&#x27; header label for synthesized column axis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.textContent = columnFieldName === &#x27;__all__&#x27; ? &#x27;&#x27; : columnValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.colSpan = state.measures.length;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.padding = &#x27;12px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.backgroundColor = &#x27;#f8f9fa&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.borderBottom = &#x27;2px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.borderRight = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.textAlign = &#x27;center&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.dataset.fieldName = columnFieldName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.dataset.fieldValue = columnValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.dataset.columnIndex = index;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.setAttribute(&#x27;draggable&#x27;, &#x27;true&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.cursor = &#x27;move&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.className = &#x27;column-header&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      columnHeaderRow.appendChild(th);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    thead.appendChild(columnHeaderRow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const measureHeaderRow = document.createElement(&#x27;tr&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // FIXED: Get current sort configuration from the engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const currentSortConfig =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      state.sortConfig &amp;&amp; state.sortConfig.length &gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ? state.sortConfig[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const rowHeader = document.createElement(&#x27;th&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeader.style.padding = &#x27;12px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeader.style.backgroundColor = &#x27;#f8f9fa&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeader.style.borderBottom = &#x27;2px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeader.style.borderRight = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeader.style.cursor = &#x27;pointer&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeader.style.userSelect = &#x27;none&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const rowHeaderContent = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeaderContent.style.display = &#x27;flex&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeaderContent.style.alignItems = &#x27;center&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeaderContent.style.justifyContent = &#x27;space-between&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const rowText = document.createElement(&#x27;span&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowText.textContent = getFieldDisplayName(rowFieldName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeaderContent.appendChild(rowText);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // FIXED: Use the proper sort icon function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const rowSortIcon = createSortIcon(rowFieldName, currentSortConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeaderContent.appendChild(rowSortIcon);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeader.appendChild(rowHeaderContent);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // FIXED: Proper sort event handler with drag interference prevention</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rowHeader.addEventListener(&#x27;click&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.stopPropagation(); // Prevent drag event interference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const stateNow = pivotEngine.getState();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const current =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stateNow.sortConfig &amp;&amp; stateNow.sortConfig.length &gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ? stateNow.sortConfig[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const nextDir =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        current &amp;&amp; current.field === rowFieldName &amp;&amp; current.direction === &#x27;asc&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ? &#x27;desc&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          : &#x27;asc&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // In processed mode, set custom alphabetical order for row values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (currentViewMode !== &#x27;raw&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const filteredRawData = stateNow.rawData;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const uniqueRowValues = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...new Set(filteredRawData.map(item =&gt; item[rowFieldName])),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const sortedRows = [...uniqueRowValues].sort((a, b) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            const result = a.localeCompare(b);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return nextDir === &#x27;asc&#x27; ? result : -result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          if (sortedRows.length &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pivotEngine.setCustomFieldOrder(rowFieldName, sortedRows, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (err) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          console.error(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;Failed to set custom row order for dimension sort:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pivotEngine.sort(rowFieldName, nextDir);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    measureHeaderRow.appendChild(rowHeader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uniqueColumnValues.forEach(columnValue =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      state.measures.forEach((measure, measureIndex) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const th = document.createElement(&#x27;th&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th.style.padding = &#x27;12px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th.style.backgroundColor = &#x27;#f8f9fa&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th.style.borderBottom = &#x27;2px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th.style.borderRight = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th.style.cursor = &#x27;pointer&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th.style.userSelect = &#x27;none&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const headerContent = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        headerContent.style.display = &#x27;flex&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        headerContent.style.alignItems = &#x27;center&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        headerContent.style.justifyContent = &#x27;space-between&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const measureText = document.createElement(&#x27;span&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        measureText.textContent = measure.caption;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        headerContent.appendChild(measureText);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // FIXED: Use the proper sort icon function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const sortIcon = createSortIcon(measure.uniqueName, currentSortConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        headerContent.appendChild(sortIcon);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th.appendChild(headerContent);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th.dataset.columnValue = String(columnValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th.dataset.measureIndex = String(measureIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // FIXED: Proper sort event handler for measures</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th.addEventListener(&#x27;click&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const stateNow = pivotEngine.getState();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const current =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stateNow.sortConfig &amp;&amp; stateNow.sortConfig.length &gt; 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ? stateNow.sortConfig[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const nextDir =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            current &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            current.field === measure.uniqueName &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            current.direction === &#x27;asc&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ? &#x27;desc&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              : &#x27;asc&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // console.log(&#x27;Applying sort direction:&#x27;, direction);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          if (currentViewMode !== &#x27;raw&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              // Determine aggregation key for the selected measure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              const measureCfg = stateNow.measures.find(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                m =&gt; m.uniqueName === measure.uniqueName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              const aggregation =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                (measureCfg &amp;&amp; measureCfg.aggregation) || &#x27;sum&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              const aggKey = `${aggregation}_${measure.uniqueName}`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              const groups = pivotEngine.getGroupedData();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              // Build full set of row values across groups (ensures rows with 0 are included)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              const allRowSet = new Set();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              groups.forEach(g =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                const keys = g.key ? g.key.split(&#x27;|&#x27;) : [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (keys[0]) allRowSet.add(keys[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              const allRowValues = Array.from(allRowSet);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              // Compute values for the selected column</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              const pairs = allRowValues.map(rv =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                const grp = groups.find(gr =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  const keys = gr.key ? gr.key.split(&#x27;|&#x27;) : [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  return keys[0] === rv &amp;&amp; keys[1] === columnValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                const aggregates = (grp &amp;&amp; grp.aggregates) || {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                const val = Number(aggregates[aggKey] ?? 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return { row: rv, val: isFinite(val) ? val : 0 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              // Sort rows by the computed values in the chosen direction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              pairs.sort((a, b) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                nextDir === &#x27;asc&#x27; ? a.val - b.val : b.val - a.val</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              const orderedRows = pairs.map(p =&gt; p.row);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              const rowFieldNameNow = pivotEngine.getRowFieldName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              if (rowFieldNameNow &amp;&amp; orderedRows.length &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                pivotEngine.setCustomFieldOrder(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  rowFieldNameNow,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  orderedRows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (err) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              console.error(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;Failed to compute/set custom row order for processed sort:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // Always call engine.sort to update sort state (icons) and internal groups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          pivotEngine.sort(measure.uniqueName, nextDir);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        measureHeaderRow.appendChild(th);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    thead.appendChild(measureHeaderRow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.appendChild(thead);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const tbody = document.createElement(&#x27;tbody&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const allUniqueRowValues = getOrderedRowValues();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Check if no data matches the current filters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!allUniqueRowValues || allUniqueRowValues.length === 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.log(&#x27;No data matches the current filters&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const tableContainer = document.getElementById(&#x27;myTable&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (tableContainer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tableContainer.innerHTML =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &#x27;&lt;div style=&quot;padding: 20px; text-align: center; color: #666;&quot;&gt;No data matches the current filters. Try adjusting your filter criteria.&lt;/div&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    updatePagination(allUniqueRowValues, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const paginatedRowValues = getPaginatedData(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allUniqueRowValues,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      paginationState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    paginatedRowValues.forEach((rowValue, rowIndex) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const tr = document.createElement(&#x27;tr&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tr.dataset.fieldName = rowFieldName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tr.dataset.fieldValue = rowValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tr.setAttribute(&#x27;draggable&#x27;, &#x27;true&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tr.style.cursor = &#x27;move&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const rowCell = document.createElement(&#x27;td&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rowCell.textContent = rowValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rowCell.style.fontWeight = &#x27;bold&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rowCell.style.padding = &#x27;8px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rowCell.style.borderBottom = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rowCell.style.borderRight = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rowCell.className = &#x27;row-cell&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Make the cell itself draggable for better browser compatibility</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rowCell.setAttribute(&#x27;draggable&#x27;, &#x27;true&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Store dataset on the draggable element as well</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rowCell.dataset.fieldName = rowFieldName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rowCell.dataset.fieldValue = rowValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tr.appendChild(rowCell);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      uniqueColumnValues.forEach(columnValue =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        state.measures.forEach(measure =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const td = document.createElement(&#x27;td&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          td.style.padding = &#x27;8px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          td.style.borderBottom = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          td.style.borderRight = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // Use engine&#x27;s calculateCellValue method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const value = pivotEngine.calculateCellValue(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rowValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            columnValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            measure,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rowFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            columnFieldName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // Use engine&#x27;s formatValue method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const formattedValue = pivotEngine.formatValue(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            value,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            measure.uniqueName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // Apply text alignment from engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          td.style.textAlign = pivotEngine.getFieldAlignment(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            measure.uniqueName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // Set the formatted value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          td.textContent = formattedValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // Add drilldown functionality</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          addDrillDownToDataCell(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            td,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rowValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            columnValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            measure,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            value,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            formattedValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rowFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            columnFieldName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          tr.appendChild(td);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tbody.appendChild(tr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table.appendChild(tbody);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tableContainer.appendChild(table);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    updatePaginationInfo(&#x27;Processed Data&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setupDragAndDrop();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} catch (error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;Error rendering table:&#x27;, error);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const tableContainer = document.getElementById(&#x27;myTable&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (tableContainer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tableContainer.innerHTML = `&lt;div style=&quot;color: red; padding: 20px;&quot;&gt;Error rendering table: ${error.message}&lt;/div&gt;`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function setupColumnDragAndDropFixed(columnFieldName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const columnHeaders = document.querySelectorAll(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;.column-header[draggable=&quot;true&quot;]&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let draggedColumnValue = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let draggedColumnIndex = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!pivotEngine) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;PivotEngine not initialized for column drag and drop&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Setting up column drag and drop for field:&#x27;, columnFieldName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnHeaders.forEach(header =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const fieldValue = header.dataset.fieldValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const columnIndex = parseInt(header.dataset.columnIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.log(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;Setting up drag for column:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fieldValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;at index:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      columnIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;dragstart&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      draggedColumnValue = fieldValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      draggedColumnIndex = columnIndex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.dataTransfer.setData(&#x27;text/plain&#x27;, fieldValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.dataTransfer.effectAllowed = &#x27;move&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      setTimeout(() =&gt; header.classList.add(&#x27;dragging&#x27;), 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.log(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;Drag started for column:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fieldValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;index:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        columnIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;dragend&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      header.classList.remove(&#x27;dragging&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.log(&#x27;Drag ended for column:&#x27;, fieldValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      draggedColumnValue = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      draggedColumnIndex = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;dragover&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.preventDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.dataTransfer.dropEffect = &#x27;move&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;dragenter&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.preventDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (draggedColumnValue &amp;&amp; draggedColumnValue !== fieldValue) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        header.classList.add(&#x27;drag-over&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;dragleave&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      header.classList.remove(&#x27;drag-over&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    header.addEventListener(&#x27;drop&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.preventDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      header.classList.remove(&#x27;drag-over&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const targetColumnValue = fieldValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const targetColumnIndex = columnIndex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.log(&#x27;Drop event:&#x27;, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        draggedValue: draggedColumnValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        draggedIndex: draggedColumnIndex,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        targetValue: targetColumnValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        targetIndex: targetColumnIndex,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        draggedColumnValue &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        draggedColumnIndex !== null &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        draggedColumnValue !== targetColumnValue &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        draggedColumnIndex !== targetColumnIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.log(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &#x27;Executing column swap:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          draggedColumnIndex,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &#x27;-&gt;&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          targetColumnIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // Use the PivotEngine&#x27;s swapDataColumns method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const result = pivotEngine.swapDataColumns(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            draggedColumnIndex,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            targetColumnIndex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          console.log(&#x27;Column swap result:&#x27;, result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // Force a re-render after the swap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          setTimeout(() =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            console.log(&#x27;Re-rendering after column swap&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            renderTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }, 50);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          console.error(&#x27;Error during column swap:&#x27;, error);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // Fallback: manual re-render</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          renderTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;Column drag and drop setup completed for&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnHeaders.length,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;headers&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function createColumnHeaders(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniqueColumnValues,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnHeaderRow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Creating column headers for values:&#x27;, uniqueColumnValues);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniqueColumnValues.forEach((columnValue, index) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const th = document.createElement(&#x27;th&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">th.textContent = columnValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">th.colSpan = state.measures.length;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">th.style.padding = &#x27;12px&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">th.style.backgroundColor = &#x27;#f8f9fa&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">th.style.borderBottom = &#x27;2px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">th.style.borderRight = &#x27;1px solid #dee2e6&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">th.style.textAlign = &#x27;center&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">th.style.position = &#x27;relative&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">th.style.userSelect = &#x27;none&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Important: Set data attributes for drag and drop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    th.dataset.fieldName = columnFieldName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    th.dataset.fieldValue = columnValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    th.dataset.columnIndex = index.toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Enable dragging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    th.setAttribute(&#x27;draggable&#x27;, &#x27;true&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    th.style.cursor = &#x27;move&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    th.className = &#x27;column-header&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Add visual feedback for draggable state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    th.addEventListener(&#x27;mouseenter&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.backgroundColor = &#x27;#e3f2fd&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    th.addEventListener(&#x27;mouseleave&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      th.style.backgroundColor = &#x27;#f8f9fa&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    columnHeaderRow.appendChild(th);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.log(&#x27;Created header for:&#x27;, columnValue, &#x27;at index:&#x27;, index);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function addEnhancedDragStyles() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const existingStyle = document.querySelector(&#x27;#enhanced-drag-styles&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (existingStyle) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const styleEl = document.createElement(&#x27;style&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">styleEl.id = &#x27;enhanced-drag-styles&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">styleEl.innerHTML = `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.column-header[draggable=&quot;true&quot;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transition: all 0.2s ease;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .column-header[draggable=&quot;true&quot;]:hover {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      background-color: #e3f2fd !important;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      border: 2px solid #2196f3 !important;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      transform: translateY(-2px);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      box-shadow: 0 4px 8px rgba(0,0,0,0.1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .column-header.dragging {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      opacity: 0.6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      background-color: #ffecb3 !important;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      border: 2px solid #ff9800 !important;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      transform: rotate(3deg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .column-header.drag-over {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      border: 3px dashed #4caf50 !important;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      background-color: #e8f5e8 !important;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      animation: pulse 0.5s infinite;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @keyframes pulse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      0% { transform: scale(1); }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      50% { transform: scale(1.05); }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      100% { transform: scale(1); }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Drag cursor feedback */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .column-header[draggable=&quot;true&quot;]:active {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cursor: grabbing !important;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document.head.appendChild(styleEl);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function setupRowDragAndDrop(rowFieldName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Prefer attaching drag to the first cell for broader browser support with table rows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const rowCells = document.querySelectorAll(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;tbody td.row-cell[draggable=&quot;true&quot;]&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let draggedRowValue = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!pivotEngine) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const uniqueRowValues = pivotEngine.getOrderedUniqueFieldValues(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowCells.forEach(cell =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const fieldValue = cell.dataset.fieldValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const row = cell.parentElement;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cell.addEventListener(&#x27;dragstart&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      draggedRowValue = fieldValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        e.dataTransfer.setData(&#x27;text/plain&#x27;, fieldValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      } catch {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      setTimeout(() =&gt; row &amp;&amp; row.classList.add(&#x27;dragging&#x27;), 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cell.addEventListener(&#x27;dragend&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (row) row.classList.remove(&#x27;dragging&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      draggedRowValue = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cell.addEventListener(&#x27;dragover&#x27;, e =&gt; e.preventDefault());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cell.addEventListener(&#x27;dragenter&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.preventDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (draggedRowValue &amp;&amp; draggedRowValue !== fieldValue &amp;&amp; row) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        row.classList.add(&#x27;drag-over&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cell.addEventListener(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;dragleave&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      () =&gt; row &amp;&amp; row.classList.remove(&#x27;drag-over&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cell.addEventListener(&#x27;drop&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      e.preventDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (row) row.classList.remove(&#x27;drag-over&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const targetRowValue = fieldValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const fromIndex = uniqueRowValues.indexOf(draggedRowValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const toIndex = uniqueRowValues.indexOf(targetRowValue);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (fromIndex !== -1 &amp;&amp; toIndex !== -1 &amp;&amp; fromIndex !== toIndex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pivotEngine.swapDataRows(fromIndex, toIndex);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Force re-render to reflect new order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setTimeout(renderTable, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function getFieldDisplayName(fieldName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return fieldName.charAt(0).toUpperCase() + fieldName.slice(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Reset filters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function resetFilters() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Use the engine&#x27;s built-in method to clear filters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pivotEngine.applyFilters([]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Reset filter inputs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const filterField = document.getElementById(&#x27;filterField&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const filterOperator = document.getElementById(&#x27;filterOperator&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const filterValue = document.getElementById(&#x27;filterValue&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (filterField) filterField.selectedIndex = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (filterOperator) filterOperator.selectedIndex = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (filterValue) filterValue.value = &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Update pagination based on data size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function updatePaginationInfo(viewType = &#x27;Processed Data&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const pageInfo = document.getElementById(&#x27;pageInfo&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (pageInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pageInfo.textContent = `${viewType} - Page ${paginationState.currentPage} of ${paginationState.totalPages}`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const prevButton = document.getElementById(&#x27;prevPage&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const nextButton = document.getElementById(&#x27;nextPage&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (prevButton) prevButton.disabled = paginationState.currentPage &lt;= 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (nextButton)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nextButton.disabled =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.currentPage &gt;= paginationState.totalPages;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Generic updatePagination function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function updatePagination(data, resetPage = false) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const pageSizeElement = document.getElementById(&#x27;pageSize&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const pageSize = pageSizeElement ? Number(pageSizeElement.value) : 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const totalPages = Math.ceil(data.length / pageSize) || 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (resetPage) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.currentPage = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else if (paginationState.currentPage &gt; totalPages) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.currentPage = totalPages;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.pageSize = pageSize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.totalPages = totalPages;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export function formatTable(newConfig) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const rowFields = (newConfig.rows || []).map(r =&gt; r.uniqueName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const columnFields = (newConfig.columns || []).map(c =&gt; c.uniqueName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const defaultGroupConfig =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">newConfig.groupConfig ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(rowFields.length &amp;&amp; columnFields.length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowFields,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnFields,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grouper: (item, fields) =&gt; fields.map(f =&gt; item[f]).join(&#x27;|&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Re-initialize engine with new config but same data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pivotEngine = new PivotEngine({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...newConfig,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      groupConfig: defaultGroupConfig || undefined,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      data: pivotEngine.getState().rawData,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pivotEngine.setPagination({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      currentPage: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pageSize: Number.MAX_SAFE_INTEGER,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      totalPages: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pivotEngine.setDataHandlingMode(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      currentViewMode === &#x27;processed&#x27; ? &#x27;processed&#x27; : &#x27;raw&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pivotEngine.subscribe(state =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      currentData = state.rawData; // Keep track of current data from engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      renderTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    renderTable(); // Initial render with new format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} catch (error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;Error formatting table:&#x27;, error);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// FIXED: Event Listeners with proper sorting integration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function setupEventListeners() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const switchButton = document.getElementById(&#x27;switchView&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (switchButton) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">switchButton.addEventListener(&#x27;click&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentViewMode = currentViewMode === &#x27;processed&#x27; ? &#x27;raw&#x27; : &#x27;processed&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">switchButton.textContent =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentViewMode === &#x27;processed&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? &#x27;Switch to Raw Data&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: &#x27;Switch to Processed Data&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.currentPage = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (pivotEngine) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pivotEngine.setDataHandlingMode(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          currentViewMode === &#x27;processed&#x27; ? &#x27;processed&#x27; : &#x27;raw&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Also update pagination info label immediately for better UX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      updatePaginationInfo(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currentViewMode === &#x27;processed&#x27; ? &#x27;Processed Data&#x27; : &#x27;Raw Data&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      renderTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const pageSizeElement = document.getElementById(&#x27;pageSize&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (pageSizeElement) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pageSizeElement.addEventListener(&#x27;change&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const newPageSize = Number(e.target.value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const currentFirstItem =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(paginationState.currentPage - 1) \* paginationState.pageSize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.currentPage =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Math.floor(currentFirstItem / newPageSize) + 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">renderTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const prevButton = document.getElementById(&#x27;prevPage&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (prevButton) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prevButton.addEventListener(&#x27;click&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (paginationState.currentPage &gt; 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.currentPage--;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">renderTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const nextButton = document.getElementById(&#x27;nextPage&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (nextButton) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nextButton.addEventListener(&#x27;click&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (paginationState.currentPage &lt; paginationState.totalPages) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paginationState.currentPage++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">renderTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const applyFilterButton = document.getElementById(&#x27;applyFilter&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (applyFilterButton) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">applyFilterButton.addEventListener(&#x27;click&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const field = document.getElementById(&#x27;filterField&#x27;).value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const operator = document.getElementById(&#x27;filterOperator&#x27;).value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const value = document.getElementById(&#x27;filterValue&#x27;).value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (!value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alert(&#x27;Please enter a filter value&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Infer type dynamically from current data for robust filtering after import</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      let parsedValue = value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const stateNow = pivotEngine.getState();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const dataNow = stateNow?.rawData || [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const sampleVal = (dataNow.find(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          r =&gt; r[field] !== null &amp;&amp; r[field] !== undefined</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ) || {})[field];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const isNumberField =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          typeof sampleVal === &#x27;number&#x27; &amp;&amp; isFinite(sampleVal);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          isNumberField &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          (operator === &#x27;equals&#x27; ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            operator === &#x27;greaterThan&#x27; ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            operator === &#x27;lessThan&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const numValue = parseFloat(String(value).trim());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          if (isNaN(numValue)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            alert(&#x27;Please enter a valid number for &#x27; + field);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          parsedValue = numValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      } catch (e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // If inference fails, fall back to string-based filtering</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parsedValue = value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const filter = { field, operator, value: parsedValue };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Use the engine&#x27;s built-in filter method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pivotEngine.applyFilters([filter]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Reset to first page when applying a new filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      paginationState.currentPage = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const resetFilterButton = document.getElementById(&#x27;resetFilter&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (resetFilterButton) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resetFilterButton.addEventListener(&#x27;click&#x27;, resetFilters);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// FIXED: Enhanced draggable styles with better sort indicators</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function addDraggableStyles() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (document.querySelector(&#x27;#pivot-table-styles&#x27;)) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const styleEl = document.createElement(&#x27;style&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">styleEl.id = &#x27;pivot-table-styles&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">styleEl.innerHTML = `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.dragging { opacity: 0.5; background-color: #f0f0f0; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.drag-over { border: 2px dashed #666 !important; background-color: #e9ecef !important; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">th[draggable=&quot;true&quot;], tr[draggable=&quot;true&quot;] { cursor: move; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.column-header[draggable=&quot;true&quot;] { cursor: move; transition: background-color 0.2s; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.column-header[draggable=&quot;true&quot;]:hover { background-color: #e3f2fd !important; border: 1px solid #2196f3 !important; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.column-header.dragging { opacity: 0.6; background-color: #ffecb3 !important; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.column-header.drag-over { border: 3px dashed #4caf50 !important; background-color: #e8f5e8 !important; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.controls-container { margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.filter-container, .pagination-container { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#myTable { overflow-x: auto; width: 100%; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">button { padding: 5px 10px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">button:disabled { background-color: #cccccc; cursor: not-allowed; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">select, input { padding: 5px; border-radius: 4px; border: 1px solid #ddd; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.drill-down-cell { cursor: pointer; transition: background-color 0.2s; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.drill-down-cell:hover { background-color: #e3f2fd !important; border: 2px solid #2196f3 !important; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.drill-down-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.drill-down-content { background: white; border-radius: 8px; padding: 20px; width: 90%; max-width: 800px; max-height: 80%; overflow: auto; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.drill-down-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.drill-down-title { font-size: 18px; font-weight: bold; color: #333; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.drill-down-close { background: #f44336; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.drill-down-table { width: 100%; border-collapse: collapse; margin-top: 10px; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.drill-down-table th { background: #f8f9fa; padding: 8px; border: 1px solid #dee2e6; font-weight: bold; text-align: left; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.drill-down-table td { padding: 6px 8px; border: 1px solid #dee2e6; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* Enhanced sort icon styles */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th span[title*=&quot;sort&quot;], th span[title*=&quot;Sort&quot;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            transition: all 0.2s ease;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            display: inline-block;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            padding: 2px 4px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            border-radius: 3px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th span[title*=&quot;sort&quot;]:hover, th span[title*=&quot;Sort&quot;]:hover {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            background-color: rgba(0, 123, 255, 0.1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            transform: scale(1.1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th[style*=&quot;cursor: pointer&quot;]:hover {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            background-color: #e9ecef !important;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* Visual feedback for sortable headers */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th[style*=&quot;cursor: pointer&quot;] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            position: relative;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            transition: background-color 0.2s ease;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th[style*=&quot;cursor: pointer&quot;]::after {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            content: &#x27;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            position: absolute;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            bottom: 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            left: 50%;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            width: 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            height: 2px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            background-color: #007bff;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            transition: width 0.3s ease;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            transform: translateX(-50%);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        th[style*=&quot;cursor: pointer&quot;]:hover::after {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            width: 80%;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document.head.appendChild(styleEl);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create drill-down modal for any fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function createDrillDownModal(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">measure,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rawDetails,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aggregatedValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnFieldName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const existingModal = document.querySelector(&#x27;.drill-down-modal&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (existingModal) existingModal.remove();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const modal = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modal.className = &#x27;drill-down-modal&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const content = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content.className = &#x27;drill-down-content&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const header = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">header.className = &#x27;drill-down-header&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const title = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title.className = &#x27;drill-down-title&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title.textContent = `Details: ${getFieldDisplayName(rowFieldName)} = ${rowValue}, ${getFieldDisplayName(columnFieldName)} = ${columnValue}`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const closeButton = document.createElement(&#x27;button&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">closeButton.className = &#x27;drill-down-close&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">closeButton.innerHTML = &#x27;×&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">closeButton.addEventListener(&#x27;click&#x27;, () =&gt; modal.remove());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">header.appendChild(title);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">header.appendChild(closeButton);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const table = document.createElement(&#x27;table&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">table.className = &#x27;drill-down-table&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const thead = document.createElement(&#x27;thead&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const headerRow = document.createElement(&#x27;tr&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const columns = rawDetails.length &gt; 0 ? Object.keys(rawDetails[0]) : [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columns.forEach(col =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const th = document.createElement(&#x27;th&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">th.textContent = getFieldDisplayName(col);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">headerRow.appendChild(th);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thead.appendChild(headerRow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">table.appendChild(thead);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const tbody = document.createElement(&#x27;tbody&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rawDetails.forEach(row =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const tr = document.createElement(&#x27;tr&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columns.forEach(col =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const td = document.createElement(&#x27;td&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">td.textContent = row[col];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tr.appendChild(td);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tbody.appendChild(tr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">table.appendChild(tbody);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content.appendChild(header);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content.appendChild(table);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modal.appendChild(content);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document.body.appendChild(modal);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modal.addEventListener(&#x27;click&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (e.target === modal) modal.remove();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Generic getDrillDownData function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function getDrillDownData(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">measure,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnFieldName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!pivotEngine) return [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const state = pivotEngine.getState();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return state.rawData.filter(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">item =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">item[rowFieldName] === rowValue &amp;&amp; item[columnFieldName] === columnValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Generic addDrillDownToDataCell function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function addDrillDownToDataCell(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">td,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">measure,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">value,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">formattedValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnFieldName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">td.textContent = formattedValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">td.className = &#x27;drill-down-cell&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">td.title = `Double-click to see details for ${rowFieldName}: ${rowValue} - ${columnFieldName}: ${columnValue}`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">td.addEventListener(&#x27;dblclick&#x27;, e =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e.preventDefault();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e.stopPropagation();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const rawDetails = getDrillDownData(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">measure,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnFieldName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (rawDetails.length === 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`No detailed data found for ${rowFieldName}: ${rowValue}, ${columnFieldName}: ${columnValue}`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">createDrillDownModal(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">measure,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rawDetails,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">formattedValue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rowFieldName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columnFieldName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Add HTML for filter and pagination controls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function addControlsHTML() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (document.querySelector(&#x27;.controls-container&#x27;)) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const container = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">container.className = &#x27;controls-container&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">container.innerHTML = `     &lt;div class=&quot;filter-container&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;select id=&quot;filterField&quot;&gt;&lt;/select&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;select id=&quot;filterOperator&quot;&gt;&lt;/select&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;input type=&quot;text&quot; id=&quot;filterValue&quot; placeholder=&quot;Filter value&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;button id=&quot;applyFilter&quot;&gt;Apply Filter&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;button id=&quot;resetFilter&quot;&gt;Reset&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;button id=&quot;switchView&quot;&gt;Switch to Raw Data&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;div class=&quot;pagination-container&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;label&gt;Items per page:&lt;/label&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;select id=&quot;pageSize&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;option value=&quot;1&quot;&gt;1&lt;/option&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;option value=&quot;2&quot;&gt;2&lt;/option&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;option value=&quot;3&quot;&gt;3&lt;/option&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;option value=&quot;4&quot;&gt;4&lt;/option&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;option value=&quot;10&quot; selected&gt;10&lt;/option&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;option value=&quot;25&quot;&gt;25&lt;/option&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;option value=&quot;50&quot;&gt;50&lt;/option&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/select&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;button id=&quot;prevPage&quot;&gt;Previous&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;span id=&quot;pageInfo&quot;&gt;Processed Data - Page 1 of 1&lt;/span&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;button id=&quot;nextPage&quot;&gt;Next&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const myTable = document.getElementById(&#x27;myTable&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (myTable?.parentNode) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">myTable.parentNode.insertBefore(container, myTable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Set up drag and drop functionality</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function setupDragAndDrop() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!pivotEngine) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const rowFieldName = pivotEngine.getRowFieldName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const columnFieldName = pivotEngine.getColumnFieldName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (rowFieldName) setupRowDragAndDrop(rowFieldName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (columnFieldName) setupColumnDragAndDropFixed(columnFieldName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Add this new function to handle file connections</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export async function handleFileConnection(fileType) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Show loading indicator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    showLoadingIndicator(&#x27;Connecting to file...&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    switch (fileType) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case &#x27;CSV&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = await ConnectService.connectToLocalCSV(pivotEngine, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          dimensions: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          csv: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            delimiter: &#x27;,&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hasHeader: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            skipEmptyLines: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            trimValues: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dynamicTyping: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          maxFileSize: 150 * 1024 * 1024, // 50MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          onProgress: progress =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            updateLoadingProgress(progress);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      case &#x27;JSON&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = await ConnectService.connectToLocalJSON(pivotEngine, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          json: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            arrayPath: null, // Will auto-detect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            validateSchema: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          maxFileSize: 150 * 1024 * 1024, // 50MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          onProgress: progress =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            updateLoadingProgress(progress);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = await ConnectService.connectToLocalFile(pivotEngine, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          maxFileSize: 50 * 1024 * 1024, // 50MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          onProgress: progress =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            updateLoadingProgress(progress);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Hide loading indicator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hideLoadingIndicator();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (result.success) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Update current data reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      currentData = result.data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Reset pagination and filters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      paginationState.currentPage = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      resetFilters();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Update the config with new data structure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (result.columns &amp;&amp; result.columns.length &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        updateConfigFromImportedData(result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Rebuild filter UI to reflect newly imported fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      initializeFilters();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Show success notification</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      showImportNotification(result, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Re-render the table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      renderTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.log(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;File connection successful:&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConnectService.createImportSummary(result)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.error(&#x27;File connection failed:&#x27;, result.error);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      showImportNotification(result, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} catch (error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hideLoadingIndicator();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;Error during file connection:&#x27;, error);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">showImportNotification(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">success: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error: error.message || &#x27;Unknown error occurred&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Helper function to update config based on imported data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function updateConfigFromImportedData(result) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!result.columns || result.columns.length === 0) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Try to intelligently map columns to pivot fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const columns = result.columns;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const sampleData = result.data.slice(0, 5); // Look at first 5 rows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Detect potential measure fields (numeric data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const measureFields = columns.filter(col =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const sampleValues = sampleData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.map(row =&gt; row[col])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.filter(val =&gt; val != null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sampleValues.length &gt; 0 &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sampleValues.every(val =&gt; typeof val === &#x27;number&#x27; &amp;&amp; !isNaN(val))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Detect potential dimension fields (text/categorical data only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// IMPORTANT: Exclude measure fields to avoid using numeric columns as dimensions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const measureSet = new Set(measureFields);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const dimensionFields = columns.filter(col =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (measureSet.has(col)) return false; // never treat numeric as a dimension</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const sampleValues = sampleData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.map(row =&gt; row[col])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.filter(val =&gt; val != null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const uniqueValues = [...new Set(sampleValues)];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Consider it a dimension if it has text values OR has limited unique values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sampleValues.some(val =&gt; typeof val === &#x27;string&#x27;) ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniqueValues.length &lt;= Math.max(10, sampleData.length \* 0.5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Respect engine&#x27;s synthesized single column axis when appropriate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const engineHasAllColumn =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pivotEngine &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pivotEngine.getColumnFieldName &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pivotEngine.getColumnFieldName() === &#x27;**all**&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Auto-configure pivot table if we have good candidates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (dimensionFields.length &gt;= 1 &amp;&amp; measureFields.length &gt;= 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const newConfig = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...config,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rows: dimensionFields.slice(0, 1).map(field =&gt; ({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniqueName: field,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caption: field,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// If we only found a single dimension or engine already decided on &#x27;**all**&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// keep a single synthesized column axis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">engineHasAllColumn || dimensionFields.length &lt; 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? [{ uniqueName: &#x27;__all__&#x27;, caption: &#x27;All&#x27; }]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">: dimensionFields.slice(1, 2).map(field =&gt; ({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniqueName: field,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caption: field,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">measures: measureFields.slice(0, 3).map(field =&gt; ({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uniqueName: field,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">caption: field,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aggregation: &#x27;sum&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Apply the new configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    formatTable(newConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.log(&#x27;Auto-configured pivot table:&#x27;, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rows: newConfig.rows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      columns: newConfig.columns,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      measures: newConfig.measures,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Loading indicator functions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function showLoadingIndicator(message = &#x27;Loading...&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let loader = document.getElementById(&#x27;file-loader&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!loader) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loader = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loader.id = &#x27;file-loader&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loader.style.cssText = `       position: fixed;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      top: 50%;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      left: 50%;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      transform: translate(-50%, -50%);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      background: white;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      padding: 30px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      border-radius: 10px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      box-shadow: 0 4px 20px rgba(0,0,0,0.3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z-index: 10000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      text-align: center;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      min-width: 300px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loader.innerHTML = `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;div style=&quot;margin-bottom: 20px; font-size: 16px; font-weight: bold;&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ${message}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;div style=&quot;background: #f0f0f0; height: 20px; border-radius: 10px; overflow: hidden;&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;div id=&quot;progress-bar&quot; style=&quot;background: #4CAF50; height: 100%; width: 0%; transition: width 0.3s;&quot;&gt;&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;div id=&quot;progress-text&quot; style=&quot;margin-top: 10px; font-size: 14px; color: #666;&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Add backdrop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const backdrop = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backdrop.id = &#x27;loader-backdrop&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backdrop.style.cssText = `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      position: fixed;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      top: 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      left: 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 100%;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 100%;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      background: rgba(0,0,0,0.5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z-index: 9999;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    document.body.appendChild(backdrop);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    document.body.appendChild(loader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function updateLoadingProgress(progress) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const progressBar = document.getElementById(&#x27;progress-bar&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const progressText = document.getElementById(&#x27;progress-text&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (progressBar) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">progressBar.style.width = `${progress}%`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (progressText) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">progressText.textContent = `${Math.round(progress)}%`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function hideLoadingIndicator() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const loader = document.getElementById(&#x27;file-loader&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const backdrop = document.getElementById(&#x27;loader-backdrop&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (loader) loader.remove();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (backdrop) backdrop.remove();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Enhanced notification system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function showImportNotification(result, isSuccess) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const notification = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">notification.style.cssText = `     position: fixed;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    top: 20px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    right: 20px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max-width: 400px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    padding: 20px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    border-radius: 8px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    box-shadow: 0 4px 12px rgba(0,0,0,0.2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z-index: 10001;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    font-family: Arial, sans-serif;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ${</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      isSuccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ? &#x27;background: #d4edda; border-left: 4px solid #28a745; color: #155724;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : &#x27;background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const title = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title.style.cssText =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;font-weight: bold; margin-bottom: 10px; font-size: 16px;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title.textContent = isSuccess ? &#x27;✅ Import Successful&#x27; : &#x27;❌ Import Failed&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const content = document.createElement(&#x27;div&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content.style.cssText = &#x27;font-size: 14px; line-height: 1.4;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (isSuccess) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content.innerHTML = `      &lt;div&gt;&lt;strong&gt;File:&lt;/strong&gt; ${result.fileName}&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;div&gt;&lt;strong&gt;Records:&lt;/strong&gt; ${result.recordCount?.toLocaleString()}&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;div&gt;&lt;strong&gt;Size:&lt;/strong&gt; ${formatFileSize(result.fileSize)}&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ${result.columns ?`&lt;div&gt;&lt;strong&gt;Columns:&lt;/strong&gt; ${result.columns.length}&lt;/div&gt;` : &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ${</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result.validationErrors?.length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ? `&lt;div style=&quot;margin-top: 10px; color: #856404;&quot;&gt;&lt;strong&gt;Warnings:&lt;/strong&gt;&lt;br&gt;${result.validationErrors.map(w =&gt; `• ${w}`).join(&#x27;&lt;br&gt;&#x27;)}&lt;/div&gt;`           : &#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    `;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content.textContent = result.error || &#x27;Unknown error occurred&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const closeBtn = document.createElement(&#x27;button&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">closeBtn.textContent = &#x27;×&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">closeBtn.style.cssText = `     position: absolute;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    top: 10px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    right: 10px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    background: none;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    border: none;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    font-size: 18px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cursor: pointer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    width: 24px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    height: 24px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display: flex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    align-items: center;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    justify-content: center;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    border-radius: 12px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    opacity: 0.7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">closeBtn.addEventListener(&#x27;click&#x27;, () =&gt; notification.remove());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">notification.appendChild(title);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">notification.appendChild(content);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">notification.appendChild(closeBtn);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document.body.appendChild(notification);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Auto-remove after 8 seconds for success, 12 seconds for error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setTimeout(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">() =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (notification.parentNode) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">notification.remove();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">isSuccess ? 8000 : 12000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function formatFileSize(bytes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!bytes) return &#x27;0 Bytes&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const k = 1024;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const sizes = [&#x27;Bytes&#x27;, &#x27;KB&#x27;, &#x27;MB&#x27;, &#x27;GB&#x27;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const i = Math.floor(Math.log(bytes) / Math.log(k));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + &#x27; &#x27; + sizes[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export function onSectionItemDrop(droppedFields) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// droppedFields.rows: Set&lt;string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// droppedFields.columns: Set&lt;string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// droppedFields.values: Map&lt;string, AggregationType&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const selection = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rows: Array.from(droppedFields.rows || []),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columns: Array.from(droppedFields.columns || []),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">values: Array.from(droppedFields.values || new Map()).map(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">([field, aggregation]) =&gt; ({ field, aggregation })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const layout = FieldService.buildLayout(selection);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (pivotEngine) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const newConfig = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...config,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rows: layout.rows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">columns: layout.columns,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">measures: layout.measures,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">formatTable(newConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// FIXED: Initialize everything when the DOM is loaded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document.addEventListener(&#x27;DOMContentLoaded&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!sampleData || !Array.isArray(sampleData) || sampleData.length === 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;Sample data is not available or empty&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const tableContainer = document.getElementById(&#x27;myTable&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (tableContainer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tableContainer.innerHTML =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;&lt;div style=&quot;color: red; padding: 20px;&quot;&gt;Error: Sample data not available.&lt;/div&gt;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const rowFields = (config.rows || []).map(r =&gt; r.uniqueName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const columnFields = (config.columns || []).map(c =&gt; c.uniqueName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const defaultGroupConfig =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      config.groupConfig ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      (rowFields.length &amp;&amp; columnFields.length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ? {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rowFields,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            columnFields,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Join row + column values with &#x27;|&#x27;, same as web-component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            grouper: (item, fields) =&gt; fields.map(f =&gt; item[f]).join(&#x27;|&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        : null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Create a single PivotEngine instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pivotEngine = new PivotEngine({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...config,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      groupConfig: defaultGroupConfig || undefined,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      data: sampleData, // Initialize with the full dataset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pivotEngine.setPagination({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      currentPage: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      pageSize: Number.MAX_SAFE_INTEGER,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      totalPages: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Ensure processed mode on load</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pivotEngine.setDataHandlingMode(&#x27;processed&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // FIXED: Subscribe to state changes to re-render the UI automatically with proper sorting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pivotEngine.subscribe(state =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      console.log(&#x27;PivotEngine state changed:&#x27;, {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sortConfig: state.sortConfig,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dataHandlingMode: state.dataHandlingMode,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processedDataLength: state.processedData?.rows?.length || 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // The engine&#x27;s state reflects the latest data after any operation (filtering, sorting, etc.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      currentData = state.rawData; // Keep track of the engine&#x27;s current data view</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      renderTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Initialize header if configured</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (config.toolbar &amp;&amp; typeof createHeader === &#x27;function&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      createHeader(config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Add UI elements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addDraggableStyles();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addControlsHTML();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initializeFilters();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setupEventListeners();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addEnhancedDragStyles();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Initial render</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    renderTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console.log(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &#x27;Initialization completed successfully with sorting functionality&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} catch (error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.error(&#x27;Error during initialization:&#x27;, error);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const tableContainer = document.getElementById(&#x27;myTable&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (tableContainer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tableContainer.innerHTML = `&lt;div style=&quot;color: red; padding: 20px;&quot;&gt;Error during initialization: ${error.message}&lt;/div&gt;`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">window.debugPivotState = function () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const state = pivotEngine.getState();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Sort config:&#x27;, state.sortConfig);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Groups count:&#x27;, state.groups.length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console.log(&#x27;Data handling mode:&#x27;, state.dataHandlingMode);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></div></details>
<p><strong>config/config.js:</strong>
This file defines the configuration for the pivot table&#x27;s rows, columns, and measures.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;rows&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        { &quot;uniqueName&quot;: &quot;Country&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;columns&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        { &quot;uniqueName&quot;: &quot;Category&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;measures&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        { &quot;uniqueName&quot;: &quot;Price&quot;, &quot;aggregation&quot;: &quot;sum&quot; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        { &quot;uniqueName&quot;: &quot;Quantity&quot;, &quot;aggregation&quot;: &quot;sum&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;options&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;grid&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;type&quot;: &quot;classic&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;showTotals&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;showGrandTotals&quot;: &quot;on&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<p><strong>data/raw_data.json :</strong></p>
<p>This is the sample data that will be loaded into the pivot table.</p>
<div class="language-JSON language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Category&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Accessories&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Country&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;USA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Quantity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Category&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Bikes&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Country&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Canada&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Quantity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Category&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Clothing&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Country&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;USA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Quantity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Category&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Accessories&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Country&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Canada&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Quantity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Category&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Bikes&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Country&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;USA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Price&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1500</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;Quantity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p><strong>3. How to Run the Demo :</strong>
Install Dependencies: Open your terminal in the sample-project directory and run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm install</span><br></span></code></pre></div></div>
<p>Start the Server: Once the installation is complete, start the local development server:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm start</span><br></span></code></pre></div></div>
<p>View in Browser: Open your web browser and navigate to the URL provided by http-server.</p>
<p>You should now see a functional pivot table rendered on the page.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/mindfiredigital/PivotHead/tree/main/documentation/docs/tutorials/core-webcomponent/sample-project.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/PivotHead/docs/getting-started/Why-we-use-pivothead"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Why Use PivotHead</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/PivotHead/docs/tutorials/core-webcomponent/setup-for-user-project"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">setup-for-user-project</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#project-structure" class="table-of-contents__link toc-highlight">Project Structure</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2025 Mindfire FOSS</div></div></div></footer></div>
</body>
</html>