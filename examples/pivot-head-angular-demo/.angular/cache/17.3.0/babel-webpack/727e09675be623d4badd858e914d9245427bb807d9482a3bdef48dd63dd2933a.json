{
  "ast": null,
  "code": "import { PivotEngine } from '@mindfiredigital/pivothead';\nfunction renderSwitch(host) {\n  const mode = host.getAttribute('mode') || 'default';\n  if (mode === 'none') {\n    if (host.shadowRoot) {\n      host.shadowRoot.innerHTML = `<style>:host { display:block; }</style>`;\n    }\n  } else if (mode === 'minimal') {\n    if (host.shadowRoot) {\n      host.shadowRoot.innerHTML = `\n        <style>\n        :host { display: block; font-family: inherit; }\n        [data-pivot-root] {\n          display: grid;\n          border: 1px solid #d8dde2; border-radius: 6px; background: #fcfdff;\n        }\n        [data-pivot-header], [data-pivot-body] {\n          padding: 0.3em 0.5em;\n        }\n        [data-pivot-header] {\n          background: #f4f7fa;\n          border-bottom: 1px solid #e2e7ed;\n          font-weight: bold;\n        }\n        </style>\n        <div role=\"grid\" data-pivot-root>\n          <div role=\"rowgroup\" data-pivot-header><slot name=\"header\"></slot></div>\n          <div role=\"rowgroup\" data-pivot-body><slot name=\"body\"></slot></div>\n        </div>\n      `;\n    }\n  } else {\n    host._showRawData ? host.renderRawTable() : host.renderFullUI();\n  }\n}\nfunction handleEngineStateChange(host, state) {\n  host.dispatchEvent(new CustomEvent('stateChange', {\n    detail: state,\n    bubbles: true,\n    composed: true\n  }));\n  host.calculatePaginationForCurrentView();\n  const mode = host.getAttribute('mode');\n  if (mode === 'none') {\n    if (host.shadowRoot) host.shadowRoot.innerHTML = `<style>:host { display:block; }</style>`;\n  } else if (mode === 'minimal') {\n    if (host.shadowRoot) {\n      host.shadowRoot.innerHTML = `\n        <style>\n        :host { display: block; font-family: inherit; }\n        [data-pivot-root] {\n          display: grid;\n          border: 1px solid #d8dde2; border-radius: 6px; background: #fcfdff;\n        }\n        [data-pivot-header], [data-pivot-body] {\n          padding: 0.3em 0.5em;\n        }\n        [data-pivot-header] {\n          background: #f4f7fa;\n          border-bottom: 1px solid #e2e7ed;\n          font-weight: bold;\n        }\n        </style>\n        <div role=\"grid\" data-pivot-root>\n          <div role=\"rowgroup\" data-pivot-header><slot name=\"header\"></slot></div>\n          <div role=\"rowgroup\" data-pivot-body><slot name=\"body\"></slot></div>\n        </div>\n      `;\n    }\n  } else {\n    host._showRawData ? host.renderRawTable() : host.renderFullUI();\n  }\n}\nfunction renderFullUI(host) {\n  const engine = host.engine;\n  if (!engine) {\n    if (host.shadowRoot) host.shadowRoot.innerHTML = '';\n    return;\n  }\n  const state = engine.getState();\n  if (!state.processedData) {\n    console.error('No processed data available');\n    return;\n  }\n  const rowField = host._options.rows?.[0];\n  const columnField = host._options.columns?.[0];\n  const measures = host._options.measures || [];\n  if (!rowField || !columnField || !measures.length) {\n    console.error('Missing row, column, or measures configuration');\n    return;\n  }\n  host.calculatePaginationForCurrentView();\n  let html = `\n      <style>\n        :host { display: block; font-family: inherit; }\n        .controls-container { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }\n        .filter-container, .pagination-container { display: flex; gap: 10px; align-items: center; }\n        table { width: 100%; border-collapse: collapse; background: #ffffff; border: 1px solid #dee2e6; margin-top: 20px; }\n        th, td { border: 1px solid #dee2e6; padding: 8px; text-align: left; }\n        th { background-color: #f8f9fa; cursor: grab; font-weight: 600; }\n        .sortable-header { cursor: pointer; position: relative; }\n        .sort-icon { margin-left: 5px; font-size: 12px; color: #6c757d; opacity: 0.5; }\n        .sort-icon.active { color: #007bff; opacity: 1; }\n        .corner-cell { background-color: #f8f9fa !important; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; }\n        .column-header { background-color: #f8f9fa !important; border-bottom: 2px solid #dee2e6; text-align: center; cursor: move; }\n        .measure-header { background-color: #f8f9fa !important; border-bottom: 2px solid #dee2e6; cursor: pointer; }\n        .row-cell { font-weight: bold; background-color: #f8f9fa; }\n        tr[draggable=\"true\"] { cursor: grab; }\n        .dragging { opacity: 0.5; }\n        .drag-over { outline: 2px dashed #2672dd; background: #f3f8fd !important; }\n        tbody tr:nth-child(even) td { background: #f8fafc; }\n        button { padding: 5px 10px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }\n        button:hover { background-color: #45a049; }\n        button:disabled { background-color: #cccccc; cursor: not-allowed; }\n        select, input { padding: 5px; border-radius: 4px; border: 1px solid #ddd; }\n        \n        /* Drill-down styles */\n        .drill-down-cell { cursor: pointer; }\n        .drill-down-cell:hover { background-color: #e3f2fd !important; }\n        \n        /* Modal styles for drill-down details */\n        .drill-down-modal {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0, 0, 0, 0.5);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        }\n\n        .drill-down-content {\n            background: white;\n            border-radius: 8px;\n            padding: 20px;\n            width: 90%;\n            max-width: 800px;\n            max-height: 80%;\n            overflow: auto;\n            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        }\n\n        .drill-down-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 20px;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e0e0e0;\n        }\n\n        .drill-down-title {\n            font-size: 18px;\n            font-weight: bold;\n            color: #333;\n        }\n\n        .drill-down-close {\n            background: #f44336;\n            color: white;\n            border: none;\n            border-radius: 50%;\n            width: 30px;\n            height: 30px;\n            cursor: pointer;\n            font-size: 16px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .drill-down-close:hover {\n            background: #d32f2f;\n        }\n\n        .drill-down-summary {\n            background: #f5f5f5;\n            padding: 10px;\n            border-radius: 4px;\n            margin-bottom: 15px;\n            font-size: 14px;\n            line-height: 1.4;\n        }\n\n        .drill-down-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 10px;\n            font-size: 14px;\n        }\n\n        .drill-down-table th {\n            background: #f8f9fa;\n            padding: 8px;\n            border: 1px solid #dee2e6;\n            font-weight: bold;\n            text-align: left;\n        }\n\n        .drill-down-table td {\n            padding: 6px 8px;\n            border: 1px solid #dee2e6;\n        }\n\n        .drill-down-table tr:nth-child(even) {\n            background-color: #f9f9f9;\n        }\n\n        .drill-down-table tr:hover {\n            background-color: #e3f2fd;\n        }\n      </style>\n      <div class=\"controls-container\">\n        <div class=\"filter-container\">\n          <label>Filter:</label>\n          <select id=\"filterField\"></select>\n          <select id=\"filterOperator\">\n            <option value=\"equals\">Equals</option>\n            <option value=\"contains\">Contains</option>\n            <option value=\"greaterThan\">Greater Than</option>\n            <option value=\"lessThan\">Less Than</option>\n          </select>\n          <input type=\"text\" id=\"filterValue\" placeholder=\"Value\">\n          <button id=\"applyFilter\">Apply</button>\n          <button id=\"resetFilter\">Reset</button>\n        </div>\n        <div class=\"pagination-container\">\n          <label>Items per page:</label>\n          <select id=\"pageSize\">\n            <option value=\"5\">5</option>\n            <option value=\"10\">10</option>\n            <option value=\"25\">25</option>\n            <option value=\"50\">50</option>\n          </select>\n          <button id=\"prevPage\">Previous</button>\n          <span id=\"pageInfo\">Page ${host._pagination.currentPage} of ${host._pagination.totalPages}</span>\n          <button id=\"nextPage\">Next</button>\n        </div>\n        <button id=\"switchView\">Switch to Raw Data</button>\n        <button id=\"formatButton\">Format</button>\n        <button id=\"exportHTML\">Export HTML</button>\n        <button id=\"exportPDF\">Export PDF</button>\n        <button id=\"exportExcel\">Export Excel</button>\n        <button id=\"printTable\">Print</button>\n      </div>\n    `;\n  // Determine column labels using engine's custom column order if any\n  const groupedData = engine.getGroupedData();\n  let uniqueColumnValues = engine.getOrderedColumnValues() || [...new Set(groupedData.map(g => {\n    const keys = g.key ? g.key.split('|') : [];\n    return keys[1] || keys[0];\n  }))].filter(Boolean);\n  if (host._processedColumnOrder.length === 0) {\n    host._processedColumnOrder = [...uniqueColumnValues];\n  }\n  if (host._processedColumnOrder.length > 0) {\n    uniqueColumnValues = host._processedColumnOrder.filter(col => uniqueColumnValues.includes(col));\n  }\n  html += '<table role=\"grid\">';\n  html += '<thead>';\n  html += '<tr>';\n  html += `<th class=\"corner-cell\">${rowField.caption} / ${columnField.caption}</th>`;\n  uniqueColumnValues.forEach((colValue, index) => {\n    html += `<th class=\"column-header\" draggable=\"true\" data-column-index=\"${index}\" data-column-value=\"${colValue}\" colspan=\"${measures.length}\">${colValue}</th>`;\n  });\n  html += '</tr>';\n  html += '<tr>';\n  const rowSortIcon = host.createProcessedSortIcon(rowField.uniqueName);\n  html += `<th class=\"row-cell sortable-header\" data-field=\"${rowField.uniqueName}\">\n      ${rowField.caption}${rowSortIcon}\n    </th>`;\n  uniqueColumnValues.forEach(colValue => {\n    measures.forEach((measure, measureIndex) => {\n      const sortIcon = host.createProcessedSortIcon(measure.uniqueName);\n      html += `<th class=\"measure-header sortable-header\" data-measure-index=\"${measureIndex}\" data-field=\"${measure.uniqueName}\" data-column-value=\"${colValue}\">\n          ${measure.caption}${sortIcon}\n        </th>`;\n    });\n  });\n  html += '</tr>';\n  html += '</thead>';\n  html += '<tbody>';\n  // Prefer engine-provided ordered row values (custom or due to sorting)\n  const orderedFromEngine = engine.getOrderedRowValues() || [];\n  let uniqueRowValues = [...orderedFromEngine];\n  if (uniqueRowValues.length === 0) {\n    // Fallback: derive row values from all grouped data keys so we don't miss any groups\n    const allGroups = engine.getGroupedData();\n    uniqueRowValues = [...new Set(allGroups.map(g => {\n      const keys = g.key ? g.key.split('|') : [];\n      return keys[0];\n    }))].filter(Boolean);\n  }\n  const paginatedRowValues = host.getPaginatedData(uniqueRowValues);\n  paginatedRowValues.forEach((rowValue, rowIndex) => {\n    html += `<tr draggable=\"true\" data-row-index=\"${rowIndex}\" data-row-value=\"${rowValue}\">`;\n    html += `<td class=\"row-cell\">${rowValue}</td>`;\n    uniqueColumnValues.forEach(colValue => {\n      measures.forEach(measure => {\n        const matchingGroup = groupedData.find(g => {\n          const keys = g.key ? g.key.split('|') : [];\n          return keys[0] === rowValue && keys[1] === colValue;\n        });\n        const aggKey = measure.aggregation + '_' + measure.uniqueName;\n        const value = matchingGroup?.aggregates?.[aggKey];\n        let formattedValue = '0';\n        if (value !== undefined && value !== null) {\n          formattedValue = engine.formatValue(value, measure.uniqueName);\n        }\n        const hasData = value !== undefined && value !== null && Number(value) > 0;\n        const cellClass = hasData ? 'data-cell drill-down-cell' : 'data-cell';\n        const cellTitle = hasData ? `Double-click to see details for ${rowField.caption}: ${rowValue} - ${columnField.caption}: ${colValue}` : '';\n        const textAlign = engine.getFieldAlignment(measure.uniqueName);\n        html += `<td class=\"${cellClass}\" \n                      style=\"text-align: ${textAlign};\"\n                      title=\"${cellTitle}\"\n                      data-row-value=\"${rowValue}\" \n                      data-column-value=\"${colValue}\" \n                      data-measure-name=\"${measure.uniqueName}\"\n                      data-measure-caption=\"${measure.caption}\"\n                      data-row-field=\"${rowField.uniqueName}\"\n                      data-column-field=\"${columnField.uniqueName}\"\n                      data-aggregate-value=\"${value || 0}\">\n                      ${formattedValue}\n                   </td>`;\n      });\n    });\n    html += '</tr>';\n  });\n  html += '</tbody>';\n  html += '</table>';\n  if (host.shadowRoot) host.shadowRoot.innerHTML = html;\n  host.addDragListeners();\n  host.setupControls();\n}\nfunction renderRawTable(host) {\n  const engine = host.engine;\n  if (!engine) return;\n  const state = engine.getState();\n  // Prefer full rawData first; state.data could be limited by engine defaults\n  const allRawData = state.rawData || state.data || [];\n  if (!allRawData.length) return;\n  host.updatePaginationForData(allRawData);\n  const displayData = host.getPaginatedData(allRawData);\n  const originalHeaders = Object.keys(displayData[0] || allRawData[0]);\n  let headers;\n  if (host._rawDataColumnOrder && host._rawDataColumnOrder.length > 0) {\n    const missingHeaders = originalHeaders.filter(h => !host._rawDataColumnOrder.includes(h));\n    headers = [...host._rawDataColumnOrder, ...missingHeaders];\n  } else {\n    headers = originalHeaders;\n    host._rawDataColumnOrder = [...headers];\n  }\n  let html = `\n      <style>\n        :host { display: block; font-family: inherit; }\n        .controls-container { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }\n        .filter-container, .pagination-container { display: flex; gap: 10px; align-items: center; }\n        table { width: 100%; border-collapse: collapse; background: #ffffff; border: 1px solid #e2e7ed; }\n        th, td { border: 1px solid #dde1e7; padding: 8px; text-align: left; }\n        th { background-color: #eaf2fa; cursor: grab; font-weight: 600; }\n        .sortable-header { cursor: pointer !important; position: relative; }\n        .sort-icon { margin-left: 5px; font-size: 12px; color: #6c757d; opacity: 0.5; }\n        .sort-icon.active { color: #007bff; opacity: 1; }\n        tr[draggable=\"true\"] { cursor: grab; }\n        .dragging { opacity: 0.5; }\n        .drag-over { outline: 2px dashed #2672dd; background: #f3f8fd !important; }\n        tbody tr:nth-child(even) td { background: #f8fafc; }\n        button { padding: 5px 10px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }\n        button:hover { background-color: #45a049; }\n        button:disabled { background-color: #cccccc; cursor: not-allowed; }\n        select, input { padding: 5px; border-radius: 4px; border: 1px solid #ddd; }\n      </style>\n      <div class=\"controls-container\">\n        <div class=\"filter-container\">\n          <label>Filter:</label>\n          <select id=\"filterField\"></select>\n          <select id=\"filterOperator\">\n            <option value=\"equals\">Equals</option>\n            <option value=\"contains\">Contains</option>\n            <option value=\"greaterThan\">Greater Than</option>\n            <option value=\"lessThan\">Less Than</option>\n          </select>\n          <input type=\"text\" id=\"filterValue\" placeholder=\"Value\">\n          <button id=\"applyFilter\">Apply</button>\n          <button id=\"resetFilter\">Reset</button>\n        </div>\n        <div class=\"pagination-container\">\n          <label>Items per page:</label>\n          <select id=\"pageSize\">\n            <option value=\"5\">5</option>\n            <option value=\"10\">10</option>\n            <option value=\"25\">25</option>\n            <option value=\"50\">50</option>\n          </select>\n          <button id=\"prevPage\">Previous</button>\n          <span id=\"pageInfo\">Page ${host._pagination.currentPage} of ${host._pagination.totalPages}</span>\n          <button id=\"nextPage\">Next</button>\n        </div>\n        <button id=\"switchView\">Switch to Processed Data</button>\n        <button id=\"formatButton\">Format</button>\n        <button id=\"exportHTML\">Export HTML</button>\n        <button id=\"exportPDF\">Export PDF</button>\n        <button id=\"exportExcel\">Export Excel</button>\n        <button id=\"printTable\">Print</button>\n      </div>\n    `;\n  html += '<table data-raw=\"true\">';\n  html += '<thead><tr>';\n  headers.forEach((header, index) => {\n    const sortIcon = host.createSortIcon(header);\n    html += `<th class=\"sortable-header\" draggable=\"true\" data-column-index=\"${index}\" data-field=\"${header}\">\n        ${header}${sortIcon}\n      </th>`;\n  });\n  html += '</tr></thead>';\n  html += '<tbody>';\n  displayData.forEach((row, rowIndex) => {\n    const pivotRow = row;\n    html += `<tr draggable=\"true\" data-row-index=\"${rowIndex}\">`;\n    headers.forEach(header => {\n      const cellValue = pivotRow[header];\n      let formattedValue = cellValue;\n      if (cellValue !== undefined && cellValue !== null) {\n        formattedValue = engine.formatValue(cellValue, header);\n      }\n      const textAlign = engine.getFieldAlignment(header);\n      html += `<td style=\"text-align: ${textAlign};\">${formattedValue}</td>`;\n    });\n    html += '</tr>';\n  });\n  html += '</tbody></table>';\n  if (host.shadowRoot) host.shadowRoot.innerHTML = html;\n  host.addDragListeners();\n  host.setupControls();\n}\n\n// Events: bindControls and updatePaginationInfo\nfunction bindControls(host) {\n  const filterField = host.shadowRoot?.getElementById('filterField');\n  if (filterField) {\n    if (host._showRawData) {\n      if (host._data.length > 0) {\n        filterField.innerHTML = Object.keys(host._data[0]).map(f => `<option value=\"${f}\">${f}</option>`).join('');\n      }\n    } else {\n      let options = '';\n      if (host._options.rows) {\n        host._options.rows.forEach(row => {\n          options += `<option value=\"${row.uniqueName}\">${row.caption}</option>`;\n        });\n      }\n      if (host._options.columns) {\n        host._options.columns.forEach(col => {\n          options += `<option value=\"${col.uniqueName}\">${col.caption}</option>`;\n        });\n      }\n      if (host._options.measures) {\n        host._options.measures.forEach(measure => {\n          const aggregatedKey = `${measure.aggregation}_${measure.uniqueName}`;\n          options += `<option value=\"${aggregatedKey}\">${measure.caption}</option>`;\n        });\n      }\n      filterField.innerHTML = options;\n    }\n  }\n  const filterValueInput = host.shadowRoot?.getElementById('filterValue');\n  if (filterValueInput && host._filters.length > 0) {\n    const currentFilter = host._filters[0];\n    if (currentFilter) {\n      const filterFieldElement = host.shadowRoot?.getElementById('filterField');\n      const filterOperatorElement = host.shadowRoot?.getElementById('filterOperator');\n      if (filterFieldElement) {\n        filterFieldElement.value = currentFilter.field;\n      }\n      if (filterOperatorElement) {\n        filterOperatorElement.value = currentFilter.operator;\n      }\n      filterValueInput.value = currentFilter.value;\n    }\n  }\n  const pageSizeSelect = host.shadowRoot?.getElementById('pageSize');\n  if (pageSizeSelect) {\n    Array.from(pageSizeSelect.options).forEach(option => {\n      option.removeAttribute('selected');\n      option.selected = false;\n    });\n    pageSizeSelect.value = host._pagination.pageSize.toString();\n    const selectedOption = pageSizeSelect.querySelector(`option[value=\"${host._pagination.pageSize}\"]`);\n    if (selectedOption) {\n      selectedOption.selected = true;\n      selectedOption.setAttribute('selected', 'selected');\n    }\n  }\n  const applyBtn = host.shadowRoot?.getElementById('applyFilter');\n  if (applyBtn) {\n    const newApplyBtn = applyBtn.cloneNode(true);\n    applyBtn.parentNode?.replaceChild(newApplyBtn, applyBtn);\n    newApplyBtn.addEventListener('click', () => {\n      const fieldElement = host.shadowRoot?.getElementById('filterField');\n      const operatorElement = host.shadowRoot?.getElementById('filterOperator');\n      const valueElement = host.shadowRoot?.getElementById('filterValue');\n      if (!fieldElement || !operatorElement || !valueElement) return;\n      const field = fieldElement.value;\n      const operator = operatorElement.value;\n      const value = valueElement.value;\n      if (!field || !operator || !value) return;\n      const filter = {\n        field,\n        operator: operator,\n        value\n      };\n      host.filters = [filter];\n    });\n  }\n  const resetBtn = host.shadowRoot?.getElementById('resetFilter');\n  if (resetBtn) {\n    const newResetBtn = resetBtn.cloneNode(true);\n    resetBtn.parentNode?.replaceChild(newResetBtn, resetBtn);\n    newResetBtn.addEventListener('click', () => {\n      host.reset();\n    });\n  }\n  const pageSizeSel = host.shadowRoot?.getElementById('pageSize');\n  if (pageSizeSel) {\n    const newPageSizeSel = pageSizeSel.cloneNode(true);\n    pageSizeSel.parentNode?.replaceChild(newPageSizeSel, pageSizeSel);\n    newPageSizeSel.addEventListener('change', e => {\n      const target = e.target;\n      host.setPageSize(Number(target.value));\n    });\n  }\n  const prevBtn = host.shadowRoot?.getElementById('prevPage');\n  if (prevBtn) {\n    const newPrevBtn = prevBtn.cloneNode(true);\n    prevBtn.parentNode?.replaceChild(newPrevBtn, prevBtn);\n    newPrevBtn.addEventListener('click', () => host.previousPage());\n  }\n  const nextBtn = host.shadowRoot?.getElementById('nextPage');\n  if (nextBtn) {\n    const newNextBtn = nextBtn.cloneNode(true);\n    nextBtn.parentNode?.replaceChild(newNextBtn, nextBtn);\n    newNextBtn.addEventListener('click', () => host.nextPage());\n  }\n  updatePaginationInfo(host);\n  const switchBtn = host.shadowRoot?.getElementById('switchView');\n  if (switchBtn) {\n    const newSwitchBtn = switchBtn.cloneNode(true);\n    switchBtn.parentNode?.replaceChild(newSwitchBtn, switchBtn);\n    newSwitchBtn.textContent = host._showRawData ? 'Switch to Processed Data' : 'Switch to Raw Data';\n    newSwitchBtn.addEventListener('click', () => {\n      host._showRawData = !host._showRawData;\n      try {\n        if (host.engine) {\n          host.engine.setDataHandlingMode(host._showRawData ? 'raw' : 'processed');\n          const currentFilters = host._showRawData ? host._rawFilters : host._processedFilters;\n          host.engine.applyFilters(currentFilters);\n          host.dispatchEvent(new CustomEvent('viewModeChange', {\n            detail: {\n              mode: host._showRawData ? 'raw' : 'processed'\n            },\n            bubbles: true,\n            composed: true\n          }));\n        }\n      } catch (error) {\n        console.error('Error during view switch:', error);\n      }\n    });\n  }\n  const exportHTML = host.shadowRoot?.getElementById('exportHTML');\n  if (exportHTML) {\n    const newExportHTML = exportHTML.cloneNode(true);\n    exportHTML.parentNode?.replaceChild(newExportHTML, exportHTML);\n    newExportHTML.addEventListener('click', () => host.exportToHTML());\n  }\n  const exportPDF = host.shadowRoot?.getElementById('exportPDF');\n  if (exportPDF) {\n    const newExportPDF = exportPDF.cloneNode(true);\n    exportPDF.parentNode?.replaceChild(newExportPDF, exportPDF);\n    newExportPDF.addEventListener('click', () => host.exportToPDF());\n  }\n  const exportExcel = host.shadowRoot?.getElementById('exportExcel');\n  if (exportExcel) {\n    const newExportExcel = exportExcel.cloneNode(true);\n    exportExcel.parentNode?.replaceChild(newExportExcel, exportExcel);\n    newExportExcel.addEventListener('click', () => host.exportToExcel());\n  }\n  const printBtn = host.shadowRoot?.getElementById('printTable');\n  if (printBtn) {\n    const newPrintBtn = printBtn.cloneNode(true);\n    printBtn.parentNode?.replaceChild(newPrintBtn, printBtn);\n    newPrintBtn.addEventListener('click', () => host.openPrintDialog());\n  }\n  const formatBtn = host.shadowRoot?.getElementById('formatButton');\n  if (formatBtn) {\n    const newFormatBtn = formatBtn.cloneNode(true);\n    formatBtn.parentNode?.replaceChild(newFormatBtn, formatBtn);\n    newFormatBtn.addEventListener('click', () => {\n      host.showFormatPopup();\n    });\n  }\n}\nfunction updatePaginationInfo(host) {\n  const pageInfo = host.shadowRoot?.getElementById('pageInfo');\n  if (pageInfo) {\n    const viewMode = host._showRawData ? 'Raw Data' : 'Processed Data';\n    pageInfo.textContent = `${viewMode} - Page ${host._pagination.currentPage} of ${host._pagination.totalPages}`;\n  }\n  const prevButton = host.shadowRoot?.getElementById('prevPage');\n  const nextButton = host.shadowRoot?.getElementById('nextPage');\n  if (prevButton) prevButton.disabled = host._pagination.currentPage <= 1;\n  if (nextButton) nextButton.disabled = host._pagination.currentPage >= host._pagination.totalPages;\n}\n// Drag & drill-down & sort handlers\nfunction addDragListeners(host) {\n  const headers = host.shadowRoot?.querySelectorAll('th[draggable=\"true\"]');\n  headers?.forEach(header => {\n    header.addEventListener('dragstart', e => {\n      handleColumnDragStart(host, e);\n    });\n    header.addEventListener('dragover', e => {\n      handleColumnDragOver(host, e);\n    });\n    header.addEventListener('dragleave', e => {\n      handleColumnDragLeave(host, e);\n    });\n    header.addEventListener('drop', e => {\n      handleColumnDrop(host, e);\n    });\n    header.addEventListener('dragend', () => {\n      handleColumnDragEnd(host);\n    });\n  });\n  const rows = host.shadowRoot?.querySelectorAll('tr[draggable=\"true\"]');\n  rows?.forEach(row => {\n    row.addEventListener('dragstart', e => {\n      handleRowDragStart(host, e);\n    });\n    row.addEventListener('dragover', e => {\n      handleRowDragOver(host, e);\n    });\n    row.addEventListener('dragleave', e => {\n      handleRowDragLeave(host, e);\n    });\n    row.addEventListener('drop', e => {\n      handleRowDrop(host, e);\n    });\n    row.addEventListener('dragend', () => {\n      handleRowDragEnd(host);\n    });\n  });\n  const sortableHeaders = host.shadowRoot?.querySelectorAll('.sortable-header');\n  sortableHeaders?.forEach(header => {\n    header.addEventListener('click', e => {\n      handleSortClick(host, e);\n    });\n  });\n  const drillDownCells = host.shadowRoot?.querySelectorAll('.drill-down-cell');\n  drillDownCells?.forEach(cell => {\n    cell.addEventListener('dblclick', e => {\n      handleDrillDownClick(host, e);\n    });\n  });\n}\nfunction handleSortClick(host, e) {\n  if (!host.engine) return;\n  const target = e.target;\n  const header = target.closest('.sortable-header');\n  if (!header) return;\n  const field = header.dataset.field;\n  if (!field) return;\n  // Calculate next direction based on current engine state\n  const state = host.engine.getState();\n  const current = state.sortConfig && state.sortConfig.length > 0 ? state.sortConfig[0] : null;\n  const nextDir = current && current.field === field && current.direction === 'asc' ? 'desc' : 'asc';\n  // In processed mode, clicking a measure header under a specific column\n  // should sort ROWS by that column's measure aggregate. We compute the row\n  // order and store it in the engine as a custom row order so rendering uses it.\n  if (!host._showRawData) {\n    const isMeasureHeader = header.hasAttribute('data-measure-index');\n    const columnValue = header.getAttribute('data-column-value') || '';\n    if (isMeasureHeader && columnValue) {\n      try {\n        const measures = host._options.measures || [];\n        const measureCfg = measures.find(m => m.uniqueName === field);\n        const aggregation = measureCfg?.aggregation || 'sum';\n        const aggKey = `${aggregation}_${field}`;\n        const groups = host.engine.getGroupedData();\n        // Build the full set of row values across ALL groups (not just those that appear for the selected column)\n        const allRowSet = new Set();\n        groups.forEach(g => {\n          const keys = g.key ? g.key.split('|') : [];\n          if (keys[0]) allRowSet.add(keys[0]);\n        });\n        const allRowValues = Array.from(allRowSet);\n        // Create [row, value] pairs for the target column; treat missing intersections as 0\n        const pairs = allRowValues.map(rv => {\n          const grp = groups.find(gr => {\n            const keys = gr.key ? gr.key.split('|') : [];\n            return keys[0] === rv && keys[1] === columnValue;\n          });\n          const aggregates = grp?.aggregates || {};\n          const val = Number(aggregates[aggKey] ?? 0);\n          return {\n            row: rv,\n            val: isFinite(val) ? val : 0\n          };\n        });\n        // Sort according to nextDir, keeping zero-value rows included\n        pairs.sort((a, b) => nextDir === 'asc' ? a.val - b.val : b.val - a.val);\n        const orderedRows = pairs.map(p => p.row);\n        const rowFieldName = host._options.rows?.[0]?.uniqueName || '';\n        if (rowFieldName && orderedRows.length > 0) {\n          host.engine.setCustomFieldOrder(rowFieldName, orderedRows, true);\n        }\n      } catch (err) {\n        console.error('Failed to compute/set custom row order for processed sort:', err);\n      }\n    } else {\n      // If sorting by the row dimension header, compute alphabetical order\n      const rowFieldName = host._options.rows?.[0]?.uniqueName || '';\n      if (rowFieldName && field === rowFieldName) {\n        try {\n          const groups = host.engine.getGroupedData();\n          const rowSet = new Set();\n          groups.forEach(g => {\n            const keys = g.key ? g.key.split('|') : [];\n            if (keys[0]) rowSet.add(keys[0]);\n          });\n          const rows = Array.from(rowSet);\n          rows.sort((a, b) => nextDir === 'asc' ? a.localeCompare(b) : b.localeCompare(a));\n          if (rows.length > 0) {\n            host.engine.setCustomFieldOrder(rowFieldName, rows, true);\n          }\n        } catch (err) {\n          console.error('Failed to set custom row order for dimension sort:', err);\n        }\n      }\n    }\n  }\n  // Also call engine.sort to update its sort state (icons) and internal groups\n  host.engine.sort(field, nextDir);\n}\nfunction handleDrillDownClick(host, e) {\n  if (!host.engine) return;\n  const cell = e.target.closest('.drill-down-cell');\n  if (!cell) return;\n  const rowValue = cell.getAttribute('data-row-value') || '';\n  const columnValue = cell.getAttribute('data-column-value') || '';\n  const measureName = cell.getAttribute('data-measure-name') || '';\n  const measureCaption = cell.getAttribute('data-measure-caption') || measureName;\n  const rowField = cell.getAttribute('data-row-field') || '';\n  const columnField = cell.getAttribute('data-column-field') || '';\n  const state = host.engine.getState();\n  const rawData = state.rawData || state.data || [];\n  const subset = rawData.filter(r => {\n    const rowOk = rowField ? String(r[rowField] ?? '') === String(rowValue) : true;\n    const colOk = columnField ? String(r[columnField] ?? '') === String(columnValue) : true;\n    return rowOk && colOk;\n  });\n  addModalStylesToDocument();\n  const overlay = document.createElement('div');\n  overlay.className = 'drill-down-modal';\n  const content = document.createElement('div');\n  content.className = 'drill-down-content';\n  content.innerHTML = `\n      <div class=\"drill-down-header\">\n        <div class=\"drill-down-title\">Details: ${rowField}: ${rowValue}${columnField ? `, ${columnField}: ${columnValue}` : ''}</div>\n        <button class=\"drill-down-close\" aria-label=\"Close\">&times;</button>\n      </div>\n      <div class=\"drill-down-summary\">\n        Records: ${subset.length}. Measure: ${measureCaption} (${measureName}).\n      </div>\n      <div class=\"drill-down-body\"></div>\n    `;\n  const bodyDiv = content.querySelector('.drill-down-body');\n  if (subset.length > 0) {\n    const headers = Object.keys(subset[0]);\n    const table = document.createElement('table');\n    table.className = 'drill-down-table';\n    const thead = document.createElement('thead');\n    const trh = document.createElement('tr');\n    headers.forEach(h => {\n      const th = document.createElement('th');\n      th.textContent = h;\n      trh.appendChild(th);\n    });\n    thead.appendChild(trh);\n    table.appendChild(thead);\n    const tbody = document.createElement('tbody');\n    subset.forEach(row => {\n      const tr = document.createElement('tr');\n      headers.forEach(h => {\n        const td = document.createElement('td');\n        const val = row[h];\n        td.textContent = val != null ? String(val) : '';\n        tr.appendChild(td);\n      });\n      tbody.appendChild(tr);\n    });\n    table.appendChild(tbody);\n    bodyDiv.appendChild(table);\n  } else {\n    bodyDiv.textContent = 'No matching records.';\n  }\n  overlay.appendChild(content);\n  document.body.appendChild(overlay);\n  const close = () => overlay.remove();\n  overlay.addEventListener('click', evt => {\n    if (evt.target === overlay) close();\n  });\n  const closeBtn = content.querySelector('.drill-down-close');\n  closeBtn?.addEventListener('click', close);\n}\nfunction addModalStylesToDocument() {\n  if (document.getElementById('pivot-head-modal-styles')) return;\n  const styleEl = document.createElement('style');\n  styleEl.id = 'pivot-head-modal-styles';\n  styleEl.textContent = `\n      .drill-down-modal {\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background-color: rgba(0, 0, 0, 0.5);\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          z-index: 1000;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n      .drill-down-content {\n          background: white;\n          border-radius: 8px;\n          padding: 20px;\n          width: 90%;\n          max-width: 800px;\n          max-height: 80%;\n          overflow: auto;\n          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n      }\n      .drill-down-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 20px;\n          padding-bottom: 10px;\n          border-bottom: 2px solid #e0e0e0;\n      }\n      .drill-down-title { font-size: 18px; font-weight: bold; color: #333; }\n      .drill-down-close {\n          background: #f44336;\n          color: white;\n          border: none;\n          border-radius: 50%;\n          width: 30px;\n          height: 30px;\n          cursor: pointer;\n          font-size: 16px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n      }\n      .drill-down-close:hover { background: #d32f2f; }\n      .drill-down-summary { background: #f5f5f5; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 14px; line-height: 1.4; }\n      .drill-down-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }\n      .drill-down-table th { background: #f8f9fa; padding: 8px; border: 1px solid #dee2e6; font-weight: bold; text-align: left; }\n      .drill-down-table td { padding: 6px 8px; border: 1px solid #dee2e6; }\n      .drill-down-table tr:nth-child(even) { background-color: #f9f9f9; }\n      .drill-down-table tr:hover { background-color: #e3f2fd; }\n    `;\n  document.head.appendChild(styleEl);\n}\n// Sort icons\nfunction createSortIcon(host, field) {\n  if (!host.engine) {\n    return '<span class=\"sort-icon\" title=\"Click to sort\">&#8693;</span>';\n  }\n  const state = host.engine.getState();\n  const sortConfig = state.sortConfig && state.sortConfig.length > 0 ? state.sortConfig[0] : null;\n  const isCurrentlySorted = !!(sortConfig && sortConfig.field === field);\n  if (isCurrentlySorted) {\n    if (sortConfig && sortConfig.direction === 'asc') {\n      return '<span class=\"sort-icon active\" title=\"Sorted ascending\">&#9650;</span>';\n    } else {\n      return '<span class=\"sort-icon active\" title=\"Sorted descending\">&#9660;</span>';\n    }\n  }\n  return '<span class=\"sort-icon\" title=\"Click to sort\">&#8693;</span>';\n}\nfunction createProcessedSortIcon(host, field) {\n  if (!host.engine) {\n    return '<span class=\"sort-icon\" title=\"Click to sort\">&#8693;</span>';\n  }\n  const state = host.engine.getState();\n  const sortConfig = state.sortConfig && state.sortConfig.length > 0 ? state.sortConfig[0] : null;\n  const isCurrentlySorted = !!(sortConfig && sortConfig.field === field);\n  if (isCurrentlySorted) {\n    if (sortConfig && sortConfig.direction === 'asc') {\n      return '<span class=\"sort-icon active\" title=\"Sorted ascending\">&#9650;</span>';\n    } else {\n      return '<span class=\"sort-icon active\" title=\"Sorted descending\">&#9660;</span>';\n    }\n  }\n  return '<span class=\"sort-icon\" title=\"Click to sort\">&#8693;</span>';\n}\nfunction handleColumnDragStart(host, e) {\n  host.draggedColumn = e.target;\n  if (e.dataTransfer) {\n    e.dataTransfer.effectAllowed = 'move';\n    e.dataTransfer.setData('text/plain', host.draggedColumn.dataset.columnIndex || '');\n  }\n  setTimeout(() => host.draggedColumn?.classList.add('dragging'), 0);\n}\nfunction handleColumnDragOver(host, e) {\n  e.preventDefault();\n  if (e.dataTransfer?.types.includes('text/plain')) {\n    const target = e.target;\n    if (target.tagName === 'TH' && target !== host.draggedColumn) {\n      target.classList.add('drag-over');\n    }\n  }\n}\nfunction handleColumnDragLeave(host, e) {\n  e.target.classList.remove('drag-over');\n}\nfunction handleColumnDrop(host, e) {\n  e.preventDefault();\n  const target = e.target;\n  target.classList.remove('drag-over');\n  if (host.draggedColumn && target.tagName === 'TH') {\n    const fromIndex = parseInt(host.draggedColumn.dataset.columnIndex || '0');\n    const toIndex = parseInt(target.dataset.columnIndex || '0');\n    if (fromIndex !== toIndex) host.swapColumns(fromIndex, toIndex);\n  }\n}\nfunction handleColumnDragEnd(host) {\n  host.draggedColumn?.classList.remove('dragging');\n  host.draggedColumn = null;\n  host.shadowRoot?.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));\n}\nfunction handleRowDragStart(host, e) {\n  host.draggedRow = e.target;\n  if (e.dataTransfer) {\n    e.dataTransfer.effectAllowed = 'move';\n    e.dataTransfer.setData('text/plain', host.draggedRow.dataset.rowIndex || '');\n  }\n  setTimeout(() => host.draggedRow?.classList.add('dragging'), 0);\n}\nfunction handleRowDragOver(host, e) {\n  e.preventDefault();\n  if (e.dataTransfer?.types.includes('text/plain')) {\n    const target = e.target;\n    const targetRow = target.closest('tr');\n    if (targetRow && targetRow.tagName === 'TR' && targetRow !== host.draggedRow) {\n      targetRow.classList.add('drag-over');\n    }\n  }\n}\nfunction handleRowDragLeave(host, e) {\n  const target = e.target;\n  const targetRow = target.closest('tr');\n  if (targetRow) targetRow.classList.remove('drag-over');\n}\nfunction handleRowDrop(host, e) {\n  e.preventDefault();\n  const target = e.target;\n  const targetRow = target.closest('tr');\n  if (targetRow) targetRow.classList.remove('drag-over');\n  if (host.draggedRow && targetRow && targetRow.tagName === 'TR') {\n    const fromIndex = parseInt(host.draggedRow.dataset.rowIndex || '0');\n    const toIndex = parseInt(targetRow.dataset.rowIndex || '0');\n    if (fromIndex !== toIndex) host.swapRows(fromIndex, toIndex);\n  }\n}\nfunction handleRowDragEnd(host) {\n  host.draggedRow?.classList.remove('dragging');\n  host.draggedRow = null;\n  host.shadowRoot?.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));\n}\nfunction tryInitializeEngine(host) {\n  const hasData = host._data && host._data.length > 0;\n  const hasOptions = host._options && Object.keys(host._options).length > 0;\n  if (!hasData || !hasOptions) return;\n  try {\n    const options = {\n      ...host._options\n    };\n    if (!options.rows || !Array.isArray(options.rows) || options.rows.length === 0) {\n      const firstRowField = host._data.length > 0 ? Object.keys(host._data[0])[0] : null;\n      if (firstRowField) {\n        options.rows = [{\n          uniqueName: firstRowField,\n          caption: firstRowField\n        }];\n      }\n    }\n    if (!options.columns || !Array.isArray(options.columns) || options.columns.length === 0) {\n      const keys = host._data.length > 0 ? Object.keys(host._data[0]) : [];\n      const colField = keys.length > 1 ? keys[1] : null;\n      if (colField) {\n        options.columns = [{\n          uniqueName: colField,\n          caption: colField\n        }];\n      }\n    }\n    if (!options.measures || !Array.isArray(options.measures) || options.measures.length === 0) {\n      const keys = host._data.length > 0 ? Object.keys(host._data[0]) : [];\n      const measureField = keys.find(k => typeof host._data[0][k] === 'number');\n      if (measureField) {\n        options.measures = [{\n          uniqueName: measureField,\n          caption: `Sum of ${measureField}`,\n          aggregation: 'sum'\n        }];\n      }\n    }\n    if (!options.groupConfig && options.rows && options.columns) {\n      options.groupConfig = {\n        rowFields: options.rows.map(r => r.uniqueName),\n        columnFields: options.columns.map(c => c.uniqueName),\n        grouper: item => {\n          return [...(options.rows?.map(r => item[r.uniqueName]) ?? []), ...(options.columns?.map(c => item[c.uniqueName]) ?? [])].join('|');\n        }\n      };\n    }\n    const config = {\n      data: host._data,\n      rawData: host._data,\n      dimensions: [],\n      defaultAggregation: 'sum',\n      rows: options.rows || [],\n      columns: options.columns || [],\n      measures: options.measures || [],\n      groupConfig: options.groupConfig\n    };\n    host.engine = new PivotEngine(config);\n    // Disable core engine pagination; the web component manages pagination itself\n    // Use a very large page size so engine never slices the data internally\n    host.engine.setPagination({\n      currentPage: 1,\n      pageSize: Number.MAX_SAFE_INTEGER,\n      totalPages: 1\n    });\n    host.engine.setDataHandlingMode(host._showRawData ? 'raw' : 'processed');\n    if (host._engineUnsubscribe) host._engineUnsubscribe();\n    host._engineUnsubscribe = host.engine.subscribe(state => {\n      host.handleEngineStateChange(state);\n    });\n    host._processedColumnOrder = [];\n    const currentFilters = host._showRawData ? host._rawFilters : host._processedFilters;\n    if (currentFilters.length > 0) {\n      host.engine.applyFilters(currentFilters);\n      return;\n    }\n  } catch (error) {\n    console.error('Error initializing PivotEngine:', error);\n  }\n}\nfunction parseAttributesIfNeeded(host) {\n  // Parse data attribute\n  const rawData = host.getAttribute('data');\n  if (rawData && !host._data.length) {\n    try {\n      host.data = JSON.parse(rawData);\n    } catch (error) {\n      console.error('Error parsing data attribute:', error);\n    }\n  }\n  // Parse options attribute\n  const rawOptions = host.getAttribute('options');\n  if (rawOptions && !Object.keys(host._options).length) {\n    try {\n      host.options = JSON.parse(rawOptions);\n    } catch (error) {\n      console.error('Error parsing options attribute:', error);\n    }\n  }\n  // Parse other attributes\n  parseOtherAttributes(host);\n}\nfunction parseOtherAttributes(host) {\n  // Parse filters\n  const rawFilters = host.getAttribute('filters');\n  if (rawFilters) {\n    try {\n      host.filters = JSON.parse(rawFilters);\n    } catch (error) {\n      console.error('Error parsing filters attribute:', error);\n    }\n  }\n  // Parse pagination\n  const rawPagination = host.getAttribute('pagination');\n  if (rawPagination) {\n    try {\n      host.pagination = {\n        ...host._pagination,\n        ...JSON.parse(rawPagination)\n      };\n    } catch (error) {\n      console.error('Error parsing pagination attribute:', error);\n    }\n  }\n}\nfunction attributeChanged(host, name, oldValue, newValue) {\n  if (oldValue === newValue) return;\n  if (name === 'mode') {\n    renderSwitch(host);\n    return;\n  }\n  switch (name) {\n    case 'data':\n      if (newValue) {\n        try {\n          host.data = JSON.parse(newValue);\n        } catch (error) {\n          console.error('Error parsing data attribute:', error);\n        }\n      }\n      break;\n    case 'options':\n      if (newValue) {\n        try {\n          host.options = JSON.parse(newValue);\n        } catch (error) {\n          console.error('Error parsing options attribute:', error);\n        }\n      }\n      break;\n    case 'filters':\n      if (newValue) {\n        try {\n          host.filters = JSON.parse(newValue);\n        } catch (error) {\n          console.error('Error parsing filters attribute:', error);\n        }\n      } else {\n        host.filters = [];\n      }\n      break;\n    case 'pagination':\n      if (newValue) {\n        try {\n          host.pagination = {\n            ...host._pagination,\n            ...JSON.parse(newValue)\n          };\n        } catch (error) {\n          console.error('Error parsing pagination attribute:', error);\n        }\n      } else {\n        host.pagination = {\n          currentPage: 1,\n          pageSize: 30,\n          totalPages: 1\n        };\n      }\n      break;\n  }\n}\nfunction calculatePaginationForCurrentView(host) {\n  if (host._showRawData) {\n    if (!host.engine) return;\n    const state = host.engine.getState();\n    // Use full rawData first; state.data may be limited\n    const allRawData = state.rawData || state.data || [];\n    updatePaginationForData(host, allRawData);\n  } else {\n    if (!host.engine) return;\n    const groupedData = host.engine.getGroupedData();\n    let uniqueRowValues = host.engine.getOrderedRowValues();\n    if (!uniqueRowValues) {\n      uniqueRowValues = [...new Set(groupedData.map(g => {\n        const keys = g.key ? g.key.split('|') : [];\n        return keys[0];\n      }))].filter(Boolean);\n    }\n    updatePaginationForData(host, uniqueRowValues);\n  }\n}\nfunction updatePaginationForData(host, data) {\n  const pageSize = host._pagination.pageSize;\n  const totalPages = Math.ceil(data.length / pageSize) || 1;\n  if (host._pagination.currentPage > totalPages) {\n    host._pagination.currentPage = Math.max(1, totalPages);\n  }\n  host._pagination.totalPages = totalPages;\n}\nfunction getPaginatedData(host, data) {\n  const start = (host._pagination.currentPage - 1) * host._pagination.pageSize;\n  const end = start + host._pagination.pageSize;\n  return data.slice(start, end);\n}\nfunction previousPage(host) {\n  if (host._pagination.currentPage > 1) {\n    host._pagination.currentPage--;\n    renderSwitch(host);\n    host.dispatchEvent(new CustomEvent('paginationChange', {\n      detail: {\n        ...host._pagination\n      },\n      bubbles: true,\n      composed: true\n    }));\n  }\n  updatePaginationInfo(host);\n}\nfunction nextPage(host) {\n  if (host._pagination.currentPage < host._pagination.totalPages) {\n    host._pagination.currentPage++;\n    renderSwitch(host);\n    host.dispatchEvent(new CustomEvent('paginationChange', {\n      detail: {\n        ...host._pagination\n      },\n      bubbles: true,\n      composed: true\n    }));\n  }\n  updatePaginationInfo(host);\n}\nfunction setPageSize(host, pageSize) {\n  if (pageSize > 0) {\n    host._pagination.pageSize = pageSize;\n    host._pagination.currentPage = 1;\n    calculatePaginationForCurrentView(host);\n    renderSwitch(host);\n    host.dispatchEvent(new CustomEvent('paginationChange', {\n      detail: {\n        ...host._pagination\n      },\n      bubbles: true,\n      composed: true\n    }));\n  }\n  updatePaginationInfo(host);\n}\nfunction goToPage(host, page) {\n  if (page >= 1 && page <= host._pagination.totalPages) {\n    host._pagination.currentPage = page;\n    renderSwitch(host);\n    host.dispatchEvent(new CustomEvent('paginationChange', {\n      detail: {\n        ...host._pagination\n      },\n      bubbles: true,\n      composed: true\n    }));\n  }\n  updatePaginationInfo(host);\n}\nfunction getState(host) {\n  if (!host.engine) {\n    throw new Error('Engine not initialized');\n  }\n  return host.engine.getState();\n}\nfunction sort(host, field, direction) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  host.engine.sort(field, direction);\n}\nfunction setMeasures(host, measures) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  host.engine.setMeasures(measures);\n}\nfunction setDimensions(host, dimensions) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  host.engine.setDimensions(dimensions);\n}\nfunction setGroupConfig(host, groupConfig) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  host.engine.setGroupConfig(groupConfig);\n}\nfunction setAggregation(host, type) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  host.engine.setAggregation(type);\n}\nfunction formatValue(host, value, field) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return String(value);\n  }\n  return host.engine.formatValue(value, field);\n}\nfunction getGroupedData(host) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return [];\n  }\n  return host.engine.getGroupedData();\n}\nfunction getData(host) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return [];\n  }\n  return host.engine.getState().rawData;\n}\nfunction getProcessedData(host) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return null;\n  }\n  return host.engine.getState().processedData;\n}\nfunction updateFieldFormatting(host, field, format) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  host.engine.updateFieldFormatting(field, format);\n}\nfunction getFieldAlignment(host, field) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return 'left';\n  }\n  return host.engine.getFieldAlignment(field);\n}\n\n// Filters\nfunction setFilters(host, value) {\n  console.log('Setting filters, current view mode:', host._showRawData ? 'RAW' : 'PROCESSED');\n  console.log('New filter value:', value);\n  if (host._showRawData) {\n    host._rawFilters = value || [];\n    console.log('Applied RAW filters:', host._rawFilters);\n  } else {\n    host._processedFilters = value || [];\n    console.log('Applied PROCESSED filters:', host._processedFilters);\n  }\n  if (host.engine) {\n    host.engine.setDataHandlingMode(host._showRawData ? 'raw' : 'processed');\n    host.engine.applyFilters(value || []);\n  }\n  host._filters = value || [];\n  host.setAttribute('filters', JSON.stringify(value));\n}\nfunction getFilters(host) {\n  if (host._showRawData) {\n    return host._rawFilters;\n  } else {\n    return host._processedFilters;\n  }\n}\n// Refresh/reset\nfunction refresh(host) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  host._filters = [];\n  host.removeAttribute('filters');\n  host.engine.reset();\n  const filterValueInput = host.shadowRoot?.getElementById('filterValue');\n  if (filterValueInput) {\n    filterValueInput.value = '';\n  }\n}\nfunction reset(host) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  host._rawFilters = [];\n  host._processedFilters = [];\n  host._filters = [];\n  host.removeAttribute('filters');\n  host._pagination.currentPage = 1;\n  host.engine.reset();\n  clearFilterUI(host);\n}\nfunction clearFilterUI(host) {\n  const filterValueInput = host.shadowRoot?.getElementById('filterValue');\n  if (filterValueInput) {\n    filterValueInput.value = '';\n  }\n  const filterFieldSelect = host.shadowRoot?.getElementById('filterField');\n  const filterOperatorSelect = host.shadowRoot?.getElementById('filterOperator');\n  if (filterFieldSelect) filterFieldSelect.selectedIndex = 0;\n  if (filterOperatorSelect) filterOperatorSelect.selectedIndex = 0;\n}\n\n// Exporting helpers\nfunction exportToHTML(host, fileName = 'pivot-table') {\n  if (!host.engine) {\n    console.error('Engine not initialized. Cannot export to HTML.');\n    return;\n  }\n  host.engine.exportToHTML(fileName);\n}\nfunction exportToPDF(host, fileName = 'pivot-table') {\n  if (!host.engine) {\n    console.error('Engine not initialized. Cannot export to PDF.');\n    return;\n  }\n  host.engine.exportToPDF(fileName);\n}\nfunction exportToExcel(host, fileName = 'pivot-table') {\n  if (!host.engine) {\n    console.error('Engine not initialized. Cannot export to Excel.');\n    return;\n  }\n  host.engine.exportToExcel(fileName);\n}\nfunction openPrintDialog(host) {\n  if (!host.engine) {\n    console.error('Engine not initialized. Cannot open print dialog.');\n    return;\n  }\n  host.engine.openPrintDialog();\n}\n// File I/O helpers\nfunction loadFromFile(host, file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      try {\n        const result = event.target?.result;\n        if (typeof result === 'string') {\n          const data = JSON.parse(result);\n          host.data = data;\n          resolve();\n        } else {\n          reject(new Error('Failed to read file as text'));\n        }\n      } catch (error) {\n        reject(error);\n      }\n    };\n    reader.onerror = () => reject(new Error('Failed to read file'));\n    reader.readAsText(file);\n  });\n}\nfunction loadFromUrl(host, url) {\n  return fetch(url).then(response => {\n    if (!response.ok) {\n      throw new Error(`Failed to fetch data from ${url}: ${response.status} ${response.statusText}`);\n    }\n    return response.json();\n  }).then(data => {\n    host.data = data;\n  });\n}\nfunction dragRow(host, fromIndex, toIndex) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  host.engine.dragRow(fromIndex, toIndex);\n}\nfunction dragColumn(host, fromIndex, toIndex) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  host.engine.dragColumn(fromIndex, toIndex);\n}\nfunction swapRows(host, fromIndex, toIndex) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  try {\n    if (host._showRawData) {\n      host.engine.swapRawDataRows(fromIndex, toIndex);\n    } else {\n      host.engine.swapDataRows(fromIndex, toIndex);\n    }\n  } catch (error) {\n    console.error('Row swap failed:', error);\n  }\n}\nfunction swapColumns(host, fromIndex, toIndex) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  try {\n    if (host._showRawData) {\n      const headers = host._data.length > 0 ? Object.keys(host._data[0]) : [];\n      if (fromIndex < 0 || toIndex < 0 || fromIndex >= headers.length || toIndex >= headers.length) {\n        console.error(`Invalid column indices for raw data swap: ${fromIndex}, ${toIndex}, total: ${headers.length}`);\n        return;\n      }\n      if (!host._rawDataColumnOrder || host._rawDataColumnOrder.length === 0) {\n        host._rawDataColumnOrder = [...headers];\n      }\n      const temp = host._rawDataColumnOrder[fromIndex];\n      host._rawDataColumnOrder[fromIndex] = host._rawDataColumnOrder[toIndex];\n      host._rawDataColumnOrder[toIndex] = temp;\n      host.renderRawTable();\n    } else {\n      host.engine.swapDataColumns(fromIndex, toIndex);\n      const newOrder = host.engine.getOrderedColumnValues();\n      if (newOrder) host._processedColumnOrder = [...newOrder];\n    }\n  } catch (error) {\n    console.error('Column swap failed:', error);\n  }\n}\nfunction swapRawDataColumns(host, fromIndex, toIndex) {\n  if (!host._data || host._data.length === 0) {\n    console.error('No raw data available for column swap');\n    return;\n  }\n  const headers = Object.keys(host._data[0]);\n  if (fromIndex < 0 || toIndex < 0 || fromIndex >= headers.length || toIndex >= headers.length) {\n    console.error(`Invalid column indices for raw data swap: ${fromIndex}, ${toIndex}, total: ${headers.length}`);\n    return;\n  }\n  if (fromIndex === toIndex) return;\n  if (!host._rawDataColumnOrder) host._rawDataColumnOrder = [...headers];\n  const temp = host._rawDataColumnOrder[fromIndex];\n  host._rawDataColumnOrder[fromIndex] = host._rawDataColumnOrder[toIndex];\n  host._rawDataColumnOrder[toIndex] = temp;\n  host.renderRawTable();\n}\nfunction setDragAndDropEnabled(host, enabled) {\n  const table = host.shadowRoot?.querySelector('table');\n  if (table) {\n    if (enabled) {\n      host.addDragListeners();\n    } else {\n      const draggableElements = table.querySelectorAll('[draggable=\"true\"]');\n      draggableElements.forEach(element => {\n        element.setAttribute('draggable', 'false');\n      });\n    }\n  }\n}\nfunction isDragAndDropEnabled(host) {\n  const firstDraggableElement = host.shadowRoot?.querySelector('[draggable=\"true\"]');\n  return !!firstDraggableElement;\n}\nfunction showFormatPopup(host) {\n  if (!host.engine) {\n    console.error('Engine not initialized');\n    return;\n  }\n  const state = host.engine.getState();\n  const availableMeasures = state.measures || [];\n  // Get available fields based on current mode - only numeric/measure fields\n  let availableFields = [];\n  if (host._showRawData) {\n    // For raw data, get only numeric fields (measures) from the data\n    if (state.rawData && state.rawData.length > 0) {\n      const allFields = Object.keys(state.rawData[0]);\n      // Filter to only include measure fields (price, discount, etc.)\n      availableFields = allFields.filter(field => {\n        const sampleValue = state.rawData[0][field];\n        return typeof sampleValue === 'number';\n      });\n    }\n  } else {\n    // For processed data, get measure names\n    availableFields = availableMeasures.map(measure => measure.caption || measure.uniqueName);\n  }\n  const overlay = document.createElement('div');\n  overlay.style.position = 'fixed';\n  overlay.style.top = '0';\n  overlay.style.left = '0';\n  overlay.style.width = '100%';\n  overlay.style.height = '100%';\n  overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\n  overlay.style.display = 'flex';\n  overlay.style.justifyContent = 'center';\n  overlay.style.alignItems = 'center';\n  overlay.style.zIndex = '1000';\n  const popup = document.createElement('div');\n  popup.style.width = '400px';\n  popup.style.padding = '20px';\n  popup.style.backgroundColor = '#fff';\n  popup.style.borderRadius = '8px';\n  popup.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';\n  const header = document.createElement('h2');\n  header.textContent = 'Format cells';\n  header.style.margin = '0 0 10px 0';\n  header.style.textAlign = 'left';\n  const headerSeparator = document.createElement('hr');\n  headerSeparator.style.border = '0';\n  headerSeparator.style.height = '1px';\n  headerSeparator.style.backgroundColor = '#ccc';\n  headerSeparator.style.margin = '10px 0';\n  const formContainer = document.createElement('div');\n  // Form fields configuration\n  const fields = [{\n    name: 'Choose value',\n    options: ['Choose value', 'All values', ...availableFields]\n  }, {\n    name: 'Text align',\n    options: ['right', 'left', 'center']\n  }, {\n    name: 'Thousand separator',\n    options: ['(Space)', '(Comma)', '(None)', '(Dot)']\n  }, {\n    name: 'Decimal separator',\n    options: ['.', ',']\n  }, {\n    name: 'Decimal places',\n    options: ['None', '0', '1', '2', '3', '4', '5']\n  }, {\n    name: 'Currency symbol',\n    options: ['', '$', '', '', '']\n  }, {\n    name: 'Currency align',\n    options: ['left', 'right']\n  }, {\n    name: 'Null value',\n    options: ['', 'null', '0', 'N/A', '-']\n  }, {\n    name: 'Format as percent',\n    options: ['false', 'true']\n  }];\n  const formValues = {};\n  const dropdownElements = [];\n  fields.forEach((field, index) => {\n    const row = document.createElement('div');\n    row.style.display = 'flex';\n    row.style.alignItems = 'center';\n    row.style.marginBottom = '15px';\n    const label = document.createElement('label');\n    label.textContent = field.name;\n    label.style.flex = '1';\n    label.style.marginRight = '10px';\n    label.style.textAlign = 'left';\n    const dropdown = document.createElement('select');\n    dropdown.style.flex = '2';\n    dropdown.style.padding = '8px';\n    dropdown.style.borderRadius = '4px';\n    dropdown.style.border = '1px solid #ccc';\n    // Populate dropdown options\n    field.options.forEach(optionText => {\n      const option = document.createElement('option');\n      option.value = optionText;\n      option.textContent = optionText;\n      dropdown.appendChild(option);\n    });\n    // Set initial value\n    formValues[field.name] = field.options[0];\n    // Disable all fields except first one initially\n    if (index !== 0) {\n      dropdown.disabled = true;\n    }\n    // Handle change events\n    dropdown.addEventListener('change', e => {\n      const target = e.target;\n      formValues[field.name] = target.value;\n      // Enable/disable other fields based on first field\n      if (index === 0) {\n        const selectedValue = target.value;\n        dropdownElements.forEach((el, i) => {\n          if (i !== 0) {\n            el.disabled = selectedValue === 'Choose value';\n          }\n        });\n      }\n    });\n    row.appendChild(label);\n    row.appendChild(dropdown);\n    formContainer.appendChild(row);\n    dropdownElements.push(dropdown);\n  });\n  const buttonContainer = document.createElement('div');\n  buttonContainer.style.display = 'flex';\n  buttonContainer.style.justifyContent = 'flex-end';\n  buttonContainer.style.marginTop = '20px';\n  const applyButton = document.createElement('button');\n  applyButton.textContent = 'APPLY';\n  applyButton.style.padding = '10px 20px';\n  applyButton.style.backgroundColor = '#666';\n  applyButton.style.color = '#fff';\n  applyButton.style.border = 'none';\n  applyButton.style.borderRadius = '4px';\n  applyButton.style.cursor = 'pointer';\n  applyButton.style.marginRight = '10px';\n  const cancelButton = document.createElement('button');\n  cancelButton.textContent = 'CANCEL';\n  cancelButton.style.padding = '10px 20px';\n  cancelButton.style.backgroundColor = '#f5f5f5';\n  cancelButton.style.color = '#333';\n  cancelButton.style.border = '1px solid #ccc';\n  cancelButton.style.borderRadius = '4px';\n  cancelButton.style.cursor = 'pointer';\n  // Event handlers\n  cancelButton.addEventListener('click', () => {\n    document.body.removeChild(overlay);\n  });\n  applyButton.addEventListener('click', () => {\n    const selectedField = formValues['Choose value'];\n    if (selectedField && selectedField !== 'Choose value') {\n      // Map UI values to FormatOptions\n      const formatOptions = {};\n      // Text align\n      if (formValues['Text align']) {\n        formatOptions.align = formValues['Text align'];\n      }\n      // Thousand separator\n      const thousandSep = formValues['Thousand separator'];\n      if (thousandSep === '(Space)') formatOptions.thousandSeparator = ' ';else if (thousandSep === '(Comma)') formatOptions.thousandSeparator = ',';else if (thousandSep === '(None)') formatOptions.thousandSeparator = '';else if (thousandSep === '(Dot)') formatOptions.thousandSeparator = '.';\n      // Decimal separator\n      if (formValues['Decimal separator']) {\n        formatOptions.decimalSeparator = formValues['Decimal separator'];\n      }\n      // Decimal places\n      if (formValues['Decimal places'] && formValues['Decimal places'] !== 'None') {\n        formatOptions.decimals = parseInt(formValues['Decimal places'], 10);\n      }\n      // Currency\n      const currencySymbol = formValues['Currency symbol'];\n      if (currencySymbol) {\n        formatOptions.type = 'currency';\n        if (currencySymbol === '$') formatOptions.currency = 'USD';else if (currencySymbol === '') formatOptions.currency = 'INR';else if (currencySymbol === '') formatOptions.currency = 'EUR';else if (currencySymbol === '') formatOptions.currency = 'GBP';\n      }\n      // Currency align\n      if (formValues['Currency align']) {\n        formatOptions.currencyAlign = formValues['Currency align'];\n      }\n      // Null value\n      if (formValues['Null value']) {\n        formatOptions.nullValue = formValues['Null value'] === 'null' ? null : formValues['Null value'];\n      }\n      // Format as percent\n      if (formValues['Format as percent'] === 'true') {\n        formatOptions.percent = true;\n        formatOptions.type = 'percentage';\n      }\n      // Apply formatting\n      try {\n        if (host.engine) {\n          if (selectedField === 'All values') {\n            // Apply to all numeric fields\n            if (host._showRawData) {\n              // For raw data, apply to all numeric fields\n              if (state.rawData && state.rawData.length > 0) {\n                const allFields = Object.keys(state.rawData[0]);\n                const numericFields = allFields.filter(field => {\n                  const sampleValue = state.rawData[0][field];\n                  return typeof sampleValue === 'number';\n                });\n                numericFields.forEach(field => {\n                  if (host.engine) {\n                    host.engine.updateFieldFormatting(field, formatOptions);\n                  }\n                });\n                console.log('Applied formatting to all numeric fields:', numericFields);\n              }\n            } else {\n              // For processed data, apply to all measures\n              availableMeasures.forEach(measure => {\n                if (host.engine) {\n                  host.engine.updateFieldFormatting(measure.uniqueName, formatOptions);\n                }\n              });\n              console.log('Applied formatting to all measures:', availableMeasures.map(m => m.uniqueName));\n            }\n          } else {\n            // Apply to specific field\n            let fieldName = selectedField;\n            if (!host._showRawData) {\n              // For processed data, find the measure's uniqueName\n              const measure = availableMeasures.find(m => m.caption === selectedField || m.uniqueName === selectedField);\n              if (measure) {\n                fieldName = measure.uniqueName;\n              }\n            }\n            host.engine.updateFieldFormatting(fieldName, formatOptions);\n            console.log('Applied formatting:', formatOptions, 'to field:', fieldName);\n          }\n          // Trigger re-render\n          host._renderSwitch();\n        }\n      } catch (error) {\n        console.error('Error applying formatting:', error);\n      }\n    }\n    document.body.removeChild(overlay);\n  });\n  buttonContainer.appendChild(applyButton);\n  buttonContainer.appendChild(cancelButton);\n  popup.appendChild(header);\n  popup.appendChild(headerSeparator);\n  popup.appendChild(formContainer);\n  popup.appendChild(buttonContainer);\n  overlay.appendChild(popup);\n  document.body.appendChild(overlay);\n}\nclass PivotHeadElement extends HTMLElement {\n  static get observedAttributes() {\n    return ['data', 'options', 'filters', 'pagination', 'mode'];\n  }\n  constructor() {\n    super();\n    this._engineUnsubscribe = null;\n    this._data = [];\n    this._originalData = [];\n    this._options = {};\n    this._filters = [];\n    this._rawFilters = [];\n    this._processedFilters = [];\n    this._rowGroups = [];\n    this._columnGroups = [];\n    this._pagination = {\n      currentPage: 1,\n      pageSize: 10,\n      totalPages: 1\n    };\n    this._showRawData = false;\n    this._rawDataColumnOrder = [];\n    this._processedColumnOrder = [];\n    this.draggedColumn = null;\n    this.draggedRow = null;\n    this.attachShadow({\n      mode: 'open'\n    });\n  }\n  set data(value) {\n    this._data = value || [];\n    this._originalData = [...(value || [])];\n    this.tryInitializeEngine();\n  }\n  get data() {\n    return this._data;\n  }\n  set options(value) {\n    this._options = value || {};\n    this.tryInitializeEngine();\n  }\n  get options() {\n    return this._options;\n  }\n  set filters(value) {\n    setFilters(this, value);\n  }\n  get filters() {\n    return getFilters(this);\n  }\n  set pagination(value) {\n    this._pagination = {\n      ...this._pagination,\n      ...value\n    };\n    this.setAttribute('pagination', JSON.stringify(this._pagination));\n    this._renderSwitch();\n  }\n  get pagination() {\n    return this._pagination;\n  }\n  handleEngineStateChange(state) {\n    handleEngineStateChange(this, state);\n  }\n  tryInitializeEngine() {\n    tryInitializeEngine(this);\n  }\n  connectedCallback() {\n    if (!this._data.length && !Object.keys(this._options).length) {\n      parseAttributesIfNeeded(this);\n    }\n    this._renderSwitch();\n  }\n  parseAttributesIfNeeded() {\n    parseAttributesIfNeeded(this);\n  }\n  parseOtherAttributes() {\n    parseOtherAttributes(this);\n  }\n  attributeChangedCallback(name, oldValue, newValue) {\n    attributeChanged(this, name, oldValue, newValue);\n  }\n  _renderSwitch() {\n    renderSwitch(this);\n  }\n  renderFullUI() {\n    renderFullUI(this);\n  }\n  setupControls() {\n    bindControls(this);\n  }\n  updatePaginationInfo() {\n    updatePaginationInfo(this);\n  }\n  calculatePaginationForCurrentView() {\n    calculatePaginationForCurrentView(this);\n  }\n  updatePaginationForData(data) {\n    updatePaginationForData(this, data);\n  }\n  getPaginatedData(data) {\n    return getPaginatedData(this, data);\n  }\n  renderRawTable() {\n    renderRawTable(this);\n  }\n  createSortIcon(field) {\n    return createSortIcon(this, field);\n  }\n  createProcessedSortIcon(field) {\n    return createProcessedSortIcon(this, field);\n  }\n  addDragListeners() {\n    addDragListeners(this);\n  }\n  handleSortClick(e) {\n    handleSortClick(this, e);\n  }\n  handleDrillDownClick(e) {\n    handleDrillDownClick(this, e);\n  }\n  getRawData() {\n    return this._data;\n  }\n  getPagination() {\n    return this._pagination;\n  }\n  getState() {\n    return getState(this);\n  }\n  refresh() {\n    refresh(this);\n  }\n  reset() {\n    reset(this);\n  }\n  clearFilterUI() {\n    clearFilterUI(this);\n  }\n  sort(field, direction) {\n    sort(this, field, direction);\n  }\n  setMeasures(measures) {\n    setMeasures(this, measures);\n  }\n  setDimensions(dimensions) {\n    setDimensions(this, dimensions);\n  }\n  setGroupConfig(groupConfig) {\n    setGroupConfig(this, groupConfig);\n  }\n  setAggregation(type) {\n    setAggregation(this, type);\n  }\n  formatValue(value, field) {\n    return formatValue(this, value, field);\n  }\n  getGroupedData() {\n    return getGroupedData(this);\n  }\n  getFilters() {\n    return this._filters;\n  }\n  getData() {\n    return getData(this);\n  }\n  getProcessedData() {\n    return getProcessedData(this);\n  }\n  exportToHTML(fileName = 'pivot-table') {\n    exportToHTML(this, fileName);\n  }\n  exportToPDF(fileName = 'pivot-table') {\n    exportToPDF(this, fileName);\n  }\n  exportToExcel(fileName = 'pivot-table') {\n    exportToExcel(this, fileName);\n  }\n  openPrintDialog() {\n    openPrintDialog(this);\n  }\n  loadFromFile(file) {\n    return loadFromFile(this, file);\n  }\n  loadFromUrl(url) {\n    return loadFromUrl(this, url);\n  }\n  dragRow(fromIndex, toIndex) {\n    dragRow(this, fromIndex, toIndex);\n  }\n  dragColumn(fromIndex, toIndex) {\n    dragColumn(this, fromIndex, toIndex);\n  }\n  swapRows(fromIndex, toIndex) {\n    swapRows(this, fromIndex, toIndex);\n  }\n  swapColumns(fromIndex, toIndex) {\n    swapColumns(this, fromIndex, toIndex);\n  }\n  swapRawDataColumns(fromIndex, toIndex) {\n    swapRawDataColumns(this, fromIndex, toIndex);\n  }\n  setDragAndDropEnabled(enabled) {\n    setDragAndDropEnabled(this, enabled);\n  }\n  isDragAndDropEnabled() {\n    return isDragAndDropEnabled(this);\n  }\n  swapDataRowsByIndex(fromIndex, toIndex) {\n    this.swapRows(fromIndex, toIndex);\n  }\n  swapDataColumnsByIndex(fromIndex, toIndex) {\n    this.swapColumns(fromIndex, toIndex);\n  }\n  previousPage() {\n    previousPage(this);\n  }\n  nextPage() {\n    nextPage(this);\n  }\n  setPageSize(pageSize) {\n    setPageSize(this, pageSize);\n  }\n  goToPage(page) {\n    goToPage(this, page);\n  }\n  setViewMode(mode) {\n    const wantRaw = mode === 'raw';\n    if (this._showRawData === wantRaw) return;\n    this._showRawData = wantRaw;\n    if (!this.engine) return;\n    try {\n      this.engine.setDataHandlingMode(wantRaw ? 'raw' : 'processed');\n      const currentFilters = wantRaw ? this._rawFilters : this._processedFilters;\n      this.engine.applyFilters(currentFilters);\n      this.dispatchEvent(new CustomEvent('viewModeChange', {\n        detail: {\n          mode\n        },\n        bubbles: true,\n        composed: true\n      }));\n    } catch (err) {\n      console.error('Failed to set view mode:', err);\n    }\n  }\n  getViewMode() {\n    return this._showRawData ? 'raw' : 'processed';\n  }\n  updateFieldFormatting(field, format) {\n    updateFieldFormatting(this, field, format);\n  }\n  getFieldAlignment(field) {\n    return getFieldAlignment(this, field);\n  }\n  showFormatPopup() {\n    showFormatPopup(this);\n  }\n}\ncustomElements.define('pivot-head', PivotHeadElement);\nexport { PivotHeadElement };\n//# sourceMappingURL=pivot-head.mjs.map",
  "map": {
    "version": 3,
    "names": [
      "PivotEngine",
      "renderSwitch",
      "host",
      "mode",
      "getAttribute",
      "shadowRoot",
      "innerHTML",
      "_showRawData",
      "renderRawTable",
      "renderFullUI",
      "handleEngineStateChange",
      "state",
      "dispatchEvent",
      "CustomEvent",
      "detail",
      "bubbles",
      "composed",
      "calculatePaginationForCurrentView",
      "engine",
      "getState",
      "processedData",
      "console",
      "error",
      "rowField",
      "_options",
      "rows",
      "columnField",
      "columns",
      "measures",
      "length",
      "html",
      "_pagination",
      "currentPage",
      "totalPages",
      "groupedData",
      "getGroupedData",
      "uniqueColumnValues",
      "getOrderedColumnValues",
      "Set",
      "map",
      "g",
      "keys",
      "key",
      "split",
      "filter",
      "Boolean",
      "_processedColumnOrder",
      "col",
      "includes",
      "caption",
      "forEach",
      "colValue",
      "index",
      "rowSortIcon",
      "createProcessedSortIcon",
      "uniqueName",
      "measure",
      "measureIndex",
      "sortIcon",
      "orderedFromEngine",
      "getOrderedRowValues",
      "uniqueRowValues",
      "allGroups",
      "paginatedRowValues",
      "getPaginatedData",
      "rowValue",
      "rowIndex",
      "matchingGroup",
      "find",
      "aggKey",
      "aggregation",
      "value",
      "aggregates",
      "formattedValue",
      "undefined",
      "formatValue",
      "hasData",
      "Number",
      "cellClass",
      "cellTitle",
      "textAlign",
      "getFieldAlignment",
      "addDragListeners",
      "setupControls",
      "allRawData",
      "rawData",
      "data",
      "updatePaginationForData",
      "displayData",
      "originalHeaders",
      "Object",
      "headers",
      "_rawDataColumnOrder",
      "missingHeaders",
      "h",
      "header",
      "createSortIcon",
      "row",
      "pivotRow",
      "cellValue",
      "bindControls",
      "filterField",
      "getElementById",
      "_data",
      "f",
      "join",
      "options",
      "aggregatedKey",
      "filterValueInput",
      "_filters",
      "currentFilter",
      "filterFieldElement",
      "filterOperatorElement",
      "field",
      "operator",
      "pageSizeSelect",
      "Array",
      "from",
      "option",
      "removeAttribute",
      "selected",
      "pageSize",
      "toString",
      "selectedOption",
      "querySelector",
      "setAttribute",
      "applyBtn",
      "newApplyBtn",
      "cloneNode",
      "parentNode",
      "replaceChild",
      "addEventListener",
      "fieldElement",
      "operatorElement",
      "valueElement",
      "filters",
      "resetBtn",
      "newResetBtn",
      "reset",
      "pageSizeSel",
      "newPageSizeSel",
      "e",
      "target",
      "setPageSize",
      "prevBtn",
      "newPrevBtn",
      "previousPage",
      "nextBtn",
      "newNextBtn",
      "nextPage",
      "updatePaginationInfo",
      "switchBtn",
      "newSwitchBtn",
      "textContent",
      "setDataHandlingMode",
      "currentFilters",
      "_rawFilters",
      "_processedFilters",
      "applyFilters",
      "exportHTML",
      "newExportHTML",
      "exportToHTML",
      "exportPDF",
      "newExportPDF",
      "exportToPDF",
      "exportExcel",
      "newExportExcel",
      "exportToExcel",
      "printBtn",
      "newPrintBtn",
      "openPrintDialog",
      "formatBtn",
      "newFormatBtn",
      "showFormatPopup",
      "pageInfo",
      "viewMode",
      "prevButton",
      "nextButton",
      "disabled",
      "querySelectorAll",
      "handleColumnDragStart",
      "handleColumnDragOver",
      "handleColumnDragLeave",
      "handleColumnDrop",
      "handleColumnDragEnd",
      "handleRowDragStart",
      "handleRowDragOver",
      "handleRowDragLeave",
      "handleRowDrop",
      "handleRowDragEnd",
      "sortableHeaders",
      "handleSortClick",
      "drillDownCells",
      "cell",
      "handleDrillDownClick",
      "closest",
      "dataset",
      "current",
      "sortConfig",
      "nextDir",
      "direction",
      "isMeasureHeader",
      "hasAttribute",
      "columnValue",
      "measureCfg",
      "m",
      "groups",
      "allRowSet",
      "add",
      "allRowValues",
      "pairs",
      "rv",
      "grp",
      "gr",
      "val",
      "isFinite",
      "sort",
      "a",
      "b",
      "orderedRows",
      "p",
      "rowFieldName",
      "setCustomFieldOrder",
      "err",
      "rowSet",
      "localeCompare",
      "measureName",
      "measureCaption",
      "subset",
      "r",
      "rowOk",
      "String",
      "colOk",
      "addModalStylesToDocument",
      "overlay",
      "document",
      "createElement",
      "className",
      "content",
      "bodyDiv",
      "table",
      "thead",
      "trh",
      "th",
      "appendChild",
      "tbody",
      "tr",
      "td",
      "body",
      "close",
      "remove",
      "evt",
      "closeBtn",
      "styleEl",
      "id",
      "head",
      "isCurrentlySorted",
      "draggedColumn",
      "dataTransfer",
      "effectAllowed",
      "setData",
      "columnIndex",
      "setTimeout",
      "classList",
      "preventDefault",
      "types",
      "tagName",
      "fromIndex",
      "parseInt",
      "toIndex",
      "swapColumns",
      "el",
      "draggedRow",
      "targetRow",
      "swapRows",
      "tryInitializeEngine",
      "hasOptions",
      "isArray",
      "firstRowField",
      "colField",
      "measureField",
      "k",
      "groupConfig",
      "rowFields",
      "columnFields",
      "c",
      "grouper",
      "item",
      "config",
      "dimensions",
      "defaultAggregation",
      "setPagination",
      "MAX_SAFE_INTEGER",
      "_engineUnsubscribe",
      "subscribe",
      "parseAttributesIfNeeded",
      "JSON",
      "parse",
      "rawOptions",
      "parseOtherAttributes",
      "rawFilters",
      "rawPagination",
      "pagination",
      "attributeChanged",
      "name",
      "oldValue",
      "newValue",
      "Math",
      "ceil",
      "max",
      "start",
      "end",
      "slice",
      "goToPage",
      "page",
      "Error",
      "setMeasures",
      "setDimensions",
      "setGroupConfig",
      "setAggregation",
      "type",
      "getData",
      "getProcessedData",
      "updateFieldFormatting",
      "format",
      "setFilters",
      "log",
      "stringify",
      "getFilters",
      "refresh",
      "clearFilterUI",
      "filterFieldSelect",
      "filterOperatorSelect",
      "selectedIndex",
      "fileName",
      "loadFromFile",
      "file",
      "Promise",
      "resolve",
      "reject",
      "reader",
      "FileReader",
      "onload",
      "event",
      "result",
      "onerror",
      "readAsText",
      "loadFromUrl",
      "url",
      "fetch",
      "then",
      "response",
      "ok",
      "status",
      "statusText",
      "json",
      "dragRow",
      "dragColumn",
      "swapRawDataRows",
      "swapDataRows",
      "temp",
      "swapDataColumns",
      "newOrder",
      "swapRawDataColumns",
      "setDragAndDropEnabled",
      "enabled",
      "draggableElements",
      "element",
      "isDragAndDropEnabled",
      "firstDraggableElement",
      "availableMeasures",
      "availableFields",
      "allFields",
      "sampleValue",
      "style",
      "position",
      "top",
      "left",
      "width",
      "height",
      "backgroundColor",
      "display",
      "justifyContent",
      "alignItems",
      "zIndex",
      "popup",
      "padding",
      "borderRadius",
      "boxShadow",
      "margin",
      "headerSeparator",
      "border",
      "formContainer",
      "fields",
      "formValues",
      "dropdownElements",
      "marginBottom",
      "label",
      "flex",
      "marginRight",
      "dropdown",
      "optionText",
      "selectedValue",
      "i",
      "push",
      "buttonContainer",
      "marginTop",
      "applyButton",
      "color",
      "cursor",
      "cancelButton",
      "removeChild",
      "selectedField",
      "formatOptions",
      "align",
      "thousandSep",
      "thousandSeparator",
      "decimalSeparator",
      "decimals",
      "currencySymbol",
      "currency",
      "currencyAlign",
      "nullValue",
      "percent",
      "numericFields",
      "fieldName",
      "_renderSwitch",
      "PivotHeadElement",
      "HTMLElement",
      "observedAttributes",
      "constructor",
      "_originalData",
      "_rowGroups",
      "_columnGroups",
      "attachShadow",
      "connectedCallback",
      "attributeChangedCallback",
      "getRawData",
      "getPagination",
      "swapDataRowsByIndex",
      "swapDataColumnsByIndex",
      "setViewMode",
      "wantRaw",
      "getViewMode",
      "customElements",
      "define"
    ],
    "sources": [
      "/home/sanghamitrad/Documents/open-source/pivot-tablesrc/PivotHead/packages/web-component/dist/pivot-head.mjs"
    ],
    "sourcesContent": [
      "import { PivotEngine } from '@mindfiredigital/pivothead';\n\nfunction renderSwitch(host) {\n    const mode = host.getAttribute('mode') || 'default';\n    if (mode === 'none') {\n        if (host.shadowRoot) {\n            host.shadowRoot.innerHTML = `<style>:host { display:block; }</style>`;\n        }\n    }\n    else if (mode === 'minimal') {\n        if (host.shadowRoot) {\n            host.shadowRoot.innerHTML = `\n        <style>\n        :host { display: block; font-family: inherit; }\n        [data-pivot-root] {\n          display: grid;\n          border: 1px solid #d8dde2; border-radius: 6px; background: #fcfdff;\n        }\n        [data-pivot-header], [data-pivot-body] {\n          padding: 0.3em 0.5em;\n        }\n        [data-pivot-header] {\n          background: #f4f7fa;\n          border-bottom: 1px solid #e2e7ed;\n          font-weight: bold;\n        }\n        </style>\n        <div role=\"grid\" data-pivot-root>\n          <div role=\"rowgroup\" data-pivot-header><slot name=\"header\"></slot></div>\n          <div role=\"rowgroup\" data-pivot-body><slot name=\"body\"></slot></div>\n        </div>\n      `;\n        }\n    }\n    else {\n        host._showRawData ? host.renderRawTable() : host.renderFullUI();\n    }\n}\nfunction handleEngineStateChange(host, state) {\n    host.dispatchEvent(new CustomEvent('stateChange', {\n        detail: state,\n        bubbles: true,\n        composed: true,\n    }));\n    host.calculatePaginationForCurrentView();\n    const mode = host.getAttribute('mode');\n    if (mode === 'none') {\n        if (host.shadowRoot)\n            host.shadowRoot.innerHTML = `<style>:host { display:block; }</style>`;\n    }\n    else if (mode === 'minimal') {\n        if (host.shadowRoot) {\n            host.shadowRoot.innerHTML = `\n        <style>\n        :host { display: block; font-family: inherit; }\n        [data-pivot-root] {\n          display: grid;\n          border: 1px solid #d8dde2; border-radius: 6px; background: #fcfdff;\n        }\n        [data-pivot-header], [data-pivot-body] {\n          padding: 0.3em 0.5em;\n        }\n        [data-pivot-header] {\n          background: #f4f7fa;\n          border-bottom: 1px solid #e2e7ed;\n          font-weight: bold;\n        }\n        </style>\n        <div role=\"grid\" data-pivot-root>\n          <div role=\"rowgroup\" data-pivot-header><slot name=\"header\"></slot></div>\n          <div role=\"rowgroup\" data-pivot-body><slot name=\"body\"></slot></div>\n        </div>\n      `;\n        }\n    }\n    else {\n        host._showRawData ? host.renderRawTable() : host.renderFullUI();\n    }\n}\nfunction renderFullUI(host) {\n    const engine = host.engine;\n    if (!engine) {\n        if (host.shadowRoot)\n            host.shadowRoot.innerHTML = '';\n        return;\n    }\n    const state = engine.getState();\n    if (!state.processedData) {\n        console.error('No processed data available');\n        return;\n    }\n    const rowField = host._options.rows?.[0];\n    const columnField = host._options.columns?.[0];\n    const measures = host._options.measures || [];\n    if (!rowField || !columnField || !measures.length) {\n        console.error('Missing row, column, or measures configuration');\n        return;\n    }\n    host.calculatePaginationForCurrentView();\n    let html = `\n      <style>\n        :host { display: block; font-family: inherit; }\n        .controls-container { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }\n        .filter-container, .pagination-container { display: flex; gap: 10px; align-items: center; }\n        table { width: 100%; border-collapse: collapse; background: #ffffff; border: 1px solid #dee2e6; margin-top: 20px; }\n        th, td { border: 1px solid #dee2e6; padding: 8px; text-align: left; }\n        th { background-color: #f8f9fa; cursor: grab; font-weight: 600; }\n        .sortable-header { cursor: pointer; position: relative; }\n        .sort-icon { margin-left: 5px; font-size: 12px; color: #6c757d; opacity: 0.5; }\n        .sort-icon.active { color: #007bff; opacity: 1; }\n        .corner-cell { background-color: #f8f9fa !important; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; }\n        .column-header { background-color: #f8f9fa !important; border-bottom: 2px solid #dee2e6; text-align: center; cursor: move; }\n        .measure-header { background-color: #f8f9fa !important; border-bottom: 2px solid #dee2e6; cursor: pointer; }\n        .row-cell { font-weight: bold; background-color: #f8f9fa; }\n        tr[draggable=\"true\"] { cursor: grab; }\n        .dragging { opacity: 0.5; }\n        .drag-over { outline: 2px dashed #2672dd; background: #f3f8fd !important; }\n        tbody tr:nth-child(even) td { background: #f8fafc; }\n        button { padding: 5px 10px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }\n        button:hover { background-color: #45a049; }\n        button:disabled { background-color: #cccccc; cursor: not-allowed; }\n        select, input { padding: 5px; border-radius: 4px; border: 1px solid #ddd; }\n        \n        /* Drill-down styles */\n        .drill-down-cell { cursor: pointer; }\n        .drill-down-cell:hover { background-color: #e3f2fd !important; }\n        \n        /* Modal styles for drill-down details */\n        .drill-down-modal {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0, 0, 0, 0.5);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        }\n\n        .drill-down-content {\n            background: white;\n            border-radius: 8px;\n            padding: 20px;\n            width: 90%;\n            max-width: 800px;\n            max-height: 80%;\n            overflow: auto;\n            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        }\n\n        .drill-down-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 20px;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e0e0e0;\n        }\n\n        .drill-down-title {\n            font-size: 18px;\n            font-weight: bold;\n            color: #333;\n        }\n\n        .drill-down-close {\n            background: #f44336;\n            color: white;\n            border: none;\n            border-radius: 50%;\n            width: 30px;\n            height: 30px;\n            cursor: pointer;\n            font-size: 16px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .drill-down-close:hover {\n            background: #d32f2f;\n        }\n\n        .drill-down-summary {\n            background: #f5f5f5;\n            padding: 10px;\n            border-radius: 4px;\n            margin-bottom: 15px;\n            font-size: 14px;\n            line-height: 1.4;\n        }\n\n        .drill-down-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 10px;\n            font-size: 14px;\n        }\n\n        .drill-down-table th {\n            background: #f8f9fa;\n            padding: 8px;\n            border: 1px solid #dee2e6;\n            font-weight: bold;\n            text-align: left;\n        }\n\n        .drill-down-table td {\n            padding: 6px 8px;\n            border: 1px solid #dee2e6;\n        }\n\n        .drill-down-table tr:nth-child(even) {\n            background-color: #f9f9f9;\n        }\n\n        .drill-down-table tr:hover {\n            background-color: #e3f2fd;\n        }\n      </style>\n      <div class=\"controls-container\">\n        <div class=\"filter-container\">\n          <label>Filter:</label>\n          <select id=\"filterField\"></select>\n          <select id=\"filterOperator\">\n            <option value=\"equals\">Equals</option>\n            <option value=\"contains\">Contains</option>\n            <option value=\"greaterThan\">Greater Than</option>\n            <option value=\"lessThan\">Less Than</option>\n          </select>\n          <input type=\"text\" id=\"filterValue\" placeholder=\"Value\">\n          <button id=\"applyFilter\">Apply</button>\n          <button id=\"resetFilter\">Reset</button>\n        </div>\n        <div class=\"pagination-container\">\n          <label>Items per page:</label>\n          <select id=\"pageSize\">\n            <option value=\"5\">5</option>\n            <option value=\"10\">10</option>\n            <option value=\"25\">25</option>\n            <option value=\"50\">50</option>\n          </select>\n          <button id=\"prevPage\">Previous</button>\n          <span id=\"pageInfo\">Page ${host._pagination.currentPage} of ${host._pagination.totalPages}</span>\n          <button id=\"nextPage\">Next</button>\n        </div>\n        <button id=\"switchView\">Switch to Raw Data</button>\n        <button id=\"formatButton\">Format</button>\n        <button id=\"exportHTML\">Export HTML</button>\n        <button id=\"exportPDF\">Export PDF</button>\n        <button id=\"exportExcel\">Export Excel</button>\n        <button id=\"printTable\">Print</button>\n      </div>\n    `;\n    // Determine column labels using engine's custom column order if any\n    const groupedData = engine.getGroupedData();\n    let uniqueColumnValues = engine.getOrderedColumnValues() ||\n        [\n            ...new Set(groupedData.map((g) => {\n                const keys = g.key ? g.key.split('|') : [];\n                return keys[1] || keys[0];\n            })),\n        ].filter(Boolean);\n    if (host._processedColumnOrder.length === 0) {\n        host._processedColumnOrder = [...uniqueColumnValues];\n    }\n    if (host._processedColumnOrder.length > 0) {\n        uniqueColumnValues = host._processedColumnOrder.filter(col => uniqueColumnValues.includes(col));\n    }\n    html += '<table role=\"grid\">';\n    html += '<thead>';\n    html += '<tr>';\n    html += `<th class=\"corner-cell\">${rowField.caption} / ${columnField.caption}</th>`;\n    uniqueColumnValues.forEach((colValue, index) => {\n        html += `<th class=\"column-header\" draggable=\"true\" data-column-index=\"${index}\" data-column-value=\"${colValue}\" colspan=\"${measures.length}\">${colValue}</th>`;\n    });\n    html += '</tr>';\n    html += '<tr>';\n    const rowSortIcon = host.createProcessedSortIcon(rowField.uniqueName);\n    html += `<th class=\"row-cell sortable-header\" data-field=\"${rowField.uniqueName}\">\n      ${rowField.caption}${rowSortIcon}\n    </th>`;\n    uniqueColumnValues.forEach(colValue => {\n        measures.forEach((measure, measureIndex) => {\n            const sortIcon = host.createProcessedSortIcon(measure.uniqueName);\n            html += `<th class=\"measure-header sortable-header\" data-measure-index=\"${measureIndex}\" data-field=\"${measure.uniqueName}\" data-column-value=\"${colValue}\">\n          ${measure.caption}${sortIcon}\n        </th>`;\n        });\n    });\n    html += '</tr>';\n    html += '</thead>';\n    html += '<tbody>';\n    // Prefer engine-provided ordered row values (custom or due to sorting)\n    const orderedFromEngine = engine.getOrderedRowValues() || [];\n    let uniqueRowValues = [...orderedFromEngine];\n    if (uniqueRowValues.length === 0) {\n        // Fallback: derive row values from all grouped data keys so we don't miss any groups\n        const allGroups = engine.getGroupedData();\n        uniqueRowValues = [\n            ...new Set(allGroups.map((g) => {\n                const keys = g.key ? g.key.split('|') : [];\n                return keys[0];\n            })),\n        ].filter(Boolean);\n    }\n    const paginatedRowValues = host.getPaginatedData(uniqueRowValues);\n    paginatedRowValues.forEach((rowValue, rowIndex) => {\n        html += `<tr draggable=\"true\" data-row-index=\"${rowIndex}\" data-row-value=\"${rowValue}\">`;\n        html += `<td class=\"row-cell\">${rowValue}</td>`;\n        uniqueColumnValues.forEach(colValue => {\n            measures.forEach((measure) => {\n                const matchingGroup = groupedData.find((g) => {\n                    const keys = g.key ? g.key.split('|') : [];\n                    return keys[0] === rowValue && keys[1] === colValue;\n                });\n                const aggKey = measure.aggregation + '_' + measure.uniqueName;\n                const value = matchingGroup?.aggregates?.[aggKey];\n                let formattedValue = '0';\n                if (value !== undefined && value !== null) {\n                    formattedValue = engine.formatValue(value, measure.uniqueName);\n                }\n                const hasData = value !== undefined && value !== null && Number(value) > 0;\n                const cellClass = hasData ? 'data-cell drill-down-cell' : 'data-cell';\n                const cellTitle = hasData\n                    ? `Double-click to see details for ${rowField.caption}: ${rowValue} - ${columnField.caption}: ${colValue}`\n                    : '';\n                const textAlign = engine.getFieldAlignment(measure.uniqueName);\n                html += `<td class=\"${cellClass}\" \n                      style=\"text-align: ${textAlign};\"\n                      title=\"${cellTitle}\"\n                      data-row-value=\"${rowValue}\" \n                      data-column-value=\"${colValue}\" \n                      data-measure-name=\"${measure.uniqueName}\"\n                      data-measure-caption=\"${measure.caption}\"\n                      data-row-field=\"${rowField.uniqueName}\"\n                      data-column-field=\"${columnField.uniqueName}\"\n                      data-aggregate-value=\"${value || 0}\">\n                      ${formattedValue}\n                   </td>`;\n            });\n        });\n        html += '</tr>';\n    });\n    html += '</tbody>';\n    html += '</table>';\n    if (host.shadowRoot)\n        host.shadowRoot.innerHTML = html;\n    host.addDragListeners();\n    host.setupControls();\n}\nfunction renderRawTable(host) {\n    const engine = host.engine;\n    if (!engine)\n        return;\n    const state = engine.getState();\n    // Prefer full rawData first; state.data could be limited by engine defaults\n    const allRawData = state.rawData || state.data || [];\n    if (!allRawData.length)\n        return;\n    host.updatePaginationForData(allRawData);\n    const displayData = host.getPaginatedData(allRawData);\n    const originalHeaders = Object.keys(displayData[0] || allRawData[0]);\n    let headers;\n    if (host._rawDataColumnOrder && host._rawDataColumnOrder.length > 0) {\n        const missingHeaders = originalHeaders.filter(h => !host._rawDataColumnOrder.includes(h));\n        headers = [...host._rawDataColumnOrder, ...missingHeaders];\n    }\n    else {\n        headers = originalHeaders;\n        host._rawDataColumnOrder = [...headers];\n    }\n    let html = `\n      <style>\n        :host { display: block; font-family: inherit; }\n        .controls-container { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }\n        .filter-container, .pagination-container { display: flex; gap: 10px; align-items: center; }\n        table { width: 100%; border-collapse: collapse; background: #ffffff; border: 1px solid #e2e7ed; }\n        th, td { border: 1px solid #dde1e7; padding: 8px; text-align: left; }\n        th { background-color: #eaf2fa; cursor: grab; font-weight: 600; }\n        .sortable-header { cursor: pointer !important; position: relative; }\n        .sort-icon { margin-left: 5px; font-size: 12px; color: #6c757d; opacity: 0.5; }\n        .sort-icon.active { color: #007bff; opacity: 1; }\n        tr[draggable=\"true\"] { cursor: grab; }\n        .dragging { opacity: 0.5; }\n        .drag-over { outline: 2px dashed #2672dd; background: #f3f8fd !important; }\n        tbody tr:nth-child(even) td { background: #f8fafc; }\n        button { padding: 5px 10px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }\n        button:hover { background-color: #45a049; }\n        button:disabled { background-color: #cccccc; cursor: not-allowed; }\n        select, input { padding: 5px; border-radius: 4px; border: 1px solid #ddd; }\n      </style>\n      <div class=\"controls-container\">\n        <div class=\"filter-container\">\n          <label>Filter:</label>\n          <select id=\"filterField\"></select>\n          <select id=\"filterOperator\">\n            <option value=\"equals\">Equals</option>\n            <option value=\"contains\">Contains</option>\n            <option value=\"greaterThan\">Greater Than</option>\n            <option value=\"lessThan\">Less Than</option>\n          </select>\n          <input type=\"text\" id=\"filterValue\" placeholder=\"Value\">\n          <button id=\"applyFilter\">Apply</button>\n          <button id=\"resetFilter\">Reset</button>\n        </div>\n        <div class=\"pagination-container\">\n          <label>Items per page:</label>\n          <select id=\"pageSize\">\n            <option value=\"5\">5</option>\n            <option value=\"10\">10</option>\n            <option value=\"25\">25</option>\n            <option value=\"50\">50</option>\n          </select>\n          <button id=\"prevPage\">Previous</button>\n          <span id=\"pageInfo\">Page ${host._pagination.currentPage} of ${host._pagination.totalPages}</span>\n          <button id=\"nextPage\">Next</button>\n        </div>\n        <button id=\"switchView\">Switch to Processed Data</button>\n        <button id=\"formatButton\">Format</button>\n        <button id=\"exportHTML\">Export HTML</button>\n        <button id=\"exportPDF\">Export PDF</button>\n        <button id=\"exportExcel\">Export Excel</button>\n        <button id=\"printTable\">Print</button>\n      </div>\n    `;\n    html += '<table data-raw=\"true\">';\n    html += '<thead><tr>';\n    headers.forEach((header, index) => {\n        const sortIcon = host.createSortIcon(header);\n        html += `<th class=\"sortable-header\" draggable=\"true\" data-column-index=\"${index}\" data-field=\"${header}\">\n        ${header}${sortIcon}\n      </th>`;\n    });\n    html += '</tr></thead>';\n    html += '<tbody>';\n    displayData.forEach((row, rowIndex) => {\n        const pivotRow = row;\n        html += `<tr draggable=\"true\" data-row-index=\"${rowIndex}\">`;\n        headers.forEach(header => {\n            const cellValue = pivotRow[header];\n            let formattedValue = cellValue;\n            if (cellValue !== undefined && cellValue !== null) {\n                formattedValue = engine.formatValue(cellValue, header);\n            }\n            const textAlign = engine.getFieldAlignment(header);\n            html += `<td style=\"text-align: ${textAlign};\">${formattedValue}</td>`;\n        });\n        html += '</tr>';\n    });\n    html += '</tbody></table>';\n    if (host.shadowRoot)\n        host.shadowRoot.innerHTML = html;\n    host.addDragListeners();\n    host.setupControls();\n}\n\n// Events: bindControls and updatePaginationInfo\nfunction bindControls(host) {\n    const filterField = host.shadowRoot?.getElementById('filterField');\n    if (filterField) {\n        if (host._showRawData) {\n            if (host._data.length > 0) {\n                filterField.innerHTML = Object.keys(host._data[0])\n                    .map(f => `<option value=\"${f}\">${f}</option>`)\n                    .join('');\n            }\n        }\n        else {\n            let options = '';\n            if (host._options.rows) {\n                host._options.rows.forEach(row => {\n                    options += `<option value=\"${row.uniqueName}\">${row.caption}</option>`;\n                });\n            }\n            if (host._options.columns) {\n                host._options.columns.forEach(col => {\n                    options += `<option value=\"${col.uniqueName}\">${col.caption}</option>`;\n                });\n            }\n            if (host._options.measures) {\n                host._options.measures.forEach(measure => {\n                    const aggregatedKey = `${measure.aggregation}_${measure.uniqueName}`;\n                    options += `<option value=\"${aggregatedKey}\">${measure.caption}</option>`;\n                });\n            }\n            filterField.innerHTML = options;\n        }\n    }\n    const filterValueInput = host.shadowRoot?.getElementById('filterValue');\n    if (filterValueInput && host._filters.length > 0) {\n        const currentFilter = host._filters[0];\n        if (currentFilter) {\n            const filterFieldElement = host.shadowRoot?.getElementById('filterField');\n            const filterOperatorElement = host.shadowRoot?.getElementById('filterOperator');\n            if (filterFieldElement) {\n                filterFieldElement.value = currentFilter.field;\n            }\n            if (filterOperatorElement) {\n                filterOperatorElement.value = currentFilter.operator;\n            }\n            filterValueInput.value = currentFilter.value;\n        }\n    }\n    const pageSizeSelect = host.shadowRoot?.getElementById('pageSize');\n    if (pageSizeSelect) {\n        Array.from(pageSizeSelect.options).forEach(option => {\n            option.removeAttribute('selected');\n            option.selected = false;\n        });\n        pageSizeSelect.value = host._pagination.pageSize.toString();\n        const selectedOption = pageSizeSelect.querySelector(`option[value=\"${host._pagination.pageSize}\"]`);\n        if (selectedOption) {\n            selectedOption.selected = true;\n            selectedOption.setAttribute('selected', 'selected');\n        }\n    }\n    const applyBtn = host.shadowRoot?.getElementById('applyFilter');\n    if (applyBtn) {\n        const newApplyBtn = applyBtn.cloneNode(true);\n        applyBtn.parentNode?.replaceChild(newApplyBtn, applyBtn);\n        newApplyBtn.addEventListener('click', () => {\n            const fieldElement = host.shadowRoot?.getElementById('filterField');\n            const operatorElement = host.shadowRoot?.getElementById('filterOperator');\n            const valueElement = host.shadowRoot?.getElementById('filterValue');\n            if (!fieldElement || !operatorElement || !valueElement)\n                return;\n            const field = fieldElement.value;\n            const operator = operatorElement.value;\n            const value = valueElement.value;\n            if (!field || !operator || !value)\n                return;\n            const filter = {\n                field,\n                operator: operator,\n                value,\n            };\n            host.filters = [filter];\n        });\n    }\n    const resetBtn = host.shadowRoot?.getElementById('resetFilter');\n    if (resetBtn) {\n        const newResetBtn = resetBtn.cloneNode(true);\n        resetBtn.parentNode?.replaceChild(newResetBtn, resetBtn);\n        newResetBtn.addEventListener('click', () => {\n            host.reset();\n        });\n    }\n    const pageSizeSel = host.shadowRoot?.getElementById('pageSize');\n    if (pageSizeSel) {\n        const newPageSizeSel = pageSizeSel.cloneNode(true);\n        pageSizeSel.parentNode?.replaceChild(newPageSizeSel, pageSizeSel);\n        newPageSizeSel.addEventListener('change', (e) => {\n            const target = e.target;\n            host.setPageSize(Number(target.value));\n        });\n    }\n    const prevBtn = host.shadowRoot?.getElementById('prevPage');\n    if (prevBtn) {\n        const newPrevBtn = prevBtn.cloneNode(true);\n        prevBtn.parentNode?.replaceChild(newPrevBtn, prevBtn);\n        newPrevBtn.addEventListener('click', () => host.previousPage());\n    }\n    const nextBtn = host.shadowRoot?.getElementById('nextPage');\n    if (nextBtn) {\n        const newNextBtn = nextBtn.cloneNode(true);\n        nextBtn.parentNode?.replaceChild(newNextBtn, nextBtn);\n        newNextBtn.addEventListener('click', () => host.nextPage());\n    }\n    updatePaginationInfo(host);\n    const switchBtn = host.shadowRoot?.getElementById('switchView');\n    if (switchBtn) {\n        const newSwitchBtn = switchBtn.cloneNode(true);\n        switchBtn.parentNode?.replaceChild(newSwitchBtn, switchBtn);\n        newSwitchBtn.textContent = host._showRawData\n            ? 'Switch to Processed Data'\n            : 'Switch to Raw Data';\n        newSwitchBtn.addEventListener('click', () => {\n            host._showRawData = !host._showRawData;\n            try {\n                if (host.engine) {\n                    host.engine.setDataHandlingMode(host._showRawData ? 'raw' : 'processed');\n                    const currentFilters = host._showRawData\n                        ? host._rawFilters\n                        : host._processedFilters;\n                    host.engine.applyFilters(currentFilters);\n                    host.dispatchEvent(new CustomEvent('viewModeChange', {\n                        detail: { mode: host._showRawData ? 'raw' : 'processed' },\n                        bubbles: true,\n                        composed: true,\n                    }));\n                }\n            }\n            catch (error) {\n                console.error('Error during view switch:', error);\n            }\n        });\n    }\n    const exportHTML = host.shadowRoot?.getElementById('exportHTML');\n    if (exportHTML) {\n        const newExportHTML = exportHTML.cloneNode(true);\n        exportHTML.parentNode?.replaceChild(newExportHTML, exportHTML);\n        newExportHTML.addEventListener('click', () => host.exportToHTML());\n    }\n    const exportPDF = host.shadowRoot?.getElementById('exportPDF');\n    if (exportPDF) {\n        const newExportPDF = exportPDF.cloneNode(true);\n        exportPDF.parentNode?.replaceChild(newExportPDF, exportPDF);\n        newExportPDF.addEventListener('click', () => host.exportToPDF());\n    }\n    const exportExcel = host.shadowRoot?.getElementById('exportExcel');\n    if (exportExcel) {\n        const newExportExcel = exportExcel.cloneNode(true);\n        exportExcel.parentNode?.replaceChild(newExportExcel, exportExcel);\n        newExportExcel.addEventListener('click', () => host.exportToExcel());\n    }\n    const printBtn = host.shadowRoot?.getElementById('printTable');\n    if (printBtn) {\n        const newPrintBtn = printBtn.cloneNode(true);\n        printBtn.parentNode?.replaceChild(newPrintBtn, printBtn);\n        newPrintBtn.addEventListener('click', () => host.openPrintDialog());\n    }\n    const formatBtn = host.shadowRoot?.getElementById('formatButton');\n    if (formatBtn) {\n        const newFormatBtn = formatBtn.cloneNode(true);\n        formatBtn.parentNode?.replaceChild(newFormatBtn, formatBtn);\n        newFormatBtn.addEventListener('click', () => {\n            host.showFormatPopup();\n        });\n    }\n}\nfunction updatePaginationInfo(host) {\n    const pageInfo = host.shadowRoot?.getElementById('pageInfo');\n    if (pageInfo) {\n        const viewMode = host._showRawData ? 'Raw Data' : 'Processed Data';\n        pageInfo.textContent = `${viewMode} - Page ${host._pagination.currentPage} of ${host._pagination.totalPages}`;\n    }\n    const prevButton = host.shadowRoot?.getElementById('prevPage');\n    const nextButton = host.shadowRoot?.getElementById('nextPage');\n    if (prevButton)\n        prevButton.disabled = host._pagination.currentPage <= 1;\n    if (nextButton)\n        nextButton.disabled =\n            host._pagination.currentPage >= host._pagination.totalPages;\n}\n// Drag & drill-down & sort handlers\nfunction addDragListeners(host) {\n    const headers = host.shadowRoot?.querySelectorAll('th[draggable=\"true\"]');\n    headers?.forEach(header => {\n        header.addEventListener('dragstart', (e) => {\n            handleColumnDragStart(host, e);\n        });\n        header.addEventListener('dragover', (e) => {\n            handleColumnDragOver(host, e);\n        });\n        header.addEventListener('dragleave', (e) => {\n            handleColumnDragLeave(host, e);\n        });\n        header.addEventListener('drop', (e) => {\n            handleColumnDrop(host, e);\n        });\n        header.addEventListener('dragend', () => {\n            handleColumnDragEnd(host);\n        });\n    });\n    const rows = host.shadowRoot?.querySelectorAll('tr[draggable=\"true\"]');\n    rows?.forEach(row => {\n        row.addEventListener('dragstart', (e) => {\n            handleRowDragStart(host, e);\n        });\n        row.addEventListener('dragover', (e) => {\n            handleRowDragOver(host, e);\n        });\n        row.addEventListener('dragleave', (e) => {\n            handleRowDragLeave(host, e);\n        });\n        row.addEventListener('drop', (e) => {\n            handleRowDrop(host, e);\n        });\n        row.addEventListener('dragend', () => {\n            handleRowDragEnd(host);\n        });\n    });\n    const sortableHeaders = host.shadowRoot?.querySelectorAll('.sortable-header');\n    sortableHeaders?.forEach(header => {\n        header.addEventListener('click', (e) => {\n            handleSortClick(host, e);\n        });\n    });\n    const drillDownCells = host.shadowRoot?.querySelectorAll('.drill-down-cell');\n    drillDownCells?.forEach(cell => {\n        cell.addEventListener('dblclick', (e) => {\n            handleDrillDownClick(host, e);\n        });\n    });\n}\nfunction handleSortClick(host, e) {\n    if (!host.engine)\n        return;\n    const target = e.target;\n    const header = target.closest('.sortable-header');\n    if (!header)\n        return;\n    const field = header.dataset.field;\n    if (!field)\n        return;\n    // Calculate next direction based on current engine state\n    const state = host.engine.getState();\n    const current = state.sortConfig && state.sortConfig.length > 0\n        ? state.sortConfig[0]\n        : null;\n    const nextDir = current && current.field === field && current.direction === 'asc'\n        ? 'desc'\n        : 'asc';\n    // In processed mode, clicking a measure header under a specific column\n    // should sort ROWS by that column's measure aggregate. We compute the row\n    // order and store it in the engine as a custom row order so rendering uses it.\n    if (!host._showRawData) {\n        const isMeasureHeader = header.hasAttribute('data-measure-index');\n        const columnValue = header.getAttribute('data-column-value') || '';\n        if (isMeasureHeader && columnValue) {\n            try {\n                const measures = (host._options.measures || []);\n                const measureCfg = measures.find(m => m.uniqueName === field);\n                const aggregation = measureCfg?.aggregation || 'sum';\n                const aggKey = `${aggregation}_${field}`;\n                const groups = host.engine.getGroupedData();\n                // Build the full set of row values across ALL groups (not just those that appear for the selected column)\n                const allRowSet = new Set();\n                groups.forEach(g => {\n                    const keys = g.key ? g.key.split('|') : [];\n                    if (keys[0])\n                        allRowSet.add(keys[0]);\n                });\n                const allRowValues = Array.from(allRowSet);\n                // Create [row, value] pairs for the target column; treat missing intersections as 0\n                const pairs = allRowValues.map(rv => {\n                    const grp = groups.find(gr => {\n                        const keys = gr.key ? gr.key.split('|') : [];\n                        return keys[0] === rv && keys[1] === columnValue;\n                    });\n                    const aggregates = (grp?.aggregates || {});\n                    const val = Number(aggregates[aggKey] ?? 0);\n                    return { row: rv, val: isFinite(val) ? val : 0 };\n                });\n                // Sort according to nextDir, keeping zero-value rows included\n                pairs.sort((a, b) => nextDir === 'asc' ? a.val - b.val : b.val - a.val);\n                const orderedRows = pairs.map(p => p.row);\n                const rowFieldName = host._options.rows?.[0]?.uniqueName || '';\n                if (rowFieldName && orderedRows.length > 0) {\n                    host.engine.setCustomFieldOrder(rowFieldName, orderedRows, true);\n                }\n            }\n            catch (err) {\n                console.error('Failed to compute/set custom row order for processed sort:', err);\n            }\n        }\n        else {\n            // If sorting by the row dimension header, compute alphabetical order\n            const rowFieldName = host._options.rows?.[0]?.uniqueName || '';\n            if (rowFieldName && field === rowFieldName) {\n                try {\n                    const groups = host.engine.getGroupedData();\n                    const rowSet = new Set();\n                    groups.forEach(g => {\n                        const keys = g.key ? g.key.split('|') : [];\n                        if (keys[0])\n                            rowSet.add(keys[0]);\n                    });\n                    const rows = Array.from(rowSet);\n                    rows.sort((a, b) => nextDir === 'asc' ? a.localeCompare(b) : b.localeCompare(a));\n                    if (rows.length > 0) {\n                        host.engine.setCustomFieldOrder(rowFieldName, rows, true);\n                    }\n                }\n                catch (err) {\n                    console.error('Failed to set custom row order for dimension sort:', err);\n                }\n            }\n        }\n    }\n    // Also call engine.sort to update its sort state (icons) and internal groups\n    host.engine.sort(field, nextDir);\n}\nfunction handleDrillDownClick(host, e) {\n    if (!host.engine)\n        return;\n    const cell = e.target.closest('.drill-down-cell');\n    if (!cell)\n        return;\n    const rowValue = cell.getAttribute('data-row-value') || '';\n    const columnValue = cell.getAttribute('data-column-value') || '';\n    const measureName = cell.getAttribute('data-measure-name') || '';\n    const measureCaption = cell.getAttribute('data-measure-caption') || measureName;\n    const rowField = cell.getAttribute('data-row-field') || '';\n    const columnField = cell.getAttribute('data-column-field') || '';\n    const state = host.engine.getState();\n    const rawData = (state.rawData || state.data || []);\n    const subset = rawData.filter((r) => {\n        const rowOk = rowField\n            ? String(r[rowField] ?? '') === String(rowValue)\n            : true;\n        const colOk = columnField\n            ? String(r[columnField] ?? '') === String(columnValue)\n            : true;\n        return rowOk && colOk;\n    });\n    addModalStylesToDocument();\n    const overlay = document.createElement('div');\n    overlay.className = 'drill-down-modal';\n    const content = document.createElement('div');\n    content.className = 'drill-down-content';\n    content.innerHTML = `\n      <div class=\"drill-down-header\">\n        <div class=\"drill-down-title\">Details: ${rowField}: ${rowValue}${columnField ? `, ${columnField}: ${columnValue}` : ''}</div>\n        <button class=\"drill-down-close\" aria-label=\"Close\">&times;</button>\n      </div>\n      <div class=\"drill-down-summary\">\n        Records: ${subset.length}. Measure: ${measureCaption} (${measureName}).\n      </div>\n      <div class=\"drill-down-body\"></div>\n    `;\n    const bodyDiv = content.querySelector('.drill-down-body');\n    if (subset.length > 0) {\n        const headers = Object.keys(subset[0]);\n        const table = document.createElement('table');\n        table.className = 'drill-down-table';\n        const thead = document.createElement('thead');\n        const trh = document.createElement('tr');\n        headers.forEach(h => {\n            const th = document.createElement('th');\n            th.textContent = h;\n            trh.appendChild(th);\n        });\n        thead.appendChild(trh);\n        table.appendChild(thead);\n        const tbody = document.createElement('tbody');\n        subset.forEach(row => {\n            const tr = document.createElement('tr');\n            headers.forEach(h => {\n                const td = document.createElement('td');\n                const val = row[h];\n                td.textContent = val != null ? String(val) : '';\n                tr.appendChild(td);\n            });\n            tbody.appendChild(tr);\n        });\n        table.appendChild(tbody);\n        bodyDiv.appendChild(table);\n    }\n    else {\n        bodyDiv.textContent = 'No matching records.';\n    }\n    overlay.appendChild(content);\n    document.body.appendChild(overlay);\n    const close = () => overlay.remove();\n    overlay.addEventListener('click', evt => {\n        if (evt.target === overlay)\n            close();\n    });\n    const closeBtn = content.querySelector('.drill-down-close');\n    closeBtn?.addEventListener('click', close);\n}\nfunction addModalStylesToDocument() {\n    if (document.getElementById('pivot-head-modal-styles'))\n        return;\n    const styleEl = document.createElement('style');\n    styleEl.id = 'pivot-head-modal-styles';\n    styleEl.textContent = `\n      .drill-down-modal {\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background-color: rgba(0, 0, 0, 0.5);\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          z-index: 1000;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n      .drill-down-content {\n          background: white;\n          border-radius: 8px;\n          padding: 20px;\n          width: 90%;\n          max-width: 800px;\n          max-height: 80%;\n          overflow: auto;\n          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n      }\n      .drill-down-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 20px;\n          padding-bottom: 10px;\n          border-bottom: 2px solid #e0e0e0;\n      }\n      .drill-down-title { font-size: 18px; font-weight: bold; color: #333; }\n      .drill-down-close {\n          background: #f44336;\n          color: white;\n          border: none;\n          border-radius: 50%;\n          width: 30px;\n          height: 30px;\n          cursor: pointer;\n          font-size: 16px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n      }\n      .drill-down-close:hover { background: #d32f2f; }\n      .drill-down-summary { background: #f5f5f5; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 14px; line-height: 1.4; }\n      .drill-down-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }\n      .drill-down-table th { background: #f8f9fa; padding: 8px; border: 1px solid #dee2e6; font-weight: bold; text-align: left; }\n      .drill-down-table td { padding: 6px 8px; border: 1px solid #dee2e6; }\n      .drill-down-table tr:nth-child(even) { background-color: #f9f9f9; }\n      .drill-down-table tr:hover { background-color: #e3f2fd; }\n    `;\n    document.head.appendChild(styleEl);\n}\n// Sort icons\nfunction createSortIcon(host, field) {\n    if (!host.engine) {\n        return '<span class=\"sort-icon\" title=\"Click to sort\">&#8693;</span>';\n    }\n    const state = host.engine.getState();\n    const sortConfig = state.sortConfig && state.sortConfig.length > 0\n        ? state.sortConfig[0]\n        : null;\n    const isCurrentlySorted = !!(sortConfig && sortConfig.field === field);\n    if (isCurrentlySorted) {\n        if (sortConfig && sortConfig.direction === 'asc') {\n            return '<span class=\"sort-icon active\" title=\"Sorted ascending\">&#9650;</span>';\n        }\n        else {\n            return '<span class=\"sort-icon active\" title=\"Sorted descending\">&#9660;</span>';\n        }\n    }\n    return '<span class=\"sort-icon\" title=\"Click to sort\">&#8693;</span>';\n}\nfunction createProcessedSortIcon(host, field) {\n    if (!host.engine) {\n        return '<span class=\"sort-icon\" title=\"Click to sort\">&#8693;</span>';\n    }\n    const state = host.engine.getState();\n    const sortConfig = state.sortConfig && state.sortConfig.length > 0\n        ? state.sortConfig[0]\n        : null;\n    const isCurrentlySorted = !!(sortConfig && sortConfig.field === field);\n    if (isCurrentlySorted) {\n        if (sortConfig && sortConfig.direction === 'asc') {\n            return '<span class=\"sort-icon active\" title=\"Sorted ascending\">&#9650;</span>';\n        }\n        else {\n            return '<span class=\"sort-icon active\" title=\"Sorted descending\">&#9660;</span>';\n        }\n    }\n    return '<span class=\"sort-icon\" title=\"Click to sort\">&#8693;</span>';\n}\nfunction handleColumnDragStart(host, e) {\n    host.draggedColumn = e.target;\n    if (e.dataTransfer) {\n        e.dataTransfer.effectAllowed = 'move';\n        e.dataTransfer.setData('text/plain', host.draggedColumn.dataset.columnIndex || '');\n    }\n    setTimeout(() => host.draggedColumn?.classList.add('dragging'), 0);\n}\nfunction handleColumnDragOver(host, e) {\n    e.preventDefault();\n    if (e.dataTransfer?.types.includes('text/plain')) {\n        const target = e.target;\n        if (target.tagName === 'TH' && target !== host.draggedColumn) {\n            target.classList.add('drag-over');\n        }\n    }\n}\nfunction handleColumnDragLeave(host, e) {\n    e.target.classList.remove('drag-over');\n}\nfunction handleColumnDrop(host, e) {\n    e.preventDefault();\n    const target = e.target;\n    target.classList.remove('drag-over');\n    if (host.draggedColumn && target.tagName === 'TH') {\n        const fromIndex = parseInt(host.draggedColumn.dataset.columnIndex || '0');\n        const toIndex = parseInt(target.dataset.columnIndex || '0');\n        if (fromIndex !== toIndex)\n            host.swapColumns(fromIndex, toIndex);\n    }\n}\nfunction handleColumnDragEnd(host) {\n    host.draggedColumn?.classList.remove('dragging');\n    host.draggedColumn = null;\n    host.shadowRoot\n        ?.querySelectorAll('.drag-over')\n        .forEach(el => el.classList.remove('drag-over'));\n}\nfunction handleRowDragStart(host, e) {\n    host.draggedRow = e.target;\n    if (e.dataTransfer) {\n        e.dataTransfer.effectAllowed = 'move';\n        e.dataTransfer.setData('text/plain', host.draggedRow.dataset.rowIndex || '');\n    }\n    setTimeout(() => host.draggedRow?.classList.add('dragging'), 0);\n}\nfunction handleRowDragOver(host, e) {\n    e.preventDefault();\n    if (e.dataTransfer?.types.includes('text/plain')) {\n        const target = e.target;\n        const targetRow = target.closest('tr');\n        if (targetRow &&\n            targetRow.tagName === 'TR' &&\n            targetRow !== host.draggedRow) {\n            targetRow.classList.add('drag-over');\n        }\n    }\n}\nfunction handleRowDragLeave(host, e) {\n    const target = e.target;\n    const targetRow = target.closest('tr');\n    if (targetRow)\n        targetRow.classList.remove('drag-over');\n}\nfunction handleRowDrop(host, e) {\n    e.preventDefault();\n    const target = e.target;\n    const targetRow = target.closest('tr');\n    if (targetRow)\n        targetRow.classList.remove('drag-over');\n    if (host.draggedRow && targetRow && targetRow.tagName === 'TR') {\n        const fromIndex = parseInt(host.draggedRow.dataset.rowIndex || '0');\n        const toIndex = parseInt(targetRow.dataset.rowIndex || '0');\n        if (fromIndex !== toIndex)\n            host.swapRows(fromIndex, toIndex);\n    }\n}\nfunction handleRowDragEnd(host) {\n    host.draggedRow?.classList.remove('dragging');\n    host.draggedRow = null;\n    host.shadowRoot\n        ?.querySelectorAll('.drag-over')\n        .forEach(el => el.classList.remove('drag-over'));\n}\n\nfunction tryInitializeEngine(host) {\n    const hasData = host._data && host._data.length > 0;\n    const hasOptions = host._options && Object.keys(host._options).length > 0;\n    if (!hasData || !hasOptions)\n        return;\n    try {\n        const options = { ...host._options };\n        if (!options.rows ||\n            !Array.isArray(options.rows) ||\n            options.rows.length === 0) {\n            const firstRowField = host._data.length > 0 ? Object.keys(host._data[0])[0] : null;\n            if (firstRowField) {\n                options.rows = [{ uniqueName: firstRowField, caption: firstRowField }];\n            }\n        }\n        if (!options.columns ||\n            !Array.isArray(options.columns) ||\n            options.columns.length === 0) {\n            const keys = host._data.length > 0 ? Object.keys(host._data[0]) : [];\n            const colField = keys.length > 1 ? keys[1] : null;\n            if (colField) {\n                options.columns = [{ uniqueName: colField, caption: colField }];\n            }\n        }\n        if (!options.measures ||\n            !Array.isArray(options.measures) ||\n            options.measures.length === 0) {\n            const keys = host._data.length > 0 ? Object.keys(host._data[0]) : [];\n            const measureField = keys.find(k => typeof host._data[0][k] === 'number');\n            if (measureField) {\n                options.measures = [\n                    {\n                        uniqueName: measureField,\n                        caption: `Sum of ${measureField}`,\n                        aggregation: 'sum',\n                    },\n                ];\n            }\n        }\n        if (!options.groupConfig && options.rows && options.columns) {\n            options.groupConfig = {\n                rowFields: options.rows.map((r) => r.uniqueName),\n                columnFields: options.columns.map((c) => c.uniqueName),\n                grouper: (item) => {\n                    return [\n                        ...(options.rows?.map((r) => item[r.uniqueName]) ?? []),\n                        ...(options.columns?.map((c) => item[c.uniqueName]) ??\n                            []),\n                    ].join('|');\n                },\n            };\n        }\n        const config = {\n            data: host._data,\n            rawData: host._data,\n            dimensions: [],\n            defaultAggregation: 'sum',\n            rows: options.rows || [],\n            columns: options.columns || [],\n            measures: options.measures || [],\n            groupConfig: options.groupConfig,\n        };\n        host.engine = new PivotEngine(config);\n        // Disable core engine pagination; the web component manages pagination itself\n        // Use a very large page size so engine never slices the data internally\n        host.engine.setPagination({\n            currentPage: 1,\n            pageSize: Number.MAX_SAFE_INTEGER,\n            totalPages: 1,\n        });\n        host.engine.setDataHandlingMode(host._showRawData ? 'raw' : 'processed');\n        if (host._engineUnsubscribe)\n            host._engineUnsubscribe();\n        host._engineUnsubscribe = host.engine.subscribe(state => {\n            host.handleEngineStateChange(state);\n        });\n        host._processedColumnOrder = [];\n        const currentFilters = host._showRawData\n            ? host._rawFilters\n            : host._processedFilters;\n        if (currentFilters.length > 0) {\n            host.engine.applyFilters(currentFilters);\n            return;\n        }\n    }\n    catch (error) {\n        console.error('Error initializing PivotEngine:', error);\n    }\n}\n\nfunction parseAttributesIfNeeded(host) {\n    // Parse data attribute\n    const rawData = host.getAttribute('data');\n    if (rawData && !host._data.length) {\n        try {\n            host.data = JSON.parse(rawData);\n        }\n        catch (error) {\n            console.error('Error parsing data attribute:', error);\n        }\n    }\n    // Parse options attribute\n    const rawOptions = host.getAttribute('options');\n    if (rawOptions && !Object.keys(host._options).length) {\n        try {\n            host.options = JSON.parse(rawOptions);\n        }\n        catch (error) {\n            console.error('Error parsing options attribute:', error);\n        }\n    }\n    // Parse other attributes\n    parseOtherAttributes(host);\n}\nfunction parseOtherAttributes(host) {\n    // Parse filters\n    const rawFilters = host.getAttribute('filters');\n    if (rawFilters) {\n        try {\n            host.filters = JSON.parse(rawFilters);\n        }\n        catch (error) {\n            console.error('Error parsing filters attribute:', error);\n        }\n    }\n    // Parse pagination\n    const rawPagination = host.getAttribute('pagination');\n    if (rawPagination) {\n        try {\n            host.pagination = {\n                ...host._pagination,\n                ...JSON.parse(rawPagination),\n            };\n        }\n        catch (error) {\n            console.error('Error parsing pagination attribute:', error);\n        }\n    }\n}\nfunction attributeChanged(host, name, oldValue, newValue) {\n    if (oldValue === newValue)\n        return;\n    if (name === 'mode') {\n        renderSwitch(host);\n        return;\n    }\n    switch (name) {\n        case 'data':\n            if (newValue) {\n                try {\n                    host.data = JSON.parse(newValue);\n                }\n                catch (error) {\n                    console.error('Error parsing data attribute:', error);\n                }\n            }\n            break;\n        case 'options':\n            if (newValue) {\n                try {\n                    host.options = JSON.parse(newValue);\n                }\n                catch (error) {\n                    console.error('Error parsing options attribute:', error);\n                }\n            }\n            break;\n        case 'filters':\n            if (newValue) {\n                try {\n                    host.filters = JSON.parse(newValue);\n                }\n                catch (error) {\n                    console.error('Error parsing filters attribute:', error);\n                }\n            }\n            else {\n                host.filters = [];\n            }\n            break;\n        case 'pagination':\n            if (newValue) {\n                try {\n                    host.pagination = {\n                        ...host._pagination,\n                        ...JSON.parse(newValue),\n                    };\n                }\n                catch (error) {\n                    console.error('Error parsing pagination attribute:', error);\n                }\n            }\n            else {\n                host.pagination = {\n                    currentPage: 1,\n                    pageSize: 30,\n                    totalPages: 1,\n                };\n            }\n            break;\n    }\n}\n\nfunction calculatePaginationForCurrentView(host) {\n    if (host._showRawData) {\n        if (!host.engine)\n            return;\n        const state = host.engine.getState();\n        // Use full rawData first; state.data may be limited\n        const allRawData = (state.rawData || state.data || []);\n        updatePaginationForData(host, allRawData);\n    }\n    else {\n        if (!host.engine)\n            return;\n        const groupedData = host.engine.getGroupedData();\n        let uniqueRowValues = host.engine.getOrderedRowValues();\n        if (!uniqueRowValues) {\n            uniqueRowValues = [\n                ...new Set(groupedData.map((g) => {\n                    const keys = g.key ? g.key.split('|') : [];\n                    return keys[0];\n                })),\n            ].filter(Boolean);\n        }\n        updatePaginationForData(host, uniqueRowValues);\n    }\n}\nfunction updatePaginationForData(host, data) {\n    const pageSize = host._pagination.pageSize;\n    const totalPages = Math.ceil(data.length / pageSize) || 1;\n    if (host._pagination.currentPage > totalPages) {\n        host._pagination.currentPage = Math.max(1, totalPages);\n    }\n    host._pagination.totalPages = totalPages;\n}\nfunction getPaginatedData(host, data) {\n    const start = (host._pagination.currentPage - 1) * host._pagination.pageSize;\n    const end = start + host._pagination.pageSize;\n    return data.slice(start, end);\n}\nfunction previousPage(host) {\n    if (host._pagination.currentPage > 1) {\n        host._pagination.currentPage--;\n        renderSwitch(host);\n        host.dispatchEvent(new CustomEvent('paginationChange', {\n            detail: { ...host._pagination },\n            bubbles: true,\n            composed: true,\n        }));\n    }\n    updatePaginationInfo(host);\n}\nfunction nextPage(host) {\n    if (host._pagination.currentPage < host._pagination.totalPages) {\n        host._pagination.currentPage++;\n        renderSwitch(host);\n        host.dispatchEvent(new CustomEvent('paginationChange', {\n            detail: { ...host._pagination },\n            bubbles: true,\n            composed: true,\n        }));\n    }\n    updatePaginationInfo(host);\n}\nfunction setPageSize(host, pageSize) {\n    if (pageSize > 0) {\n        host._pagination.pageSize = pageSize;\n        host._pagination.currentPage = 1;\n        calculatePaginationForCurrentView(host);\n        renderSwitch(host);\n        host.dispatchEvent(new CustomEvent('paginationChange', {\n            detail: { ...host._pagination },\n            bubbles: true,\n            composed: true,\n        }));\n    }\n    updatePaginationInfo(host);\n}\nfunction goToPage(host, page) {\n    if (page >= 1 && page <= host._pagination.totalPages) {\n        host._pagination.currentPage = page;\n        renderSwitch(host);\n        host.dispatchEvent(new CustomEvent('paginationChange', {\n            detail: { ...host._pagination },\n            bubbles: true,\n            composed: true,\n        }));\n    }\n    updatePaginationInfo(host);\n}\n\nfunction getState(host) {\n    if (!host.engine) {\n        throw new Error('Engine not initialized');\n    }\n    return host.engine.getState();\n}\nfunction sort(host, field, direction) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    host.engine.sort(field, direction);\n}\nfunction setMeasures(host, measures) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    host.engine.setMeasures(measures);\n}\nfunction setDimensions(host, dimensions) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    host.engine.setDimensions(dimensions);\n}\nfunction setGroupConfig(host, groupConfig) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    host.engine.setGroupConfig(groupConfig);\n}\nfunction setAggregation(host, type) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    host.engine.setAggregation(type);\n}\nfunction formatValue(host, value, field) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return String(value);\n    }\n    return host.engine.formatValue(value, field);\n}\nfunction getGroupedData(host) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return [];\n    }\n    return host.engine.getGroupedData();\n}\nfunction getData(host) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return [];\n    }\n    return host.engine.getState().rawData;\n}\nfunction getProcessedData(host) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return null;\n    }\n    return host.engine.getState().processedData;\n}\nfunction updateFieldFormatting(host, field, format) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    host.engine.updateFieldFormatting(field, format);\n}\nfunction getFieldAlignment(host, field) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return 'left';\n    }\n    return host.engine.getFieldAlignment(field);\n}\n\n// Filters\nfunction setFilters(host, value) {\n    console.log('Setting filters, current view mode:', host._showRawData ? 'RAW' : 'PROCESSED');\n    console.log('New filter value:', value);\n    if (host._showRawData) {\n        host._rawFilters = value || [];\n        console.log('Applied RAW filters:', host._rawFilters);\n    }\n    else {\n        host._processedFilters = value || [];\n        console.log('Applied PROCESSED filters:', host._processedFilters);\n    }\n    if (host.engine) {\n        host.engine.setDataHandlingMode(host._showRawData ? 'raw' : 'processed');\n        host.engine.applyFilters(value || []);\n    }\n    host._filters = value || [];\n    host.setAttribute('filters', JSON.stringify(value));\n}\nfunction getFilters(host) {\n    if (host._showRawData) {\n        return host._rawFilters;\n    }\n    else {\n        return host._processedFilters;\n    }\n}\n// Refresh/reset\nfunction refresh(host) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    host._filters = [];\n    host.removeAttribute('filters');\n    host.engine.reset();\n    const filterValueInput = host.shadowRoot?.getElementById('filterValue');\n    if (filterValueInput) {\n        filterValueInput.value = '';\n    }\n}\nfunction reset(host) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    host._rawFilters = [];\n    host._processedFilters = [];\n    host._filters = [];\n    host.removeAttribute('filters');\n    host._pagination.currentPage = 1;\n    host.engine.reset();\n    clearFilterUI(host);\n}\nfunction clearFilterUI(host) {\n    const filterValueInput = host.shadowRoot?.getElementById('filterValue');\n    if (filterValueInput) {\n        filterValueInput.value = '';\n    }\n    const filterFieldSelect = host.shadowRoot?.getElementById('filterField');\n    const filterOperatorSelect = host.shadowRoot?.getElementById('filterOperator');\n    if (filterFieldSelect)\n        filterFieldSelect.selectedIndex = 0;\n    if (filterOperatorSelect)\n        filterOperatorSelect.selectedIndex = 0;\n}\n\n// Exporting helpers\nfunction exportToHTML(host, fileName = 'pivot-table') {\n    if (!host.engine) {\n        console.error('Engine not initialized. Cannot export to HTML.');\n        return;\n    }\n    host.engine.exportToHTML(fileName);\n}\nfunction exportToPDF(host, fileName = 'pivot-table') {\n    if (!host.engine) {\n        console.error('Engine not initialized. Cannot export to PDF.');\n        return;\n    }\n    host.engine.exportToPDF(fileName);\n}\nfunction exportToExcel(host, fileName = 'pivot-table') {\n    if (!host.engine) {\n        console.error('Engine not initialized. Cannot export to Excel.');\n        return;\n    }\n    host.engine.exportToExcel(fileName);\n}\nfunction openPrintDialog(host) {\n    if (!host.engine) {\n        console.error('Engine not initialized. Cannot open print dialog.');\n        return;\n    }\n    host.engine.openPrintDialog();\n}\n// File I/O helpers\nfunction loadFromFile(host, file) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = event => {\n            try {\n                const result = event.target?.result;\n                if (typeof result === 'string') {\n                    const data = JSON.parse(result);\n                    host.data = data;\n                    resolve();\n                }\n                else {\n                    reject(new Error('Failed to read file as text'));\n                }\n            }\n            catch (error) {\n                reject(error);\n            }\n        };\n        reader.onerror = () => reject(new Error('Failed to read file'));\n        reader.readAsText(file);\n    });\n}\nfunction loadFromUrl(host, url) {\n    return fetch(url)\n        .then(response => {\n        if (!response.ok) {\n            throw new Error(`Failed to fetch data from ${url}: ${response.status} ${response.statusText}`);\n        }\n        return response.json();\n    })\n        .then(data => {\n        host.data = data;\n    });\n}\n\nfunction dragRow(host, fromIndex, toIndex) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    host.engine.dragRow(fromIndex, toIndex);\n}\nfunction dragColumn(host, fromIndex, toIndex) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    host.engine.dragColumn(fromIndex, toIndex);\n}\nfunction swapRows(host, fromIndex, toIndex) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    try {\n        if (host._showRawData) {\n            host.engine.swapRawDataRows(fromIndex, toIndex);\n        }\n        else {\n            host.engine.swapDataRows(fromIndex, toIndex);\n        }\n    }\n    catch (error) {\n        console.error('Row swap failed:', error);\n    }\n}\nfunction swapColumns(host, fromIndex, toIndex) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    try {\n        if (host._showRawData) {\n            const headers = host._data.length > 0 ? Object.keys(host._data[0]) : [];\n            if (fromIndex < 0 ||\n                toIndex < 0 ||\n                fromIndex >= headers.length ||\n                toIndex >= headers.length) {\n                console.error(`Invalid column indices for raw data swap: ${fromIndex}, ${toIndex}, total: ${headers.length}`);\n                return;\n            }\n            if (!host._rawDataColumnOrder || host._rawDataColumnOrder.length === 0) {\n                host._rawDataColumnOrder = [...headers];\n            }\n            const temp = host._rawDataColumnOrder[fromIndex];\n            host._rawDataColumnOrder[fromIndex] = host._rawDataColumnOrder[toIndex];\n            host._rawDataColumnOrder[toIndex] = temp;\n            host.renderRawTable();\n        }\n        else {\n            host.engine.swapDataColumns(fromIndex, toIndex);\n            const newOrder = host.engine.getOrderedColumnValues();\n            if (newOrder)\n                host._processedColumnOrder = [...newOrder];\n        }\n    }\n    catch (error) {\n        console.error('Column swap failed:', error);\n    }\n}\nfunction swapRawDataColumns(host, fromIndex, toIndex) {\n    if (!host._data || host._data.length === 0) {\n        console.error('No raw data available for column swap');\n        return;\n    }\n    const headers = Object.keys(host._data[0]);\n    if (fromIndex < 0 ||\n        toIndex < 0 ||\n        fromIndex >= headers.length ||\n        toIndex >= headers.length) {\n        console.error(`Invalid column indices for raw data swap: ${fromIndex}, ${toIndex}, total: ${headers.length}`);\n        return;\n    }\n    if (fromIndex === toIndex)\n        return;\n    if (!host._rawDataColumnOrder)\n        host._rawDataColumnOrder = [...headers];\n    const temp = host._rawDataColumnOrder[fromIndex];\n    host._rawDataColumnOrder[fromIndex] = host._rawDataColumnOrder[toIndex];\n    host._rawDataColumnOrder[toIndex] = temp;\n    host.renderRawTable();\n}\nfunction setDragAndDropEnabled(host, enabled) {\n    const table = host.shadowRoot?.querySelector('table');\n    if (table) {\n        if (enabled) {\n            host.addDragListeners();\n        }\n        else {\n            const draggableElements = table.querySelectorAll('[draggable=\"true\"]');\n            draggableElements.forEach(element => {\n                element.setAttribute('draggable', 'false');\n            });\n        }\n    }\n}\nfunction isDragAndDropEnabled(host) {\n    const firstDraggableElement = host.shadowRoot?.querySelector('[draggable=\"true\"]');\n    return !!firstDraggableElement;\n}\n\nfunction showFormatPopup(host) {\n    if (!host.engine) {\n        console.error('Engine not initialized');\n        return;\n    }\n    const state = host.engine.getState();\n    const availableMeasures = state.measures || [];\n    // Get available fields based on current mode - only numeric/measure fields\n    let availableFields = [];\n    if (host._showRawData) {\n        // For raw data, get only numeric fields (measures) from the data\n        if (state.rawData && state.rawData.length > 0) {\n            const allFields = Object.keys(state.rawData[0]);\n            // Filter to only include measure fields (price, discount, etc.)\n            availableFields = allFields.filter(field => {\n                const sampleValue = state.rawData[0][field];\n                return typeof sampleValue === 'number';\n            });\n        }\n    }\n    else {\n        // For processed data, get measure names\n        availableFields = availableMeasures.map(measure => measure.caption || measure.uniqueName);\n    }\n    const overlay = document.createElement('div');\n    overlay.style.position = 'fixed';\n    overlay.style.top = '0';\n    overlay.style.left = '0';\n    overlay.style.width = '100%';\n    overlay.style.height = '100%';\n    overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\n    overlay.style.display = 'flex';\n    overlay.style.justifyContent = 'center';\n    overlay.style.alignItems = 'center';\n    overlay.style.zIndex = '1000';\n    const popup = document.createElement('div');\n    popup.style.width = '400px';\n    popup.style.padding = '20px';\n    popup.style.backgroundColor = '#fff';\n    popup.style.borderRadius = '8px';\n    popup.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';\n    const header = document.createElement('h2');\n    header.textContent = 'Format cells';\n    header.style.margin = '0 0 10px 0';\n    header.style.textAlign = 'left';\n    const headerSeparator = document.createElement('hr');\n    headerSeparator.style.border = '0';\n    headerSeparator.style.height = '1px';\n    headerSeparator.style.backgroundColor = '#ccc';\n    headerSeparator.style.margin = '10px 0';\n    const formContainer = document.createElement('div');\n    // Form fields configuration\n    const fields = [\n        {\n            name: 'Choose value',\n            options: ['Choose value', 'All values', ...availableFields],\n        },\n        { name: 'Text align', options: ['right', 'left', 'center'] },\n        {\n            name: 'Thousand separator',\n            options: ['(Space)', '(Comma)', '(None)', '(Dot)'],\n        },\n        { name: 'Decimal separator', options: ['.', ','] },\n        { name: 'Decimal places', options: ['None', '0', '1', '2', '3', '4', '5'] },\n        { name: 'Currency symbol', options: ['', '$', '', '', ''] },\n        { name: 'Currency align', options: ['left', 'right'] },\n        { name: 'Null value', options: ['', 'null', '0', 'N/A', '-'] },\n        { name: 'Format as percent', options: ['false', 'true'] },\n    ];\n    const formValues = {};\n    const dropdownElements = [];\n    fields.forEach((field, index) => {\n        const row = document.createElement('div');\n        row.style.display = 'flex';\n        row.style.alignItems = 'center';\n        row.style.marginBottom = '15px';\n        const label = document.createElement('label');\n        label.textContent = field.name;\n        label.style.flex = '1';\n        label.style.marginRight = '10px';\n        label.style.textAlign = 'left';\n        const dropdown = document.createElement('select');\n        dropdown.style.flex = '2';\n        dropdown.style.padding = '8px';\n        dropdown.style.borderRadius = '4px';\n        dropdown.style.border = '1px solid #ccc';\n        // Populate dropdown options\n        field.options.forEach(optionText => {\n            const option = document.createElement('option');\n            option.value = optionText;\n            option.textContent = optionText;\n            dropdown.appendChild(option);\n        });\n        // Set initial value\n        formValues[field.name] = field.options[0];\n        // Disable all fields except first one initially\n        if (index !== 0) {\n            dropdown.disabled = true;\n        }\n        // Handle change events\n        dropdown.addEventListener('change', e => {\n            const target = e.target;\n            formValues[field.name] = target.value;\n            // Enable/disable other fields based on first field\n            if (index === 0) {\n                const selectedValue = target.value;\n                dropdownElements.forEach((el, i) => {\n                    if (i !== 0) {\n                        el.disabled = selectedValue === 'Choose value';\n                    }\n                });\n            }\n        });\n        row.appendChild(label);\n        row.appendChild(dropdown);\n        formContainer.appendChild(row);\n        dropdownElements.push(dropdown);\n    });\n    const buttonContainer = document.createElement('div');\n    buttonContainer.style.display = 'flex';\n    buttonContainer.style.justifyContent = 'flex-end';\n    buttonContainer.style.marginTop = '20px';\n    const applyButton = document.createElement('button');\n    applyButton.textContent = 'APPLY';\n    applyButton.style.padding = '10px 20px';\n    applyButton.style.backgroundColor = '#666';\n    applyButton.style.color = '#fff';\n    applyButton.style.border = 'none';\n    applyButton.style.borderRadius = '4px';\n    applyButton.style.cursor = 'pointer';\n    applyButton.style.marginRight = '10px';\n    const cancelButton = document.createElement('button');\n    cancelButton.textContent = 'CANCEL';\n    cancelButton.style.padding = '10px 20px';\n    cancelButton.style.backgroundColor = '#f5f5f5';\n    cancelButton.style.color = '#333';\n    cancelButton.style.border = '1px solid #ccc';\n    cancelButton.style.borderRadius = '4px';\n    cancelButton.style.cursor = 'pointer';\n    // Event handlers\n    cancelButton.addEventListener('click', () => {\n        document.body.removeChild(overlay);\n    });\n    applyButton.addEventListener('click', () => {\n        const selectedField = formValues['Choose value'];\n        if (selectedField && selectedField !== 'Choose value') {\n            // Map UI values to FormatOptions\n            const formatOptions = {};\n            // Text align\n            if (formValues['Text align']) {\n                formatOptions.align = formValues['Text align'];\n            }\n            // Thousand separator\n            const thousandSep = formValues['Thousand separator'];\n            if (thousandSep === '(Space)')\n                formatOptions.thousandSeparator = ' ';\n            else if (thousandSep === '(Comma)')\n                formatOptions.thousandSeparator = ',';\n            else if (thousandSep === '(None)')\n                formatOptions.thousandSeparator = '';\n            else if (thousandSep === '(Dot)')\n                formatOptions.thousandSeparator = '.';\n            // Decimal separator\n            if (formValues['Decimal separator']) {\n                formatOptions.decimalSeparator = formValues['Decimal separator'];\n            }\n            // Decimal places\n            if (formValues['Decimal places'] &&\n                formValues['Decimal places'] !== 'None') {\n                formatOptions.decimals = parseInt(formValues['Decimal places'], 10);\n            }\n            // Currency\n            const currencySymbol = formValues['Currency symbol'];\n            if (currencySymbol) {\n                formatOptions.type = 'currency';\n                if (currencySymbol === '$')\n                    formatOptions.currency = 'USD';\n                else if (currencySymbol === '')\n                    formatOptions.currency = 'INR';\n                else if (currencySymbol === '')\n                    formatOptions.currency = 'EUR';\n                else if (currencySymbol === '')\n                    formatOptions.currency = 'GBP';\n            }\n            // Currency align\n            if (formValues['Currency align']) {\n                formatOptions.currencyAlign = formValues['Currency align'];\n            }\n            // Null value\n            if (formValues['Null value']) {\n                formatOptions.nullValue =\n                    formValues['Null value'] === 'null' ? null : formValues['Null value'];\n            }\n            // Format as percent\n            if (formValues['Format as percent'] === 'true') {\n                formatOptions.percent = true;\n                formatOptions.type = 'percentage';\n            }\n            // Apply formatting\n            try {\n                if (host.engine) {\n                    if (selectedField === 'All values') {\n                        // Apply to all numeric fields\n                        if (host._showRawData) {\n                            // For raw data, apply to all numeric fields\n                            if (state.rawData && state.rawData.length > 0) {\n                                const allFields = Object.keys(state.rawData[0]);\n                                const numericFields = allFields.filter(field => {\n                                    const sampleValue = state.rawData[0][field];\n                                    return typeof sampleValue === 'number';\n                                });\n                                numericFields.forEach(field => {\n                                    if (host.engine) {\n                                        host.engine.updateFieldFormatting(field, formatOptions);\n                                    }\n                                });\n                                console.log('Applied formatting to all numeric fields:', numericFields);\n                            }\n                        }\n                        else {\n                            // For processed data, apply to all measures\n                            availableMeasures.forEach(measure => {\n                                if (host.engine) {\n                                    host.engine.updateFieldFormatting(measure.uniqueName, formatOptions);\n                                }\n                            });\n                            console.log('Applied formatting to all measures:', availableMeasures.map(m => m.uniqueName));\n                        }\n                    }\n                    else {\n                        // Apply to specific field\n                        let fieldName = selectedField;\n                        if (!host._showRawData) {\n                            // For processed data, find the measure's uniqueName\n                            const measure = availableMeasures.find(m => m.caption === selectedField || m.uniqueName === selectedField);\n                            if (measure) {\n                                fieldName = measure.uniqueName;\n                            }\n                        }\n                        host.engine.updateFieldFormatting(fieldName, formatOptions);\n                        console.log('Applied formatting:', formatOptions, 'to field:', fieldName);\n                    }\n                    // Trigger re-render\n                    host._renderSwitch();\n                }\n            }\n            catch (error) {\n                console.error('Error applying formatting:', error);\n            }\n        }\n        document.body.removeChild(overlay);\n    });\n    buttonContainer.appendChild(applyButton);\n    buttonContainer.appendChild(cancelButton);\n    popup.appendChild(header);\n    popup.appendChild(headerSeparator);\n    popup.appendChild(formContainer);\n    popup.appendChild(buttonContainer);\n    overlay.appendChild(popup);\n    document.body.appendChild(overlay);\n}\n\nclass PivotHeadElement extends HTMLElement {\n    static get observedAttributes() {\n        return ['data', 'options', 'filters', 'pagination', 'mode'];\n    }\n    constructor() {\n        super();\n        this._engineUnsubscribe = null;\n        this._data = [];\n        this._originalData = [];\n        this._options = {};\n        this._filters = [];\n        this._rawFilters = [];\n        this._processedFilters = [];\n        this._rowGroups = [];\n        this._columnGroups = [];\n        this._pagination = {\n            currentPage: 1,\n            pageSize: 10,\n            totalPages: 1,\n        };\n        this._showRawData = false;\n        this._rawDataColumnOrder = [];\n        this._processedColumnOrder = [];\n        this.draggedColumn = null;\n        this.draggedRow = null;\n        this.attachShadow({ mode: 'open' });\n    }\n    set data(value) {\n        this._data = value || [];\n        this._originalData = [...(value || [])];\n        this.tryInitializeEngine();\n    }\n    get data() {\n        return this._data;\n    }\n    set options(value) {\n        this._options = value || {};\n        this.tryInitializeEngine();\n    }\n    get options() {\n        return this._options;\n    }\n    set filters(value) {\n        setFilters(this, value);\n    }\n    get filters() {\n        return getFilters(this);\n    }\n    set pagination(value) {\n        this._pagination = { ...this._pagination, ...value };\n        this.setAttribute('pagination', JSON.stringify(this._pagination));\n        this._renderSwitch();\n    }\n    get pagination() {\n        return this._pagination;\n    }\n    handleEngineStateChange(state) {\n        handleEngineStateChange(this, state);\n    }\n    tryInitializeEngine() {\n        tryInitializeEngine(this);\n    }\n    connectedCallback() {\n        if (!this._data.length && !Object.keys(this._options).length) {\n            parseAttributesIfNeeded(this);\n        }\n        this._renderSwitch();\n    }\n    parseAttributesIfNeeded() {\n        parseAttributesIfNeeded(this);\n    }\n    parseOtherAttributes() {\n        parseOtherAttributes(this);\n    }\n    attributeChangedCallback(name, oldValue, newValue) {\n        attributeChanged(this, name, oldValue, newValue);\n    }\n    _renderSwitch() {\n        renderSwitch(this);\n    }\n    renderFullUI() {\n        renderFullUI(this);\n    }\n    setupControls() {\n        bindControls(this);\n    }\n    updatePaginationInfo() {\n        updatePaginationInfo(this);\n    }\n    calculatePaginationForCurrentView() {\n        calculatePaginationForCurrentView(this);\n    }\n    updatePaginationForData(data) {\n        updatePaginationForData(this, data);\n    }\n    getPaginatedData(data) {\n        return getPaginatedData(this, data);\n    }\n    renderRawTable() {\n        renderRawTable(this);\n    }\n    createSortIcon(field) {\n        return createSortIcon(this, field);\n    }\n    createProcessedSortIcon(field) {\n        return createProcessedSortIcon(this, field);\n    }\n    addDragListeners() {\n        addDragListeners(this);\n    }\n    handleSortClick(e) {\n        handleSortClick(this, e);\n    }\n    handleDrillDownClick(e) {\n        handleDrillDownClick(this, e);\n    }\n    getRawData() {\n        return this._data;\n    }\n    getPagination() {\n        return this._pagination;\n    }\n    getState() {\n        return getState(this);\n    }\n    refresh() {\n        refresh(this);\n    }\n    reset() {\n        reset(this);\n    }\n    clearFilterUI() {\n        clearFilterUI(this);\n    }\n    sort(field, direction) {\n        sort(this, field, direction);\n    }\n    setMeasures(measures) {\n        setMeasures(this, measures);\n    }\n    setDimensions(dimensions) {\n        setDimensions(this, dimensions);\n    }\n    setGroupConfig(groupConfig) {\n        setGroupConfig(this, groupConfig);\n    }\n    setAggregation(type) {\n        setAggregation(this, type);\n    }\n    formatValue(value, field) {\n        return formatValue(this, value, field);\n    }\n    getGroupedData() {\n        return getGroupedData(this);\n    }\n    getFilters() {\n        return this._filters;\n    }\n    getData() {\n        return getData(this);\n    }\n    getProcessedData() {\n        return getProcessedData(this);\n    }\n    exportToHTML(fileName = 'pivot-table') {\n        exportToHTML(this, fileName);\n    }\n    exportToPDF(fileName = 'pivot-table') {\n        exportToPDF(this, fileName);\n    }\n    exportToExcel(fileName = 'pivot-table') {\n        exportToExcel(this, fileName);\n    }\n    openPrintDialog() {\n        openPrintDialog(this);\n    }\n    loadFromFile(file) {\n        return loadFromFile(this, file);\n    }\n    loadFromUrl(url) {\n        return loadFromUrl(this, url);\n    }\n    dragRow(fromIndex, toIndex) {\n        dragRow(this, fromIndex, toIndex);\n    }\n    dragColumn(fromIndex, toIndex) {\n        dragColumn(this, fromIndex, toIndex);\n    }\n    swapRows(fromIndex, toIndex) {\n        swapRows(this, fromIndex, toIndex);\n    }\n    swapColumns(fromIndex, toIndex) {\n        swapColumns(this, fromIndex, toIndex);\n    }\n    swapRawDataColumns(fromIndex, toIndex) {\n        swapRawDataColumns(this, fromIndex, toIndex);\n    }\n    setDragAndDropEnabled(enabled) {\n        setDragAndDropEnabled(this, enabled);\n    }\n    isDragAndDropEnabled() {\n        return isDragAndDropEnabled(this);\n    }\n    swapDataRowsByIndex(fromIndex, toIndex) {\n        this.swapRows(fromIndex, toIndex);\n    }\n    swapDataColumnsByIndex(fromIndex, toIndex) {\n        this.swapColumns(fromIndex, toIndex);\n    }\n    previousPage() {\n        previousPage(this);\n    }\n    nextPage() {\n        nextPage(this);\n    }\n    setPageSize(pageSize) {\n        setPageSize(this, pageSize);\n    }\n    goToPage(page) {\n        goToPage(this, page);\n    }\n    setViewMode(mode) {\n        const wantRaw = mode === 'raw';\n        if (this._showRawData === wantRaw)\n            return;\n        this._showRawData = wantRaw;\n        if (!this.engine)\n            return;\n        try {\n            this.engine.setDataHandlingMode(wantRaw ? 'raw' : 'processed');\n            const currentFilters = wantRaw\n                ? this._rawFilters\n                : this._processedFilters;\n            this.engine.applyFilters(currentFilters);\n            this.dispatchEvent(new CustomEvent('viewModeChange', {\n                detail: { mode },\n                bubbles: true,\n                composed: true,\n            }));\n        }\n        catch (err) {\n            console.error('Failed to set view mode:', err);\n        }\n    }\n    getViewMode() {\n        return this._showRawData ? 'raw' : 'processed';\n    }\n    updateFieldFormatting(field, format) {\n        updateFieldFormatting(this, field, format);\n    }\n    getFieldAlignment(field) {\n        return getFieldAlignment(this, field);\n    }\n    showFormatPopup() {\n        showFormatPopup(this);\n    }\n}\ncustomElements.define('pivot-head', PivotHeadElement);\n\nexport { PivotHeadElement };\n//# sourceMappingURL=pivot-head.mjs.map\n"
    ],
    "mappings": "AAAA,SAASA,WAAW,QAAQ,4BAA4B;AAExD,SAASC,YAAYA,CAACC,IAAI,EAAE;EACxB,MAAMC,IAAI,GAAGD,IAAI,CAACE,YAAY,CAAC,MAAM,CAAC,IAAI,SAAS;EACnD,IAAID,IAAI,KAAK,MAAM,EAAE;IACjB,IAAID,IAAI,CAACG,UAAU,EAAE;MACjBH,IAAI,CAACG,UAAU,CAACC,SAAS,GAAI,yCAAwC;IACzE;EACJ,CAAC,MACI,IAAIH,IAAI,KAAK,SAAS,EAAE;IACzB,IAAID,IAAI,CAACG,UAAU,EAAE;MACjBH,IAAI,CAACG,UAAU,CAACC,SAAS,GAAI;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;IACC;EACJ,CAAC,MACI;IACDJ,IAAI,CAACK,YAAY,GAAGL,IAAI,CAACM,cAAc,CAAC,CAAC,GAAGN,IAAI,CAACO,YAAY,CAAC,CAAC;EACnE;AACJ;AACA,SAASC,uBAAuBA,CAACR,IAAI,EAAES,KAAK,EAAE;EAC1CT,IAAI,CAACU,aAAa,CAAC,IAAIC,WAAW,CAAC,aAAa,EAAE;IAC9CC,MAAM,EAAEH,KAAK;IACbI,OAAO,EAAE,IAAI;IACbC,QAAQ,EAAE;EACd,CAAC,CAAC,CAAC;EACHd,IAAI,CAACe,iCAAiC,CAAC,CAAC;EACxC,MAAMd,IAAI,GAAGD,IAAI,CAACE,YAAY,CAAC,MAAM,CAAC;EACtC,IAAID,IAAI,KAAK,MAAM,EAAE;IACjB,IAAID,IAAI,CAACG,UAAU,EACfH,IAAI,CAACG,UAAU,CAACC,SAAS,GAAI,yCAAwC;EAC7E,CAAC,MACI,IAAIH,IAAI,KAAK,SAAS,EAAE;IACzB,IAAID,IAAI,CAACG,UAAU,EAAE;MACjBH,IAAI,CAACG,UAAU,CAACC,SAAS,GAAI;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;IACC;EACJ,CAAC,MACI;IACDJ,IAAI,CAACK,YAAY,GAAGL,IAAI,CAACM,cAAc,CAAC,CAAC,GAAGN,IAAI,CAACO,YAAY,CAAC,CAAC;EACnE;AACJ;AACA,SAASA,YAAYA,CAACP,IAAI,EAAE;EACxB,MAAMgB,MAAM,GAAGhB,IAAI,CAACgB,MAAM;EAC1B,IAAI,CAACA,MAAM,EAAE;IACT,IAAIhB,IAAI,CAACG,UAAU,EACfH,IAAI,CAACG,UAAU,CAACC,SAAS,GAAG,EAAE;IAClC;EACJ;EACA,MAAMK,KAAK,GAAGO,MAAM,CAACC,QAAQ,CAAC,CAAC;EAC/B,IAAI,CAACR,KAAK,CAACS,aAAa,EAAE;IACtBC,OAAO,CAACC,KAAK,CAAC,6BAA6B,CAAC;IAC5C;EACJ;EACA,MAAMC,QAAQ,GAAGrB,IAAI,CAACsB,QAAQ,CAACC,IAAI,GAAG,CAAC,CAAC;EACxC,MAAMC,WAAW,GAAGxB,IAAI,CAACsB,QAAQ,CAACG,OAAO,GAAG,CAAC,CAAC;EAC9C,MAAMC,QAAQ,GAAG1B,IAAI,CAACsB,QAAQ,CAACI,QAAQ,IAAI,EAAE;EAC7C,IAAI,CAACL,QAAQ,IAAI,CAACG,WAAW,IAAI,CAACE,QAAQ,CAACC,MAAM,EAAE;IAC/CR,OAAO,CAACC,KAAK,CAAC,gDAAgD,CAAC;IAC/D;EACJ;EACApB,IAAI,CAACe,iCAAiC,CAAC,CAAC;EACxC,IAAIa,IAAI,GAAI;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A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",
    "ignoreList": []
  },
  "metadata": {},
  "sourceType": "module",
  "externalDependencies": []
}
