{
  "ast": null,
  "code": "/* PivotHead Demo\n *\n * This file demonstrates the usage of the PivotheadCore library to create an interactive pivot table.\n * Features include:\n * - Sorting\n * - Grouping\n * - Column resizing\n * - Column reordering (drag and drop)\n * - Row reordering (drag and drop)\n */\nimport { createHeader } from './header/header.js';\n// Use PivotEngine directly from the global scope\nimport { PivotEngine } from '@mindfiredigital/pivothead';\nimport { sampleData } from './config/config.js';\nimport { config } from './config/config.js';\n\n// Create a single instance of PivotEngine\nexport let pivotEngine;\n// Store filtered data\nlet filteredData = [...sampleData];\nlet showProcessedData = true;\nlet currentViewMode = 'processed'; // 'raw' or 'processed'\n\n// Manage pagination state locally\nlet paginationState = {\n  currentPage: 1,\n  pageSize: 10,\n  totalPages: 1\n};\nlet cellFormatter = null;\nlet selectedCells = new Set();\n\n// Cell formatting configuration\nconst CellFormatConfig = {\n  textAlign: 'left',\n  fontWeight: 'normal',\n  fontStyle: 'normal',\n  fontSize: '14px',\n  fontFamily: 'Arial, sans-serif',\n  color: '#000000',\n  backgroundColor: '#ffffff',\n  chooseValue: 'none',\n  thousandSeparator: ' ',\n  decimalSeparator: '.',\n  decimalPlaces: 2,\n  currencySymbol: '$',\n  currencyAlign: 'left',\n  nullValue: '',\n  formatAsPercent: false\n};\n\n// Initialize filter fields\n// function initializeFilters() {\n//   const filterField = document.getElementById('filterField');\n//   filterField.innerHTML = `\n//         <option value=\"product\">Product</option>\n//         <option value=\"region\">Region</option>\n//         <option value=\"sales\">Sales</option>\n//         <option value=\"quantity\">Quantity</option>\n//         <option value=\"date\">Date</option>\n//     `;\n\n//   const filterOperator = document.getElementById('filterOperator');\n//   filterOperator.innerHTML = `\n//         <option value=\"equals\">Equals</option>\n//         <option value=\"contains\">Contains</option>\n//         <option value=\"greaterThan\">Greater Than</option>\n//         <option value=\"lessThan\">Less Than</option>\n//     `;\n// }\n\nfunction initializeFilters() {\n  const filterField = document.getElementById('filterField');\n  filterField.innerHTML = `\n    <option value=\"country\">Country</option>\n    <option value=\"category\">Category</option>\n    <option value=\"price\">Price</option>\n    <option value=\"discount\">Discount</option>\n  `;\n  const filterOperator = document.getElementById('filterOperator');\n  filterOperator.innerHTML = `\n    <option value=\"equals\">Equals</option>\n    <option value=\"contains\">Contains</option>\n    <option value=\"greaterThan\">Greater Than</option>\n    <option value=\"lessThan\">Less Than</option>\n  `;\n}\n\n// Apply filter to data\n\n// Replace your applyFilter function with this fixed version:\nfunction applyFilter(data, filter) {\n  const newFilteredData = data.filter(item => {\n    const fieldValue = item[filter.field];\n    switch (filter.operator) {\n      case 'equals':\n        return fieldValue === filter.value;\n      case 'contains':\n        return String(fieldValue).toLowerCase().includes(String(filter.value).toLowerCase());\n      case 'greaterThan':\n        return parseFloat(fieldValue) > parseFloat(filter.value);\n      case 'lessThan':\n        return parseFloat(fieldValue) < parseFloat(filter.value);\n      default:\n        return true;\n    }\n  });\n\n  // Update the global filteredData variable\n  filteredData = newFilteredData;\n\n  // Create a new PivotEngine instance with the filtered data\n  pivotEngine = new PivotEngine({\n    ...config,\n    data: newFilteredData\n  });\n  return newFilteredData;\n}\n\n// Get paginated data\nfunction getPaginatedData(data, paginationState) {\n  const start = (paginationState.currentPage - 1) * paginationState.pageSize;\n  const end = start + paginationState.pageSize;\n  return data.slice(start, end);\n}\n\n// Helper function to create sort icons\nfunction createSortIcon(field, currentSortConfig) {\n  const sortIcon = document.createElement('span');\n  sortIcon.style.marginLeft = '5px';\n  sortIcon.style.display = 'inline-block';\n\n  // Check if this field is currently being sorted\n  const isCurrentlySorted = currentSortConfig && currentSortConfig.field === field;\n  if (isCurrentlySorted) {\n    // Show the appropriate icon based on sort direction\n    if (currentSortConfig.direction === 'asc') {\n      sortIcon.innerHTML = '&#9650;'; // Up arrow\n      sortIcon.title = 'Sorted ascending';\n    } else {\n      sortIcon.innerHTML = '&#9660;'; // Down arrow\n      sortIcon.title = 'Sorted descending';\n    }\n    sortIcon.style.color = '#007bff'; // Highlight the active sort\n  } else {\n    // Show a neutral icon for unsorted fields\n    sortIcon.innerHTML = '&#8693;'; // Up/down arrow\n    sortIcon.title = 'Click to sort';\n    sortIcon.style.color = '#6c757d';\n    sortIcon.style.opacity = '0.5';\n  }\n  return sortIcon;\n}\n\n// Cell Formatter Class - ADD THIS ENTIRE CLASS\n// REPLACE your existing CellFormatter class with this enhanced version\n\nclass CellFormatter {\n  constructor() {\n    this.currentFormat = {\n      ...CellFormatConfig\n    };\n    this.selectedCells = new Set();\n    this.formatHistory = new Map();\n  }\n\n  // Enhanced formatNumber with all separator options\n  formatNumber(value, config) {\n    if (value === null || value === undefined || value === '') {\n      return config.nullValue || '';\n    }\n    let num = parseFloat(value);\n    if (isNaN(num)) return value;\n\n    // Handle percentage\n    if (config.formatAsPercent) {\n      num = num * 100;\n    }\n\n    // Apply decimal places\n    const decimalPlaces = config.decimalPlaces || 2;\n    num = num.toFixed(decimalPlaces);\n\n    // Split into integer and decimal parts\n    let [integerPart, decimalPart] = num.split('.');\n\n    // Apply thousand separator\n    if (config.thousandSeparator && config.thousandSeparator !== 'none') {\n      let separator = config.thousandSeparator;\n      // Convert display names to actual separators\n      if (separator === '(Space)') separator = ' ';\n      if (separator === '(Comma)') separator = ',';\n      if (separator === '(Dot)') separator = '.';\n      integerPart = integerPart.replace(/\\B(?=(\\d{3})+(?!\\d))/g, separator);\n    }\n\n    // Combine parts with decimal separator\n    let formattedNumber = integerPart;\n    if (decimalPart && decimalPlaces > 0) {\n      let decSeparator = config.decimalSeparator || '.';\n      // Convert display names to actual separators\n      if (decSeparator === '. (Dot)') decSeparator = '.';\n      if (decSeparator === ', (Comma)') decSeparator = ',';\n      formattedNumber += decSeparator + decimalPart;\n    }\n\n    // Add currency or percentage symbol\n    if (config.chooseValue === 'currency') {\n      const symbol = this.getCurrencySymbol(config.currencySymbol);\n      formattedNumber = config.currencyAlign === 'right' ? formattedNumber + symbol : symbol + formattedNumber;\n    } else if (config.formatAsPercent || config.chooseValue === 'percentage') {\n      formattedNumber += '%';\n    }\n    return formattedNumber;\n  }\n\n  // Get currency symbol from dropdown value\n  getCurrencySymbol(currencyValue) {\n    const currencyMap = {\n      '$ (Dollar)': '$',\n      '€ (Euro)': '€',\n      '£ (Pound)': '£',\n      '₹ (Rupee)': '₹',\n      '¥ (Yen)': '¥'\n    };\n    return currencyMap[currencyValue] || '$';\n  }\n\n  // Enhanced applyTextStyling with text alignment\n  applyTextStyling(element, config) {\n    if (!element) return;\n    element.style.textAlign = config.textAlign || 'left';\n    element.style.fontFamily = config.fontFamily || 'Arial, sans-serif';\n    element.style.fontSize = config.fontSize || '14px';\n    element.style.fontWeight = config.fontWeight || 'normal';\n    element.style.fontStyle = config.fontStyle || 'normal';\n    element.style.color = config.color || '#000000';\n    element.style.backgroundColor = config.backgroundColor || '#ffffff';\n  }\n  showFormatModal() {\n    if (this.selectedCells.size === 0) {\n      alert('Please select cells first by clicking on them while holding Ctrl');\n      return;\n    }\n    const modal = this.createFormatModal();\n    document.body.appendChild(modal);\n    this.setupModalEventListeners(modal);\n    this.loadCurrentFormat();\n    this.updatePreview();\n  }\n\n  // Enhanced createFormatModal with all options matching the screenshot\n  createFormatModal() {\n    const modal = document.createElement('div');\n    modal.id = 'formatCellModal';\n    modal.className = 'format-modal';\n    modal.innerHTML = `\n      <div class=\"format-modal-content\">\n        <div class=\"format-modal-header\">\n          <h3>Format cells</h3>\n          <button id=\"closeFormatModal\" class=\"format-close-btn\">&times;</button>\n        </div>\n        \n        <div class=\"format-modal-body\">\n          <!-- Choose Value -->\n          <div class=\"format-section\">\n            <label for=\"chooseValue\">CHOOSE VALUE</label>\n            <select id=\"chooseValue\" class=\"format-select\">\n              <option value=\"none\">Choose value</option>\n              <option value=\"currency\">Currency</option>\n              <option value=\"number\">Number</option>\n              <option value=\"percentage\">Percentage</option>\n              <option value=\"text\">Text</option>\n              <option value=\"date\">Date</option>\n            </select>\n          </div>\n\n          <!-- Text Align -->\n          <div class=\"format-section\">\n            <label for=\"textAlign\">Text align</label>\n            <select id=\"textAlign\" class=\"format-select\">\n              <option value=\"left\">left</option>\n              <option value=\"center\">center</option>\n              <option value=\"right\">right</option>\n            </select>\n          </div>\n\n          <!-- Thousand Separator -->\n          <div class=\"format-section\">\n            <label for=\"thousandSeparator\">Thousand separator</label>\n            <select id=\"thousandSeparator\" class=\"format-select\">\n              <option value=\"(Space)\">(Space)</option>\n              <option value=\"(Comma)\">(Comma)</option>\n              <option value=\"(Dot)\">(Dot)</option>\n              <option value=\"none\">None</option>\n            </select>\n          </div>\n\n          <!-- Decimal Separator -->\n          <div class=\"format-section\">\n            <label for=\"decimalSeparator\">Decimal separator</label>\n            <select id=\"decimalSeparator\" class=\"format-select\">\n              <option value=\". (Dot)\">. (Dot)</option>\n              <option value=\", (Comma)\">, (Comma)</option>\n            </select>\n          </div>\n\n          <!-- Decimal Places -->\n          <div class=\"format-section\">\n            <label for=\"decimalPlaces\">Decimal places</label>\n            <select id=\"decimalPlaces\" class=\"format-select\">\n              <option value=\"none\">None</option>\n              <option value=\"0\">0</option>\n              <option value=\"1\">1</option>\n              <option value=\"2\" selected>2</option>\n              <option value=\"3\">3</option>\n              <option value=\"4\">4</option>\n            </select>\n          </div>\n\n          <!-- Currency Symbol -->\n          <div class=\"format-section currency-section\" style=\"display: none;\">\n            <label for=\"currencySymbol\">Currency symbol</label>\n            <select id=\"currencySymbol\" class=\"format-select\">\n              <option value=\"$ (Dollar)\">$ (Dollar)</option>\n              <option value=\"€ (Euro)\">€ (Euro)</option>\n              <option value=\"£ (Pound)\">£ (Pound)</option>\n              <option value=\"₹ (Rupee)\">₹ (Rupee)</option>\n              <option value=\"¥ (Yen)\">¥ (Yen)</option>\n            </select>\n          </div>\n\n          <!-- Currency Align -->\n          <div class=\"format-section currency-section\" style=\"display: none;\">\n            <label for=\"currencyAlign\">Currency align</label>\n            <select id=\"currencyAlign\" class=\"format-select\">\n              <option value=\"left\">left</option>\n              <option value=\"right\">right</option>\n            </select>\n          </div>\n\n          <!-- Null Value -->\n          <div class=\"format-section\">\n            <label for=\"nullValue\">Null value</label>\n            <input type=\"text\" id=\"nullValue\" class=\"format-input\" placeholder=\"What to show for empty values\">\n          </div>\n\n          <!-- Format as Percent -->\n          <div class=\"format-section\">\n            <label for=\"formatAsPercent\">Format as percent</label>\n            <select id=\"formatAsPercent\" class=\"format-select\">\n              <option value=\"false\">false</option>\n              <option value=\"true\">true</option>\n            </select>\n          </div>\n\n          <!-- Font Styling -->\n          <div class=\"format-section\">\n            <label>Font Style</label>\n            <div class=\"font-controls\">\n              <select id=\"fontFamily\" class=\"format-select\">\n                <option value=\"Arial, sans-serif\">Arial</option>\n                <option value=\"Helvetica, sans-serif\">Helvetica</option>\n                <option value=\"Times New Roman, serif\">Times New Roman</option>\n                <option value=\"Courier New, monospace\">Courier New</option>\n              </select>\n              <select id=\"fontSize\" class=\"format-select\">\n                <option value=\"12px\">12px</option>\n                <option value=\"14px\" selected>14px</option>\n                <option value=\"16px\">16px</option>\n                <option value=\"18px\">18px</option>\n              </select>\n              <button type=\"button\" id=\"boldToggle\" class=\"format-btn\">B</button>\n              <button type=\"button\" id=\"italicToggle\" class=\"format-btn\">I</button>\n            </div>\n          </div>\n\n          <!-- Colors -->\n          <div class=\"format-section\">\n            <label>Colors</label>\n            <div class=\"color-controls\">\n              <div class=\"color-control\">\n                <label for=\"textColor\">Text Color:</label>\n                <input type=\"color\" id=\"textColor\" value=\"#000000\">\n              </div>\n              <div class=\"color-control\">\n                <label for=\"backgroundColor\">Background:</label>\n                <input type=\"color\" id=\"backgroundColor\" value=\"#ffffff\">\n              </div>\n            </div>\n          </div>\n\n          <!-- Preview Section -->\n          <div class=\"format-section\">\n            <label>Preview</label>\n            <div id=\"formatPreview\" class=\"format-preview\">1234.56</div>\n          </div>\n        </div>\n\n        <div class=\"format-modal-footer\">\n          <button id=\"applyFormat\" class=\"format-apply-btn\">APPLY</button>\n          <button id=\"cancelFormat\" class=\"format-cancel-btn\">CANCEL</button>\n        </div>\n      </div>\n    `;\n    return modal;\n  }\n\n  // Enhanced setupModalEventListeners\n  setupModalEventListeners(modal) {\n    // Close handlers\n    modal.querySelector('#closeFormatModal').addEventListener('click', () => modal.remove());\n    modal.querySelector('#cancelFormat').addEventListener('click', () => modal.remove());\n\n    // Apply handler\n    modal.querySelector('#applyFormat').addEventListener('click', () => {\n      this.applyFormat();\n      modal.remove();\n    });\n\n    // Input change handlers\n    const inputs = modal.querySelectorAll('select, input');\n    inputs.forEach(input => {\n      input.addEventListener('change', () => {\n        this.updateFormatFromInputs();\n        this.updatePreview();\n      });\n      input.addEventListener('input', () => {\n        this.updateFormatFromInputs();\n        this.updatePreview();\n      });\n    });\n\n    // Font style toggles\n    const boldToggle = modal.querySelector('#boldToggle');\n    const italicToggle = modal.querySelector('#italicToggle');\n    boldToggle.addEventListener('click', () => {\n      boldToggle.classList.toggle('active');\n      this.currentFormat.fontWeight = boldToggle.classList.contains('active') ? 'bold' : 'normal';\n      this.updatePreview();\n    });\n    italicToggle.addEventListener('click', () => {\n      italicToggle.classList.toggle('active');\n      this.currentFormat.fontStyle = italicToggle.classList.contains('active') ? 'italic' : 'normal';\n      this.updatePreview();\n    });\n\n    // Show/hide currency sections based on choose value\n    modal.querySelector('#chooseValue').addEventListener('change', e => {\n      this.toggleCurrencyFields();\n      this.updatePreview();\n    });\n  }\n\n  // Enhanced updateFormatFromInputs\n  updateFormatFromInputs() {\n    const modal = document.getElementById('formatCellModal');\n    if (!modal) return;\n    this.currentFormat = {\n      ...this.currentFormat,\n      chooseValue: modal.querySelector('#chooseValue').value,\n      textAlign: modal.querySelector('#textAlign').value,\n      thousandSeparator: modal.querySelector('#thousandSeparator').value,\n      decimalSeparator: modal.querySelector('#decimalSeparator').value,\n      decimalPlaces: modal.querySelector('#decimalPlaces').value === 'none' ? 0 : parseInt(modal.querySelector('#decimalPlaces').value),\n      currencySymbol: modal.querySelector('#currencySymbol').value,\n      currencyAlign: modal.querySelector('#currencyAlign').value,\n      nullValue: modal.querySelector('#nullValue').value,\n      formatAsPercent: modal.querySelector('#formatAsPercent').value === 'true',\n      fontFamily: modal.querySelector('#fontFamily').value,\n      fontSize: modal.querySelector('#fontSize').value,\n      color: modal.querySelector('#textColor').value,\n      backgroundColor: modal.querySelector('#backgroundColor').value\n    };\n  }\n\n  // Toggle currency-specific fields\n  toggleCurrencyFields() {\n    const currencySections = document.querySelectorAll('.currency-section');\n    const isCurrency = this.currentFormat.chooseValue === 'currency';\n    currencySections.forEach(section => {\n      section.style.display = isCurrency ? 'block' : 'none';\n    });\n  }\n\n  // Enhanced updatePreview\n  updatePreview() {\n    const preview = document.getElementById('formatPreview');\n    if (!preview) return;\n\n    // Sample value for preview\n    const sampleValue = 1234.56;\n    const formattedValue = this.formatNumber(sampleValue, this.currentFormat);\n    preview.textContent = formattedValue;\n    this.applyTextStyling(preview, this.currentFormat);\n  }\n\n  // Load current format into modal\n  loadCurrentFormat() {\n    const modal = document.getElementById('formatCellModal');\n    if (!modal) return;\n\n    // Set all input values\n    modal.querySelector('#chooseValue').value = this.currentFormat.chooseValue || 'none';\n    modal.querySelector('#textAlign').value = this.currentFormat.textAlign || 'left';\n    modal.querySelector('#thousandSeparator').value = this.currentFormat.thousandSeparator || '(Space)';\n    modal.querySelector('#decimalSeparator').value = this.currentFormat.decimalSeparator || '. (Dot)';\n    modal.querySelector('#decimalPlaces').value = this.currentFormat.decimalPlaces === 0 ? 'none' : this.currentFormat.decimalPlaces || 2;\n    modal.querySelector('#currencySymbol').value = this.currentFormat.currencySymbol || '$ (Dollar)';\n    modal.querySelector('#currencyAlign').value = this.currentFormat.currencyAlign || 'left';\n    modal.querySelector('#nullValue').value = this.currentFormat.nullValue || '';\n    modal.querySelector('#formatAsPercent').value = this.currentFormat.formatAsPercent ? 'true' : 'false';\n    modal.querySelector('#fontFamily').value = this.currentFormat.fontFamily || 'Arial, sans-serif';\n    modal.querySelector('#fontSize').value = this.currentFormat.fontSize || '14px';\n    modal.querySelector('#textColor').value = this.currentFormat.color || '#000000';\n    modal.querySelector('#backgroundColor').value = this.currentFormat.backgroundColor || '#ffffff';\n\n    // Set font style toggles\n    const boldToggle = modal.querySelector('#boldToggle');\n    const italicToggle = modal.querySelector('#italicToggle');\n    if (this.currentFormat.fontWeight === 'bold') {\n      boldToggle.classList.add('active');\n    }\n    if (this.currentFormat.fontStyle === 'italic') {\n      italicToggle.classList.add('active');\n    }\n    this.toggleCurrencyFields();\n  }\n\n  // Apply format to selected cells\n  applyFormat() {\n    this.selectedCells.forEach(cellSelector => {\n      const cell = document.querySelector(cellSelector);\n      if (cell) {\n        const originalValue = cell.dataset.originalValue || cell.textContent;\n        cell.dataset.originalValue = originalValue;\n        const formattedValue = this.formatNumber(originalValue, this.currentFormat);\n        cell.textContent = formattedValue;\n        this.applyTextStyling(cell, this.currentFormat);\n        this.formatHistory.set(cellSelector, {\n          ...this.currentFormat\n        });\n      }\n    });\n  }\n\n  // Rest of the methods remain the same...\n  addCellToSelection(cell) {\n    const selector = this.getCellSelector(cell);\n    this.selectedCells.add(selector);\n    cell.classList.add('selected-cell');\n  }\n  removeCellFromSelection(cell) {\n    const selector = this.getCellSelector(cell);\n    this.selectedCells.delete(selector);\n    cell.classList.remove('selected-cell');\n  }\n  clearSelection() {\n    document.querySelectorAll('.selected-cell').forEach(cell => {\n      cell.classList.remove('selected-cell');\n    });\n    this.selectedCells.clear();\n  }\n  getCellSelector(cell) {\n    const row = cell.closest('tr').rowIndex;\n    const col = cell.cellIndex;\n    return `tr:nth-child(${row + 1}) td:nth-child(${col + 1})`;\n  }\n}\nfunction sortRawDataByColumn(columnName, rawData) {\n  console.log(`Sorting raw data by column: ${columnName}`);\n\n  // Get current sort state\n  const currentSort = window.rawDataSort || {};\n  const direction = currentSort.column === columnName && currentSort.direction === 'asc' ? 'desc' : 'asc';\n\n  // Sort the data\n  rawData.sort((a, b) => {\n    let aVal = a[columnName];\n    let bVal = b[columnName];\n\n    // Handle different data types\n    if (typeof aVal === 'string') aVal = aVal.toLowerCase();\n    if (typeof bVal === 'string') bVal = bVal.toLowerCase();\n    if (aVal < bVal) return direction === 'asc' ? -1 : 1;\n    if (aVal > bVal) return direction === 'asc' ? 1 : -1;\n    return 0;\n  });\n\n  // Store sort state\n  window.rawDataSort = {\n    column: columnName,\n    direction\n  };\n\n  // Update the global data arrays to maintain sort\n  if (filteredData === rawData) {\n    filteredData = [...rawData];\n  }\n  console.log(`Sorted raw data by ${columnName} (${direction})`);\n  renderRawDataTable();\n}\nfunction swapRawDataRows(fromIndex, toIndex, rawData) {\n  console.log('Swapping raw data rows:', fromIndex, '->', toIndex);\n  if (fromIndex < 0 || toIndex < 0 || fromIndex >= rawData.length || toIndex >= rawData.length) {\n    console.error('Invalid row indices for raw data swap');\n    return;\n  }\n\n  // Swap the rows in the raw data array\n  const temp = rawData[fromIndex];\n  rawData[fromIndex] = rawData[toIndex];\n  rawData[toIndex] = temp;\n\n  // Update filteredData if it's the same reference\n  if (filteredData === rawData || filteredData && filteredData.length === rawData.length) {\n    filteredData = [...rawData];\n  }\n  console.log('Raw data rows swapped successfully');\n}\n\n// Keep existing swapRawDataColumns function or add this if missing:\nfunction swapRawDataColumns(fromIndex, toIndex) {\n  // Store the column order preference for raw data\n  if (!window.rawDataColumnOrder) {\n    const rawData = filteredData.length > 0 ? filteredData : sampleData;\n    const headers = rawData.length > 0 ? Object.keys(rawData[0]) : [];\n    window.rawDataColumnOrder = [...headers];\n  }\n\n  // Swap in the column order array\n  const temp = window.rawDataColumnOrder[fromIndex];\n  window.rawDataColumnOrder[fromIndex] = window.rawDataColumnOrder[toIndex];\n  window.rawDataColumnOrder[toIndex] = temp;\n  console.log('Raw data column order updated:', window.rawDataColumnOrder);\n}\nfunction renderRawDataTable() {\n  try {\n    console.log('Rendering raw data table');\n\n    // Get data source\n    let rawDataToUse;\n    if (filteredData && filteredData.length > 0) {\n      rawDataToUse = filteredData;\n      console.log('Using filteredData for raw view:', filteredData.length, 'items');\n    } else if (sampleData && sampleData.length > 0) {\n      rawDataToUse = sampleData;\n      console.log('Using sampleData for raw view:', sampleData.length, 'items');\n    } else {\n      const state = pivotEngine.getState();\n      rawDataToUse = state.data || state.rawData || [];\n      console.log('Using engine data for raw view:', rawDataToUse.length, 'items');\n    }\n    if (!rawDataToUse || rawDataToUse.length === 0) {\n      console.error('No raw data available');\n      const tableContainer = document.getElementById('myTable');\n      tableContainer.innerHTML = '<div style=\"padding: 20px;\">No data available to display.</div>';\n      return;\n    }\n    console.log('Rendering raw data table with', rawDataToUse.length, 'total items');\n    const tableContainer = document.getElementById('myTable');\n    tableContainer.innerHTML = '';\n    const table = document.createElement('table');\n    table.style.width = '100%';\n    table.style.borderCollapse = 'collapse';\n    table.style.marginTop = '20px';\n    table.style.border = '1px solid #dee2e6';\n\n    // Get headers\n    const headers = rawDataToUse.length > 0 ? Object.keys(rawDataToUse[0]) : [];\n    console.log('Raw data headers:', headers);\n\n    // Create table header\n    const thead = document.createElement('thead');\n    const headerRow = document.createElement('tr');\n    headers.forEach((headerText, index) => {\n      const th = document.createElement('th');\n      th.style.padding = '12px';\n      th.style.backgroundColor = '#f8f9fa';\n      th.style.borderBottom = '2px solid #dee2e6';\n      th.style.borderRight = '1px solid #dee2e6';\n      th.style.cursor = 'pointer';\n      th.style.position = 'relative';\n      th.setAttribute('draggable', 'true');\n      th.dataset.columnIndex = index;\n      th.dataset.columnName = headerText;\n      th.className = 'raw-data-header';\n      const headerContent = document.createElement('div');\n      headerContent.style.display = 'flex';\n      headerContent.style.alignItems = 'center';\n      headerContent.style.justifyContent = 'space-between';\n      const headerSpan = document.createElement('span');\n      headerSpan.textContent = getFieldDisplayName(headerText);\n      headerContent.appendChild(headerSpan);\n      const sortIcon = document.createElement('span');\n      sortIcon.innerHTML = '↕️';\n      sortIcon.style.marginLeft = '5px';\n      sortIcon.style.fontSize = '12px';\n      headerContent.appendChild(sortIcon);\n      th.appendChild(headerContent);\n      th.addEventListener('click', () => {\n        sortRawDataByColumn(headerText, rawDataToUse);\n      });\n      headerRow.appendChild(th);\n    });\n    thead.appendChild(headerRow);\n    table.appendChild(thead);\n\n    // FIXED: Only update pagination once, here\n    updateRawDataPagination(rawDataToUse);\n\n    // Get paginated data\n    const paginatedData = getPaginatedData(rawDataToUse, paginationState);\n    console.log('Paginated raw data:', paginatedData.length, 'items out of', rawDataToUse.length, 'total');\n\n    // Create table body\n    const tbody = document.createElement('tbody');\n    paginatedData.forEach((rowData, rowIndex) => {\n      const tr = document.createElement('tr');\n      tr.dataset.rowIndex = rowIndex;\n      tr.dataset.globalIndex = rawDataToUse.indexOf(rowData);\n      tr.setAttribute('draggable', 'true');\n      tr.style.cursor = 'move';\n      tr.className = 'raw-data-row';\n      headers.forEach(header => {\n        const td = document.createElement('td');\n        td.style.padding = '8px';\n        td.style.borderBottom = '1px solid #dee2e6';\n        td.style.borderRight = '1px solid #dee2e6';\n        let cellValue = rowData[header];\n        if (cellValue === null || cellValue === undefined) {\n          cellValue = '';\n        } else if (typeof cellValue === 'number') {\n          if (header === 'price' || header === 'sales' || header === 'revenue' || header === 'discount') {\n            cellValue = new Intl.NumberFormat('en-US', {\n              style: 'currency',\n              currency: 'USD'\n            }).format(cellValue);\n          } else if (typeof cellValue === 'number' && cellValue % 1 !== 0) {\n            cellValue = cellValue.toFixed(2);\n          }\n        }\n        td.textContent = cellValue;\n        tr.appendChild(td);\n      });\n      tbody.appendChild(tr);\n    });\n    table.appendChild(tbody);\n    tableContainer.appendChild(table);\n\n    // Update pagination info\n    updatePaginationInfo('Raw Data');\n\n    // Set up drag and drop\n    setupRawDataDragAndDrop(rawDataToUse);\n  } catch (error) {\n    console.error('Error rendering raw data table:', error);\n    const tableContainer = document.getElementById('myTable');\n    tableContainer.innerHTML = `<div style=\"color: red; padding: 20px;\">Error rendering raw data table: ${error.message}</div>`;\n  }\n}\nfunction updateRawDataPagination(rawData) {\n  // Get pageSize from the select element, with fallback\n  const pageSizeElement = document.getElementById('pageSize');\n  const pageSize = pageSizeElement ? Number(pageSizeElement.value) : 10;\n  const totalPages = Math.ceil(rawData.length / pageSize) || 1;\n  console.log('updateRawDataPagination - Total raw data items:', rawData.length);\n  console.log('updateRawDataPagination - Page size:', pageSize);\n  console.log('updateRawDataPagination - Total pages:', totalPages);\n\n  // FIXED: Only reset to first page when explicitly needed, not on every call\n  // Check if current page is valid for new pagination\n  if (paginationState.currentPage > totalPages) {\n    paginationState.currentPage = Math.max(1, totalPages);\n  }\n  paginationState.pageSize = pageSize;\n  paginationState.totalPages = totalPages;\n  console.log('Updated pagination state for raw data:', paginationState);\n}\n\n// Add this new function to ensure data consistency:\nfunction ensureDataConsistency() {\n  const state = pivotEngine.getState();\n  console.log('Checking data consistency:');\n  console.log('- sampleData length:', sampleData.length);\n  console.log('- filteredData length:', filteredData.length);\n  console.log('- state.data length:', state.data.length);\n  console.log('- state.rawData length:', state.rawData.length);\n\n  // FIXED: Only reinitialize if there's a significant data loss\n  const hasSignificantInconsistency = Math.abs(state.rawData.length - filteredData.length) > 50;\n  if (hasSignificantInconsistency) {\n    console.log('Significant data inconsistency detected, preserving custom orders during reinit...');\n\n    // FIXED: Preserve both row and column custom orders\n    const customColumnOrder = pivotEngine.getOrderedColumnValues && pivotEngine.getOrderedColumnValues();\n    const customRowOrder = pivotEngine.getOrderedRowValues && pivotEngine.getOrderedRowValues();\n    const preservedColumnOrder = customColumnOrder || window.swappedColumnOrder;\n    const preservedRowOrder = customRowOrder || window.swappedRowOrder;\n    console.log('Preserving column order:', preservedColumnOrder);\n    console.log('Preserving row order:', preservedRowOrder);\n\n    // Reinitialize the engine with full data\n    pivotEngine = new PivotEngine({\n      ...config,\n      data: filteredData\n    });\n\n    // FIXED: Restore custom orders using the core engine methods\n    if (preservedColumnOrder && preservedColumnOrder.length > 0) {\n      console.log('Restoring preserved column order:', preservedColumnOrder);\n      const columnFieldName = pivotEngine.getColumnFieldName();\n      pivotEngine.setCustomFieldOrder(columnFieldName, preservedColumnOrder, false);\n      window.swappedColumnOrder = preservedColumnOrder;\n    }\n    if (preservedRowOrder && preservedRowOrder.length > 0) {\n      console.log('Restoring preserved row order:', preservedRowOrder);\n      const rowFieldName = pivotEngine.getRowFieldName();\n      pivotEngine.setCustomFieldOrder(rowFieldName, preservedRowOrder, true);\n      window.swappedRowOrder = preservedRowOrder;\n    }\n  } else {\n    console.log('Data consistency acceptable, no reinit needed');\n  }\n}\n\n// function getOrderedRegions(state) {\n//   // First try to get custom region order from the pivot engine\n//   if (pivotEngine.getCustomRegionOrder) {\n//     const customOrder = pivotEngine.getCustomRegionOrder();\n//     if (customOrder && customOrder.length > 0) {\n//       console.log('Using custom region order from engine:', customOrder);\n//       return customOrder;\n//     }\n//   }\n\n//   // Check if the state has custom region order\n//   if (state.customRegionOrder && state.customRegionOrder.length > 0) {\n//     console.log(\n//       'Using custom region order from state:',\n//       state.customRegionOrder\n//     );\n//     return state.customRegionOrder;\n//   }\n\n//   // Fall back to swapped region order if available\n//   if (window.swappedRegionOrder && window.swappedRegionOrder.length > 0) {\n//     console.log('Using swapped region order:', window.swappedRegionOrder);\n//     return window.swappedRegionOrder;\n//   }\n\n//   const uniqueRegions = [...new Set(state.rawData.map(item => item.region))];\n//   console.log('Using natural region order:', uniqueRegions);\n//   return uniqueRegions;\n// }\n\n// Add drag and drop functionality for raw data:\n// FIXED: Add the getOrderedCategories function (similar to getOrderedRegions)\n// function getOrderedCategories(state) {\n//   // First try to get custom category order from the pivot engine\n//   if (pivotEngine.getCustomRegionOrder) {\n//     const customOrder = pivotEngine.getCustomRegionOrder();\n//     if (customOrder && customOrder.length > 0) {\n//       console.log('Using custom category order from engine:', customOrder);\n//       return customOrder;\n//     }\n//   }\n\n//   // Check if the state has custom category order\n//   if ((state).customRegionOrder && (state).customRegionOrder.length > 0) {\n//     console.log('Using custom category order from state:', (state).customRegionOrder);\n//     return (state).customRegionOrder;\n//   }\n\n//   // Fall back to swapped category order if available\n//   if (window.swappedRegionOrder && window.swappedRegionOrder.length > 0) {\n//     console.log('Using swapped category order:', window.swappedRegionOrder);\n//     return window.swappedRegionOrder;\n//   }\n\n//   const uniqueCategories = [...new Set(state.rawData.map(item => item.category).filter(category => category))];\n//   console.log('Using natural category order:', uniqueCategories);\n//   return uniqueCategories;\n// }\n\n// Generic function to get ordered column values (replaces getOrderedCategories)\nfunction getOrderedColumnValues(state) {\n  const columnFieldName = pivotEngine.getColumnFieldName();\n  if (!columnFieldName) {\n    console.warn('No column field configured');\n    return [];\n  }\n\n  // Check for custom order from engine\n  const customOrder = pivotEngine.getOrderedColumnValues && pivotEngine.getOrderedColumnValues();\n  if (customOrder && customOrder.length > 0) {\n    console.log(`Using custom ${columnFieldName} order from engine:`, customOrder);\n    return customOrder;\n  }\n\n  // Check engine state for custom order\n  if (state.customColumnOrder && state.customColumnOrder.fieldName === columnFieldName) {\n    console.log(`Using custom ${columnFieldName} order from state:`, state.customColumnOrder.order);\n    return state.customColumnOrder.order;\n  }\n\n  // Check window storage\n  if (window.swappedColumnOrder && window.swappedColumnOrder.length > 0) {\n    console.log(`Using swapped ${columnFieldName} order:`, window.swappedColumnOrder);\n    return window.swappedColumnOrder;\n  }\n\n  // Use natural order\n  const uniqueValues = pivotEngine.getUniqueFieldValues(columnFieldName);\n  console.log(`Using natural ${columnFieldName} order:`, uniqueValues);\n  return uniqueValues;\n}\n\n// Generic function to get ordered row values\nfunction getOrderedRowValues(state) {\n  // Get the row field name from configuration\n  const rowFieldName = pivotEngine.getRowFieldName();\n  if (!rowFieldName) {\n    console.warn('No row field configured');\n    return [];\n  }\n\n  // First try to get custom row order from the pivot engine\n  const customOrder = pivotEngine.getOrderedRowValues();\n  if (customOrder && customOrder.length > 0) {\n    console.log(`Using custom ${rowFieldName} order from engine:`, customOrder);\n    return customOrder;\n  }\n\n  // Fall back to swapped order if available\n  if (window.swappedRowOrder && window.swappedRowOrder.length > 0) {\n    console.log(`Using swapped ${rowFieldName} order:`, window.swappedRowOrder);\n    return window.swappedRowOrder;\n  }\n\n  // Use natural order from data\n  const uniqueValues = pivotEngine.getUniqueFieldValues(rowFieldName);\n  console.log(`Using natural ${rowFieldName} order:`, uniqueValues);\n  return uniqueValues;\n}\nfunction setupRawDataDragAndDrop(rawData) {\n  console.log('Setting up raw data drag and drop with', rawData.length, 'items');\n\n  // Column drag and drop for raw data\n  const headers = document.querySelectorAll('.raw-data-header[draggable=\"true\"]');\n  let draggedColumnIndex = null;\n  headers.forEach(header => {\n    const columnIndex = parseInt(header.dataset.columnIndex);\n    const columnName = header.dataset.columnName;\n    header.addEventListener('dragstart', e => {\n      draggedColumnIndex = columnIndex;\n      e.dataTransfer.setData('text/plain', columnName);\n      setTimeout(() => header.classList.add('dragging'), 0);\n      console.log('Raw data column drag started:', columnName, 'Index:', columnIndex);\n    });\n    header.addEventListener('dragend', () => {\n      header.classList.remove('dragging');\n      draggedColumnIndex = null;\n    });\n    header.addEventListener('dragover', e => {\n      e.preventDefault();\n    });\n    header.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedColumnIndex !== null && draggedColumnIndex !== columnIndex) {\n        header.classList.add('drag-over');\n      }\n    });\n    header.addEventListener('dragleave', () => {\n      header.classList.remove('drag-over');\n    });\n    header.addEventListener('drop', e => {\n      e.preventDefault();\n      header.classList.remove('drag-over');\n      const targetColumnIndex = columnIndex;\n      if (draggedColumnIndex !== null && draggedColumnIndex !== targetColumnIndex) {\n        console.log(`Swapping raw data columns ${draggedColumnIndex} with ${targetColumnIndex}`);\n        swapRawDataColumns(draggedColumnIndex, targetColumnIndex);\n        renderRawDataTable();\n      }\n    });\n  });\n\n  // Row drag and drop for raw data\n  const rows = document.querySelectorAll('.raw-data-row[draggable=\"true\"]');\n  let draggedRowIndex = null;\n  rows.forEach(row => {\n    const rowIndex = parseInt(row.dataset.rowIndex);\n    const globalIndex = parseInt(row.dataset.globalIndex);\n    row.addEventListener('dragstart', e => {\n      draggedRowIndex = globalIndex;\n      e.dataTransfer.setData('text/plain', rowIndex.toString());\n      setTimeout(() => row.classList.add('dragging'), 0);\n      console.log('Raw data row drag started. Global index:', globalIndex);\n    });\n    row.addEventListener('dragend', () => {\n      row.classList.remove('dragging');\n      draggedRowIndex = null;\n    });\n    row.addEventListener('dragover', e => {\n      e.preventDefault();\n    });\n    row.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedRowIndex !== null && draggedRowIndex !== globalIndex) {\n        row.classList.add('drag-over');\n      }\n    });\n    row.addEventListener('dragleave', () => {\n      row.classList.remove('drag-over');\n    });\n    row.addEventListener('drop', e => {\n      e.preventDefault();\n      row.classList.remove('drag-over');\n      const targetRowIndex = globalIndex;\n      if (draggedRowIndex !== null && draggedRowIndex !== targetRowIndex) {\n        console.log(`Swapping raw data rows ${draggedRowIndex} with ${targetRowIndex}`);\n        swapRawDataRows(draggedRowIndex, targetRowIndex, rawData);\n        renderRawDataTable();\n      }\n    });\n  });\n}\n\n// Update your renderTable function with data consistency check:\n// function renderTable() {\n\n//   // Check current view mode\n//   if (!showProcessedData || currentViewMode === 'raw') {\n//     renderRawDataTable();\n//     return;\n//   }\n\n//   try {\n//     // CRITICAL: Ensure data consistency before rendering\n//     ensureDataConsistency();\n\n//     const state = pivotEngine.getState();\n//     console.log('Current Engine State:', state);\n\n//     if (!state.processedData) {\n//       console.error('No processed data available');\n//       return;\n//     }\n\n//     const tableContainer = document.getElementById('myTable');\n\n//     // Clear previous content\n//     tableContainer.innerHTML = '';\n\n//     // Create table element\n//     const table = document.createElement('table');\n//     table.style.width = '100%';\n//     table.style.borderCollapse = 'collapse';\n//     table.style.marginTop = '20px';\n//     table.style.border = '1px solid #dee2e6';\n\n//     // Create table header\n//     const thead = document.createElement('thead');\n\n//     // First header row for regions\n//     const regionHeaderRow = document.createElement('tr');\n\n//     // Add empty cell for top-left corner (Product/Region)\n//     const cornerCell = document.createElement('th');\n//     cornerCell.style.padding = '12px';\n//     cornerCell.style.backgroundColor = '#f8f9fa';\n//     cornerCell.style.borderBottom = '2px solid #dee2e6';\n//     cornerCell.style.borderRight = '1px solid #dee2e6';\n//     cornerCell.textContent = 'Product / Region';\n//     regionHeaderRow.appendChild(cornerCell);\n\n//     // Get unique regions from current state data\n//     // const uniqueRegions = [...new Set(state.rawData.map(item => item.region))];\n//     const uniqueRegions = getOrderedRegions(state);\n\n//     // Add region headers with colspan for measures\n//     uniqueRegions.forEach((region, index) => {\n//       const th = document.createElement('th');\n//       th.textContent = region;\n//       th.colSpan = state.measures.length;\n//       th.style.padding = '12px';\n//       th.style.backgroundColor = '#f8f9fa';\n//       th.style.borderBottom = '2px solid #dee2e6';\n//       th.style.borderRight = '1px solid #dee2e6';\n//       th.style.textAlign = 'center';\n//       th.dataset.index = index + 1;\n\n//       // Make headers draggable\n//       th.setAttribute('draggable', 'true');\n//       th.style.cursor = 'move';\n\n//       regionHeaderRow.appendChild(th);\n//     });\n\n//     thead.appendChild(regionHeaderRow);\n\n//     // Second header row for measures\n//     const measureHeaderRow = document.createElement('tr');\n\n//     // Get current sort configuration\n//     const currentSortConfig = state.sortConfig?.[0];\n\n//     // Add product header with sort icon\n//     const productHeader = document.createElement('th');\n//     productHeader.style.padding = '12px';\n//     productHeader.style.backgroundColor = '#f8f9fa';\n//     productHeader.style.borderBottom = '2px solid #dee2e6';\n//     productHeader.style.borderRight = '1px solid #dee2e6';\n//     productHeader.style.cursor = 'pointer';\n\n//     // Create a container for the header content to align text and icon\n//     const productHeaderContent = document.createElement('div');\n//     productHeaderContent.style.display = 'flex';\n//     productHeaderContent.style.alignItems = 'center';\n\n//     const productText = document.createElement('span');\n//     productText.textContent = 'Product';\n//     productHeaderContent.appendChild(productText);\n\n//     // Add sort icon for product\n//     const productSortIcon = createSortIcon('product', currentSortConfig);\n//     productHeaderContent.appendChild(productSortIcon);\n\n//     productHeader.appendChild(productHeaderContent);\n\n//     // Add sort functionality to product header\n//     productHeader.addEventListener('click', () => {\n//       const direction =\n//         currentSortConfig?.field === 'product' &&\n//         currentSortConfig?.direction === 'asc'\n//           ? 'desc'\n//           : 'asc';\n//       pivotEngine.sort('product', direction);\n//       renderTable();\n//     });\n\n//     measureHeaderRow.appendChild(productHeader);\n\n//     // Add measure headers for each region\n//     uniqueRegions.forEach(region => {\n//       state.measures.forEach(measure => {\n//         const th = document.createElement('th');\n//         th.style.padding = '12px';\n//         th.style.backgroundColor = '#f8f9fa';\n//         th.style.borderBottom = '2px solid #dee2e6';\n//         th.style.borderRight = '1px solid #dee2e6';\n//         th.style.cursor = 'pointer';\n\n//         // Create a container for the header content to align text and icon\n//         const headerContent = document.createElement('div');\n//         headerContent.style.display = 'flex';\n//         headerContent.style.alignItems = 'center';\n//         headerContent.style.justifyContent = 'space-between';\n\n//         const measureText = document.createElement('span');\n//         measureText.textContent = measure.caption;\n//         headerContent.appendChild(measureText);\n\n//         // Add sort icon for measure\n//         const sortIcon = createSortIcon(measure.uniqueName, currentSortConfig);\n//         headerContent.appendChild(sortIcon);\n\n//         th.appendChild(headerContent);\n\n//         // Add sort functionality\n//         th.addEventListener('click', () => {\n//           const direction =\n//             currentSortConfig?.field === measure.uniqueName &&\n//             currentSortConfig?.direction === 'asc'\n//               ? 'desc'\n//               : 'asc';\n//           pivotEngine.sort(measure.uniqueName, direction);\n//           renderTable();\n//         });\n\n//         measureHeaderRow.appendChild(th);\n//       });\n//     });\n\n//     thead.appendChild(measureHeaderRow);\n//     table.appendChild(thead);\n\n//     // Create table body\n//     const tbody = document.createElement('tbody');\n\n//     // CRITICAL: Get all unique products in their current order from the engine's data\n//     const allUniqueProducts = [\n//       ...new Set(state.rawData.map(item => item.product)),\n//     ];\n\n//     // Update pagination to ensure it's based on current data\n//     updatePagination(state.rawData, false);\n\n//     // Get paginated products for CURRENT PAGE ONLY\n//     const paginatedProducts = getPaginatedData(\n//       allUniqueProducts,\n//       paginationState\n//     );\n\n//     console.log('All unique products:', allUniqueProducts);\n//     console.log('Products for current page:', paginatedProducts);\n//     console.log('Current pagination state:', paginationState);\n\n//     // Add rows for ONLY the paginated products\n//     paginatedProducts.forEach((product, rowIndex) => {\n//       const tr = document.createElement('tr');\n//       tr.dataset.rowIndex = rowIndex; // This is the row index within the current page\n//       tr.dataset.product = product; // Store the product name\n//       tr.dataset.globalIndex = allUniqueProducts.indexOf(product); // Store global index\n//       tr.setAttribute('draggable', 'true');\n//       tr.style.cursor = 'move';\n\n//       // Add product cell\n//       const productCell = document.createElement('td');\n//       productCell.textContent = product;\n//       productCell.style.fontWeight = 'bold';\n//       productCell.style.padding = '8px';\n//       productCell.style.borderBottom = '1px solid #dee2e6';\n//       productCell.style.borderRight = '1px solid #dee2e6';\n//       productCell.className = 'product-cell'; // Add class for easy identification\n//       tr.appendChild(productCell);\n\n//       // Add data cells for each region and measure\n//       uniqueRegions.forEach(region => {\n//         // Filter data from state.rawData for this product and region\n//         const filteredDataForProduct = state.rawData.filter(\n//           item => item.product === product && item.region === region\n//         );\n\n//         // Add cells for each measure\n//         state.measures.forEach(measure => {\n//           const td = document.createElement('td');\n//           td.style.padding = '8px';\n//           td.style.borderBottom = '1px solid #dee2e6';\n//           td.style.borderRight = '1px solid #dee2e6';\n//           td.style.textAlign = 'right';\n\n//           // Calculate the value based on aggregation\n//           let value = 0;\n//           if (filteredDataForProduct.length > 0) {\n//             switch (measure.aggregation) {\n//               case 'sum':\n//                 value = filteredDataForProduct.reduce(\n//                   (sum, item) => sum + (item[measure.uniqueName] || 0),\n//                   0\n//                 );\n//                 break;\n//               case 'avg':\n//                 if (measure.formula) {\n//                   value =\n//                     filteredDataForProduct.reduce(\n//                       (sum, item) => sum + measure.formula(item),\n//                       0\n//                     ) / filteredDataForProduct.length;\n//                 } else {\n//                   value =\n//                     filteredDataForProduct.reduce(\n//                       (sum, item) => sum + (item[measure.uniqueName] || 0),\n//                       0\n//                     ) / filteredDataForProduct.length;\n//                 }\n//                 break;\n//               case 'max':\n//                 value = Math.max(\n//                   ...filteredDataForProduct.map(\n//                     item => item[measure.uniqueName] || 0\n//                   )\n//                 );\n//                 break;\n//               case 'min':\n//                 value = Math.min(\n//                   ...filteredDataForProduct.map(\n//                     item => item[measure.uniqueName] || 0\n//                   )\n//                 );\n//                 break;\n//               default:\n//                 value = 0;\n//             }\n//           }\n\n//           // Format the value\n//           let formattedValue = value;\n//           if (measure.format) {\n//             if (measure.format.type === 'currency') {\n//               formattedValue = new Intl.NumberFormat(measure.format.locale, {\n//                 style: 'currency',\n//                 currency: measure.format.currency,\n//                 minimumFractionDigits: measure.format.decimals,\n//                 maximumFractionDigits: measure.format.decimals,\n//               }).format(value);\n//             } else if (measure.format.type === 'number') {\n//               formattedValue = new Intl.NumberFormat(measure.format.locale, {\n//                 minimumFractionDigits: measure.format.decimals,\n//                 maximumFractionDigits: measure.format.decimals,\n//               }).format(value);\n//             }\n//           }\n\n//           // td.textContent = formattedValue;\n//           // addDrillDownToDataCell(td, product, region, measure, value, formattedValue);\n//           let cellValue = addDrillDownToDataCell(td, product, region, measure, value, formattedValue);\n//           console.log('Cell value :', cellValue);\n\n//           // Apply conditional formatting\n//           if (\n//             config.conditionalFormatting &&\n//             Array.isArray(config.conditionalFormatting)\n//           ) {\n//             config.conditionalFormatting.forEach(rule => {\n//               if (rule.value.type === 'Number' && !isNaN(value)) {\n//                 let applyFormat = false;\n\n//                 switch (rule.value.operator) {\n//                   case 'Greater than':\n//                     applyFormat = value > parseFloat(rule.value.value1);\n//                     break;\n//                   case 'Less than':\n//                     applyFormat = value < parseFloat(rule.value.value1);\n//                     break;\n//                   case 'Equal to':\n//                     applyFormat = value === parseFloat(rule.value.value1);\n//                     break;\n//                   case 'Between':\n//                     applyFormat =\n//                       value >= parseFloat(rule.value.value1) &&\n//                       value <= parseFloat(rule.value.value2);\n//                     break;\n//                 }\n\n//                 if (applyFormat) {\n//                   if (rule.format.font) td.style.fontFamily = rule.format.font;\n//                   if (rule.format.size) td.style.fontSize = rule.format.size;\n//                   if (rule.format.color) td.style.color = rule.format.color;\n//                   if (rule.format.backgroundColor)\n//                     td.style.backgroundColor = rule.format.backgroundColor;\n//                 }\n//               }\n//             });\n//           }\n\n//           tr.appendChild(td);\n//         });\n//       });\n\n//       tbody.appendChild(tr);\n//     });\n\n//     table.appendChild(tbody);\n//     tableContainer.appendChild(table);\n\n//     // Update pagination info\n//     const pageInfo = document.getElementById('pageInfo');\n//     if (pageInfo) {\n//       pageInfo.textContent = `Page ${paginationState.currentPage} of ${paginationState.totalPages}`;\n\n//       // Update button states\n//       const prevButton = document.getElementById('prevPage');\n//       const nextButton = document.getElementById('nextPage');\n//       if (prevButton) prevButton.disabled = paginationState.currentPage <= 1;\n//       if (nextButton)\n//         nextButton.disabled =\n//           paginationState.currentPage >= paginationState.totalPages;\n//     }\n\n//     // Set up drag and drop after rendering\n//     setupDragAndDrop();\n//   } catch (error) {\n//     console.error('Error rendering table:', error);\n\n//     // Display error message to user\n//     const tableContainer = document.getElementById('myTable');\n//     tableContainer.innerHTML = `<div style=\"color: red; padding: 20px;\">Error rendering table: ${error.message}</div>`;\n//   }\n// }\n\n// Generic renderTable function that works with any field names\nfunction renderTable() {\n  // Check current view mode\n  if (!showProcessedData || currentViewMode === 'raw') {\n    console.log('Rendering raw data view');\n    renderRawDataTable();\n    return;\n  }\n  try {\n    // CRITICAL: Ensure data consistency before rendering\n    ensureDataConsistency();\n    const state = pivotEngine.getState();\n    console.log('Current Engine State:', state);\n    if (!state.processedData) {\n      console.error('No processed data available');\n      return;\n    }\n\n    // Get field names from configuration\n    const rowFieldName = pivotEngine.getRowFieldName();\n    const columnFieldName = pivotEngine.getColumnFieldName();\n    if (!rowFieldName || !columnFieldName) {\n      console.error('Row or column field not configured');\n      return;\n    }\n    console.log(`Rendering table with row field: ${rowFieldName}, column field: ${columnFieldName}`);\n    const tableContainer = document.getElementById('myTable');\n\n    // Clear previous content\n    tableContainer.innerHTML = '';\n\n    // Create table element\n    const table = document.createElement('table');\n    table.style.width = '100%';\n    table.style.borderCollapse = 'collapse';\n    table.style.marginTop = '20px';\n    table.style.border = '1px solid #dee2e6';\n\n    // Create table header\n    const thead = document.createElement('thead');\n\n    // First header row for column values\n    const columnHeaderRow = document.createElement('tr');\n\n    // Add empty cell for top-left corner\n    const cornerCell = document.createElement('th');\n    cornerCell.style.padding = '12px';\n    cornerCell.style.backgroundColor = '#f8f9fa';\n    cornerCell.style.borderBottom = '2px solid #dee2e6';\n    cornerCell.style.borderRight = '1px solid #dee2e6';\n    cornerCell.textContent = `${getFieldDisplayName(rowFieldName)} / ${getFieldDisplayName(columnFieldName)}`;\n    columnHeaderRow.appendChild(cornerCell);\n\n    // Get unique column values\n    const uniqueColumnValues = getOrderedColumnValues(state);\n    console.log('Setting up column headers for values:', uniqueColumnValues);\n\n    // Add column headers with colspan for measures\n    uniqueColumnValues.forEach((columnValue, index) => {\n      const th = document.createElement('th');\n      th.textContent = columnValue;\n      th.colSpan = state.measures.length;\n      th.style.padding = '12px';\n      th.style.backgroundColor = '#f8f9fa';\n      th.style.borderBottom = '2px solid #dee2e6';\n      th.style.borderRight = '1px solid #dee2e6';\n      th.style.textAlign = 'center';\n      th.dataset.index = index + 1;\n      th.dataset.fieldName = columnFieldName;\n      th.dataset.fieldValue = columnValue;\n      th.dataset.columnIndex = index;\n\n      // Make headers draggable\n      th.setAttribute('draggable', 'true');\n      th.style.cursor = 'move';\n      th.className = 'column-header';\n      console.log(`Created column header: ${columnValue}, index: ${index}, fieldName: ${columnFieldName}`);\n      columnHeaderRow.appendChild(th);\n    });\n    thead.appendChild(columnHeaderRow);\n\n    // Second header row for measures\n    const measureHeaderRow = document.createElement('tr');\n\n    // Get current sort configuration\n    const currentSortConfig = state.sortConfig?.[0];\n\n    // Add row field header with sort icon\n    const rowHeader = document.createElement('th');\n    rowHeader.style.padding = '12px';\n    rowHeader.style.backgroundColor = '#f8f9fa';\n    rowHeader.style.borderBottom = '2px solid #dee2e6';\n    rowHeader.style.borderRight = '1px solid #dee2e6';\n    rowHeader.style.cursor = 'pointer';\n\n    // Create a container for the header content to align text and icon\n    const rowHeaderContent = document.createElement('div');\n    rowHeaderContent.style.display = 'flex';\n    rowHeaderContent.style.alignItems = 'center';\n    const rowText = document.createElement('span');\n    rowText.textContent = getFieldDisplayName(rowFieldName);\n    rowHeaderContent.appendChild(rowText);\n\n    // Add sort icon for row field\n    const rowSortIcon = createSortIcon(rowFieldName, currentSortConfig);\n    rowHeaderContent.appendChild(rowSortIcon);\n    rowHeader.appendChild(rowHeaderContent);\n\n    // Add sort functionality to row header\n    rowHeader.addEventListener('click', () => {\n      const direction = currentSortConfig?.field === rowFieldName && currentSortConfig?.direction === 'asc' ? 'desc' : 'asc';\n      pivotEngine.sort(rowFieldName, direction);\n      renderTable();\n    });\n    measureHeaderRow.appendChild(rowHeader);\n\n    // Add measure headers for each column value\n    uniqueColumnValues.forEach(columnValue => {\n      state.measures.forEach(measure => {\n        const th = document.createElement('th');\n        th.style.padding = '12px';\n        th.style.backgroundColor = '#f8f9fa';\n        th.style.borderBottom = '2px solid #dee2e6';\n        th.style.borderRight = '1px solid #dee2e6';\n        th.style.cursor = 'pointer';\n\n        // Create a container for the header content to align text and icon\n        const headerContent = document.createElement('div');\n        headerContent.style.display = 'flex';\n        headerContent.style.alignItems = 'center';\n        headerContent.style.justifyContent = 'space-between';\n        const measureText = document.createElement('span');\n        measureText.textContent = measure.caption;\n        headerContent.appendChild(measureText);\n\n        // Add sort icon for measure\n        const sortIcon = createSortIcon(measure.uniqueName, currentSortConfig);\n        headerContent.appendChild(sortIcon);\n        th.appendChild(headerContent);\n\n        // Add sort functionality\n        th.addEventListener('click', () => {\n          const direction = currentSortConfig?.field === measure.uniqueName && currentSortConfig?.direction === 'asc' ? 'desc' : 'asc';\n          pivotEngine.sort(measure.uniqueName, direction);\n          renderTable();\n        });\n        measureHeaderRow.appendChild(th);\n      });\n    });\n    thead.appendChild(measureHeaderRow);\n    table.appendChild(thead);\n\n    // Create table body\n    const tbody = document.createElement('tbody');\n\n    // Get all unique row values in their current order\n    const allUniqueRowValues = getOrderedRowValues(state);\n    console.log(`All unique ${rowFieldName} values:`, allUniqueRowValues);\n\n    // Update pagination to ensure it's based on current data\n    updatePagination(state.rawData, false);\n\n    // Get paginated row values for CURRENT PAGE ONLY\n    const paginatedRowValues = getPaginatedData(allUniqueRowValues, paginationState);\n    console.log(`${getFieldDisplayName(rowFieldName)} for current page:`, paginatedRowValues);\n    console.log('Current pagination state:', paginationState);\n\n    // Add rows for ONLY the paginated row values\n    paginatedRowValues.forEach((rowValue, rowIndex) => {\n      const tr = document.createElement('tr');\n      tr.dataset.rowIndex = rowIndex;\n      tr.dataset.fieldName = rowFieldName;\n      tr.dataset.fieldValue = rowValue;\n      tr.dataset.globalIndex = allUniqueRowValues.indexOf(rowValue);\n      tr.setAttribute('draggable', 'true');\n      tr.style.cursor = 'move';\n\n      // Add row value cell\n      const rowCell = document.createElement('td');\n      rowCell.textContent = rowValue;\n      rowCell.style.fontWeight = 'bold';\n      rowCell.style.padding = '8px';\n      rowCell.style.borderBottom = '1px solid #dee2e6';\n      rowCell.style.borderRight = '1px solid #dee2e6';\n      rowCell.className = 'row-cell';\n      tr.appendChild(rowCell);\n\n      // Add data cells for each column value and measure\n      uniqueColumnValues.forEach(columnValue => {\n        // Filter data for this row value and column value\n        const filteredDataForCell = state.rawData.filter(item => item[rowFieldName] === rowValue && item[columnFieldName] === columnValue);\n\n        // Add cells for each measure\n        state.measures.forEach(measure => {\n          const td = document.createElement('td');\n          td.style.padding = '8px';\n          td.style.borderBottom = '1px solid #dee2e6';\n          td.style.borderRight = '1px solid #dee2e6';\n          td.style.textAlign = 'right';\n\n          // Calculate the value based on aggregation\n          let value = 0;\n          if (filteredDataForCell.length > 0) {\n            switch (measure.aggregation) {\n              case 'sum':\n                value = filteredDataForCell.reduce((sum, item) => sum + (item[measure.uniqueName] || 0), 0);\n                break;\n              case 'avg':\n                if (measure.formula) {\n                  value = filteredDataForCell.reduce((sum, item) => sum + measure.formula(item), 0) / filteredDataForCell.length;\n                } else {\n                  value = filteredDataForCell.reduce((sum, item) => sum + (item[measure.uniqueName] || 0), 0) / filteredDataForCell.length;\n                }\n                break;\n              case 'max':\n                value = Math.max(...filteredDataForCell.map(item => item[measure.uniqueName] || 0));\n                break;\n              case 'min':\n                value = Math.min(...filteredDataForCell.map(item => item[measure.uniqueName] || 0));\n                break;\n              default:\n                value = 0;\n            }\n          }\n\n          // Format the value\n          let formattedValue = value;\n          if (measure.format) {\n            if (measure.format.type === 'currency') {\n              formattedValue = new Intl.NumberFormat(measure.format.locale, {\n                style: 'currency',\n                currency: measure.format.currency,\n                minimumFractionDigits: measure.format.decimals,\n                maximumFractionDigits: measure.format.decimals\n              }).format(value);\n            } else if (measure.format.type === 'number') {\n              formattedValue = new Intl.NumberFormat(measure.format.locale, {\n                minimumFractionDigits: measure.format.decimals,\n                maximumFractionDigits: measure.format.decimals\n              }).format(value);\n            }\n          }\n\n          // Add drill-down functionality with generic parameters\n          addDrillDownToDataCell(td, rowValue, columnValue, measure, value, formattedValue, rowFieldName, columnFieldName);\n\n          // Apply conditional formatting\n          if (config.conditionalFormatting && Array.isArray(config.conditionalFormatting)) {\n            config.conditionalFormatting.forEach(rule => {\n              if (rule.value.type === 'Number' && !isNaN(value)) {\n                let applyFormat = false;\n                switch (rule.value.operator) {\n                  case 'Greater than':\n                    applyFormat = value > parseFloat(rule.value.value1);\n                    break;\n                  case 'Less than':\n                    applyFormat = value < parseFloat(rule.value.value1);\n                    break;\n                  case 'Equal to':\n                    applyFormat = value === parseFloat(rule.value.value1);\n                    break;\n                  case 'Between':\n                    applyFormat = value >= parseFloat(rule.value.value1) && value <= parseFloat(rule.value.value2);\n                    break;\n                }\n                if (applyFormat) {\n                  if (rule.format.font) td.style.fontFamily = rule.format.font;\n                  if (rule.format.size) td.style.fontSize = rule.format.size;\n                  if (rule.format.color) td.style.color = rule.format.color;\n                  if (rule.format.backgroundColor) td.style.backgroundColor = rule.format.backgroundColor;\n                }\n              }\n            });\n          }\n          tr.appendChild(td);\n        });\n      });\n      tbody.appendChild(tr);\n    });\n    table.appendChild(tbody);\n    tableContainer.appendChild(table);\n\n    // Update pagination info\n    const pageInfo = document.getElementById('pageInfo');\n    if (pageInfo) {\n      pageInfo.textContent = `Page ${paginationState.currentPage} of ${paginationState.totalPages}`;\n\n      // Update button states\n      const prevButton = document.getElementById('prevPage');\n      const nextButton = document.getElementById('nextPage');\n      if (prevButton) prevButton.disabled = paginationState.currentPage <= 1;\n      if (nextButton) nextButton.disabled = paginationState.currentPage >= paginationState.totalPages;\n    }\n\n    // Set up drag and drop after rendering\n    setupDragAndDrop();\n  } catch (error) {\n    console.error('Error rendering table:', error);\n\n    // Display error message to user\n    const tableContainer = document.getElementById('myTable');\n    tableContainer.innerHTML = `<div style=\"color: red; padding: 20px;\">Error rendering table: ${error.message}</div>`;\n  }\n}\nfunction setupColumnDragAndDropFixed(columnFieldName) {\n  // Select only column headers with proper class\n  const columnHeaders = document.querySelectorAll('.column-header[draggable=\"true\"]');\n  let draggedColumnIndex = null;\n  let draggedColumnValue = null;\n  console.log('Setting up column drag, found column headers:', columnHeaders.length);\n  const state = pivotEngine.getState();\n  const uniqueColumnValues = getOrderedColumnValues(state);\n  console.log(`Current ${columnFieldName} values for drag setup:`, uniqueColumnValues);\n  columnHeaders.forEach((header, headerIdx) => {\n    const fieldName = header.dataset.fieldName;\n    const fieldValue = header.dataset.fieldValue;\n    const columnIndex = parseInt(header.dataset.columnIndex);\n    console.log(`Setting up column header ${headerIdx}: field=${fieldName}, value=${fieldValue}, columnIndex=${columnIndex}`);\n\n    // Validate this is our column field\n    if (fieldName !== columnFieldName || !fieldValue) {\n      console.warn('Skipping header - field mismatch or missing value:', fieldName, fieldValue);\n      return;\n    }\n    header.addEventListener('dragstart', e => {\n      draggedColumnIndex = columnIndex;\n      draggedColumnValue = fieldValue;\n      e.dataTransfer.setData('text/plain', fieldValue);\n      setTimeout(() => header.classList.add('dragging'), 0);\n      console.log(`Column drag started for ${columnFieldName}: ${fieldValue}, Index: ${columnIndex}`);\n    });\n    header.addEventListener('dragend', () => {\n      header.classList.remove('dragging');\n      draggedColumnIndex = null;\n      draggedColumnValue = null;\n      console.log('Column drag ended');\n    });\n    header.addEventListener('dragover', e => {\n      e.preventDefault();\n    });\n    header.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedColumnValue && draggedColumnValue !== fieldValue) {\n        header.classList.add('drag-over');\n      }\n    });\n    header.addEventListener('dragleave', () => {\n      header.classList.remove('drag-over');\n    });\n    header.addEventListener('drop', e => {\n      e.preventDefault();\n      header.classList.remove('drag-over');\n      const targetColumnValue = fieldValue;\n      const targetColumnIndex = parseInt(header.dataset.columnIndex);\n      if (draggedColumnValue && targetColumnValue && draggedColumnValue !== targetColumnValue) {\n        console.log(`Swapping ${columnFieldName}: ${draggedColumnValue} (index: ${draggedColumnIndex}) with ${targetColumnValue} (index: ${targetColumnIndex})`);\n        try {\n          // Try core engine method first\n          pivotEngine.swapDataColumns(draggedColumnIndex, targetColumnIndex);\n          console.log('Core column swap completed');\n\n          // FIXED: Immediately store the new order to prevent loss\n          const newOrder = pivotEngine.getOrderedColumnValues();\n          if (newOrder) {\n            window.swappedColumnOrder = newOrder;\n            console.log('Stored new column order:', newOrder);\n          }\n          renderTable();\n        } catch (error) {\n          console.error('Core column swap failed:', error);\n          // Fallback to manual swap\n          console.log('Falling back to manual column swap');\n          manualColumnSwap(draggedColumnIndex, targetColumnIndex, columnFieldName, uniqueColumnValues);\n          renderTable();\n        }\n      } else {\n        console.log('Invalid column swap - same values or missing data');\n      }\n    });\n  });\n}\nfunction setupRowDragAndDrop(rowFieldName) {\n  const rows = document.querySelectorAll('tbody tr[draggable=\"true\"]');\n  let draggedRowIndex = null;\n  let draggedRowValue = null;\n  console.log('Setting up row drag, found rows:', rows.length);\n  rows.forEach((row, rowIdx) => {\n    const fieldName = row.dataset.fieldName;\n    const fieldValue = row.dataset.fieldValue;\n    const globalIndex = parseInt(row.dataset.globalIndex);\n    console.log(`Setting up row ${rowIdx}: field=${fieldName}, value=${fieldValue}, globalIndex=${globalIndex}`);\n\n    // Validate this is our row field\n    if (fieldName !== rowFieldName || !fieldValue) {\n      console.warn('Skipping row - field mismatch or missing value:', fieldName, fieldValue);\n      return;\n    }\n    row.addEventListener('dragstart', e => {\n      draggedRowValue = fieldValue;\n      draggedRowIndex = globalIndex;\n      e.dataTransfer.setData('text/plain', fieldValue);\n      setTimeout(() => row.classList.add('dragging'), 0);\n      console.log(`Row drag started for ${rowFieldName}: ${fieldValue}, Global index: ${globalIndex}`);\n    });\n    row.addEventListener('dragend', () => {\n      row.classList.remove('dragging');\n      draggedRowValue = null;\n      draggedRowIndex = null;\n    });\n    row.addEventListener('dragover', e => {\n      e.preventDefault();\n    });\n    row.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedRowValue && draggedRowValue !== fieldValue) {\n        row.classList.add('drag-over');\n      }\n    });\n    row.addEventListener('dragleave', () => {\n      row.classList.remove('drag-over');\n    });\n    row.addEventListener('drop', e => {\n      e.preventDefault();\n      row.classList.remove('drag-over');\n      const targetRowValue = fieldValue;\n      const targetRowIndex = globalIndex;\n      if (draggedRowValue && targetRowValue && draggedRowValue !== targetRowValue) {\n        console.log(`Swapping ${rowFieldName}: ${draggedRowValue} (global: ${draggedRowIndex}) with ${targetRowValue} (global: ${targetRowIndex})`);\n        try {\n          // Try core engine method first\n          pivotEngine.swapDataRows(draggedRowIndex, targetRowIndex);\n          console.log('Core row swap completed');\n          renderTable();\n        } catch (error) {\n          console.error('Core row swap failed:', error);\n          // Fallback to manual swap\n          console.log('Falling back to manual row swap');\n          manualRowSwap(draggedRowIndex, targetRowIndex, rowFieldName);\n          renderTable();\n        }\n      }\n    });\n  });\n}\n\n// FIXED: Manual column swap function\nfunction manualColumnSwap(fromIndex, toIndex, columnFieldName, uniqueColumnValues) {\n  console.log(`Manual column swap: ${columnFieldName} from ${fromIndex} to ${toIndex}`);\n  console.log('Available column values:', uniqueColumnValues);\n  if (fromIndex < 0 || toIndex < 0 || fromIndex >= uniqueColumnValues.length || toIndex >= uniqueColumnValues.length) {\n    console.error('Invalid column indices:', fromIndex, toIndex, 'Available:', uniqueColumnValues.length);\n    return;\n  }\n\n  // Create swapped order\n  const swappedValues = [...uniqueColumnValues];\n  const temp = swappedValues[fromIndex];\n  swappedValues[fromIndex] = swappedValues[toIndex];\n  swappedValues[toIndex] = temp;\n  console.log('New column order:', swappedValues);\n\n  // FIXED: Store in multiple locations to ensure persistence\n  window.swappedColumnOrder = swappedValues;\n\n  // Store in engine state using the core method\n  if (pivotEngine.setCustomFieldOrder) {\n    pivotEngine.setCustomFieldOrder(columnFieldName, swappedValues, false);\n  }\n\n  // Also store directly in state as backup\n  if (pivotEngine.state) {\n    pivotEngine.state.customColumnOrder = {\n      fieldName: columnFieldName,\n      order: swappedValues\n    };\n  }\n  console.log('Manual column swap completed and stored');\n}\n\n// FIXED: Manual row swap function\nfunction manualRowSwap(fromIndex, toIndex, rowFieldName) {\n  const state = pivotEngine.getState();\n  const uniqueRowValues = pivotEngine.getUniqueFieldValues(rowFieldName);\n  console.log(`Manual row swap: ${rowFieldName} from ${fromIndex} to ${toIndex}`);\n  console.log('Available row values:', uniqueRowValues);\n  if (fromIndex < 0 || toIndex < 0 || fromIndex >= uniqueRowValues.length || toIndex >= uniqueRowValues.length) {\n    console.error('Invalid row indices:', fromIndex, toIndex, 'Available:', uniqueRowValues.length);\n    return;\n  }\n\n  // Get the values to swap\n  const fromValue = uniqueRowValues[fromIndex];\n  const toValue = uniqueRowValues[toIndex];\n\n  // Create swapped order\n  const swappedValues = [...uniqueRowValues];\n  swappedValues[fromIndex] = toValue;\n  swappedValues[toIndex] = fromValue;\n  console.log('New row order:', swappedValues);\n\n  // Reorder the actual data\n  const dataToUse = state.data || state.rawData || filteredData;\n  const newData = [...dataToUse];\n  newData.sort((a, b) => {\n    const aIndex = swappedValues.indexOf(a[rowFieldName]);\n    const bIndex = swappedValues.indexOf(b[rowFieldName]);\n    return aIndex - bIndex;\n  });\n\n  // Update filteredData\n  if (filteredData) {\n    filteredData.sort((a, b) => {\n      const aIndex = swappedValues.indexOf(a[rowFieldName]);\n      const bIndex = swappedValues.indexOf(b[rowFieldName]);\n      return aIndex - bIndex;\n    });\n  }\n\n  // Create new engine\n  pivotEngine = new PivotEngine({\n    ...config,\n    data: newData\n  });\n  console.log('Manual row swap completed');\n}\nfunction getFieldDisplayName(fieldName) {\n  // Convert field name to display name (capitalize first letter)\n  return fieldName.charAt(0).toUpperCase() + fieldName.slice(1);\n}\n\n// Reset filters\n// Replace your resetFilters function with this:\nfunction resetFilters() {\n  // Reset data to original\n  filteredData = [...sampleData];\n\n  // Create a new PivotEngine instance with the original data\n  pivotEngine = new PivotEngine({\n    ...config,\n    data: sampleData // Use original sample data\n  });\n\n  // Subscribe again to state changes\n  pivotEngine.subscribe(state => {\n    renderTable();\n  });\n\n  // Update pagination\n  updatePagination(sampleData, true);\n\n  // Reset filter inputs\n  document.getElementById('filterField').selectedIndex = 0;\n  document.getElementById('filterOperator').selectedIndex = 0;\n  document.getElementById('filterValue').value = '';\n\n  // No need to call renderTable() here\n}\n\n// Update pagination based on data size\nfunction updatePaginationInfo(viewType = null) {\n  const pageInfo = document.getElementById('pageInfo');\n  if (pageInfo) {\n    let viewMode;\n    if (viewType) {\n      viewMode = viewType;\n    } else {\n      viewMode = currentViewMode === 'raw' ? 'Raw Data' : 'Processed Data';\n    }\n    pageInfo.textContent = `${viewMode} - Page ${paginationState.currentPage} of ${paginationState.totalPages}`;\n    const prevButton = document.getElementById('prevPage');\n    const nextButton = document.getElementById('nextPage');\n    if (prevButton) prevButton.disabled = paginationState.currentPage <= 1;\n    if (nextButton) nextButton.disabled = paginationState.currentPage >= paginationState.totalPages;\n  }\n}\n\n// Generic updatePagination function\nfunction updatePagination(data, resetPage = false) {\n  const state = pivotEngine.getState();\n  const rowFieldName = pivotEngine.getRowFieldName();\n  if (!rowFieldName) {\n    console.warn('No row field configured for pagination');\n    return;\n  }\n\n  // Get unique row values\n  const uniqueRowValues = pivotEngine.getUniqueFieldValues(rowFieldName);\n\n  // Get pageSize from the select element, with fallback\n  const pageSizeElement = document.getElementById('pageSize');\n  const pageSize = pageSizeElement ? Number(pageSizeElement.value) : 10;\n  const totalPages = Math.ceil(uniqueRowValues.length / pageSize) || 1;\n  console.log(`updatePagination - Total unique ${rowFieldName}:`, uniqueRowValues.length);\n  console.log('updatePagination - Page size:', pageSize);\n  console.log('updatePagination - Total pages:', totalPages);\n  if (resetPage) {\n    paginationState.currentPage = 1;\n  } else {\n    // Ensure current page doesn't exceed total pages\n    if (paginationState.currentPage > totalPages) {\n      paginationState.currentPage = totalPages;\n    }\n  }\n  paginationState.pageSize = pageSize;\n  paginationState.totalPages = totalPages;\n\n  // Keep the engine in sync\n  pivotEngine.setPagination(paginationState);\n  console.log('Updated pagination state:', paginationState);\n}\nexport function formatTable(config) {\n  pivotEngine = new PivotEngine(config);\n  renderTable();\n}\n\n// Event Listeners\nfunction setupEventListeners() {\n  // FIXED: Enhanced switch view functionality\n  document.getElementById('switchView').addEventListener('click', () => {\n    // Toggle the view mode\n    currentViewMode = currentViewMode === 'processed' ? 'raw' : 'processed';\n    showProcessedData = currentViewMode === 'processed';\n    console.log('Switching to view mode:', currentViewMode);\n\n    // Update button text\n    const switchButton = document.getElementById('switchView');\n    switchButton.textContent = currentViewMode === 'processed' ? 'Switch to Raw Data' : 'Switch to Processed Data';\n\n    // FIXED: Proper pagination reset when switching views\n    if (currentViewMode === 'raw') {\n      const dataToUse = filteredData.length > 0 ? filteredData : sampleData;\n      // Reset to first page when switching to raw data\n      paginationState.currentPage = 1;\n      updateRawDataPagination(dataToUse);\n      console.log('Switched to raw data view with', dataToUse.length, 'total items');\n    } else {\n      // Reset to first page when switching to processed data\n      paginationState.currentPage = 1;\n      updatePagination(filteredData, true);\n      console.log('Switched to processed data view');\n    }\n\n    // Re-render table\n    renderTable();\n  });\n\n  // FIXED: Page size change handler\n  document.getElementById('pageSize').addEventListener('change', e => {\n    const newPageSize = Number(e.target.value);\n\n    // Calculate what page we should be on with the new page size\n    // to keep roughly the same position\n    const currentFirstItem = (paginationState.currentPage - 1) * paginationState.pageSize;\n    const newPage = Math.floor(currentFirstItem / newPageSize) + 1;\n    paginationState.currentPage = newPage;\n    if (currentViewMode === 'raw') {\n      const dataToUse = filteredData.length > 0 ? filteredData : sampleData;\n      updateRawDataPagination(dataToUse);\n    } else {\n      updatePagination(filteredData, false); // Don't reset page, we calculated it above\n      // But ensure we don't exceed total pages\n      if (paginationState.currentPage > paginationState.totalPages) {\n        paginationState.currentPage = paginationState.totalPages;\n      }\n    }\n    console.log('Page size changed to:', newPageSize, 'New page:', paginationState.currentPage);\n    renderTable();\n  });\n\n  // FIXED: Previous page handler\n  document.getElementById('prevPage').addEventListener('click', () => {\n    if (paginationState.currentPage > 1) {\n      paginationState.currentPage--;\n      if (currentViewMode === 'processed') {\n        pivotEngine.setPagination(paginationState);\n      }\n      console.log('Previous page clicked, now on page:', paginationState.currentPage);\n      renderTable();\n    }\n  });\n\n  // FIXED: Next page handler\n  document.getElementById('nextPage').addEventListener('click', () => {\n    if (paginationState.currentPage < paginationState.totalPages) {\n      paginationState.currentPage++;\n      if (currentViewMode === 'processed') {\n        pivotEngine.setPagination(paginationState);\n      }\n      console.log('Next page clicked, now on page:', paginationState.currentPage);\n      renderTable();\n    }\n  });\n\n  // Keep your existing filter event listeners...\n  document.getElementById('applyFilter').addEventListener('click', () => {\n    const field = document.getElementById('filterField').value;\n    const operator = document.getElementById('filterOperator').value;\n    const value = document.getElementById('filterValue').value;\n    if (!value) {\n      alert('Please enter a filter value');\n      return;\n    }\n    const filter = {\n      field,\n      operator,\n      value\n    };\n    filteredData = applyFilter(sampleData, filter);\n    console.log('Filtered data:', filteredData);\n\n    // Reset to first page when applying filter\n    paginationState.currentPage = 1;\n    if (currentViewMode === 'raw') {\n      updateRawDataPagination(filteredData);\n    } else {\n      updatePagination(filteredData, true);\n    }\n    renderTable();\n  });\n  document.getElementById('resetFilter').addEventListener('click', () => {\n    filteredData = [...sampleData];\n    pivotEngine = new PivotEngine({\n      ...config,\n      data: sampleData\n    });\n\n    // Subscribe again to state changes\n    pivotEngine.subscribe(state => {\n      renderTable();\n    });\n\n    // Reset to first page\n    paginationState.currentPage = 1;\n    if (currentViewMode === 'raw') {\n      updateRawDataPagination(sampleData);\n    } else {\n      updatePagination(filteredData, true);\n    }\n    document.getElementById('filterField').selectedIndex = 0;\n    document.getElementById('filterOperator').selectedIndex = 0;\n    document.getElementById('filterValue').value = '';\n\n    // Format controls event listeners - ADD THESE LINES\n    // document.getElementById('formatCellsBtn').addEventListener('click', () => {\n    //   if (cellFormatter.selectedCells.size === 0) {\n    //     alert('Please select cells first by clicking on them while holding Ctrl');\n    //     return;\n    //   }\n    //   cellFormatter.showFormatModal();\n    // });\n\n    // document.getElementById('clearFormatBtn').addEventListener('click', () => {\n    //   if (confirm('Clear all cell formatting?')) {\n    //     document.querySelectorAll('td').forEach(cell => {\n    //       if (cell.dataset.originalValue) {\n    //         cell.textContent = cell.dataset.originalValue;\n    //         delete cell.dataset.originalValue;\n    //       }\n    //       cell.style.cssText = cell.style.cssText.replace(/text-align[^;]*;?/g, '')\n    //                                              .replace(/font-family[^;]*;?/g, '')\n    //                                              .replace(/font-size[^;]*;?/g, '')\n    //                                              .replace(/font-weight[^;]*;?/g, '')\n    //                                              .replace(/font-style[^;]*;?/g, '')\n    //                                              .replace(/color[^;]*;?/g, '')\n    //                                              .replace(/background-color[^;]*;?/g, '');\n    //     });\n    //     cellFormatter.formatHistory.clear();\n    //   }\n    // });\n\n    // No need to call renderTable() here\n  });\n}\n\n// Update the addDraggableStyles function to include styles for sort icons\n// function addDraggableStyles() {\n//   const styleEl = document.createElement('style');\n//   styleEl.innerHTML = `\n//         .dragging {\n//             opacity: 0.5;\n//             background-color: #f0f0f0;\n//         }\n\n//         .drag-over {\n//             border: 2px dashed #666 !important;\n//             background-color: #e9ecef !important;\n//         }\n\n//         th[draggable=\"true\"], tr[draggable=\"true\"] {\n//             cursor: move;\n//         }\n\n//         /* Sort icon styles */\n//         .sort-icon {\n//             margin-left: 5px;\n//             display: inline-block;\n//             transition: transform 0.2s;\n//         }\n\n//         th:hover .sort-icon {\n//             opacity: 1 !important;\n//         }\n\n//         /* Header hover effect */\n//         th[data-sortable=\"true\"]:hover {\n//             background-color: #e9ecef !important;\n//         }\n\n//         .controls-container {\n//             margin-bottom: 20px;\n//             display: flex;\n//             flex-direction: column;\n//             gap: 10px;\n//         }\n\n//         .filter-container, .pagination-container {\n//             display: flex;\n//             gap: 10px;\n//             align-items: center;\n//             flex-wrap: wrap;\n//         }\n\n//         /* Make sure table is responsive */\n//         #myTable {\n//             overflow-x: auto;\n//             width: 100%;\n//         }\n\n//         /* Button styling */\n//         button {\n//             padding: 5px 10px;\n//             background-color: #4CAF50;\n//             color: white;\n//             border: none;\n//             border-radius: 4px;\n//             cursor: pointer;\n//         }\n\n//         button:disabled {\n//             background-color: #cccccc;\n//             cursor: not-allowed;\n//         }\n\n//         /* Select and input styling */\n//         select, input {\n//             padding: 5px;\n//             border-radius: 4px;\n//             border: 1px solid #ddd;\n//         }\n//     `;\n//   document.head.appendChild(styleEl);\n// }\n\nfunction addDraggableStyles() {\n  const styleEl = document.createElement('style');\n  styleEl.innerHTML = `\n        .dragging {\n            opacity: 0.5;\n            background-color: #f0f0f0;\n        }\n        \n        .drag-over {\n            border: 2px dashed #666 !important;\n            background-color: #e9ecef !important;\n        }\n        \n        th[draggable=\"true\"], tr[draggable=\"true\"] {\n            cursor: move;\n        }\n        \n        /* ENHANCED: Column header specific styles */\n        .column-header[draggable=\"true\"] {\n            cursor: move;\n            transition: background-color 0.2s;\n        }\n        \n        .column-header[draggable=\"true\"]:hover {\n            background-color: #e3f2fd !important;\n            border: 1px solid #2196f3 !important;\n        }\n        \n        .column-header.dragging {\n            opacity: 0.6;\n            background-color: #ffecb3 !important;\n        }\n        \n        .column-header.drag-over {\n            border: 3px dashed #4caf50 !important;\n            background-color: #e8f5e8 !important;\n        }\n        \n        /* Sort icon styles */\n        .sort-icon {\n            margin-left: 5px;\n            display: inline-block;\n            transition: transform 0.2s;\n        }\n        \n        th:hover .sort-icon {\n            opacity: 1 !important;\n        }\n        \n        /* Header hover effect */\n        th[data-sortable=\"true\"]:hover {\n            background-color: #e9ecef !important;\n        }\n        \n        .controls-container {\n            margin-bottom: 20px;\n            display: flex;\n            flex-direction: column;\n            gap: 10px;\n        }\n        \n        .filter-container, .pagination-container {\n            display: flex;\n            gap: 10px;\n            align-items: center;\n            flex-wrap: wrap;\n        }\n        \n        /* Make sure table is responsive */\n        #myTable {\n            overflow-x: auto;\n            width: 100%;\n        }\n        \n        /* Button styling */\n        button {\n            padding: 5px 10px;\n            background-color: #4CAF50;\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n        }\n        \n        button:disabled {\n            background-color: #cccccc;\n            cursor: not-allowed;\n        }\n        \n        /* Select and input styling */\n        select, input {\n            padding: 5px;\n            border-radius: 4px;\n            border: 1px solid #ddd;\n        }\n\n        /* Drill-down cell styling */\n        .drill-down-cell {\n            cursor: pointer;\n            transition: background-color 0.2s;\n        }\n        \n        .drill-down-cell:hover {\n            background-color: #e3f2fd !important;\n            border: 2px solid #2196f3 !important;\n        }\n\n        /* Modal styles for drill-down details */\n        .drill-down-modal {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0, 0, 0, 0.5);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n        }\n\n        .drill-down-content {\n            background: white;\n            border-radius: 8px;\n            padding: 20px;\n            width: 90%;\n            max-width: 800px;\n            max-height: 80%;\n            overflow: auto;\n            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        }\n\n        .drill-down-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 20px;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e0e0e0;\n        }\n\n        .drill-down-title {\n            font-size: 18px;\n            font-weight: bold;\n            color: #333;\n        }\n\n        .drill-down-close {\n            background: #f44336;\n            color: white;\n            border: none;\n            border-radius: 50%;\n            width: 30px;\n            height: 30px;\n            cursor: pointer;\n            font-size: 16px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .drill-down-close:hover {\n            background: #d32f2f;\n        }\n\n        .drill-down-summary {\n            background: #f5f5f5;\n            padding: 10px;\n            border-radius: 4px;\n            margin-bottom: 15px;\n            font-size: 14px;\n        }\n\n        .drill-down-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 10px;\n        }\n\n        .drill-down-table th {\n            background: #f8f9fa;\n            padding: 8px;\n            border: 1px solid #dee2e6;\n            font-weight: bold;\n            text-align: left;\n        }\n\n        .drill-down-table td {\n            padding: 6px 8px;\n            border: 1px solid #dee2e6;\n        }\n\n        .drill-down-table tr:nth-child(even) {\n            background-color: #f9f9f9;\n        }\n\n        .drill-down-table tr:hover {\n            background-color: #e3f2fd;\n        }\n    `;\n  document.head.appendChild(styleEl);\n}\n\n/* REPLACE your addFormattingStyles function with this enhanced version */\n\nfunction addFormattingStyles() {\n  const styles = `\n    <style id=\"formattingStyles\">\n      /* Cell selection styles */\n      .selected-cell {\n        background-color: rgba(76, 175, 80, 0.3) !important;\n        border: 2px solid #4CAF50 !important;\n      }\n      \n      /* Format modal styles - matching the screenshot */\n      .format-modal {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.5);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 10000;\n      }\n\n      .format-modal-content {\n        background: white;\n        border-radius: 4px;\n        width: 90%;\n        max-width: 480px;\n        max-height: 90vh;\n        overflow-y: auto;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        border: 1px solid #d0d0d0;\n      }\n\n      .format-modal-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 16px 20px;\n        border-bottom: 1px solid #e0e0e0;\n        background-color: #fafafa;\n      }\n\n      .format-modal-header h3 {\n        margin: 0;\n        font-size: 16px;\n        font-weight: 500;\n        color: #333;\n      }\n\n      .format-close-btn {\n        background: none;\n        border: none;\n        font-size: 20px;\n        cursor: pointer;\n        color: #666;\n        padding: 4px;\n        width: 28px;\n        height: 28px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border-radius: 2px;\n      }\n\n      .format-close-btn:hover {\n        background-color: #e0e0e0;\n      }\n\n      .format-modal-body {\n        padding: 20px;\n        max-height: calc(90vh - 140px);\n        overflow-y: auto;\n      }\n\n      .format-section {\n        margin-bottom: 16px;\n      }\n\n      .format-section label {\n        display: block;\n        margin-bottom: 6px;\n        font-weight: 400;\n        color: #555;\n        font-size: 13px;\n        text-transform: none;\n      }\n\n      .format-select, .format-input {\n        width: 100%;\n        padding: 8px 10px;\n        border: 1px solid #d0d0d0;\n        border-radius: 3px;\n        font-size: 13px;\n        background-color: white;\n        color: #333;\n        font-family: inherit;\n      }\n\n      .format-select:focus, .format-input:focus {\n        outline: none;\n        border-color: #4a90e2;\n        box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);\n      }\n\n      .format-input::placeholder {\n        color: #999;\n        font-style: italic;\n      }\n\n      /* Font controls styling */\n      .font-controls {\n        display: grid;\n        grid-template-columns: 2fr 1fr auto auto;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .format-btn {\n        width: 32px;\n        height: 32px;\n        border: 1px solid #d0d0d0;\n        background: white;\n        border-radius: 3px;\n        font-weight: bold;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 13px;\n        color: #333;\n      }\n\n      .format-btn.active {\n        background-color: #4a90e2;\n        color: white;\n        border-color: #4a90e2;\n      }\n\n      .format-btn:hover {\n        background-color: #f0f0f0;\n      }\n\n      .format-btn.active:hover {\n        background-color: #357abd;\n      }\n\n      /* Color controls styling */\n      .color-controls {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 12px;\n      }\n\n      .color-control {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .color-control label {\n        margin: 0;\n        font-size: 12px;\n        min-width: 65px;\n        color: #666;\n      }\n\n      .color-control input[type=\"color\"] {\n        width: 36px;\n        height: 24px;\n        border: 1px solid #d0d0d0;\n        border-radius: 3px;\n        cursor: pointer;\n        padding: 0;\n      }\n\n      /* Preview styling */\n      .format-preview {\n        border: 1px solid #d0d0d0;\n        border-radius: 3px;\n        padding: 12px;\n        background-color: #f9f9f9;\n        text-align: center;\n        min-height: 20px;\n        font-size: 14px;\n        color: #333;\n        font-family: inherit;\n      }\n\n      /* Modal footer styling */\n      .format-modal-footer {\n        padding: 16px 20px;\n        border-top: 1px solid #e0e0e0;\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        background-color: #fafafa;\n      }\n\n      .format-apply-btn, .format-cancel-btn {\n        padding: 8px 20px;\n        border: none;\n        border-radius: 3px;\n        font-size: 13px;\n        font-weight: 500;\n        cursor: pointer;\n        min-width: 70px;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n\n      .format-apply-btn {\n        background-color: #666;\n        color: white;\n      }\n\n      .format-apply-btn:hover {\n        background-color: #555;\n      }\n\n      .format-cancel-btn {\n        background-color: #e0e0e0;\n        color: #666;\n        border: 1px solid #d0d0d0;\n      }\n\n      .format-cancel-btn:hover {\n        background-color: #d0d0d0;\n      }\n\n      /* Currency section visibility */\n      .currency-section {\n        transition: all 0.2s ease;\n      }\n\n      /* Scrollbar styling for modal body */\n      .format-modal-body::-webkit-scrollbar {\n        width: 6px;\n      }\n\n      .format-modal-body::-webkit-scrollbar-track {\n        background: #f1f1f1;\n        border-radius: 3px;\n      }\n\n      .format-modal-body::-webkit-scrollbar-thumb {\n        background: #c1c1c1;\n        border-radius: 3px;\n      }\n\n      .format-modal-body::-webkit-scrollbar-thumb:hover {\n        background: #a8a8a8;\n      }\n\n      /* Responsive adjustments */\n      @media (max-width: 600px) {\n        .format-modal-content {\n          width: 95%;\n          margin: 10px;\n        }\n        \n        .font-controls {\n          grid-template-columns: 1fr;\n          gap: 8px;\n        }\n        \n        .color-controls {\n          grid-template-columns: 1fr;\n        }\n        \n        .format-modal-footer {\n          flex-direction: column-reverse;\n        }\n        \n        .format-apply-btn, .format-cancel-btn {\n          width: 100%;\n        }\n      }\n\n      /* Disabled state for currency fields */\n      .currency-section select:disabled {\n        background-color: #f5f5f5;\n        color: #999;\n        cursor: not-allowed;\n      }\n\n      /* Better focus states */\n      .format-btn:focus {\n        outline: none;\n        box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3);\n      }\n\n      .color-control input[type=\"color\"]:focus {\n        outline: none;\n        box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3);\n      }\n    </style>\n  `;\n  document.head.insertAdjacentHTML('beforeend', styles);\n}\n\n// Add this function to create the drill-down modal:\n// Generic function to update drill-down modal for any fields\nfunction createDrillDownModal(rowValue, columnValue, measure, rawDetails, aggregatedValue, rowFieldName, columnFieldName) {\n  // Remove existing modal if any\n  const existingModal = document.querySelector('.drill-down-modal');\n  if (existingModal) {\n    existingModal.remove();\n  }\n\n  // Create modal elements\n  const modal = document.createElement('div');\n  modal.className = 'drill-down-modal';\n  const content = document.createElement('div');\n  content.className = 'drill-down-content';\n\n  // Header\n  const header = document.createElement('div');\n  header.className = 'drill-down-header';\n  const title = document.createElement('div');\n  title.className = 'drill-down-title';\n  title.textContent = 'Details';\n  const closeButton = document.createElement('button');\n  closeButton.className = 'drill-down-close';\n  closeButton.innerHTML = '×';\n  closeButton.addEventListener('click', () => modal.remove());\n  header.appendChild(title);\n  header.appendChild(closeButton);\n\n  // Summary\n  const summary = document.createElement('div');\n  summary.className = 'drill-down-summary';\n  summary.innerHTML = `\n    <strong>${getFieldDisplayName(rowFieldName)}:</strong> ${rowValue} &nbsp;&nbsp;\n    <strong>${getFieldDisplayName(columnFieldName)}:</strong> ${columnValue} &nbsp;&nbsp;\n    <strong>${measure.caption}:</strong> ${aggregatedValue}\n  `;\n\n  // Table\n  const table = document.createElement('table');\n  table.className = 'drill-down-table';\n\n  // Table header\n  const thead = document.createElement('thead');\n  const headerRow = document.createElement('tr');\n\n  // Get all columns from the raw data\n  const columns = rawDetails.length > 0 ? Object.keys(rawDetails[0]) : [];\n  columns.forEach(col => {\n    const th = document.createElement('th');\n    th.textContent = getFieldDisplayName(col);\n    headerRow.appendChild(th);\n  });\n  thead.appendChild(headerRow);\n  table.appendChild(thead);\n\n  // Table body\n  const tbody = document.createElement('tbody');\n  rawDetails.forEach((row, index) => {\n    const tr = document.createElement('tr');\n    columns.forEach(col => {\n      const td = document.createElement('td');\n      let value = row[col];\n\n      // Format values appropriately based on measure format\n      if (measure.format && (col === measure.uniqueName || col.includes('price') || col.includes('sales') || col.includes('revenue'))) {\n        if (typeof value === 'number') {\n          if (measure.format.type === 'currency') {\n            value = new Intl.NumberFormat('en-US', {\n              style: 'currency',\n              currency: 'USD'\n            }).format(value);\n          }\n        }\n      } else if (col.includes('date')) {\n        value = new Date(value).toLocaleDateString();\n      }\n      td.textContent = value;\n      tr.appendChild(td);\n    });\n    tbody.appendChild(tr);\n  });\n  table.appendChild(tbody);\n\n  // Assemble modal\n  content.appendChild(header);\n  content.appendChild(summary);\n  content.appendChild(table);\n  modal.appendChild(content);\n\n  // Add to document\n  document.body.appendChild(modal);\n\n  // Close modal when clicking outside\n  modal.addEventListener('click', e => {\n    if (e.target === modal) {\n      modal.remove();\n    }\n  });\n\n  // Close modal with Escape key\n  const handleEscape = e => {\n    if (e.key === 'Escape') {\n      modal.remove();\n      document.removeEventListener('keydown', handleEscape);\n    }\n  };\n  document.addEventListener('keydown', handleEscape);\n}\n\n// Add this function to get drill-down data for a specific cell:\n// Generic getDrillDownData function\nfunction getDrillDownData(rowValue, columnValue, measure, rowFieldName, columnFieldName) {\n  const state = pivotEngine.getState();\n\n  // Create filter object dynamically\n  const filter = {};\n  filter[rowFieldName] = rowValue;\n  filter[columnFieldName] = columnValue;\n\n  // Filter raw data for this specific row and column combination\n  const filteredData = state.rawData.filter(item => {\n    return Object.keys(filter).every(key => item[key] === filter[key]);\n  });\n  console.log(`Drill-down for ${rowFieldName}:${rowValue} - ${columnFieldName}:${columnValue} - ${measure.caption}:`, filteredData);\n  return filteredData;\n}\n\n// Generic addDrillDownToDataCell function\nfunction addDrillDownToDataCell(td, rowValue, columnValue, measure, value, formattedValue, rowFieldName, columnFieldName) {\n  td.textContent = formattedValue;\n\n  // Add drill-down functionality\n  td.className = 'drill-down-cell';\n  td.title = `Double-click to see details for ${rowFieldName}: ${rowValue} - ${columnFieldName}: ${columnValue}`;\n\n  // Add double-click event listener\n  td.addEventListener('dblclick', e => {\n    e.preventDefault();\n    e.stopPropagation();\n    console.log(`Double-clicked on ${rowFieldName}: ${rowValue} - ${columnFieldName}: ${columnValue} - ${measure.caption}`);\n\n    // Get the raw data for this cell\n    const rawDetails = getDrillDownData(rowValue, columnValue, measure, rowFieldName, columnFieldName);\n    if (rawDetails.length === 0) {\n      alert(`No detailed data found for ${rowFieldName}: ${rowValue} in ${columnFieldName}: ${columnValue}`);\n      return;\n    }\n\n    // Show the drill-down modal\n    createDrillDownModal(rowValue, columnValue, measure, rawDetails, formattedValue, rowFieldName, columnFieldName);\n  });\n}\n\n// Add HTML for filter and pagination controls\nfunction addControlsHTML() {\n  if (document.querySelector('.controls-container')) {\n    return;\n  }\n  const container = document.createElement('div');\n  container.className = 'controls-container';\n  container.innerHTML = `\n    <div class=\"filter-container\">\n      <select id=\"filterField\"></select>\n      <select id=\"filterOperator\"></select>\n      <input type=\"text\" id=\"filterValue\" placeholder=\"Filter value\">\n      <button id=\"applyFilter\">Apply Filter</button>\n      <button id=\"resetFilter\">Reset</button>\n      <button id=\"switchView\">Switch to Raw Data</button>\n    </div>\n   \n    <div class=\"pagination-container\">\n      <label>Items per page:</label>\n      <select id=\"pageSize\">\n        <option value=\"1\">1</option>\n        <option value=\"2\">2</option>\n        <option value=\"3\">3</option>\n        <option value=\"4\">4</option>\n        <option value=\"10\" selected>10</option>\n        <option value=\"25\">25</option>\n        <option value=\"50\">50</option>\n      </select>\n      <button id=\"prevPage\">Previous</button>\n      <span id=\"pageInfo\">Processed Data - Page 1 of 1</span>\n      <button id=\"nextPage\">Next</button>\n    </div>\n  `;\n  const myTable = document.getElementById('myTable');\n  myTable.parentNode.insertBefore(container, myTable);\n}\nfunction setupCellSelection() {\n  document.addEventListener('click', e => {\n    if (e.target.tagName === 'TD' && e.target.closest('#myTable')) {\n      if (e.ctrlKey || e.metaKey) {\n        if (e.target.classList.contains('selected-cell')) {\n          cellFormatter.removeCellFromSelection(e.target);\n        } else {\n          cellFormatter.addCellToSelection(e.target);\n        }\n      } else {\n        cellFormatter.clearSelection();\n        cellFormatter.addCellToSelection(e.target);\n      }\n    } else if (!e.target.closest('.format-modal')) {\n      cellFormatter.clearSelection();\n    }\n  });\n}\n\n// Add this function to set up drag and drop functionality\n// Replace your setupDragAndDrop function with this version that includes column swapping:\n\n// Update your setupDragAndDrop function column section:\n// function setupDragAndDrop() {\n//   console.log('Setting up generic drag and drop');\n\n//   // Get field names from configuration\n//   const rowFieldName = pivotEngine.getRowFieldName();\n//   const columnFieldName = pivotEngine.getColumnFieldName();\n\n//   if (!rowFieldName || !columnFieldName) {\n//     console.warn('Row or column field not configured for drag and drop');\n//     return;\n//   }\n\n//   console.log(`Setting up drag and drop for row field: ${rowFieldName}, column field: ${columnFieldName}`);\n\n//   // ENHANCED: Column drag and drop with SWAPPING (generic for any column field)\n//   const headers = document.querySelectorAll('th[draggable=\"true\"]');\n//   let draggedColumnIndex = null;\n//   let draggedColumnValue = null;\n\n//   console.log('Setting up drag and drop, found headers:', headers.length);\n\n//   const state = pivotEngine.getState();\n//   const uniqueColumnValues = getOrderedColumnValues(state);\n\n//   console.log(`Current ${columnFieldName} values for drag setup:`, uniqueColumnValues);\n\n//   headers.forEach((header, headerIdx) => {\n//     const headerIndex = header.dataset.index ? parseInt(header.dataset.index) : null;\n//     const fieldName = header.dataset.fieldName;\n//     const fieldValue = header.dataset.fieldValue;\n\n//     console.log(`Setting up header ${headerIdx}: index=${headerIndex}, field=${fieldName}, value=${fieldValue}`);\n\n//     // Skip if this is not a column header or missing data\n//     if (headerIndex === null || fieldName !== columnFieldName || !fieldValue) {\n//       console.log('Skipping header - not a column header or missing data');\n//       return;\n//     }\n\n//     // Find the actual index in the column values array\n//     const actualColumnIndex = uniqueColumnValues.indexOf(fieldValue);\n//     const indexToUse = actualColumnIndex !== -1 ? actualColumnIndex : headerIndex - 1;\n\n//     console.log(`Using ${columnFieldName} index ${indexToUse} for ${fieldValue}`);\n\n//     header.addEventListener('dragstart', e => {\n//       draggedColumnIndex = indexToUse;\n//       draggedColumnValue = fieldValue;\n//       e.dataTransfer.setData('text/plain', fieldValue);\n//       setTimeout(() => header.classList.add('dragging'), 0);\n//       console.log(`Column drag started for ${columnFieldName}:`, fieldValue, 'Index:', indexToUse);\n//     });\n\n//     header.addEventListener('dragend', () => {\n//       header.classList.remove('dragging');\n//       draggedColumnIndex = null;\n//       draggedColumnValue = null;\n//     });\n\n//     header.addEventListener('dragover', e => {\n//       e.preventDefault();\n//     });\n\n//     header.addEventListener('dragenter', e => {\n//       e.preventDefault();\n//       if (draggedColumnValue && draggedColumnValue !== fieldValue) {\n//         header.classList.add('drag-over');\n//       }\n//     });\n\n//     header.addEventListener('dragleave', () => {\n//       header.classList.remove('drag-over');\n//     });\n\n//     header.addEventListener('drop', e => {\n//       e.preventDefault();\n//       header.classList.remove('drag-over');\n\n//       const targetColumnValue = fieldValue;\n//       const targetColumnIndex = uniqueColumnValues.indexOf(targetColumnValue);\n//       const targetIndexToUse = targetColumnIndex !== -1 ? targetColumnIndex : indexToUse;\n\n//       if (draggedColumnValue && targetColumnValue && draggedColumnValue !== targetColumnValue) {\n//         console.log(`Attempting to swap ${columnFieldName} ${draggedColumnValue} (index: ${draggedColumnIndex}) with ${targetColumnValue} (index: ${targetIndexToUse})`);\n\n//         try {\n//           // Use core engine method\n//           pivotEngine.swapDataColumns(draggedColumnIndex, targetIndexToUse);\n//           renderTable();\n//         } catch (error) {\n//           console.error('Error during column swap operation:', error);\n//           // Fallback to manual swap\n//           swapGenericFieldValues(draggedColumnIndex, targetIndexToUse, columnFieldName, false);\n//           renderTable();\n//         }\n//       }\n//     });\n//   });\n\n//   // ENHANCED: Row drag and drop with SWAPPING (generic for any row field)\n//   const rows = document.querySelectorAll('tbody tr[draggable=\"true\"]');\n//   let draggedRowIndex = null;\n//   let draggedRowValue = null;\n\n//   console.log('Setting up row drag, found rows:', rows.length);\n\n//   rows.forEach((row) => {\n//     const rowCell = row.querySelector('.row-cell');\n//     const fieldName = row.dataset.fieldName;\n//     const fieldValue = row.dataset.fieldValue;\n//     const globalIndex = parseInt(row.dataset.globalIndex);\n\n//     // Validate this is a row for our configured row field\n//     if (fieldName !== rowFieldName || !fieldValue) {\n//       console.warn('Row field mismatch or missing data');\n//       return;\n//     }\n\n//     console.log(`Setting up row drag for ${rowFieldName}: ${fieldValue} (global index: ${globalIndex})`);\n\n//     row.addEventListener('dragstart', e => {\n//       draggedRowValue = fieldValue;\n//       draggedRowIndex = globalIndex;\n//       e.dataTransfer.setData('text/plain', fieldValue);\n//       setTimeout(() => row.classList.add('dragging'), 0);\n//       console.log(`Drag started for ${rowFieldName}:`, fieldValue, 'Global index:', globalIndex);\n//     });\n\n//     row.addEventListener('dragend', () => {\n//       row.classList.remove('dragging');\n//       draggedRowValue = null;\n//       draggedRowIndex = null;\n//     });\n\n//     row.addEventListener('dragover', e => {\n//       e.preventDefault();\n//     });\n\n//     row.addEventListener('dragenter', e => {\n//       e.preventDefault();\n//       if (draggedRowValue && draggedRowValue !== fieldValue) {\n//         row.classList.add('drag-over');\n//       }\n//     });\n\n//     row.addEventListener('dragleave', () => {\n//       row.classList.remove('drag-over');\n//     });\n\n//     row.addEventListener('drop', e => {\n//       e.preventDefault();\n//       row.classList.remove('drag-over');\n\n//       const targetRowValue = fieldValue;\n//       const targetRowIndex = globalIndex;\n\n//       if (draggedRowValue && targetRowValue && draggedRowValue !== targetRowValue) {\n//         console.log(`Swapping ${rowFieldName} ${draggedRowValue} (global: ${draggedRowIndex}) with ${targetRowValue} (global: ${targetRowIndex})`);\n\n//         try {\n//           // Use core engine method\n//           pivotEngine.swapDataRows(draggedRowIndex, targetRowIndex);\n//           renderTable();\n//         } catch (error) {\n//           console.error('Error during row swap operation:', error);\n//           // Fallback to manual swap\n//           swapGenericFieldValues(draggedRowIndex, targetRowIndex, rowFieldName, true);\n//           renderTable();\n//         }\n//       }\n//     });\n//   });\n// }\n\nfunction setupDragAndDrop() {\n  console.log('Setting up generic drag and drop');\n\n  // Get field names from configuration\n  const rowFieldName = pivotEngine.getRowFieldName();\n  const columnFieldName = pivotEngine.getColumnFieldName();\n  if (!rowFieldName || !columnFieldName) {\n    console.warn('Row or column field not configured for drag and drop');\n    return;\n  }\n  console.log(`Setting up drag and drop for row field: ${rowFieldName}, column field: ${columnFieldName}`);\n\n  // FIXED: Use the improved column drag setup\n  setupColumnDragAndDropFixed(columnFieldName);\n\n  // Row drag setup (keep existing)\n  setupRowDragAndDrop(rowFieldName);\n}\n\n// Add this new function to handle region/column swapping:\n// Keep the manual swap function as fallback:\n// function swapRegionsInEngine(fromIndex, toIndex) {\n//   const state = pivotEngine.getState();\n//   const currentRegions = getOrderedRegions(state);\n\n//   console.log(\n//     'Manual column swap - From index:',\n//     fromIndex,\n//     'To index:',\n//     toIndex\n//   );\n//   console.log('Current regions:', currentRegions);\n\n//   // Validate indices\n//   if (\n//     fromIndex < 0 ||\n//     toIndex < 0 ||\n//     fromIndex >= currentRegions.length ||\n//     toIndex >= currentRegions.length\n//   ) {\n//     console.error('Invalid indices for column swap:', fromIndex, toIndex);\n//     return;\n//   }\n\n//   if (fromIndex === toIndex) {\n//     console.log('Same column, no swap needed');\n//     return;\n//   }\n\n//   // Get the region names to swap\n//   const fromRegion = currentRegions[fromIndex];\n//   const toRegion = currentRegions[toIndex];\n\n//   if (!fromRegion || !toRegion) {\n//     console.error('Invalid regions for swap:', fromRegion, toRegion);\n//     return;\n//   }\n\n//   // Create swapped region order\n//   const swappedRegions = [...currentRegions];\n//   swappedRegions[fromIndex] = toRegion;\n//   swappedRegions[toIndex] = fromRegion;\n\n//   console.log('After manual swap - Regions:', swappedRegions);\n\n//   // Store the swapped region order in multiple places for persistence\n//   window.swappedRegionOrder = swappedRegions;\n\n//   // Also store in the engine state if possible\n//   if (pivotEngine.state) {\n//     pivotEngine.state.customRegionOrder = swappedRegions;\n//   }\n\n//   console.log(\n//     'Manual column swap completed. New region order:',\n//     swappedRegions\n//   );\n// }\n\n// // Keep the existing swapProductsInEngine function for rows:\n// function swapProductsInEngine(fromIndex, toIndex) {\n//   const state = pivotEngine.getState();\n//   const allUniqueProducts = [\n//     ...new Set(state.rawData.map(item => item.product)),\n//   ];\n\n//   console.log('Manual swap - From index:', fromIndex, 'To index:', toIndex);\n//   console.log('Before swap - Products:', allUniqueProducts);\n\n//   // Get the product names to swap\n//   const fromProduct = allUniqueProducts[fromIndex];\n//   const toProduct = allUniqueProducts[toIndex];\n\n//   if (!fromProduct || !toProduct) {\n//     console.error('Invalid products for swap:', fromProduct, toProduct);\n//     return;\n//   }\n\n//   // Create new data array with swapped product order\n//   const newData = [...state.rawData];\n\n//   // Create swapped product order\n//   const swappedProducts = [...allUniqueProducts];\n//   swappedProducts[fromIndex] = toProduct;\n//   swappedProducts[toIndex] = fromProduct;\n\n//   console.log('After swap - Products:', swappedProducts);\n\n//   // Sort data according to the new product order\n//   newData.sort((a, b) => {\n//     const aIndex = swappedProducts.indexOf(a.product);\n//     const bIndex = swappedProducts.indexOf(b.product);\n//     return aIndex - bIndex;\n//   });\n\n//   // Update filteredData to maintain consistency\n//   if (filteredData) {\n//     filteredData.sort((a, b) => {\n//       const aIndex = swappedProducts.indexOf(a.product);\n//       const bIndex = swappedProducts.indexOf(b.product);\n//       return aIndex - bIndex;\n//     });\n//   }\n\n//   // Create new engine with swapped data\n//   pivotEngine = new PivotEngine({\n//     ...config,\n//     data: newData,\n//   });\n\n//   console.log('Swap completed. New product order:', [\n//     ...new Set(pivotEngine.getState().rawData.map(item => item.product)),\n//   ]);\n// }\n\n// Add this function for manual category swapping:\n// function swapCategoriesInEngine(fromIndex, toIndex) {\n//   const state = pivotEngine.getState();\n//   const currentCategories = getOrderedCategories(state);\n\n//   console.log('Manual column swap - From index:', fromIndex, 'To index:', toIndex);\n//   console.log('Current categories:', currentCategories);\n\n//   // Validate indices\n//   if (fromIndex < 0 || toIndex < 0 || fromIndex >= currentCategories.length || toIndex >= currentCategories.length) {\n//     console.error('Invalid indices for column swap:', fromIndex, toIndex);\n//     return;\n//   }\n\n//   if (fromIndex === toIndex) {\n//     console.log('Same column, no swap needed');\n//     return;\n//   }\n\n//   // Get the category names to swap\n//   const fromCategory = currentCategories[fromIndex];\n//   const toCategory = currentCategories[toIndex];\n\n//   if (!fromCategory || !toCategory) {\n//     console.error('Invalid categories for swap:', fromCategory, toCategory);\n//     return;\n//   }\n\n//   // Create swapped category order\n//   const swappedCategories = [...currentCategories];\n//   swappedCategories[fromIndex] = toCategory;\n//   swappedCategories[toIndex] = fromCategory;\n\n//   console.log('After manual swap - Categories:', swappedCategories);\n\n//   // Store the swapped category order in multiple places for persistence\n//   window.swappedRegionOrder = swappedCategories;\n\n//   // Also store in the engine state if possible\n//   if (pivotEngine.state) {\n//     (pivotEngine.state).customRegionOrder = swappedCategories;\n//   }\n\n//   console.log('Manual column swap completed. New category order:', swappedCategories);\n// }\n\n// // Add this function for manual country swapping:\n// function swapCountriesInEngine(fromIndex, toIndex) {\n//   const state = pivotEngine.getState();\n//   const allUniqueCountries = [...new Set(state.rawData.map(item => item.country).filter(country => country))];\n\n//   console.log('Manual swap - From index:', fromIndex, 'To index:', toIndex);\n//   console.log('Before swap - Countries:', allUniqueCountries);\n\n//   // Get the country names to swap\n//   const fromCountry = allUniqueCountries[fromIndex];\n//   const toCountry = allUniqueCountries[toIndex];\n\n//   if (!fromCountry || !toCountry) {\n//     console.error('Invalid countries for swap:', fromCountry, toCountry);\n//     return;\n//   }\n\n//   // Create new data array with swapped country order\n//   const newData = [...state.rawData];\n\n//   // Create swapped country order\n//   const swappedCountries = [...allUniqueCountries];\n//   swappedCountries[fromIndex] = toCountry;\n//   swappedCountries[toIndex] = fromCountry;\n\n//   console.log('After swap - Countries:', swappedCountries);\n\n//   // Sort data according to the new country order\n//   newData.sort((a, b) => {\n//     const aIndex = swappedCountries.indexOf(a.country);\n//     const bIndex = swappedCountries.indexOf(b.country);\n//     return aIndex - bIndex;\n//   });\n\n//   // Update filteredData to maintain consistency\n//   if (filteredData) {\n//     filteredData.sort((a, b) => {\n//       const aIndex = swappedCountries.indexOf(a.country);\n//       const bIndex = swappedCountries.indexOf(b.country);\n//       return aIndex - bIndex;\n//     });\n//   }\n\n//   // Create new engine with swapped data\n//   pivotEngine = new PivotEngine({\n//     ...config,\n//     data: newData,\n//   });\n\n//   console.log('Swap completed. New country order:', [...new Set(pivotEngine.getState().rawData.map(item => item.country))]);\n// }\n\n// Generic function to manually swap field values (fallback)\nfunction swapGenericFieldValues(fromIndex, toIndex, fieldName, isRowField) {\n  const state = pivotEngine.getState();\n  const uniqueValues = pivotEngine.getUniqueFieldValues(fieldName);\n  console.log(`Manual ${fieldName} swap - From index:`, fromIndex, 'To index:', toIndex);\n  console.log(`Current ${fieldName} values:`, uniqueValues);\n\n  // Validate indices\n  if (fromIndex < 0 || toIndex < 0 || fromIndex >= uniqueValues.length || toIndex >= uniqueValues.length) {\n    console.error(`Invalid indices for ${fieldName} swap:`, fromIndex, toIndex, 'Available values:', uniqueValues.length);\n    return;\n  }\n  if (fromIndex === toIndex) {\n    console.log('Same index, no swap needed');\n    return;\n  }\n\n  // Get the values to swap\n  const fromValue = uniqueValues[fromIndex];\n  const toValue = uniqueValues[toIndex];\n  if (!fromValue || !toValue) {\n    console.error(`Invalid ${fieldName} values for swap:`, fromValue, toValue);\n    return;\n  }\n  console.log(`Swapping ${fieldName}: ${fromValue} <-> ${toValue}`);\n\n  // Create swapped value order\n  const swappedValues = [...uniqueValues];\n  swappedValues[fromIndex] = toValue;\n  swappedValues[toIndex] = fromValue;\n  console.log(`After manual swap - ${fieldName} values:`, swappedValues);\n\n  // Store the swapped order\n  const storageKey = isRowField ? 'swappedRowOrder' : 'swappedColumnOrder';\n  window[storageKey] = swappedValues;\n\n  // Also store in the engine state\n  if (pivotEngine.state) {\n    const stateKey = isRowField ? 'customRowOrder' : 'customColumnOrder';\n    pivotEngine.state[stateKey] = {\n      fieldName: fieldName,\n      order: swappedValues\n    };\n  }\n\n  // For row fields, we need to reorder the actual data\n  if (isRowField) {\n    const dataToUse = state.data || state.rawData || filteredData;\n    const newData = [...dataToUse];\n\n    // Sort data according to the new value order\n    newData.sort((a, b) => {\n      const aIndex = swappedValues.indexOf(a[fieldName]);\n      const bIndex = swappedValues.indexOf(b[fieldName]);\n      return aIndex - bIndex;\n    });\n\n    // Update filteredData to maintain consistency\n    if (filteredData) {\n      filteredData.sort((a, b) => {\n        const aIndex = swappedValues.indexOf(a[fieldName]);\n        const bIndex = swappedValues.indexOf(b[fieldName]);\n        return aIndex - bIndex;\n      });\n    }\n\n    // Create new engine with swapped data\n    pivotEngine = new PivotEngine({\n      ...config,\n      data: newData\n    });\n  }\n  console.log(`Manual ${fieldName} swap completed. New order:`, swappedValues);\n}\nexport function onSectionItemDrop(droppedFields) {\n  let droppedFieldsInSections = JSON.stringify({\n    rows: Array.from(droppedFields.rows),\n    columns: Array.from(droppedFields.columns),\n    values: Array.from(droppedFields.values),\n    filters: Array.from(droppedFields.filters)\n  });\n  const parsedDroppedFieldsInSections = JSON.parse(droppedFieldsInSections);\n  const transformedRows = parsedDroppedFieldsInSections.rows.map(rowField => {\n    return {\n      uniqueName: rowField.toLowerCase(),\n      caption: rowField\n    };\n  });\n  const transformedColumns = parsedDroppedFieldsInSections.columns.map(columnField => {\n    return {\n      uniqueName: columnField.toLowerCase(),\n      caption: columnField\n    };\n  });\n  // const transformedValues=parsedDroppedFieldsInSections.values.map((valueField)=>{ return { uniqueName:valueField.toLowerCase(), caption:valueField}})\n  // const transformedFilters=parsedDroppedFieldsInSections.filters.map((filterField)=>{ return { uniqueName:filterField.toLowerCase(), caption:filterField}})\n\n  //TODO: for now only-applicable to rows and columns, will do the same for values and global filters in next iteration\n  pivotEngine.state.rows = transformedRows;\n  pivotEngine.state.columns = transformedColumns;\n  renderTable();\n}\n// Initialize everything when the DOM is loaded\n// Replace your initialization section at the bottom with this:\ndocument.addEventListener('DOMContentLoaded', () => {\n  // CRITICAL: Ensure we start with all the original data\n  console.log('Initializing with sampleData:', sampleData.length, 'items');\n\n  // Reset filteredData to ensure we have all data\n  filteredData = [...sampleData];\n\n  // Create PivotEngine instance with all data\n  pivotEngine = new PivotEngine({\n    ...config,\n    data: sampleData // Use original sample data, not filtered\n  });\n\n  // Subscribe to state changes and re-render UI\n  pivotEngine.subscribe(state => {\n    renderTable();\n  });\n  console.log('Initial pivot engine state:', pivotEngine.getState());\n\n  // Initialize cell formatter - ADD THESE LINES\n  cellFormatter = new CellFormatter();\n  addFormattingStyles();\n  if (config.toolbar) {\n    createHeader(config);\n  }\n\n  // Add draggable styles\n  addDraggableStyles();\n\n  // Add controls HTML\n  addControlsHTML();\n\n  // Initialize UI\n  initializeFilters();\n  setupEventListeners();\n  setupCellSelection();\n\n  // CRITICAL: Set initial pagination with all sample data\n  updatePagination(sampleData, true);\n  window.cellFormatter = cellFormatter;\n\n  // Initial render (optional, since subscribe will call it immediately)\n  // renderTable();\n});",
  "map": {
    "version": 3,
    "names": [
      "createHeader",
      "PivotEngine",
      "sampleData",
      "config",
      "pivotEngine",
      "filteredData",
      "showProcessedData",
      "currentViewMode",
      "paginationState",
      "currentPage",
      "pageSize",
      "totalPages",
      "cellFormatter",
      "selectedCells",
      "Set",
      "CellFormatConfig",
      "textAlign",
      "fontWeight",
      "fontStyle",
      "fontSize",
      "fontFamily",
      "color",
      "backgroundColor",
      "chooseValue",
      "thousandSeparator",
      "decimalSeparator",
      "decimalPlaces",
      "currencySymbol",
      "currencyAlign",
      "nullValue",
      "formatAsPercent",
      "initializeFilters",
      "filterField",
      "document",
      "getElementById",
      "innerHTML",
      "filterOperator",
      "applyFilter",
      "data",
      "filter",
      "newFilteredData",
      "item",
      "fieldValue",
      "field",
      "operator",
      "value",
      "String",
      "toLowerCase",
      "includes",
      "parseFloat",
      "getPaginatedData",
      "start",
      "end",
      "slice",
      "createSortIcon",
      "currentSortConfig",
      "sortIcon",
      "createElement",
      "style",
      "marginLeft",
      "display",
      "isCurrentlySorted",
      "direction",
      "title",
      "opacity",
      "CellFormatter",
      "constructor",
      "currentFormat",
      "formatHistory",
      "Map",
      "formatNumber",
      "undefined",
      "num",
      "isNaN",
      "toFixed",
      "integerPart",
      "decimalPart",
      "split",
      "separator",
      "replace",
      "formattedNumber",
      "decSeparator",
      "symbol",
      "getCurrencySymbol",
      "currencyValue",
      "currencyMap",
      "applyTextStyling",
      "element",
      "showFormatModal",
      "size",
      "alert",
      "modal",
      "createFormatModal",
      "body",
      "appendChild",
      "setupModalEventListeners",
      "loadCurrentFormat",
      "updatePreview",
      "id",
      "className",
      "querySelector",
      "addEventListener",
      "remove",
      "applyFormat",
      "inputs",
      "querySelectorAll",
      "forEach",
      "input",
      "updateFormatFromInputs",
      "boldToggle",
      "italicToggle",
      "classList",
      "toggle",
      "contains",
      "e",
      "toggleCurrencyFields",
      "parseInt",
      "currencySections",
      "isCurrency",
      "section",
      "preview",
      "sampleValue",
      "formattedValue",
      "textContent",
      "add",
      "cellSelector",
      "cell",
      "originalValue",
      "dataset",
      "set",
      "addCellToSelection",
      "selector",
      "getCellSelector",
      "removeCellFromSelection",
      "delete",
      "clearSelection",
      "clear",
      "row",
      "closest",
      "rowIndex",
      "col",
      "cellIndex",
      "sortRawDataByColumn",
      "columnName",
      "rawData",
      "console",
      "log",
      "currentSort",
      "window",
      "rawDataSort",
      "column",
      "sort",
      "a",
      "b",
      "aVal",
      "bVal",
      "renderRawDataTable",
      "swapRawDataRows",
      "fromIndex",
      "toIndex",
      "length",
      "error",
      "temp",
      "swapRawDataColumns",
      "rawDataColumnOrder",
      "headers",
      "Object",
      "keys",
      "rawDataToUse",
      "state",
      "getState",
      "tableContainer",
      "table",
      "width",
      "borderCollapse",
      "marginTop",
      "border",
      "thead",
      "headerRow",
      "headerText",
      "index",
      "th",
      "padding",
      "borderBottom",
      "borderRight",
      "cursor",
      "position",
      "setAttribute",
      "columnIndex",
      "headerContent",
      "alignItems",
      "justifyContent",
      "headerSpan",
      "getFieldDisplayName",
      "updateRawDataPagination",
      "paginatedData",
      "tbody",
      "rowData",
      "tr",
      "globalIndex",
      "indexOf",
      "header",
      "td",
      "cellValue",
      "Intl",
      "NumberFormat",
      "currency",
      "format",
      "updatePaginationInfo",
      "setupRawDataDragAndDrop",
      "message",
      "pageSizeElement",
      "Number",
      "Math",
      "ceil",
      "max",
      "ensureDataConsistency",
      "hasSignificantInconsistency",
      "abs",
      "customColumnOrder",
      "getOrderedColumnValues",
      "customRowOrder",
      "getOrderedRowValues",
      "preservedColumnOrder",
      "swappedColumnOrder",
      "preservedRowOrder",
      "swappedRowOrder",
      "columnFieldName",
      "getColumnFieldName",
      "setCustomFieldOrder",
      "rowFieldName",
      "getRowFieldName",
      "warn",
      "customOrder",
      "fieldName",
      "order",
      "uniqueValues",
      "getUniqueFieldValues",
      "draggedColumnIndex",
      "dataTransfer",
      "setData",
      "setTimeout",
      "preventDefault",
      "targetColumnIndex",
      "rows",
      "draggedRowIndex",
      "toString",
      "targetRowIndex",
      "renderTable",
      "processedData",
      "columnHeaderRow",
      "cornerCell",
      "uniqueColumnValues",
      "columnValue",
      "colSpan",
      "measures",
      "measureHeaderRow",
      "sortConfig",
      "rowHeader",
      "rowHeaderContent",
      "rowText",
      "rowSortIcon",
      "measure",
      "measureText",
      "caption",
      "uniqueName",
      "allUniqueRowValues",
      "updatePagination",
      "paginatedRowValues",
      "rowValue",
      "rowCell",
      "filteredDataForCell",
      "aggregation",
      "reduce",
      "sum",
      "formula",
      "map",
      "min",
      "type",
      "locale",
      "minimumFractionDigits",
      "decimals",
      "maximumFractionDigits",
      "addDrillDownToDataCell",
      "conditionalFormatting",
      "Array",
      "isArray",
      "rule",
      "value1",
      "value2",
      "font",
      "pageInfo",
      "prevButton",
      "nextButton",
      "disabled",
      "setupDragAndDrop",
      "setupColumnDragAndDropFixed",
      "columnHeaders",
      "draggedColumnValue",
      "headerIdx",
      "targetColumnValue",
      "swapDataColumns",
      "newOrder",
      "manualColumnSwap",
      "setupRowDragAndDrop",
      "draggedRowValue",
      "rowIdx",
      "targetRowValue",
      "swapDataRows",
      "manualRowSwap",
      "swappedValues",
      "uniqueRowValues",
      "fromValue",
      "toValue",
      "dataToUse",
      "newData",
      "aIndex",
      "bIndex",
      "charAt",
      "toUpperCase",
      "resetFilters",
      "subscribe",
      "selectedIndex",
      "viewType",
      "viewMode",
      "resetPage",
      "setPagination",
      "formatTable",
      "setupEventListeners",
      "switchButton",
      "newPageSize",
      "target",
      "currentFirstItem",
      "newPage",
      "floor",
      "addDraggableStyles",
      "styleEl",
      "head",
      "addFormattingStyles",
      "styles",
      "insertAdjacentHTML",
      "createDrillDownModal",
      "rawDetails",
      "aggregatedValue",
      "existingModal",
      "content",
      "closeButton",
      "summary",
      "columns",
      "Date",
      "toLocaleDateString",
      "handleEscape",
      "key",
      "removeEventListener",
      "getDrillDownData",
      "every",
      "stopPropagation",
      "addControlsHTML",
      "container",
      "myTable",
      "parentNode",
      "insertBefore",
      "setupCellSelection",
      "tagName",
      "ctrlKey",
      "metaKey",
      "swapGenericFieldValues",
      "isRowField",
      "storageKey",
      "stateKey",
      "onSectionItemDrop",
      "droppedFields",
      "droppedFieldsInSections",
      "JSON",
      "stringify",
      "from",
      "values",
      "filters",
      "parsedDroppedFieldsInSections",
      "parse",
      "transformedRows",
      "rowField",
      "transformedColumns",
      "columnField",
      "toolbar"
    ],
    "sources": [
      "/home/sanghamitrad/Documents/open-source/pivot-tablesrc/PivotHead/examples/index.js"
    ],
    "sourcesContent": [
      "/* PivotHead Demo\n *\n * This file demonstrates the usage of the PivotheadCore library to create an interactive pivot table.\n * Features include:\n * - Sorting\n * - Grouping\n * - Column resizing\n * - Column reordering (drag and drop)\n * - Row reordering (drag and drop)\n */\nimport { createHeader } from './header/header.js';\n// Use PivotEngine directly from the global scope\nimport { PivotEngine } from '@mindfiredigital/pivothead';\nimport { sampleData } from './config/config.js';\nimport { config } from './config/config.js';\n\n// Create a single instance of PivotEngine\nexport let pivotEngine;\n// Store filtered data\nlet filteredData = [...sampleData];\nlet showProcessedData = true;\nlet currentViewMode = 'processed'; // 'raw' or 'processed'\n\n// Manage pagination state locally\nlet paginationState = {\n  currentPage: 1,\n  pageSize: 10,\n  totalPages: 1,\n};\n\nlet cellFormatter = null;\nlet selectedCells = new Set();\n\n// Cell formatting configuration\nconst CellFormatConfig = {\n  textAlign: 'left',\n  fontWeight: 'normal',\n  fontStyle: 'normal',\n  fontSize: '14px',\n  fontFamily: 'Arial, sans-serif',\n  color: '#000000',\n  backgroundColor: '#ffffff',\n  chooseValue: 'none',\n  thousandSeparator: ' ',\n  decimalSeparator: '.',\n  decimalPlaces: 2,\n  currencySymbol: '$',\n  currencyAlign: 'left',\n  nullValue: '',\n  formatAsPercent: false,\n};\n\n// Initialize filter fields\n// function initializeFilters() {\n//   const filterField = document.getElementById('filterField');\n//   filterField.innerHTML = `\n//         <option value=\"product\">Product</option>\n//         <option value=\"region\">Region</option>\n//         <option value=\"sales\">Sales</option>\n//         <option value=\"quantity\">Quantity</option>\n//         <option value=\"date\">Date</option>\n//     `;\n\n//   const filterOperator = document.getElementById('filterOperator');\n//   filterOperator.innerHTML = `\n//         <option value=\"equals\">Equals</option>\n//         <option value=\"contains\">Contains</option>\n//         <option value=\"greaterThan\">Greater Than</option>\n//         <option value=\"lessThan\">Less Than</option>\n//     `;\n// }\n\nfunction initializeFilters() {\n  const filterField = document.getElementById('filterField');\n  filterField.innerHTML = `\n    <option value=\"country\">Country</option>\n    <option value=\"category\">Category</option>\n    <option value=\"price\">Price</option>\n    <option value=\"discount\">Discount</option>\n  `;\n\n  const filterOperator = document.getElementById('filterOperator');\n  filterOperator.innerHTML = `\n    <option value=\"equals\">Equals</option>\n    <option value=\"contains\">Contains</option>\n    <option value=\"greaterThan\">Greater Than</option>\n    <option value=\"lessThan\">Less Than</option>\n  `;\n}\n\n// Apply filter to data\n\n// Replace your applyFilter function with this fixed version:\nfunction applyFilter(data, filter) {\n  const newFilteredData = data.filter(item => {\n    const fieldValue = item[filter.field];\n\n    switch (filter.operator) {\n      case 'equals':\n        return fieldValue === filter.value;\n      case 'contains':\n        return String(fieldValue)\n          .toLowerCase()\n          .includes(String(filter.value).toLowerCase());\n      case 'greaterThan':\n        return parseFloat(fieldValue) > parseFloat(filter.value);\n      case 'lessThan':\n        return parseFloat(fieldValue) < parseFloat(filter.value);\n      default:\n        return true;\n    }\n  });\n\n  // Update the global filteredData variable\n  filteredData = newFilteredData;\n\n  // Create a new PivotEngine instance with the filtered data\n  pivotEngine = new PivotEngine({\n    ...config,\n    data: newFilteredData,\n  });\n\n  return newFilteredData;\n}\n\n// Get paginated data\nfunction getPaginatedData(data, paginationState) {\n  const start = (paginationState.currentPage - 1) * paginationState.pageSize;\n  const end = start + paginationState.pageSize;\n  return data.slice(start, end);\n}\n\n// Helper function to create sort icons\nfunction createSortIcon(field, currentSortConfig) {\n  const sortIcon = document.createElement('span');\n  sortIcon.style.marginLeft = '5px';\n  sortIcon.style.display = 'inline-block';\n\n  // Check if this field is currently being sorted\n  const isCurrentlySorted =\n    currentSortConfig && currentSortConfig.field === field;\n\n  if (isCurrentlySorted) {\n    // Show the appropriate icon based on sort direction\n    if (currentSortConfig.direction === 'asc') {\n      sortIcon.innerHTML = '&#9650;'; // Up arrow\n      sortIcon.title = 'Sorted ascending';\n    } else {\n      sortIcon.innerHTML = '&#9660;'; // Down arrow\n      sortIcon.title = 'Sorted descending';\n    }\n    sortIcon.style.color = '#007bff'; // Highlight the active sort\n  } else {\n    // Show a neutral icon for unsorted fields\n    sortIcon.innerHTML = '&#8693;'; // Up/down arrow\n    sortIcon.title = 'Click to sort';\n    sortIcon.style.color = '#6c757d';\n    sortIcon.style.opacity = '0.5';\n  }\n\n  return sortIcon;\n}\n\n// Cell Formatter Class - ADD THIS ENTIRE CLASS\n// REPLACE your existing CellFormatter class with this enhanced version\n\nclass CellFormatter {\n  constructor() {\n    this.currentFormat = { ...CellFormatConfig };\n    this.selectedCells = new Set();\n    this.formatHistory = new Map();\n  }\n\n  // Enhanced formatNumber with all separator options\n  formatNumber(value, config) {\n    if (value === null || value === undefined || value === '') {\n      return config.nullValue || '';\n    }\n\n    let num = parseFloat(value);\n    if (isNaN(num)) return value;\n\n    // Handle percentage\n    if (config.formatAsPercent) {\n      num = num * 100;\n    }\n\n    // Apply decimal places\n    const decimalPlaces = config.decimalPlaces || 2;\n    num = num.toFixed(decimalPlaces);\n\n    // Split into integer and decimal parts\n    let [integerPart, decimalPart] = num.split('.');\n\n    // Apply thousand separator\n    if (config.thousandSeparator && config.thousandSeparator !== 'none') {\n      let separator = config.thousandSeparator;\n      // Convert display names to actual separators\n      if (separator === '(Space)') separator = ' ';\n      if (separator === '(Comma)') separator = ',';\n      if (separator === '(Dot)') separator = '.';\n\n      integerPart = integerPart.replace(/\\B(?=(\\d{3})+(?!\\d))/g, separator);\n    }\n\n    // Combine parts with decimal separator\n    let formattedNumber = integerPart;\n    if (decimalPart && decimalPlaces > 0) {\n      let decSeparator = config.decimalSeparator || '.';\n      // Convert display names to actual separators\n      if (decSeparator === '. (Dot)') decSeparator = '.';\n      if (decSeparator === ', (Comma)') decSeparator = ',';\n\n      formattedNumber += decSeparator + decimalPart;\n    }\n\n    // Add currency or percentage symbol\n    if (config.chooseValue === 'currency') {\n      const symbol = this.getCurrencySymbol(config.currencySymbol);\n      formattedNumber =\n        config.currencyAlign === 'right'\n          ? formattedNumber + symbol\n          : symbol + formattedNumber;\n    } else if (config.formatAsPercent || config.chooseValue === 'percentage') {\n      formattedNumber += '%';\n    }\n\n    return formattedNumber;\n  }\n\n  // Get currency symbol from dropdown value\n  getCurrencySymbol(currencyValue) {\n    const currencyMap = {\n      '$ (Dollar)': '$',\n      '€ (Euro)': '€',\n      '£ (Pound)': '£',\n      '₹ (Rupee)': '₹',\n      '¥ (Yen)': '¥',\n    };\n    return currencyMap[currencyValue] || '$';\n  }\n\n  // Enhanced applyTextStyling with text alignment\n  applyTextStyling(element, config) {\n    if (!element) return;\n    element.style.textAlign = config.textAlign || 'left';\n    element.style.fontFamily = config.fontFamily || 'Arial, sans-serif';\n    element.style.fontSize = config.fontSize || '14px';\n    element.style.fontWeight = config.fontWeight || 'normal';\n    element.style.fontStyle = config.fontStyle || 'normal';\n    element.style.color = config.color || '#000000';\n    element.style.backgroundColor = config.backgroundColor || '#ffffff';\n  }\n\n  showFormatModal() {\n    if (this.selectedCells.size === 0) {\n      alert('Please select cells first by clicking on them while holding Ctrl');\n      return;\n    }\n\n    const modal = this.createFormatModal();\n    document.body.appendChild(modal);\n    this.setupModalEventListeners(modal);\n    this.loadCurrentFormat();\n    this.updatePreview();\n  }\n\n  // Enhanced createFormatModal with all options matching the screenshot\n  createFormatModal() {\n    const modal = document.createElement('div');\n    modal.id = 'formatCellModal';\n    modal.className = 'format-modal';\n    modal.innerHTML = `\n      <div class=\"format-modal-content\">\n        <div class=\"format-modal-header\">\n          <h3>Format cells</h3>\n          <button id=\"closeFormatModal\" class=\"format-close-btn\">&times;</button>\n        </div>\n        \n        <div class=\"format-modal-body\">\n          <!-- Choose Value -->\n          <div class=\"format-section\">\n            <label for=\"chooseValue\">CHOOSE VALUE</label>\n            <select id=\"chooseValue\" class=\"format-select\">\n              <option value=\"none\">Choose value</option>\n              <option value=\"currency\">Currency</option>\n              <option value=\"number\">Number</option>\n              <option value=\"percentage\">Percentage</option>\n              <option value=\"text\">Text</option>\n              <option value=\"date\">Date</option>\n            </select>\n          </div>\n\n          <!-- Text Align -->\n          <div class=\"format-section\">\n            <label for=\"textAlign\">Text align</label>\n            <select id=\"textAlign\" class=\"format-select\">\n              <option value=\"left\">left</option>\n              <option value=\"center\">center</option>\n              <option value=\"right\">right</option>\n            </select>\n          </div>\n\n          <!-- Thousand Separator -->\n          <div class=\"format-section\">\n            <label for=\"thousandSeparator\">Thousand separator</label>\n            <select id=\"thousandSeparator\" class=\"format-select\">\n              <option value=\"(Space)\">(Space)</option>\n              <option value=\"(Comma)\">(Comma)</option>\n              <option value=\"(Dot)\">(Dot)</option>\n              <option value=\"none\">None</option>\n            </select>\n          </div>\n\n          <!-- Decimal Separator -->\n          <div class=\"format-section\">\n            <label for=\"decimalSeparator\">Decimal separator</label>\n            <select id=\"decimalSeparator\" class=\"format-select\">\n              <option value=\". (Dot)\">. (Dot)</option>\n              <option value=\", (Comma)\">, (Comma)</option>\n            </select>\n          </div>\n\n          <!-- Decimal Places -->\n          <div class=\"format-section\">\n            <label for=\"decimalPlaces\">Decimal places</label>\n            <select id=\"decimalPlaces\" class=\"format-select\">\n              <option value=\"none\">None</option>\n              <option value=\"0\">0</option>\n              <option value=\"1\">1</option>\n              <option value=\"2\" selected>2</option>\n              <option value=\"3\">3</option>\n              <option value=\"4\">4</option>\n            </select>\n          </div>\n\n          <!-- Currency Symbol -->\n          <div class=\"format-section currency-section\" style=\"display: none;\">\n            <label for=\"currencySymbol\">Currency symbol</label>\n            <select id=\"currencySymbol\" class=\"format-select\">\n              <option value=\"$ (Dollar)\">$ (Dollar)</option>\n              <option value=\"€ (Euro)\">€ (Euro)</option>\n              <option value=\"£ (Pound)\">£ (Pound)</option>\n              <option value=\"₹ (Rupee)\">₹ (Rupee)</option>\n              <option value=\"¥ (Yen)\">¥ (Yen)</option>\n            </select>\n          </div>\n\n          <!-- Currency Align -->\n          <div class=\"format-section currency-section\" style=\"display: none;\">\n            <label for=\"currencyAlign\">Currency align</label>\n            <select id=\"currencyAlign\" class=\"format-select\">\n              <option value=\"left\">left</option>\n              <option value=\"right\">right</option>\n            </select>\n          </div>\n\n          <!-- Null Value -->\n          <div class=\"format-section\">\n            <label for=\"nullValue\">Null value</label>\n            <input type=\"text\" id=\"nullValue\" class=\"format-input\" placeholder=\"What to show for empty values\">\n          </div>\n\n          <!-- Format as Percent -->\n          <div class=\"format-section\">\n            <label for=\"formatAsPercent\">Format as percent</label>\n            <select id=\"formatAsPercent\" class=\"format-select\">\n              <option value=\"false\">false</option>\n              <option value=\"true\">true</option>\n            </select>\n          </div>\n\n          <!-- Font Styling -->\n          <div class=\"format-section\">\n            <label>Font Style</label>\n            <div class=\"font-controls\">\n              <select id=\"fontFamily\" class=\"format-select\">\n                <option value=\"Arial, sans-serif\">Arial</option>\n                <option value=\"Helvetica, sans-serif\">Helvetica</option>\n                <option value=\"Times New Roman, serif\">Times New Roman</option>\n                <option value=\"Courier New, monospace\">Courier New</option>\n              </select>\n              <select id=\"fontSize\" class=\"format-select\">\n                <option value=\"12px\">12px</option>\n                <option value=\"14px\" selected>14px</option>\n                <option value=\"16px\">16px</option>\n                <option value=\"18px\">18px</option>\n              </select>\n              <button type=\"button\" id=\"boldToggle\" class=\"format-btn\">B</button>\n              <button type=\"button\" id=\"italicToggle\" class=\"format-btn\">I</button>\n            </div>\n          </div>\n\n          <!-- Colors -->\n          <div class=\"format-section\">\n            <label>Colors</label>\n            <div class=\"color-controls\">\n              <div class=\"color-control\">\n                <label for=\"textColor\">Text Color:</label>\n                <input type=\"color\" id=\"textColor\" value=\"#000000\">\n              </div>\n              <div class=\"color-control\">\n                <label for=\"backgroundColor\">Background:</label>\n                <input type=\"color\" id=\"backgroundColor\" value=\"#ffffff\">\n              </div>\n            </div>\n          </div>\n\n          <!-- Preview Section -->\n          <div class=\"format-section\">\n            <label>Preview</label>\n            <div id=\"formatPreview\" class=\"format-preview\">1234.56</div>\n          </div>\n        </div>\n\n        <div class=\"format-modal-footer\">\n          <button id=\"applyFormat\" class=\"format-apply-btn\">APPLY</button>\n          <button id=\"cancelFormat\" class=\"format-cancel-btn\">CANCEL</button>\n        </div>\n      </div>\n    `;\n    return modal;\n  }\n\n  // Enhanced setupModalEventListeners\n  setupModalEventListeners(modal) {\n    // Close handlers\n    modal\n      .querySelector('#closeFormatModal')\n      .addEventListener('click', () => modal.remove());\n    modal\n      .querySelector('#cancelFormat')\n      .addEventListener('click', () => modal.remove());\n\n    // Apply handler\n    modal.querySelector('#applyFormat').addEventListener('click', () => {\n      this.applyFormat();\n      modal.remove();\n    });\n\n    // Input change handlers\n    const inputs = modal.querySelectorAll('select, input');\n    inputs.forEach(input => {\n      input.addEventListener('change', () => {\n        this.updateFormatFromInputs();\n        this.updatePreview();\n      });\n      input.addEventListener('input', () => {\n        this.updateFormatFromInputs();\n        this.updatePreview();\n      });\n    });\n\n    // Font style toggles\n    const boldToggle = modal.querySelector('#boldToggle');\n    const italicToggle = modal.querySelector('#italicToggle');\n\n    boldToggle.addEventListener('click', () => {\n      boldToggle.classList.toggle('active');\n      this.currentFormat.fontWeight = boldToggle.classList.contains('active')\n        ? 'bold'\n        : 'normal';\n      this.updatePreview();\n    });\n\n    italicToggle.addEventListener('click', () => {\n      italicToggle.classList.toggle('active');\n      this.currentFormat.fontStyle = italicToggle.classList.contains('active')\n        ? 'italic'\n        : 'normal';\n      this.updatePreview();\n    });\n\n    // Show/hide currency sections based on choose value\n    modal.querySelector('#chooseValue').addEventListener('change', e => {\n      this.toggleCurrencyFields();\n      this.updatePreview();\n    });\n  }\n\n  // Enhanced updateFormatFromInputs\n  updateFormatFromInputs() {\n    const modal = document.getElementById('formatCellModal');\n    if (!modal) return;\n\n    this.currentFormat = {\n      ...this.currentFormat,\n      chooseValue: modal.querySelector('#chooseValue').value,\n      textAlign: modal.querySelector('#textAlign').value,\n      thousandSeparator: modal.querySelector('#thousandSeparator').value,\n      decimalSeparator: modal.querySelector('#decimalSeparator').value,\n      decimalPlaces:\n        modal.querySelector('#decimalPlaces').value === 'none'\n          ? 0\n          : parseInt(modal.querySelector('#decimalPlaces').value),\n      currencySymbol: modal.querySelector('#currencySymbol').value,\n      currencyAlign: modal.querySelector('#currencyAlign').value,\n      nullValue: modal.querySelector('#nullValue').value,\n      formatAsPercent: modal.querySelector('#formatAsPercent').value === 'true',\n      fontFamily: modal.querySelector('#fontFamily').value,\n      fontSize: modal.querySelector('#fontSize').value,\n      color: modal.querySelector('#textColor').value,\n      backgroundColor: modal.querySelector('#backgroundColor').value,\n    };\n  }\n\n  // Toggle currency-specific fields\n  toggleCurrencyFields() {\n    const currencySections = document.querySelectorAll('.currency-section');\n    const isCurrency = this.currentFormat.chooseValue === 'currency';\n\n    currencySections.forEach(section => {\n      section.style.display = isCurrency ? 'block' : 'none';\n    });\n  }\n\n  // Enhanced updatePreview\n  updatePreview() {\n    const preview = document.getElementById('formatPreview');\n    if (!preview) return;\n\n    // Sample value for preview\n    const sampleValue = 1234.56;\n    const formattedValue = this.formatNumber(sampleValue, this.currentFormat);\n\n    preview.textContent = formattedValue;\n    this.applyTextStyling(preview, this.currentFormat);\n  }\n\n  // Load current format into modal\n  loadCurrentFormat() {\n    const modal = document.getElementById('formatCellModal');\n    if (!modal) return;\n\n    // Set all input values\n    modal.querySelector('#chooseValue').value =\n      this.currentFormat.chooseValue || 'none';\n    modal.querySelector('#textAlign').value =\n      this.currentFormat.textAlign || 'left';\n    modal.querySelector('#thousandSeparator').value =\n      this.currentFormat.thousandSeparator || '(Space)';\n    modal.querySelector('#decimalSeparator').value =\n      this.currentFormat.decimalSeparator || '. (Dot)';\n    modal.querySelector('#decimalPlaces').value =\n      this.currentFormat.decimalPlaces === 0\n        ? 'none'\n        : this.currentFormat.decimalPlaces || 2;\n    modal.querySelector('#currencySymbol').value =\n      this.currentFormat.currencySymbol || '$ (Dollar)';\n    modal.querySelector('#currencyAlign').value =\n      this.currentFormat.currencyAlign || 'left';\n    modal.querySelector('#nullValue').value =\n      this.currentFormat.nullValue || '';\n    modal.querySelector('#formatAsPercent').value = this.currentFormat\n      .formatAsPercent\n      ? 'true'\n      : 'false';\n    modal.querySelector('#fontFamily').value =\n      this.currentFormat.fontFamily || 'Arial, sans-serif';\n    modal.querySelector('#fontSize').value =\n      this.currentFormat.fontSize || '14px';\n    modal.querySelector('#textColor').value =\n      this.currentFormat.color || '#000000';\n    modal.querySelector('#backgroundColor').value =\n      this.currentFormat.backgroundColor || '#ffffff';\n\n    // Set font style toggles\n    const boldToggle = modal.querySelector('#boldToggle');\n    const italicToggle = modal.querySelector('#italicToggle');\n\n    if (this.currentFormat.fontWeight === 'bold') {\n      boldToggle.classList.add('active');\n    }\n    if (this.currentFormat.fontStyle === 'italic') {\n      italicToggle.classList.add('active');\n    }\n\n    this.toggleCurrencyFields();\n  }\n\n  // Apply format to selected cells\n  applyFormat() {\n    this.selectedCells.forEach(cellSelector => {\n      const cell = document.querySelector(cellSelector);\n      if (cell) {\n        const originalValue = cell.dataset.originalValue || cell.textContent;\n        cell.dataset.originalValue = originalValue;\n\n        const formattedValue = this.formatNumber(\n          originalValue,\n          this.currentFormat\n        );\n        cell.textContent = formattedValue;\n        this.applyTextStyling(cell, this.currentFormat);\n\n        this.formatHistory.set(cellSelector, { ...this.currentFormat });\n      }\n    });\n  }\n\n  // Rest of the methods remain the same...\n  addCellToSelection(cell) {\n    const selector = this.getCellSelector(cell);\n    this.selectedCells.add(selector);\n    cell.classList.add('selected-cell');\n  }\n\n  removeCellFromSelection(cell) {\n    const selector = this.getCellSelector(cell);\n    this.selectedCells.delete(selector);\n    cell.classList.remove('selected-cell');\n  }\n\n  clearSelection() {\n    document.querySelectorAll('.selected-cell').forEach(cell => {\n      cell.classList.remove('selected-cell');\n    });\n    this.selectedCells.clear();\n  }\n\n  getCellSelector(cell) {\n    const row = cell.closest('tr').rowIndex;\n    const col = cell.cellIndex;\n    return `tr:nth-child(${row + 1}) td:nth-child(${col + 1})`;\n  }\n}\n\nfunction sortRawDataByColumn(columnName, rawData) {\n  console.log(`Sorting raw data by column: ${columnName}`);\n\n  // Get current sort state\n  const currentSort = window.rawDataSort || {};\n  const direction =\n    currentSort.column === columnName && currentSort.direction === 'asc'\n      ? 'desc'\n      : 'asc';\n\n  // Sort the data\n  rawData.sort((a, b) => {\n    let aVal = a[columnName];\n    let bVal = b[columnName];\n\n    // Handle different data types\n    if (typeof aVal === 'string') aVal = aVal.toLowerCase();\n    if (typeof bVal === 'string') bVal = bVal.toLowerCase();\n\n    if (aVal < bVal) return direction === 'asc' ? -1 : 1;\n    if (aVal > bVal) return direction === 'asc' ? 1 : -1;\n    return 0;\n  });\n\n  // Store sort state\n  window.rawDataSort = { column: columnName, direction };\n\n  // Update the global data arrays to maintain sort\n  if (filteredData === rawData) {\n    filteredData = [...rawData];\n  }\n\n  console.log(`Sorted raw data by ${columnName} (${direction})`);\n  renderRawDataTable();\n}\n\nfunction swapRawDataRows(fromIndex, toIndex, rawData) {\n  console.log('Swapping raw data rows:', fromIndex, '->', toIndex);\n\n  if (\n    fromIndex < 0 ||\n    toIndex < 0 ||\n    fromIndex >= rawData.length ||\n    toIndex >= rawData.length\n  ) {\n    console.error('Invalid row indices for raw data swap');\n    return;\n  }\n\n  // Swap the rows in the raw data array\n  const temp = rawData[fromIndex];\n  rawData[fromIndex] = rawData[toIndex];\n  rawData[toIndex] = temp;\n\n  // Update filteredData if it's the same reference\n  if (\n    filteredData === rawData ||\n    (filteredData && filteredData.length === rawData.length)\n  ) {\n    filteredData = [...rawData];\n  }\n\n  console.log('Raw data rows swapped successfully');\n}\n\n// Keep existing swapRawDataColumns function or add this if missing:\nfunction swapRawDataColumns(fromIndex, toIndex) {\n  // Store the column order preference for raw data\n  if (!window.rawDataColumnOrder) {\n    const rawData = filteredData.length > 0 ? filteredData : sampleData;\n    const headers = rawData.length > 0 ? Object.keys(rawData[0]) : [];\n    window.rawDataColumnOrder = [...headers];\n  }\n\n  // Swap in the column order array\n  const temp = window.rawDataColumnOrder[fromIndex];\n  window.rawDataColumnOrder[fromIndex] = window.rawDataColumnOrder[toIndex];\n  window.rawDataColumnOrder[toIndex] = temp;\n\n  console.log('Raw data column order updated:', window.rawDataColumnOrder);\n}\n\nfunction renderRawDataTable() {\n  try {\n    console.log('Rendering raw data table');\n\n    // Get data source\n    let rawDataToUse;\n    if (filteredData && filteredData.length > 0) {\n      rawDataToUse = filteredData;\n      console.log(\n        'Using filteredData for raw view:',\n        filteredData.length,\n        'items'\n      );\n    } else if (sampleData && sampleData.length > 0) {\n      rawDataToUse = sampleData;\n      console.log('Using sampleData for raw view:', sampleData.length, 'items');\n    } else {\n      const state = pivotEngine.getState();\n      rawDataToUse = state.data || state.rawData || [];\n      console.log(\n        'Using engine data for raw view:',\n        rawDataToUse.length,\n        'items'\n      );\n    }\n\n    if (!rawDataToUse || rawDataToUse.length === 0) {\n      console.error('No raw data available');\n      const tableContainer = document.getElementById('myTable');\n      tableContainer.innerHTML =\n        '<div style=\"padding: 20px;\">No data available to display.</div>';\n      return;\n    }\n\n    console.log(\n      'Rendering raw data table with',\n      rawDataToUse.length,\n      'total items'\n    );\n\n    const tableContainer = document.getElementById('myTable');\n    tableContainer.innerHTML = '';\n\n    const table = document.createElement('table');\n    table.style.width = '100%';\n    table.style.borderCollapse = 'collapse';\n    table.style.marginTop = '20px';\n    table.style.border = '1px solid #dee2e6';\n\n    // Get headers\n    const headers = rawDataToUse.length > 0 ? Object.keys(rawDataToUse[0]) : [];\n    console.log('Raw data headers:', headers);\n\n    // Create table header\n    const thead = document.createElement('thead');\n    const headerRow = document.createElement('tr');\n\n    headers.forEach((headerText, index) => {\n      const th = document.createElement('th');\n      th.style.padding = '12px';\n      th.style.backgroundColor = '#f8f9fa';\n      th.style.borderBottom = '2px solid #dee2e6';\n      th.style.borderRight = '1px solid #dee2e6';\n      th.style.cursor = 'pointer';\n      th.style.position = 'relative';\n\n      th.setAttribute('draggable', 'true');\n      th.dataset.columnIndex = index;\n      th.dataset.columnName = headerText;\n      th.className = 'raw-data-header';\n\n      const headerContent = document.createElement('div');\n      headerContent.style.display = 'flex';\n      headerContent.style.alignItems = 'center';\n      headerContent.style.justifyContent = 'space-between';\n\n      const headerSpan = document.createElement('span');\n      headerSpan.textContent = getFieldDisplayName(headerText);\n      headerContent.appendChild(headerSpan);\n\n      const sortIcon = document.createElement('span');\n      sortIcon.innerHTML = '↕️';\n      sortIcon.style.marginLeft = '5px';\n      sortIcon.style.fontSize = '12px';\n      headerContent.appendChild(sortIcon);\n\n      th.appendChild(headerContent);\n\n      th.addEventListener('click', () => {\n        sortRawDataByColumn(headerText, rawDataToUse);\n      });\n\n      headerRow.appendChild(th);\n    });\n\n    thead.appendChild(headerRow);\n    table.appendChild(thead);\n\n    // FIXED: Only update pagination once, here\n    updateRawDataPagination(rawDataToUse);\n\n    // Get paginated data\n    const paginatedData = getPaginatedData(rawDataToUse, paginationState);\n    console.log(\n      'Paginated raw data:',\n      paginatedData.length,\n      'items out of',\n      rawDataToUse.length,\n      'total'\n    );\n\n    // Create table body\n    const tbody = document.createElement('tbody');\n\n    paginatedData.forEach((rowData, rowIndex) => {\n      const tr = document.createElement('tr');\n      tr.dataset.rowIndex = rowIndex;\n      tr.dataset.globalIndex = rawDataToUse.indexOf(rowData);\n      tr.setAttribute('draggable', 'true');\n      tr.style.cursor = 'move';\n      tr.className = 'raw-data-row';\n\n      headers.forEach(header => {\n        const td = document.createElement('td');\n        td.style.padding = '8px';\n        td.style.borderBottom = '1px solid #dee2e6';\n        td.style.borderRight = '1px solid #dee2e6';\n\n        let cellValue = rowData[header];\n        if (cellValue === null || cellValue === undefined) {\n          cellValue = '';\n        } else if (typeof cellValue === 'number') {\n          if (\n            header === 'price' ||\n            header === 'sales' ||\n            header === 'revenue' ||\n            header === 'discount'\n          ) {\n            cellValue = new Intl.NumberFormat('en-US', {\n              style: 'currency',\n              currency: 'USD',\n            }).format(cellValue);\n          } else if (typeof cellValue === 'number' && cellValue % 1 !== 0) {\n            cellValue = cellValue.toFixed(2);\n          }\n        }\n\n        td.textContent = cellValue;\n        tr.appendChild(td);\n      });\n\n      tbody.appendChild(tr);\n    });\n\n    table.appendChild(tbody);\n    tableContainer.appendChild(table);\n\n    // Update pagination info\n    updatePaginationInfo('Raw Data');\n\n    // Set up drag and drop\n    setupRawDataDragAndDrop(rawDataToUse);\n  } catch (error) {\n    console.error('Error rendering raw data table:', error);\n    const tableContainer = document.getElementById('myTable');\n    tableContainer.innerHTML = `<div style=\"color: red; padding: 20px;\">Error rendering raw data table: ${error.message}</div>`;\n  }\n}\n\nfunction updateRawDataPagination(rawData) {\n  // Get pageSize from the select element, with fallback\n  const pageSizeElement = document.getElementById('pageSize');\n  const pageSize = pageSizeElement ? Number(pageSizeElement.value) : 10;\n  const totalPages = Math.ceil(rawData.length / pageSize) || 1;\n\n  console.log(\n    'updateRawDataPagination - Total raw data items:',\n    rawData.length\n  );\n  console.log('updateRawDataPagination - Page size:', pageSize);\n  console.log('updateRawDataPagination - Total pages:', totalPages);\n\n  // FIXED: Only reset to first page when explicitly needed, not on every call\n  // Check if current page is valid for new pagination\n  if (paginationState.currentPage > totalPages) {\n    paginationState.currentPage = Math.max(1, totalPages);\n  }\n\n  paginationState.pageSize = pageSize;\n  paginationState.totalPages = totalPages;\n\n  console.log('Updated pagination state for raw data:', paginationState);\n}\n\n// Add this new function to ensure data consistency:\nfunction ensureDataConsistency() {\n  const state = pivotEngine.getState();\n  console.log('Checking data consistency:');\n  console.log('- sampleData length:', sampleData.length);\n  console.log('- filteredData length:', filteredData.length);\n  console.log('- state.data length:', state.data.length);\n  console.log('- state.rawData length:', state.rawData.length);\n\n  // FIXED: Only reinitialize if there's a significant data loss\n  const hasSignificantInconsistency =\n    Math.abs(state.rawData.length - filteredData.length) > 50;\n\n  if (hasSignificantInconsistency) {\n    console.log(\n      'Significant data inconsistency detected, preserving custom orders during reinit...'\n    );\n\n    // FIXED: Preserve both row and column custom orders\n    const customColumnOrder =\n      pivotEngine.getOrderedColumnValues &&\n      pivotEngine.getOrderedColumnValues();\n    const customRowOrder =\n      pivotEngine.getOrderedRowValues && pivotEngine.getOrderedRowValues();\n    const preservedColumnOrder = customColumnOrder || window.swappedColumnOrder;\n    const preservedRowOrder = customRowOrder || window.swappedRowOrder;\n\n    console.log('Preserving column order:', preservedColumnOrder);\n    console.log('Preserving row order:', preservedRowOrder);\n\n    // Reinitialize the engine with full data\n    pivotEngine = new PivotEngine({\n      ...config,\n      data: filteredData,\n    });\n\n    // FIXED: Restore custom orders using the core engine methods\n    if (preservedColumnOrder && preservedColumnOrder.length > 0) {\n      console.log('Restoring preserved column order:', preservedColumnOrder);\n      const columnFieldName = pivotEngine.getColumnFieldName();\n      pivotEngine.setCustomFieldOrder(\n        columnFieldName,\n        preservedColumnOrder,\n        false\n      );\n      window.swappedColumnOrder = preservedColumnOrder;\n    }\n\n    if (preservedRowOrder && preservedRowOrder.length > 0) {\n      console.log('Restoring preserved row order:', preservedRowOrder);\n      const rowFieldName = pivotEngine.getRowFieldName();\n      pivotEngine.setCustomFieldOrder(rowFieldName, preservedRowOrder, true);\n      window.swappedRowOrder = preservedRowOrder;\n    }\n  } else {\n    console.log('Data consistency acceptable, no reinit needed');\n  }\n}\n\n// function getOrderedRegions(state) {\n//   // First try to get custom region order from the pivot engine\n//   if (pivotEngine.getCustomRegionOrder) {\n//     const customOrder = pivotEngine.getCustomRegionOrder();\n//     if (customOrder && customOrder.length > 0) {\n//       console.log('Using custom region order from engine:', customOrder);\n//       return customOrder;\n//     }\n//   }\n\n//   // Check if the state has custom region order\n//   if (state.customRegionOrder && state.customRegionOrder.length > 0) {\n//     console.log(\n//       'Using custom region order from state:',\n//       state.customRegionOrder\n//     );\n//     return state.customRegionOrder;\n//   }\n\n//   // Fall back to swapped region order if available\n//   if (window.swappedRegionOrder && window.swappedRegionOrder.length > 0) {\n//     console.log('Using swapped region order:', window.swappedRegionOrder);\n//     return window.swappedRegionOrder;\n//   }\n\n//   const uniqueRegions = [...new Set(state.rawData.map(item => item.region))];\n//   console.log('Using natural region order:', uniqueRegions);\n//   return uniqueRegions;\n// }\n\n// Add drag and drop functionality for raw data:\n// FIXED: Add the getOrderedCategories function (similar to getOrderedRegions)\n// function getOrderedCategories(state) {\n//   // First try to get custom category order from the pivot engine\n//   if (pivotEngine.getCustomRegionOrder) {\n//     const customOrder = pivotEngine.getCustomRegionOrder();\n//     if (customOrder && customOrder.length > 0) {\n//       console.log('Using custom category order from engine:', customOrder);\n//       return customOrder;\n//     }\n//   }\n\n//   // Check if the state has custom category order\n//   if ((state).customRegionOrder && (state).customRegionOrder.length > 0) {\n//     console.log('Using custom category order from state:', (state).customRegionOrder);\n//     return (state).customRegionOrder;\n//   }\n\n//   // Fall back to swapped category order if available\n//   if (window.swappedRegionOrder && window.swappedRegionOrder.length > 0) {\n//     console.log('Using swapped category order:', window.swappedRegionOrder);\n//     return window.swappedRegionOrder;\n//   }\n\n//   const uniqueCategories = [...new Set(state.rawData.map(item => item.category).filter(category => category))];\n//   console.log('Using natural category order:', uniqueCategories);\n//   return uniqueCategories;\n// }\n\n// Generic function to get ordered column values (replaces getOrderedCategories)\nfunction getOrderedColumnValues(state) {\n  const columnFieldName = pivotEngine.getColumnFieldName();\n  if (!columnFieldName) {\n    console.warn('No column field configured');\n    return [];\n  }\n\n  // Check for custom order from engine\n  const customOrder =\n    pivotEngine.getOrderedColumnValues && pivotEngine.getOrderedColumnValues();\n  if (customOrder && customOrder.length > 0) {\n    console.log(\n      `Using custom ${columnFieldName} order from engine:`,\n      customOrder\n    );\n    return customOrder;\n  }\n\n  // Check engine state for custom order\n  if (\n    state.customColumnOrder &&\n    state.customColumnOrder.fieldName === columnFieldName\n  ) {\n    console.log(\n      `Using custom ${columnFieldName} order from state:`,\n      state.customColumnOrder.order\n    );\n    return state.customColumnOrder.order;\n  }\n\n  // Check window storage\n  if (window.swappedColumnOrder && window.swappedColumnOrder.length > 0) {\n    console.log(\n      `Using swapped ${columnFieldName} order:`,\n      window.swappedColumnOrder\n    );\n    return window.swappedColumnOrder;\n  }\n\n  // Use natural order\n  const uniqueValues = pivotEngine.getUniqueFieldValues(columnFieldName);\n  console.log(`Using natural ${columnFieldName} order:`, uniqueValues);\n  return uniqueValues;\n}\n\n// Generic function to get ordered row values\nfunction getOrderedRowValues(state) {\n  // Get the row field name from configuration\n  const rowFieldName = pivotEngine.getRowFieldName();\n  if (!rowFieldName) {\n    console.warn('No row field configured');\n    return [];\n  }\n\n  // First try to get custom row order from the pivot engine\n  const customOrder = pivotEngine.getOrderedRowValues();\n  if (customOrder && customOrder.length > 0) {\n    console.log(`Using custom ${rowFieldName} order from engine:`, customOrder);\n    return customOrder;\n  }\n\n  // Fall back to swapped order if available\n  if (window.swappedRowOrder && window.swappedRowOrder.length > 0) {\n    console.log(`Using swapped ${rowFieldName} order:`, window.swappedRowOrder);\n    return window.swappedRowOrder;\n  }\n\n  // Use natural order from data\n  const uniqueValues = pivotEngine.getUniqueFieldValues(rowFieldName);\n  console.log(`Using natural ${rowFieldName} order:`, uniqueValues);\n  return uniqueValues;\n}\n\nfunction setupRawDataDragAndDrop(rawData) {\n  console.log(\n    'Setting up raw data drag and drop with',\n    rawData.length,\n    'items'\n  );\n\n  // Column drag and drop for raw data\n  const headers = document.querySelectorAll(\n    '.raw-data-header[draggable=\"true\"]'\n  );\n  let draggedColumnIndex = null;\n\n  headers.forEach(header => {\n    const columnIndex = parseInt(header.dataset.columnIndex);\n    const columnName = header.dataset.columnName;\n\n    header.addEventListener('dragstart', e => {\n      draggedColumnIndex = columnIndex;\n      e.dataTransfer.setData('text/plain', columnName);\n      setTimeout(() => header.classList.add('dragging'), 0);\n      console.log(\n        'Raw data column drag started:',\n        columnName,\n        'Index:',\n        columnIndex\n      );\n    });\n\n    header.addEventListener('dragend', () => {\n      header.classList.remove('dragging');\n      draggedColumnIndex = null;\n    });\n\n    header.addEventListener('dragover', e => {\n      e.preventDefault();\n    });\n\n    header.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedColumnIndex !== null && draggedColumnIndex !== columnIndex) {\n        header.classList.add('drag-over');\n      }\n    });\n\n    header.addEventListener('dragleave', () => {\n      header.classList.remove('drag-over');\n    });\n\n    header.addEventListener('drop', e => {\n      e.preventDefault();\n      header.classList.remove('drag-over');\n\n      const targetColumnIndex = columnIndex;\n\n      if (\n        draggedColumnIndex !== null &&\n        draggedColumnIndex !== targetColumnIndex\n      ) {\n        console.log(\n          `Swapping raw data columns ${draggedColumnIndex} with ${targetColumnIndex}`\n        );\n        swapRawDataColumns(draggedColumnIndex, targetColumnIndex);\n        renderRawDataTable();\n      }\n    });\n  });\n\n  // Row drag and drop for raw data\n  const rows = document.querySelectorAll('.raw-data-row[draggable=\"true\"]');\n  let draggedRowIndex = null;\n\n  rows.forEach(row => {\n    const rowIndex = parseInt(row.dataset.rowIndex);\n    const globalIndex = parseInt(row.dataset.globalIndex);\n\n    row.addEventListener('dragstart', e => {\n      draggedRowIndex = globalIndex;\n      e.dataTransfer.setData('text/plain', rowIndex.toString());\n      setTimeout(() => row.classList.add('dragging'), 0);\n      console.log('Raw data row drag started. Global index:', globalIndex);\n    });\n\n    row.addEventListener('dragend', () => {\n      row.classList.remove('dragging');\n      draggedRowIndex = null;\n    });\n\n    row.addEventListener('dragover', e => {\n      e.preventDefault();\n    });\n\n    row.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedRowIndex !== null && draggedRowIndex !== globalIndex) {\n        row.classList.add('drag-over');\n      }\n    });\n\n    row.addEventListener('dragleave', () => {\n      row.classList.remove('drag-over');\n    });\n\n    row.addEventListener('drop', e => {\n      e.preventDefault();\n      row.classList.remove('drag-over');\n\n      const targetRowIndex = globalIndex;\n\n      if (draggedRowIndex !== null && draggedRowIndex !== targetRowIndex) {\n        console.log(\n          `Swapping raw data rows ${draggedRowIndex} with ${targetRowIndex}`\n        );\n        swapRawDataRows(draggedRowIndex, targetRowIndex, rawData);\n        renderRawDataTable();\n      }\n    });\n  });\n}\n\n// Update your renderTable function with data consistency check:\n// function renderTable() {\n\n//   // Check current view mode\n//   if (!showProcessedData || currentViewMode === 'raw') {\n//     renderRawDataTable();\n//     return;\n//   }\n\n//   try {\n//     // CRITICAL: Ensure data consistency before rendering\n//     ensureDataConsistency();\n\n//     const state = pivotEngine.getState();\n//     console.log('Current Engine State:', state);\n\n//     if (!state.processedData) {\n//       console.error('No processed data available');\n//       return;\n//     }\n\n//     const tableContainer = document.getElementById('myTable');\n\n//     // Clear previous content\n//     tableContainer.innerHTML = '';\n\n//     // Create table element\n//     const table = document.createElement('table');\n//     table.style.width = '100%';\n//     table.style.borderCollapse = 'collapse';\n//     table.style.marginTop = '20px';\n//     table.style.border = '1px solid #dee2e6';\n\n//     // Create table header\n//     const thead = document.createElement('thead');\n\n//     // First header row for regions\n//     const regionHeaderRow = document.createElement('tr');\n\n//     // Add empty cell for top-left corner (Product/Region)\n//     const cornerCell = document.createElement('th');\n//     cornerCell.style.padding = '12px';\n//     cornerCell.style.backgroundColor = '#f8f9fa';\n//     cornerCell.style.borderBottom = '2px solid #dee2e6';\n//     cornerCell.style.borderRight = '1px solid #dee2e6';\n//     cornerCell.textContent = 'Product / Region';\n//     regionHeaderRow.appendChild(cornerCell);\n\n//     // Get unique regions from current state data\n//     // const uniqueRegions = [...new Set(state.rawData.map(item => item.region))];\n//     const uniqueRegions = getOrderedRegions(state);\n\n//     // Add region headers with colspan for measures\n//     uniqueRegions.forEach((region, index) => {\n//       const th = document.createElement('th');\n//       th.textContent = region;\n//       th.colSpan = state.measures.length;\n//       th.style.padding = '12px';\n//       th.style.backgroundColor = '#f8f9fa';\n//       th.style.borderBottom = '2px solid #dee2e6';\n//       th.style.borderRight = '1px solid #dee2e6';\n//       th.style.textAlign = 'center';\n//       th.dataset.index = index + 1;\n\n//       // Make headers draggable\n//       th.setAttribute('draggable', 'true');\n//       th.style.cursor = 'move';\n\n//       regionHeaderRow.appendChild(th);\n//     });\n\n//     thead.appendChild(regionHeaderRow);\n\n//     // Second header row for measures\n//     const measureHeaderRow = document.createElement('tr');\n\n//     // Get current sort configuration\n//     const currentSortConfig = state.sortConfig?.[0];\n\n//     // Add product header with sort icon\n//     const productHeader = document.createElement('th');\n//     productHeader.style.padding = '12px';\n//     productHeader.style.backgroundColor = '#f8f9fa';\n//     productHeader.style.borderBottom = '2px solid #dee2e6';\n//     productHeader.style.borderRight = '1px solid #dee2e6';\n//     productHeader.style.cursor = 'pointer';\n\n//     // Create a container for the header content to align text and icon\n//     const productHeaderContent = document.createElement('div');\n//     productHeaderContent.style.display = 'flex';\n//     productHeaderContent.style.alignItems = 'center';\n\n//     const productText = document.createElement('span');\n//     productText.textContent = 'Product';\n//     productHeaderContent.appendChild(productText);\n\n//     // Add sort icon for product\n//     const productSortIcon = createSortIcon('product', currentSortConfig);\n//     productHeaderContent.appendChild(productSortIcon);\n\n//     productHeader.appendChild(productHeaderContent);\n\n//     // Add sort functionality to product header\n//     productHeader.addEventListener('click', () => {\n//       const direction =\n//         currentSortConfig?.field === 'product' &&\n//         currentSortConfig?.direction === 'asc'\n//           ? 'desc'\n//           : 'asc';\n//       pivotEngine.sort('product', direction);\n//       renderTable();\n//     });\n\n//     measureHeaderRow.appendChild(productHeader);\n\n//     // Add measure headers for each region\n//     uniqueRegions.forEach(region => {\n//       state.measures.forEach(measure => {\n//         const th = document.createElement('th');\n//         th.style.padding = '12px';\n//         th.style.backgroundColor = '#f8f9fa';\n//         th.style.borderBottom = '2px solid #dee2e6';\n//         th.style.borderRight = '1px solid #dee2e6';\n//         th.style.cursor = 'pointer';\n\n//         // Create a container for the header content to align text and icon\n//         const headerContent = document.createElement('div');\n//         headerContent.style.display = 'flex';\n//         headerContent.style.alignItems = 'center';\n//         headerContent.style.justifyContent = 'space-between';\n\n//         const measureText = document.createElement('span');\n//         measureText.textContent = measure.caption;\n//         headerContent.appendChild(measureText);\n\n//         // Add sort icon for measure\n//         const sortIcon = createSortIcon(measure.uniqueName, currentSortConfig);\n//         headerContent.appendChild(sortIcon);\n\n//         th.appendChild(headerContent);\n\n//         // Add sort functionality\n//         th.addEventListener('click', () => {\n//           const direction =\n//             currentSortConfig?.field === measure.uniqueName &&\n//             currentSortConfig?.direction === 'asc'\n//               ? 'desc'\n//               : 'asc';\n//           pivotEngine.sort(measure.uniqueName, direction);\n//           renderTable();\n//         });\n\n//         measureHeaderRow.appendChild(th);\n//       });\n//     });\n\n//     thead.appendChild(measureHeaderRow);\n//     table.appendChild(thead);\n\n//     // Create table body\n//     const tbody = document.createElement('tbody');\n\n//     // CRITICAL: Get all unique products in their current order from the engine's data\n//     const allUniqueProducts = [\n//       ...new Set(state.rawData.map(item => item.product)),\n//     ];\n\n//     // Update pagination to ensure it's based on current data\n//     updatePagination(state.rawData, false);\n\n//     // Get paginated products for CURRENT PAGE ONLY\n//     const paginatedProducts = getPaginatedData(\n//       allUniqueProducts,\n//       paginationState\n//     );\n\n//     console.log('All unique products:', allUniqueProducts);\n//     console.log('Products for current page:', paginatedProducts);\n//     console.log('Current pagination state:', paginationState);\n\n//     // Add rows for ONLY the paginated products\n//     paginatedProducts.forEach((product, rowIndex) => {\n//       const tr = document.createElement('tr');\n//       tr.dataset.rowIndex = rowIndex; // This is the row index within the current page\n//       tr.dataset.product = product; // Store the product name\n//       tr.dataset.globalIndex = allUniqueProducts.indexOf(product); // Store global index\n//       tr.setAttribute('draggable', 'true');\n//       tr.style.cursor = 'move';\n\n//       // Add product cell\n//       const productCell = document.createElement('td');\n//       productCell.textContent = product;\n//       productCell.style.fontWeight = 'bold';\n//       productCell.style.padding = '8px';\n//       productCell.style.borderBottom = '1px solid #dee2e6';\n//       productCell.style.borderRight = '1px solid #dee2e6';\n//       productCell.className = 'product-cell'; // Add class for easy identification\n//       tr.appendChild(productCell);\n\n//       // Add data cells for each region and measure\n//       uniqueRegions.forEach(region => {\n//         // Filter data from state.rawData for this product and region\n//         const filteredDataForProduct = state.rawData.filter(\n//           item => item.product === product && item.region === region\n//         );\n\n//         // Add cells for each measure\n//         state.measures.forEach(measure => {\n//           const td = document.createElement('td');\n//           td.style.padding = '8px';\n//           td.style.borderBottom = '1px solid #dee2e6';\n//           td.style.borderRight = '1px solid #dee2e6';\n//           td.style.textAlign = 'right';\n\n//           // Calculate the value based on aggregation\n//           let value = 0;\n//           if (filteredDataForProduct.length > 0) {\n//             switch (measure.aggregation) {\n//               case 'sum':\n//                 value = filteredDataForProduct.reduce(\n//                   (sum, item) => sum + (item[measure.uniqueName] || 0),\n//                   0\n//                 );\n//                 break;\n//               case 'avg':\n//                 if (measure.formula) {\n//                   value =\n//                     filteredDataForProduct.reduce(\n//                       (sum, item) => sum + measure.formula(item),\n//                       0\n//                     ) / filteredDataForProduct.length;\n//                 } else {\n//                   value =\n//                     filteredDataForProduct.reduce(\n//                       (sum, item) => sum + (item[measure.uniqueName] || 0),\n//                       0\n//                     ) / filteredDataForProduct.length;\n//                 }\n//                 break;\n//               case 'max':\n//                 value = Math.max(\n//                   ...filteredDataForProduct.map(\n//                     item => item[measure.uniqueName] || 0\n//                   )\n//                 );\n//                 break;\n//               case 'min':\n//                 value = Math.min(\n//                   ...filteredDataForProduct.map(\n//                     item => item[measure.uniqueName] || 0\n//                   )\n//                 );\n//                 break;\n//               default:\n//                 value = 0;\n//             }\n//           }\n\n//           // Format the value\n//           let formattedValue = value;\n//           if (measure.format) {\n//             if (measure.format.type === 'currency') {\n//               formattedValue = new Intl.NumberFormat(measure.format.locale, {\n//                 style: 'currency',\n//                 currency: measure.format.currency,\n//                 minimumFractionDigits: measure.format.decimals,\n//                 maximumFractionDigits: measure.format.decimals,\n//               }).format(value);\n//             } else if (measure.format.type === 'number') {\n//               formattedValue = new Intl.NumberFormat(measure.format.locale, {\n//                 minimumFractionDigits: measure.format.decimals,\n//                 maximumFractionDigits: measure.format.decimals,\n//               }).format(value);\n//             }\n//           }\n\n//           // td.textContent = formattedValue;\n//           // addDrillDownToDataCell(td, product, region, measure, value, formattedValue);\n//           let cellValue = addDrillDownToDataCell(td, product, region, measure, value, formattedValue);\n//           console.log('Cell value :', cellValue);\n\n//           // Apply conditional formatting\n//           if (\n//             config.conditionalFormatting &&\n//             Array.isArray(config.conditionalFormatting)\n//           ) {\n//             config.conditionalFormatting.forEach(rule => {\n//               if (rule.value.type === 'Number' && !isNaN(value)) {\n//                 let applyFormat = false;\n\n//                 switch (rule.value.operator) {\n//                   case 'Greater than':\n//                     applyFormat = value > parseFloat(rule.value.value1);\n//                     break;\n//                   case 'Less than':\n//                     applyFormat = value < parseFloat(rule.value.value1);\n//                     break;\n//                   case 'Equal to':\n//                     applyFormat = value === parseFloat(rule.value.value1);\n//                     break;\n//                   case 'Between':\n//                     applyFormat =\n//                       value >= parseFloat(rule.value.value1) &&\n//                       value <= parseFloat(rule.value.value2);\n//                     break;\n//                 }\n\n//                 if (applyFormat) {\n//                   if (rule.format.font) td.style.fontFamily = rule.format.font;\n//                   if (rule.format.size) td.style.fontSize = rule.format.size;\n//                   if (rule.format.color) td.style.color = rule.format.color;\n//                   if (rule.format.backgroundColor)\n//                     td.style.backgroundColor = rule.format.backgroundColor;\n//                 }\n//               }\n//             });\n//           }\n\n//           tr.appendChild(td);\n//         });\n//       });\n\n//       tbody.appendChild(tr);\n//     });\n\n//     table.appendChild(tbody);\n//     tableContainer.appendChild(table);\n\n//     // Update pagination info\n//     const pageInfo = document.getElementById('pageInfo');\n//     if (pageInfo) {\n//       pageInfo.textContent = `Page ${paginationState.currentPage} of ${paginationState.totalPages}`;\n\n//       // Update button states\n//       const prevButton = document.getElementById('prevPage');\n//       const nextButton = document.getElementById('nextPage');\n//       if (prevButton) prevButton.disabled = paginationState.currentPage <= 1;\n//       if (nextButton)\n//         nextButton.disabled =\n//           paginationState.currentPage >= paginationState.totalPages;\n//     }\n\n//     // Set up drag and drop after rendering\n//     setupDragAndDrop();\n//   } catch (error) {\n//     console.error('Error rendering table:', error);\n\n//     // Display error message to user\n//     const tableContainer = document.getElementById('myTable');\n//     tableContainer.innerHTML = `<div style=\"color: red; padding: 20px;\">Error rendering table: ${error.message}</div>`;\n//   }\n// }\n\n// Generic renderTable function that works with any field names\nfunction renderTable() {\n  // Check current view mode\n  if (!showProcessedData || currentViewMode === 'raw') {\n    console.log('Rendering raw data view');\n    renderRawDataTable();\n    return;\n  }\n\n  try {\n    // CRITICAL: Ensure data consistency before rendering\n    ensureDataConsistency();\n\n    const state = pivotEngine.getState();\n    console.log('Current Engine State:', state);\n\n    if (!state.processedData) {\n      console.error('No processed data available');\n      return;\n    }\n\n    // Get field names from configuration\n    const rowFieldName = pivotEngine.getRowFieldName();\n    const columnFieldName = pivotEngine.getColumnFieldName();\n\n    if (!rowFieldName || !columnFieldName) {\n      console.error('Row or column field not configured');\n      return;\n    }\n\n    console.log(\n      `Rendering table with row field: ${rowFieldName}, column field: ${columnFieldName}`\n    );\n\n    const tableContainer = document.getElementById('myTable');\n\n    // Clear previous content\n    tableContainer.innerHTML = '';\n\n    // Create table element\n    const table = document.createElement('table');\n    table.style.width = '100%';\n    table.style.borderCollapse = 'collapse';\n    table.style.marginTop = '20px';\n    table.style.border = '1px solid #dee2e6';\n\n    // Create table header\n    const thead = document.createElement('thead');\n\n    // First header row for column values\n    const columnHeaderRow = document.createElement('tr');\n\n    // Add empty cell for top-left corner\n    const cornerCell = document.createElement('th');\n    cornerCell.style.padding = '12px';\n    cornerCell.style.backgroundColor = '#f8f9fa';\n    cornerCell.style.borderBottom = '2px solid #dee2e6';\n    cornerCell.style.borderRight = '1px solid #dee2e6';\n    cornerCell.textContent = `${getFieldDisplayName(rowFieldName)} / ${getFieldDisplayName(columnFieldName)}`;\n    columnHeaderRow.appendChild(cornerCell);\n\n    // Get unique column values\n    const uniqueColumnValues = getOrderedColumnValues(state);\n    console.log('Setting up column headers for values:', uniqueColumnValues);\n\n    // Add column headers with colspan for measures\n    uniqueColumnValues.forEach((columnValue, index) => {\n      const th = document.createElement('th');\n      th.textContent = columnValue;\n      th.colSpan = state.measures.length;\n      th.style.padding = '12px';\n      th.style.backgroundColor = '#f8f9fa';\n      th.style.borderBottom = '2px solid #dee2e6';\n      th.style.borderRight = '1px solid #dee2e6';\n      th.style.textAlign = 'center';\n      th.dataset.index = index + 1;\n      th.dataset.fieldName = columnFieldName;\n      th.dataset.fieldValue = columnValue;\n      th.dataset.columnIndex = index;\n\n      // Make headers draggable\n      th.setAttribute('draggable', 'true');\n      th.style.cursor = 'move';\n      th.className = 'column-header';\n\n      console.log(\n        `Created column header: ${columnValue}, index: ${index}, fieldName: ${columnFieldName}`\n      );\n\n      columnHeaderRow.appendChild(th);\n    });\n\n    thead.appendChild(columnHeaderRow);\n\n    // Second header row for measures\n    const measureHeaderRow = document.createElement('tr');\n\n    // Get current sort configuration\n    const currentSortConfig = state.sortConfig?.[0];\n\n    // Add row field header with sort icon\n    const rowHeader = document.createElement('th');\n    rowHeader.style.padding = '12px';\n    rowHeader.style.backgroundColor = '#f8f9fa';\n    rowHeader.style.borderBottom = '2px solid #dee2e6';\n    rowHeader.style.borderRight = '1px solid #dee2e6';\n    rowHeader.style.cursor = 'pointer';\n\n    // Create a container for the header content to align text and icon\n    const rowHeaderContent = document.createElement('div');\n    rowHeaderContent.style.display = 'flex';\n    rowHeaderContent.style.alignItems = 'center';\n\n    const rowText = document.createElement('span');\n    rowText.textContent = getFieldDisplayName(rowFieldName);\n    rowHeaderContent.appendChild(rowText);\n\n    // Add sort icon for row field\n    const rowSortIcon = createSortIcon(rowFieldName, currentSortConfig);\n    rowHeaderContent.appendChild(rowSortIcon);\n\n    rowHeader.appendChild(rowHeaderContent);\n\n    // Add sort functionality to row header\n    rowHeader.addEventListener('click', () => {\n      const direction =\n        currentSortConfig?.field === rowFieldName &&\n        currentSortConfig?.direction === 'asc'\n          ? 'desc'\n          : 'asc';\n      pivotEngine.sort(rowFieldName, direction);\n      renderTable();\n    });\n\n    measureHeaderRow.appendChild(rowHeader);\n\n    // Add measure headers for each column value\n    uniqueColumnValues.forEach(columnValue => {\n      state.measures.forEach(measure => {\n        const th = document.createElement('th');\n        th.style.padding = '12px';\n        th.style.backgroundColor = '#f8f9fa';\n        th.style.borderBottom = '2px solid #dee2e6';\n        th.style.borderRight = '1px solid #dee2e6';\n        th.style.cursor = 'pointer';\n\n        // Create a container for the header content to align text and icon\n        const headerContent = document.createElement('div');\n        headerContent.style.display = 'flex';\n        headerContent.style.alignItems = 'center';\n        headerContent.style.justifyContent = 'space-between';\n\n        const measureText = document.createElement('span');\n        measureText.textContent = measure.caption;\n        headerContent.appendChild(measureText);\n\n        // Add sort icon for measure\n        const sortIcon = createSortIcon(measure.uniqueName, currentSortConfig);\n        headerContent.appendChild(sortIcon);\n\n        th.appendChild(headerContent);\n\n        // Add sort functionality\n        th.addEventListener('click', () => {\n          const direction =\n            currentSortConfig?.field === measure.uniqueName &&\n            currentSortConfig?.direction === 'asc'\n              ? 'desc'\n              : 'asc';\n          pivotEngine.sort(measure.uniqueName, direction);\n          renderTable();\n        });\n\n        measureHeaderRow.appendChild(th);\n      });\n    });\n\n    thead.appendChild(measureHeaderRow);\n    table.appendChild(thead);\n\n    // Create table body\n    const tbody = document.createElement('tbody');\n\n    // Get all unique row values in their current order\n    const allUniqueRowValues = getOrderedRowValues(state);\n\n    console.log(`All unique ${rowFieldName} values:`, allUniqueRowValues);\n\n    // Update pagination to ensure it's based on current data\n    updatePagination(state.rawData, false);\n\n    // Get paginated row values for CURRENT PAGE ONLY\n    const paginatedRowValues = getPaginatedData(\n      allUniqueRowValues,\n      paginationState\n    );\n\n    console.log(\n      `${getFieldDisplayName(rowFieldName)} for current page:`,\n      paginatedRowValues\n    );\n    console.log('Current pagination state:', paginationState);\n\n    // Add rows for ONLY the paginated row values\n    paginatedRowValues.forEach((rowValue, rowIndex) => {\n      const tr = document.createElement('tr');\n      tr.dataset.rowIndex = rowIndex;\n      tr.dataset.fieldName = rowFieldName;\n      tr.dataset.fieldValue = rowValue;\n      tr.dataset.globalIndex = allUniqueRowValues.indexOf(rowValue);\n      tr.setAttribute('draggable', 'true');\n      tr.style.cursor = 'move';\n\n      // Add row value cell\n      const rowCell = document.createElement('td');\n      rowCell.textContent = rowValue;\n      rowCell.style.fontWeight = 'bold';\n      rowCell.style.padding = '8px';\n      rowCell.style.borderBottom = '1px solid #dee2e6';\n      rowCell.style.borderRight = '1px solid #dee2e6';\n      rowCell.className = 'row-cell';\n      tr.appendChild(rowCell);\n\n      // Add data cells for each column value and measure\n      uniqueColumnValues.forEach(columnValue => {\n        // Filter data for this row value and column value\n        const filteredDataForCell = state.rawData.filter(\n          item =>\n            item[rowFieldName] === rowValue &&\n            item[columnFieldName] === columnValue\n        );\n\n        // Add cells for each measure\n        state.measures.forEach(measure => {\n          const td = document.createElement('td');\n          td.style.padding = '8px';\n          td.style.borderBottom = '1px solid #dee2e6';\n          td.style.borderRight = '1px solid #dee2e6';\n          td.style.textAlign = 'right';\n\n          // Calculate the value based on aggregation\n          let value = 0;\n          if (filteredDataForCell.length > 0) {\n            switch (measure.aggregation) {\n              case 'sum':\n                value = filteredDataForCell.reduce(\n                  (sum, item) => sum + (item[measure.uniqueName] || 0),\n                  0\n                );\n                break;\n              case 'avg':\n                if (measure.formula) {\n                  value =\n                    filteredDataForCell.reduce(\n                      (sum, item) => sum + measure.formula(item),\n                      0\n                    ) / filteredDataForCell.length;\n                } else {\n                  value =\n                    filteredDataForCell.reduce(\n                      (sum, item) => sum + (item[measure.uniqueName] || 0),\n                      0\n                    ) / filteredDataForCell.length;\n                }\n                break;\n              case 'max':\n                value = Math.max(\n                  ...filteredDataForCell.map(\n                    item => item[measure.uniqueName] || 0\n                  )\n                );\n                break;\n              case 'min':\n                value = Math.min(\n                  ...filteredDataForCell.map(\n                    item => item[measure.uniqueName] || 0\n                  )\n                );\n                break;\n              default:\n                value = 0;\n            }\n          }\n\n          // Format the value\n          let formattedValue = value;\n          if (measure.format) {\n            if (measure.format.type === 'currency') {\n              formattedValue = new Intl.NumberFormat(measure.format.locale, {\n                style: 'currency',\n                currency: measure.format.currency,\n                minimumFractionDigits: measure.format.decimals,\n                maximumFractionDigits: measure.format.decimals,\n              }).format(value);\n            } else if (measure.format.type === 'number') {\n              formattedValue = new Intl.NumberFormat(measure.format.locale, {\n                minimumFractionDigits: measure.format.decimals,\n                maximumFractionDigits: measure.format.decimals,\n              }).format(value);\n            }\n          }\n\n          // Add drill-down functionality with generic parameters\n          addDrillDownToDataCell(\n            td,\n            rowValue,\n            columnValue,\n            measure,\n            value,\n            formattedValue,\n            rowFieldName,\n            columnFieldName\n          );\n\n          // Apply conditional formatting\n          if (\n            config.conditionalFormatting &&\n            Array.isArray(config.conditionalFormatting)\n          ) {\n            config.conditionalFormatting.forEach(rule => {\n              if (rule.value.type === 'Number' && !isNaN(value)) {\n                let applyFormat = false;\n\n                switch (rule.value.operator) {\n                  case 'Greater than':\n                    applyFormat = value > parseFloat(rule.value.value1);\n                    break;\n                  case 'Less than':\n                    applyFormat = value < parseFloat(rule.value.value1);\n                    break;\n                  case 'Equal to':\n                    applyFormat = value === parseFloat(rule.value.value1);\n                    break;\n                  case 'Between':\n                    applyFormat =\n                      value >= parseFloat(rule.value.value1) &&\n                      value <= parseFloat(rule.value.value2);\n                    break;\n                }\n\n                if (applyFormat) {\n                  if (rule.format.font) td.style.fontFamily = rule.format.font;\n                  if (rule.format.size) td.style.fontSize = rule.format.size;\n                  if (rule.format.color) td.style.color = rule.format.color;\n                  if (rule.format.backgroundColor)\n                    td.style.backgroundColor = rule.format.backgroundColor;\n                }\n              }\n            });\n          }\n\n          tr.appendChild(td);\n        });\n      });\n\n      tbody.appendChild(tr);\n    });\n\n    table.appendChild(tbody);\n    tableContainer.appendChild(table);\n\n    // Update pagination info\n    const pageInfo = document.getElementById('pageInfo');\n    if (pageInfo) {\n      pageInfo.textContent = `Page ${paginationState.currentPage} of ${paginationState.totalPages}`;\n\n      // Update button states\n      const prevButton = document.getElementById('prevPage');\n      const nextButton = document.getElementById('nextPage');\n      if (prevButton) prevButton.disabled = paginationState.currentPage <= 1;\n      if (nextButton)\n        nextButton.disabled =\n          paginationState.currentPage >= paginationState.totalPages;\n    }\n\n    // Set up drag and drop after rendering\n    setupDragAndDrop();\n  } catch (error) {\n    console.error('Error rendering table:', error);\n\n    // Display error message to user\n    const tableContainer = document.getElementById('myTable');\n    tableContainer.innerHTML = `<div style=\"color: red; padding: 20px;\">Error rendering table: ${error.message}</div>`;\n  }\n}\nfunction setupColumnDragAndDropFixed(columnFieldName) {\n  // Select only column headers with proper class\n  const columnHeaders = document.querySelectorAll(\n    '.column-header[draggable=\"true\"]'\n  );\n  let draggedColumnIndex = null;\n  let draggedColumnValue = null;\n\n  console.log(\n    'Setting up column drag, found column headers:',\n    columnHeaders.length\n  );\n\n  const state = pivotEngine.getState();\n  const uniqueColumnValues = getOrderedColumnValues(state);\n\n  console.log(\n    `Current ${columnFieldName} values for drag setup:`,\n    uniqueColumnValues\n  );\n\n  columnHeaders.forEach((header, headerIdx) => {\n    const fieldName = header.dataset.fieldName;\n    const fieldValue = header.dataset.fieldValue;\n    const columnIndex = parseInt(header.dataset.columnIndex);\n\n    console.log(\n      `Setting up column header ${headerIdx}: field=${fieldName}, value=${fieldValue}, columnIndex=${columnIndex}`\n    );\n\n    // Validate this is our column field\n    if (fieldName !== columnFieldName || !fieldValue) {\n      console.warn(\n        'Skipping header - field mismatch or missing value:',\n        fieldName,\n        fieldValue\n      );\n      return;\n    }\n\n    header.addEventListener('dragstart', e => {\n      draggedColumnIndex = columnIndex;\n      draggedColumnValue = fieldValue;\n      e.dataTransfer.setData('text/plain', fieldValue);\n      setTimeout(() => header.classList.add('dragging'), 0);\n      console.log(\n        `Column drag started for ${columnFieldName}: ${fieldValue}, Index: ${columnIndex}`\n      );\n    });\n\n    header.addEventListener('dragend', () => {\n      header.classList.remove('dragging');\n      draggedColumnIndex = null;\n      draggedColumnValue = null;\n      console.log('Column drag ended');\n    });\n\n    header.addEventListener('dragover', e => {\n      e.preventDefault();\n    });\n\n    header.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedColumnValue && draggedColumnValue !== fieldValue) {\n        header.classList.add('drag-over');\n      }\n    });\n\n    header.addEventListener('dragleave', () => {\n      header.classList.remove('drag-over');\n    });\n\n    header.addEventListener('drop', e => {\n      e.preventDefault();\n      header.classList.remove('drag-over');\n\n      const targetColumnValue = fieldValue;\n      const targetColumnIndex = parseInt(header.dataset.columnIndex);\n\n      if (\n        draggedColumnValue &&\n        targetColumnValue &&\n        draggedColumnValue !== targetColumnValue\n      ) {\n        console.log(\n          `Swapping ${columnFieldName}: ${draggedColumnValue} (index: ${draggedColumnIndex}) with ${targetColumnValue} (index: ${targetColumnIndex})`\n        );\n\n        try {\n          // Try core engine method first\n          pivotEngine.swapDataColumns(draggedColumnIndex, targetColumnIndex);\n          console.log('Core column swap completed');\n\n          // FIXED: Immediately store the new order to prevent loss\n          const newOrder = pivotEngine.getOrderedColumnValues();\n          if (newOrder) {\n            window.swappedColumnOrder = newOrder;\n            console.log('Stored new column order:', newOrder);\n          }\n\n          renderTable();\n        } catch (error) {\n          console.error('Core column swap failed:', error);\n          // Fallback to manual swap\n          console.log('Falling back to manual column swap');\n          manualColumnSwap(\n            draggedColumnIndex,\n            targetColumnIndex,\n            columnFieldName,\n            uniqueColumnValues\n          );\n          renderTable();\n        }\n      } else {\n        console.log('Invalid column swap - same values or missing data');\n      }\n    });\n  });\n}\nfunction setupRowDragAndDrop(rowFieldName) {\n  const rows = document.querySelectorAll('tbody tr[draggable=\"true\"]');\n  let draggedRowIndex = null;\n  let draggedRowValue = null;\n\n  console.log('Setting up row drag, found rows:', rows.length);\n\n  rows.forEach((row, rowIdx) => {\n    const fieldName = row.dataset.fieldName;\n    const fieldValue = row.dataset.fieldValue;\n    const globalIndex = parseInt(row.dataset.globalIndex);\n\n    console.log(\n      `Setting up row ${rowIdx}: field=${fieldName}, value=${fieldValue}, globalIndex=${globalIndex}`\n    );\n\n    // Validate this is our row field\n    if (fieldName !== rowFieldName || !fieldValue) {\n      console.warn(\n        'Skipping row - field mismatch or missing value:',\n        fieldName,\n        fieldValue\n      );\n      return;\n    }\n\n    row.addEventListener('dragstart', e => {\n      draggedRowValue = fieldValue;\n      draggedRowIndex = globalIndex;\n      e.dataTransfer.setData('text/plain', fieldValue);\n      setTimeout(() => row.classList.add('dragging'), 0);\n      console.log(\n        `Row drag started for ${rowFieldName}: ${fieldValue}, Global index: ${globalIndex}`\n      );\n    });\n\n    row.addEventListener('dragend', () => {\n      row.classList.remove('dragging');\n      draggedRowValue = null;\n      draggedRowIndex = null;\n    });\n\n    row.addEventListener('dragover', e => {\n      e.preventDefault();\n    });\n\n    row.addEventListener('dragenter', e => {\n      e.preventDefault();\n      if (draggedRowValue && draggedRowValue !== fieldValue) {\n        row.classList.add('drag-over');\n      }\n    });\n\n    row.addEventListener('dragleave', () => {\n      row.classList.remove('drag-over');\n    });\n\n    row.addEventListener('drop', e => {\n      e.preventDefault();\n      row.classList.remove('drag-over');\n\n      const targetRowValue = fieldValue;\n      const targetRowIndex = globalIndex;\n\n      if (\n        draggedRowValue &&\n        targetRowValue &&\n        draggedRowValue !== targetRowValue\n      ) {\n        console.log(\n          `Swapping ${rowFieldName}: ${draggedRowValue} (global: ${draggedRowIndex}) with ${targetRowValue} (global: ${targetRowIndex})`\n        );\n\n        try {\n          // Try core engine method first\n          pivotEngine.swapDataRows(draggedRowIndex, targetRowIndex);\n          console.log('Core row swap completed');\n          renderTable();\n        } catch (error) {\n          console.error('Core row swap failed:', error);\n          // Fallback to manual swap\n          console.log('Falling back to manual row swap');\n          manualRowSwap(draggedRowIndex, targetRowIndex, rowFieldName);\n          renderTable();\n        }\n      }\n    });\n  });\n}\n\n// FIXED: Manual column swap function\nfunction manualColumnSwap(\n  fromIndex,\n  toIndex,\n  columnFieldName,\n  uniqueColumnValues\n) {\n  console.log(\n    `Manual column swap: ${columnFieldName} from ${fromIndex} to ${toIndex}`\n  );\n  console.log('Available column values:', uniqueColumnValues);\n\n  if (\n    fromIndex < 0 ||\n    toIndex < 0 ||\n    fromIndex >= uniqueColumnValues.length ||\n    toIndex >= uniqueColumnValues.length\n  ) {\n    console.error(\n      'Invalid column indices:',\n      fromIndex,\n      toIndex,\n      'Available:',\n      uniqueColumnValues.length\n    );\n    return;\n  }\n\n  // Create swapped order\n  const swappedValues = [...uniqueColumnValues];\n  const temp = swappedValues[fromIndex];\n  swappedValues[fromIndex] = swappedValues[toIndex];\n  swappedValues[toIndex] = temp;\n\n  console.log('New column order:', swappedValues);\n\n  // FIXED: Store in multiple locations to ensure persistence\n  window.swappedColumnOrder = swappedValues;\n\n  // Store in engine state using the core method\n  if (pivotEngine.setCustomFieldOrder) {\n    pivotEngine.setCustomFieldOrder(columnFieldName, swappedValues, false);\n  }\n\n  // Also store directly in state as backup\n  if (pivotEngine.state) {\n    pivotEngine.state.customColumnOrder = {\n      fieldName: columnFieldName,\n      order: swappedValues,\n    };\n  }\n\n  console.log('Manual column swap completed and stored');\n}\n\n// FIXED: Manual row swap function\nfunction manualRowSwap(fromIndex, toIndex, rowFieldName) {\n  const state = pivotEngine.getState();\n  const uniqueRowValues = pivotEngine.getUniqueFieldValues(rowFieldName);\n\n  console.log(\n    `Manual row swap: ${rowFieldName} from ${fromIndex} to ${toIndex}`\n  );\n  console.log('Available row values:', uniqueRowValues);\n\n  if (\n    fromIndex < 0 ||\n    toIndex < 0 ||\n    fromIndex >= uniqueRowValues.length ||\n    toIndex >= uniqueRowValues.length\n  ) {\n    console.error(\n      'Invalid row indices:',\n      fromIndex,\n      toIndex,\n      'Available:',\n      uniqueRowValues.length\n    );\n    return;\n  }\n\n  // Get the values to swap\n  const fromValue = uniqueRowValues[fromIndex];\n  const toValue = uniqueRowValues[toIndex];\n\n  // Create swapped order\n  const swappedValues = [...uniqueRowValues];\n  swappedValues[fromIndex] = toValue;\n  swappedValues[toIndex] = fromValue;\n\n  console.log('New row order:', swappedValues);\n\n  // Reorder the actual data\n  const dataToUse = state.data || state.rawData || filteredData;\n  const newData = [...dataToUse];\n\n  newData.sort((a, b) => {\n    const aIndex = swappedValues.indexOf(a[rowFieldName]);\n    const bIndex = swappedValues.indexOf(b[rowFieldName]);\n    return aIndex - bIndex;\n  });\n\n  // Update filteredData\n  if (filteredData) {\n    filteredData.sort((a, b) => {\n      const aIndex = swappedValues.indexOf(a[rowFieldName]);\n      const bIndex = swappedValues.indexOf(b[rowFieldName]);\n      return aIndex - bIndex;\n    });\n  }\n\n  // Create new engine\n  pivotEngine = new PivotEngine({\n    ...config,\n    data: newData,\n  });\n\n  console.log('Manual row swap completed');\n}\n\nfunction getFieldDisplayName(fieldName) {\n  // Convert field name to display name (capitalize first letter)\n  return fieldName.charAt(0).toUpperCase() + fieldName.slice(1);\n}\n\n// Reset filters\n// Replace your resetFilters function with this:\nfunction resetFilters() {\n  // Reset data to original\n  filteredData = [...sampleData];\n\n  // Create a new PivotEngine instance with the original data\n  pivotEngine = new PivotEngine({\n    ...config,\n    data: sampleData, // Use original sample data\n  });\n\n  // Subscribe again to state changes\n  pivotEngine.subscribe(state => {\n    renderTable();\n  });\n\n  // Update pagination\n  updatePagination(sampleData, true);\n\n  // Reset filter inputs\n  document.getElementById('filterField').selectedIndex = 0;\n  document.getElementById('filterOperator').selectedIndex = 0;\n  document.getElementById('filterValue').value = '';\n\n  // No need to call renderTable() here\n}\n\n// Update pagination based on data size\nfunction updatePaginationInfo(viewType = null) {\n  const pageInfo = document.getElementById('pageInfo');\n  if (pageInfo) {\n    let viewMode;\n    if (viewType) {\n      viewMode = viewType;\n    } else {\n      viewMode = currentViewMode === 'raw' ? 'Raw Data' : 'Processed Data';\n    }\n\n    pageInfo.textContent = `${viewMode} - Page ${paginationState.currentPage} of ${paginationState.totalPages}`;\n\n    const prevButton = document.getElementById('prevPage');\n    const nextButton = document.getElementById('nextPage');\n    if (prevButton) prevButton.disabled = paginationState.currentPage <= 1;\n    if (nextButton)\n      nextButton.disabled =\n        paginationState.currentPage >= paginationState.totalPages;\n  }\n}\n\n// Generic updatePagination function\nfunction updatePagination(data, resetPage = false) {\n  const state = pivotEngine.getState();\n  const rowFieldName = pivotEngine.getRowFieldName();\n\n  if (!rowFieldName) {\n    console.warn('No row field configured for pagination');\n    return;\n  }\n\n  // Get unique row values\n  const uniqueRowValues = pivotEngine.getUniqueFieldValues(rowFieldName);\n\n  // Get pageSize from the select element, with fallback\n  const pageSizeElement = document.getElementById('pageSize');\n  const pageSize = pageSizeElement ? Number(pageSizeElement.value) : 10;\n  const totalPages = Math.ceil(uniqueRowValues.length / pageSize) || 1;\n\n  console.log(\n    `updatePagination - Total unique ${rowFieldName}:`,\n    uniqueRowValues.length\n  );\n  console.log('updatePagination - Page size:', pageSize);\n  console.log('updatePagination - Total pages:', totalPages);\n\n  if (resetPage) {\n    paginationState.currentPage = 1;\n  } else {\n    // Ensure current page doesn't exceed total pages\n    if (paginationState.currentPage > totalPages) {\n      paginationState.currentPage = totalPages;\n    }\n  }\n\n  paginationState.pageSize = pageSize;\n  paginationState.totalPages = totalPages;\n\n  // Keep the engine in sync\n  pivotEngine.setPagination(paginationState);\n\n  console.log('Updated pagination state:', paginationState);\n}\n\nexport function formatTable(config) {\n  pivotEngine = new PivotEngine(config);\n  renderTable();\n}\n\n// Event Listeners\nfunction setupEventListeners() {\n  // FIXED: Enhanced switch view functionality\n  document.getElementById('switchView').addEventListener('click', () => {\n    // Toggle the view mode\n    currentViewMode = currentViewMode === 'processed' ? 'raw' : 'processed';\n    showProcessedData = currentViewMode === 'processed';\n\n    console.log('Switching to view mode:', currentViewMode);\n\n    // Update button text\n    const switchButton = document.getElementById('switchView');\n    switchButton.textContent =\n      currentViewMode === 'processed'\n        ? 'Switch to Raw Data'\n        : 'Switch to Processed Data';\n\n    // FIXED: Proper pagination reset when switching views\n    if (currentViewMode === 'raw') {\n      const dataToUse = filteredData.length > 0 ? filteredData : sampleData;\n      // Reset to first page when switching to raw data\n      paginationState.currentPage = 1;\n      updateRawDataPagination(dataToUse);\n      console.log(\n        'Switched to raw data view with',\n        dataToUse.length,\n        'total items'\n      );\n    } else {\n      // Reset to first page when switching to processed data\n      paginationState.currentPage = 1;\n      updatePagination(filteredData, true);\n      console.log('Switched to processed data view');\n    }\n\n    // Re-render table\n    renderTable();\n  });\n\n  // FIXED: Page size change handler\n  document.getElementById('pageSize').addEventListener('change', e => {\n    const newPageSize = Number(e.target.value);\n\n    // Calculate what page we should be on with the new page size\n    // to keep roughly the same position\n    const currentFirstItem =\n      (paginationState.currentPage - 1) * paginationState.pageSize;\n    const newPage = Math.floor(currentFirstItem / newPageSize) + 1;\n\n    paginationState.currentPage = newPage;\n\n    if (currentViewMode === 'raw') {\n      const dataToUse = filteredData.length > 0 ? filteredData : sampleData;\n      updateRawDataPagination(dataToUse);\n    } else {\n      updatePagination(filteredData, false); // Don't reset page, we calculated it above\n      // But ensure we don't exceed total pages\n      if (paginationState.currentPage > paginationState.totalPages) {\n        paginationState.currentPage = paginationState.totalPages;\n      }\n    }\n\n    console.log(\n      'Page size changed to:',\n      newPageSize,\n      'New page:',\n      paginationState.currentPage\n    );\n    renderTable();\n  });\n\n  // FIXED: Previous page handler\n  document.getElementById('prevPage').addEventListener('click', () => {\n    if (paginationState.currentPage > 1) {\n      paginationState.currentPage--;\n      if (currentViewMode === 'processed') {\n        pivotEngine.setPagination(paginationState);\n      }\n      console.log(\n        'Previous page clicked, now on page:',\n        paginationState.currentPage\n      );\n      renderTable();\n    }\n  });\n\n  // FIXED: Next page handler\n  document.getElementById('nextPage').addEventListener('click', () => {\n    if (paginationState.currentPage < paginationState.totalPages) {\n      paginationState.currentPage++;\n      if (currentViewMode === 'processed') {\n        pivotEngine.setPagination(paginationState);\n      }\n      console.log(\n        'Next page clicked, now on page:',\n        paginationState.currentPage\n      );\n      renderTable();\n    }\n  });\n\n  // Keep your existing filter event listeners...\n  document.getElementById('applyFilter').addEventListener('click', () => {\n    const field = document.getElementById('filterField').value;\n    const operator = document.getElementById('filterOperator').value;\n    const value = document.getElementById('filterValue').value;\n\n    if (!value) {\n      alert('Please enter a filter value');\n      return;\n    }\n\n    const filter = { field, operator, value };\n    filteredData = applyFilter(sampleData, filter);\n\n    console.log('Filtered data:', filteredData);\n\n    // Reset to first page when applying filter\n    paginationState.currentPage = 1;\n\n    if (currentViewMode === 'raw') {\n      updateRawDataPagination(filteredData);\n    } else {\n      updatePagination(filteredData, true);\n    }\n\n    renderTable();\n  });\n\n  document.getElementById('resetFilter').addEventListener('click', () => {\n    filteredData = [...sampleData];\n\n    pivotEngine = new PivotEngine({\n      ...config,\n      data: sampleData,\n    });\n\n    // Subscribe again to state changes\n    pivotEngine.subscribe(state => {\n      renderTable();\n    });\n\n    // Reset to first page\n    paginationState.currentPage = 1;\n\n    if (currentViewMode === 'raw') {\n      updateRawDataPagination(sampleData);\n    } else {\n      updatePagination(filteredData, true);\n    }\n\n    document.getElementById('filterField').selectedIndex = 0;\n    document.getElementById('filterOperator').selectedIndex = 0;\n    document.getElementById('filterValue').value = '';\n\n    // Format controls event listeners - ADD THESE LINES\n    // document.getElementById('formatCellsBtn').addEventListener('click', () => {\n    //   if (cellFormatter.selectedCells.size === 0) {\n    //     alert('Please select cells first by clicking on them while holding Ctrl');\n    //     return;\n    //   }\n    //   cellFormatter.showFormatModal();\n    // });\n\n    // document.getElementById('clearFormatBtn').addEventListener('click', () => {\n    //   if (confirm('Clear all cell formatting?')) {\n    //     document.querySelectorAll('td').forEach(cell => {\n    //       if (cell.dataset.originalValue) {\n    //         cell.textContent = cell.dataset.originalValue;\n    //         delete cell.dataset.originalValue;\n    //       }\n    //       cell.style.cssText = cell.style.cssText.replace(/text-align[^;]*;?/g, '')\n    //                                              .replace(/font-family[^;]*;?/g, '')\n    //                                              .replace(/font-size[^;]*;?/g, '')\n    //                                              .replace(/font-weight[^;]*;?/g, '')\n    //                                              .replace(/font-style[^;]*;?/g, '')\n    //                                              .replace(/color[^;]*;?/g, '')\n    //                                              .replace(/background-color[^;]*;?/g, '');\n    //     });\n    //     cellFormatter.formatHistory.clear();\n    //   }\n    // });\n\n    // No need to call renderTable() here\n  });\n}\n\n// Update the addDraggableStyles function to include styles for sort icons\n// function addDraggableStyles() {\n//   const styleEl = document.createElement('style');\n//   styleEl.innerHTML = `\n//         .dragging {\n//             opacity: 0.5;\n//             background-color: #f0f0f0;\n//         }\n\n//         .drag-over {\n//             border: 2px dashed #666 !important;\n//             background-color: #e9ecef !important;\n//         }\n\n//         th[draggable=\"true\"], tr[draggable=\"true\"] {\n//             cursor: move;\n//         }\n\n//         /* Sort icon styles */\n//         .sort-icon {\n//             margin-left: 5px;\n//             display: inline-block;\n//             transition: transform 0.2s;\n//         }\n\n//         th:hover .sort-icon {\n//             opacity: 1 !important;\n//         }\n\n//         /* Header hover effect */\n//         th[data-sortable=\"true\"]:hover {\n//             background-color: #e9ecef !important;\n//         }\n\n//         .controls-container {\n//             margin-bottom: 20px;\n//             display: flex;\n//             flex-direction: column;\n//             gap: 10px;\n//         }\n\n//         .filter-container, .pagination-container {\n//             display: flex;\n//             gap: 10px;\n//             align-items: center;\n//             flex-wrap: wrap;\n//         }\n\n//         /* Make sure table is responsive */\n//         #myTable {\n//             overflow-x: auto;\n//             width: 100%;\n//         }\n\n//         /* Button styling */\n//         button {\n//             padding: 5px 10px;\n//             background-color: #4CAF50;\n//             color: white;\n//             border: none;\n//             border-radius: 4px;\n//             cursor: pointer;\n//         }\n\n//         button:disabled {\n//             background-color: #cccccc;\n//             cursor: not-allowed;\n//         }\n\n//         /* Select and input styling */\n//         select, input {\n//             padding: 5px;\n//             border-radius: 4px;\n//             border: 1px solid #ddd;\n//         }\n//     `;\n//   document.head.appendChild(styleEl);\n// }\n\nfunction addDraggableStyles() {\n  const styleEl = document.createElement('style');\n  styleEl.innerHTML = `\n        .dragging {\n            opacity: 0.5;\n            background-color: #f0f0f0;\n        }\n        \n        .drag-over {\n            border: 2px dashed #666 !important;\n            background-color: #e9ecef !important;\n        }\n        \n        th[draggable=\"true\"], tr[draggable=\"true\"] {\n            cursor: move;\n        }\n        \n        /* ENHANCED: Column header specific styles */\n        .column-header[draggable=\"true\"] {\n            cursor: move;\n            transition: background-color 0.2s;\n        }\n        \n        .column-header[draggable=\"true\"]:hover {\n            background-color: #e3f2fd !important;\n            border: 1px solid #2196f3 !important;\n        }\n        \n        .column-header.dragging {\n            opacity: 0.6;\n            background-color: #ffecb3 !important;\n        }\n        \n        .column-header.drag-over {\n            border: 3px dashed #4caf50 !important;\n            background-color: #e8f5e8 !important;\n        }\n        \n        /* Sort icon styles */\n        .sort-icon {\n            margin-left: 5px;\n            display: inline-block;\n            transition: transform 0.2s;\n        }\n        \n        th:hover .sort-icon {\n            opacity: 1 !important;\n        }\n        \n        /* Header hover effect */\n        th[data-sortable=\"true\"]:hover {\n            background-color: #e9ecef !important;\n        }\n        \n        .controls-container {\n            margin-bottom: 20px;\n            display: flex;\n            flex-direction: column;\n            gap: 10px;\n        }\n        \n        .filter-container, .pagination-container {\n            display: flex;\n            gap: 10px;\n            align-items: center;\n            flex-wrap: wrap;\n        }\n        \n        /* Make sure table is responsive */\n        #myTable {\n            overflow-x: auto;\n            width: 100%;\n        }\n        \n        /* Button styling */\n        button {\n            padding: 5px 10px;\n            background-color: #4CAF50;\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n        }\n        \n        button:disabled {\n            background-color: #cccccc;\n            cursor: not-allowed;\n        }\n        \n        /* Select and input styling */\n        select, input {\n            padding: 5px;\n            border-radius: 4px;\n            border: 1px solid #ddd;\n        }\n\n        /* Drill-down cell styling */\n        .drill-down-cell {\n            cursor: pointer;\n            transition: background-color 0.2s;\n        }\n        \n        .drill-down-cell:hover {\n            background-color: #e3f2fd !important;\n            border: 2px solid #2196f3 !important;\n        }\n\n        /* Modal styles for drill-down details */\n        .drill-down-modal {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0, 0, 0, 0.5);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n        }\n\n        .drill-down-content {\n            background: white;\n            border-radius: 8px;\n            padding: 20px;\n            width: 90%;\n            max-width: 800px;\n            max-height: 80%;\n            overflow: auto;\n            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\n        }\n\n        .drill-down-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 20px;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #e0e0e0;\n        }\n\n        .drill-down-title {\n            font-size: 18px;\n            font-weight: bold;\n            color: #333;\n        }\n\n        .drill-down-close {\n            background: #f44336;\n            color: white;\n            border: none;\n            border-radius: 50%;\n            width: 30px;\n            height: 30px;\n            cursor: pointer;\n            font-size: 16px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .drill-down-close:hover {\n            background: #d32f2f;\n        }\n\n        .drill-down-summary {\n            background: #f5f5f5;\n            padding: 10px;\n            border-radius: 4px;\n            margin-bottom: 15px;\n            font-size: 14px;\n        }\n\n        .drill-down-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 10px;\n        }\n\n        .drill-down-table th {\n            background: #f8f9fa;\n            padding: 8px;\n            border: 1px solid #dee2e6;\n            font-weight: bold;\n            text-align: left;\n        }\n\n        .drill-down-table td {\n            padding: 6px 8px;\n            border: 1px solid #dee2e6;\n        }\n\n        .drill-down-table tr:nth-child(even) {\n            background-color: #f9f9f9;\n        }\n\n        .drill-down-table tr:hover {\n            background-color: #e3f2fd;\n        }\n    `;\n  document.head.appendChild(styleEl);\n}\n\n/* REPLACE your addFormattingStyles function with this enhanced version */\n\nfunction addFormattingStyles() {\n  const styles = `\n    <style id=\"formattingStyles\">\n      /* Cell selection styles */\n      .selected-cell {\n        background-color: rgba(76, 175, 80, 0.3) !important;\n        border: 2px solid #4CAF50 !important;\n      }\n      \n      /* Format modal styles - matching the screenshot */\n      .format-modal {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background-color: rgba(0, 0, 0, 0.5);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 10000;\n      }\n\n      .format-modal-content {\n        background: white;\n        border-radius: 4px;\n        width: 90%;\n        max-width: 480px;\n        max-height: 90vh;\n        overflow-y: auto;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        border: 1px solid #d0d0d0;\n      }\n\n      .format-modal-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 16px 20px;\n        border-bottom: 1px solid #e0e0e0;\n        background-color: #fafafa;\n      }\n\n      .format-modal-header h3 {\n        margin: 0;\n        font-size: 16px;\n        font-weight: 500;\n        color: #333;\n      }\n\n      .format-close-btn {\n        background: none;\n        border: none;\n        font-size: 20px;\n        cursor: pointer;\n        color: #666;\n        padding: 4px;\n        width: 28px;\n        height: 28px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        border-radius: 2px;\n      }\n\n      .format-close-btn:hover {\n        background-color: #e0e0e0;\n      }\n\n      .format-modal-body {\n        padding: 20px;\n        max-height: calc(90vh - 140px);\n        overflow-y: auto;\n      }\n\n      .format-section {\n        margin-bottom: 16px;\n      }\n\n      .format-section label {\n        display: block;\n        margin-bottom: 6px;\n        font-weight: 400;\n        color: #555;\n        font-size: 13px;\n        text-transform: none;\n      }\n\n      .format-select, .format-input {\n        width: 100%;\n        padding: 8px 10px;\n        border: 1px solid #d0d0d0;\n        border-radius: 3px;\n        font-size: 13px;\n        background-color: white;\n        color: #333;\n        font-family: inherit;\n      }\n\n      .format-select:focus, .format-input:focus {\n        outline: none;\n        border-color: #4a90e2;\n        box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);\n      }\n\n      .format-input::placeholder {\n        color: #999;\n        font-style: italic;\n      }\n\n      /* Font controls styling */\n      .font-controls {\n        display: grid;\n        grid-template-columns: 2fr 1fr auto auto;\n        gap: 8px;\n        align-items: center;\n      }\n\n      .format-btn {\n        width: 32px;\n        height: 32px;\n        border: 1px solid #d0d0d0;\n        background: white;\n        border-radius: 3px;\n        font-weight: bold;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 13px;\n        color: #333;\n      }\n\n      .format-btn.active {\n        background-color: #4a90e2;\n        color: white;\n        border-color: #4a90e2;\n      }\n\n      .format-btn:hover {\n        background-color: #f0f0f0;\n      }\n\n      .format-btn.active:hover {\n        background-color: #357abd;\n      }\n\n      /* Color controls styling */\n      .color-controls {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 12px;\n      }\n\n      .color-control {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n      }\n\n      .color-control label {\n        margin: 0;\n        font-size: 12px;\n        min-width: 65px;\n        color: #666;\n      }\n\n      .color-control input[type=\"color\"] {\n        width: 36px;\n        height: 24px;\n        border: 1px solid #d0d0d0;\n        border-radius: 3px;\n        cursor: pointer;\n        padding: 0;\n      }\n\n      /* Preview styling */\n      .format-preview {\n        border: 1px solid #d0d0d0;\n        border-radius: 3px;\n        padding: 12px;\n        background-color: #f9f9f9;\n        text-align: center;\n        min-height: 20px;\n        font-size: 14px;\n        color: #333;\n        font-family: inherit;\n      }\n\n      /* Modal footer styling */\n      .format-modal-footer {\n        padding: 16px 20px;\n        border-top: 1px solid #e0e0e0;\n        display: flex;\n        justify-content: flex-end;\n        gap: 12px;\n        background-color: #fafafa;\n      }\n\n      .format-apply-btn, .format-cancel-btn {\n        padding: 8px 20px;\n        border: none;\n        border-radius: 3px;\n        font-size: 13px;\n        font-weight: 500;\n        cursor: pointer;\n        min-width: 70px;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n      }\n\n      .format-apply-btn {\n        background-color: #666;\n        color: white;\n      }\n\n      .format-apply-btn:hover {\n        background-color: #555;\n      }\n\n      .format-cancel-btn {\n        background-color: #e0e0e0;\n        color: #666;\n        border: 1px solid #d0d0d0;\n      }\n\n      .format-cancel-btn:hover {\n        background-color: #d0d0d0;\n      }\n\n      /* Currency section visibility */\n      .currency-section {\n        transition: all 0.2s ease;\n      }\n\n      /* Scrollbar styling for modal body */\n      .format-modal-body::-webkit-scrollbar {\n        width: 6px;\n      }\n\n      .format-modal-body::-webkit-scrollbar-track {\n        background: #f1f1f1;\n        border-radius: 3px;\n      }\n\n      .format-modal-body::-webkit-scrollbar-thumb {\n        background: #c1c1c1;\n        border-radius: 3px;\n      }\n\n      .format-modal-body::-webkit-scrollbar-thumb:hover {\n        background: #a8a8a8;\n      }\n\n      /* Responsive adjustments */\n      @media (max-width: 600px) {\n        .format-modal-content {\n          width: 95%;\n          margin: 10px;\n        }\n        \n        .font-controls {\n          grid-template-columns: 1fr;\n          gap: 8px;\n        }\n        \n        .color-controls {\n          grid-template-columns: 1fr;\n        }\n        \n        .format-modal-footer {\n          flex-direction: column-reverse;\n        }\n        \n        .format-apply-btn, .format-cancel-btn {\n          width: 100%;\n        }\n      }\n\n      /* Disabled state for currency fields */\n      .currency-section select:disabled {\n        background-color: #f5f5f5;\n        color: #999;\n        cursor: not-allowed;\n      }\n\n      /* Better focus states */\n      .format-btn:focus {\n        outline: none;\n        box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3);\n      }\n\n      .color-control input[type=\"color\"]:focus {\n        outline: none;\n        box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.3);\n      }\n    </style>\n  `;\n\n  document.head.insertAdjacentHTML('beforeend', styles);\n}\n\n// Add this function to create the drill-down modal:\n// Generic function to update drill-down modal for any fields\nfunction createDrillDownModal(\n  rowValue,\n  columnValue,\n  measure,\n  rawDetails,\n  aggregatedValue,\n  rowFieldName,\n  columnFieldName\n) {\n  // Remove existing modal if any\n  const existingModal = document.querySelector('.drill-down-modal');\n  if (existingModal) {\n    existingModal.remove();\n  }\n\n  // Create modal elements\n  const modal = document.createElement('div');\n  modal.className = 'drill-down-modal';\n\n  const content = document.createElement('div');\n  content.className = 'drill-down-content';\n\n  // Header\n  const header = document.createElement('div');\n  header.className = 'drill-down-header';\n\n  const title = document.createElement('div');\n  title.className = 'drill-down-title';\n  title.textContent = 'Details';\n\n  const closeButton = document.createElement('button');\n  closeButton.className = 'drill-down-close';\n  closeButton.innerHTML = '×';\n  closeButton.addEventListener('click', () => modal.remove());\n\n  header.appendChild(title);\n  header.appendChild(closeButton);\n\n  // Summary\n  const summary = document.createElement('div');\n  summary.className = 'drill-down-summary';\n  summary.innerHTML = `\n    <strong>${getFieldDisplayName(rowFieldName)}:</strong> ${rowValue} &nbsp;&nbsp;\n    <strong>${getFieldDisplayName(columnFieldName)}:</strong> ${columnValue} &nbsp;&nbsp;\n    <strong>${measure.caption}:</strong> ${aggregatedValue}\n  `;\n\n  // Table\n  const table = document.createElement('table');\n  table.className = 'drill-down-table';\n\n  // Table header\n  const thead = document.createElement('thead');\n  const headerRow = document.createElement('tr');\n\n  // Get all columns from the raw data\n  const columns = rawDetails.length > 0 ? Object.keys(rawDetails[0]) : [];\n  columns.forEach(col => {\n    const th = document.createElement('th');\n    th.textContent = getFieldDisplayName(col);\n    headerRow.appendChild(th);\n  });\n\n  thead.appendChild(headerRow);\n  table.appendChild(thead);\n\n  // Table body\n  const tbody = document.createElement('tbody');\n  rawDetails.forEach((row, index) => {\n    const tr = document.createElement('tr');\n    columns.forEach(col => {\n      const td = document.createElement('td');\n      let value = row[col];\n\n      // Format values appropriately based on measure format\n      if (\n        measure.format &&\n        (col === measure.uniqueName ||\n          col.includes('price') ||\n          col.includes('sales') ||\n          col.includes('revenue'))\n      ) {\n        if (typeof value === 'number') {\n          if (measure.format.type === 'currency') {\n            value = new Intl.NumberFormat('en-US', {\n              style: 'currency',\n              currency: 'USD',\n            }).format(value);\n          }\n        }\n      } else if (col.includes('date')) {\n        value = new Date(value).toLocaleDateString();\n      }\n\n      td.textContent = value;\n      tr.appendChild(td);\n    });\n    tbody.appendChild(tr);\n  });\n\n  table.appendChild(tbody);\n\n  // Assemble modal\n  content.appendChild(header);\n  content.appendChild(summary);\n  content.appendChild(table);\n  modal.appendChild(content);\n\n  // Add to document\n  document.body.appendChild(modal);\n\n  // Close modal when clicking outside\n  modal.addEventListener('click', e => {\n    if (e.target === modal) {\n      modal.remove();\n    }\n  });\n\n  // Close modal with Escape key\n  const handleEscape = e => {\n    if (e.key === 'Escape') {\n      modal.remove();\n      document.removeEventListener('keydown', handleEscape);\n    }\n  };\n  document.addEventListener('keydown', handleEscape);\n}\n\n// Add this function to get drill-down data for a specific cell:\n// Generic getDrillDownData function\nfunction getDrillDownData(\n  rowValue,\n  columnValue,\n  measure,\n  rowFieldName,\n  columnFieldName\n) {\n  const state = pivotEngine.getState();\n\n  // Create filter object dynamically\n  const filter = {};\n  filter[rowFieldName] = rowValue;\n  filter[columnFieldName] = columnValue;\n\n  // Filter raw data for this specific row and column combination\n  const filteredData = state.rawData.filter(item => {\n    return Object.keys(filter).every(key => item[key] === filter[key]);\n  });\n\n  console.log(\n    `Drill-down for ${rowFieldName}:${rowValue} - ${columnFieldName}:${columnValue} - ${measure.caption}:`,\n    filteredData\n  );\n\n  return filteredData;\n}\n\n// Generic addDrillDownToDataCell function\nfunction addDrillDownToDataCell(\n  td,\n  rowValue,\n  columnValue,\n  measure,\n  value,\n  formattedValue,\n  rowFieldName,\n  columnFieldName\n) {\n  td.textContent = formattedValue;\n\n  // Add drill-down functionality\n  td.className = 'drill-down-cell';\n  td.title = `Double-click to see details for ${rowFieldName}: ${rowValue} - ${columnFieldName}: ${columnValue}`;\n\n  // Add double-click event listener\n  td.addEventListener('dblclick', e => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    console.log(\n      `Double-clicked on ${rowFieldName}: ${rowValue} - ${columnFieldName}: ${columnValue} - ${measure.caption}`\n    );\n\n    // Get the raw data for this cell\n    const rawDetails = getDrillDownData(\n      rowValue,\n      columnValue,\n      measure,\n      rowFieldName,\n      columnFieldName\n    );\n\n    if (rawDetails.length === 0) {\n      alert(\n        `No detailed data found for ${rowFieldName}: ${rowValue} in ${columnFieldName}: ${columnValue}`\n      );\n      return;\n    }\n\n    // Show the drill-down modal\n    createDrillDownModal(\n      rowValue,\n      columnValue,\n      measure,\n      rawDetails,\n      formattedValue,\n      rowFieldName,\n      columnFieldName\n    );\n  });\n}\n\n// Add HTML for filter and pagination controls\nfunction addControlsHTML() {\n  if (document.querySelector('.controls-container')) {\n    return;\n  }\n\n  const container = document.createElement('div');\n  container.className = 'controls-container';\n  container.innerHTML = `\n    <div class=\"filter-container\">\n      <select id=\"filterField\"></select>\n      <select id=\"filterOperator\"></select>\n      <input type=\"text\" id=\"filterValue\" placeholder=\"Filter value\">\n      <button id=\"applyFilter\">Apply Filter</button>\n      <button id=\"resetFilter\">Reset</button>\n      <button id=\"switchView\">Switch to Raw Data</button>\n    </div>\n   \n    <div class=\"pagination-container\">\n      <label>Items per page:</label>\n      <select id=\"pageSize\">\n        <option value=\"1\">1</option>\n        <option value=\"2\">2</option>\n        <option value=\"3\">3</option>\n        <option value=\"4\">4</option>\n        <option value=\"10\" selected>10</option>\n        <option value=\"25\">25</option>\n        <option value=\"50\">50</option>\n      </select>\n      <button id=\"prevPage\">Previous</button>\n      <span id=\"pageInfo\">Processed Data - Page 1 of 1</span>\n      <button id=\"nextPage\">Next</button>\n    </div>\n  `;\n\n  const myTable = document.getElementById('myTable');\n  myTable.parentNode.insertBefore(container, myTable);\n}\n\nfunction setupCellSelection() {\n  document.addEventListener('click', e => {\n    if (e.target.tagName === 'TD' && e.target.closest('#myTable')) {\n      if (e.ctrlKey || e.metaKey) {\n        if (e.target.classList.contains('selected-cell')) {\n          cellFormatter.removeCellFromSelection(e.target);\n        } else {\n          cellFormatter.addCellToSelection(e.target);\n        }\n      } else {\n        cellFormatter.clearSelection();\n        cellFormatter.addCellToSelection(e.target);\n      }\n    } else if (!e.target.closest('.format-modal')) {\n      cellFormatter.clearSelection();\n    }\n  });\n}\n\n// Add this function to set up drag and drop functionality\n// Replace your setupDragAndDrop function with this version that includes column swapping:\n\n// Update your setupDragAndDrop function column section:\n// function setupDragAndDrop() {\n//   console.log('Setting up generic drag and drop');\n\n//   // Get field names from configuration\n//   const rowFieldName = pivotEngine.getRowFieldName();\n//   const columnFieldName = pivotEngine.getColumnFieldName();\n\n//   if (!rowFieldName || !columnFieldName) {\n//     console.warn('Row or column field not configured for drag and drop');\n//     return;\n//   }\n\n//   console.log(`Setting up drag and drop for row field: ${rowFieldName}, column field: ${columnFieldName}`);\n\n//   // ENHANCED: Column drag and drop with SWAPPING (generic for any column field)\n//   const headers = document.querySelectorAll('th[draggable=\"true\"]');\n//   let draggedColumnIndex = null;\n//   let draggedColumnValue = null;\n\n//   console.log('Setting up drag and drop, found headers:', headers.length);\n\n//   const state = pivotEngine.getState();\n//   const uniqueColumnValues = getOrderedColumnValues(state);\n\n//   console.log(`Current ${columnFieldName} values for drag setup:`, uniqueColumnValues);\n\n//   headers.forEach((header, headerIdx) => {\n//     const headerIndex = header.dataset.index ? parseInt(header.dataset.index) : null;\n//     const fieldName = header.dataset.fieldName;\n//     const fieldValue = header.dataset.fieldValue;\n\n//     console.log(`Setting up header ${headerIdx}: index=${headerIndex}, field=${fieldName}, value=${fieldValue}`);\n\n//     // Skip if this is not a column header or missing data\n//     if (headerIndex === null || fieldName !== columnFieldName || !fieldValue) {\n//       console.log('Skipping header - not a column header or missing data');\n//       return;\n//     }\n\n//     // Find the actual index in the column values array\n//     const actualColumnIndex = uniqueColumnValues.indexOf(fieldValue);\n//     const indexToUse = actualColumnIndex !== -1 ? actualColumnIndex : headerIndex - 1;\n\n//     console.log(`Using ${columnFieldName} index ${indexToUse} for ${fieldValue}`);\n\n//     header.addEventListener('dragstart', e => {\n//       draggedColumnIndex = indexToUse;\n//       draggedColumnValue = fieldValue;\n//       e.dataTransfer.setData('text/plain', fieldValue);\n//       setTimeout(() => header.classList.add('dragging'), 0);\n//       console.log(`Column drag started for ${columnFieldName}:`, fieldValue, 'Index:', indexToUse);\n//     });\n\n//     header.addEventListener('dragend', () => {\n//       header.classList.remove('dragging');\n//       draggedColumnIndex = null;\n//       draggedColumnValue = null;\n//     });\n\n//     header.addEventListener('dragover', e => {\n//       e.preventDefault();\n//     });\n\n//     header.addEventListener('dragenter', e => {\n//       e.preventDefault();\n//       if (draggedColumnValue && draggedColumnValue !== fieldValue) {\n//         header.classList.add('drag-over');\n//       }\n//     });\n\n//     header.addEventListener('dragleave', () => {\n//       header.classList.remove('drag-over');\n//     });\n\n//     header.addEventListener('drop', e => {\n//       e.preventDefault();\n//       header.classList.remove('drag-over');\n\n//       const targetColumnValue = fieldValue;\n//       const targetColumnIndex = uniqueColumnValues.indexOf(targetColumnValue);\n//       const targetIndexToUse = targetColumnIndex !== -1 ? targetColumnIndex : indexToUse;\n\n//       if (draggedColumnValue && targetColumnValue && draggedColumnValue !== targetColumnValue) {\n//         console.log(`Attempting to swap ${columnFieldName} ${draggedColumnValue} (index: ${draggedColumnIndex}) with ${targetColumnValue} (index: ${targetIndexToUse})`);\n\n//         try {\n//           // Use core engine method\n//           pivotEngine.swapDataColumns(draggedColumnIndex, targetIndexToUse);\n//           renderTable();\n//         } catch (error) {\n//           console.error('Error during column swap operation:', error);\n//           // Fallback to manual swap\n//           swapGenericFieldValues(draggedColumnIndex, targetIndexToUse, columnFieldName, false);\n//           renderTable();\n//         }\n//       }\n//     });\n//   });\n\n//   // ENHANCED: Row drag and drop with SWAPPING (generic for any row field)\n//   const rows = document.querySelectorAll('tbody tr[draggable=\"true\"]');\n//   let draggedRowIndex = null;\n//   let draggedRowValue = null;\n\n//   console.log('Setting up row drag, found rows:', rows.length);\n\n//   rows.forEach((row) => {\n//     const rowCell = row.querySelector('.row-cell');\n//     const fieldName = row.dataset.fieldName;\n//     const fieldValue = row.dataset.fieldValue;\n//     const globalIndex = parseInt(row.dataset.globalIndex);\n\n//     // Validate this is a row for our configured row field\n//     if (fieldName !== rowFieldName || !fieldValue) {\n//       console.warn('Row field mismatch or missing data');\n//       return;\n//     }\n\n//     console.log(`Setting up row drag for ${rowFieldName}: ${fieldValue} (global index: ${globalIndex})`);\n\n//     row.addEventListener('dragstart', e => {\n//       draggedRowValue = fieldValue;\n//       draggedRowIndex = globalIndex;\n//       e.dataTransfer.setData('text/plain', fieldValue);\n//       setTimeout(() => row.classList.add('dragging'), 0);\n//       console.log(`Drag started for ${rowFieldName}:`, fieldValue, 'Global index:', globalIndex);\n//     });\n\n//     row.addEventListener('dragend', () => {\n//       row.classList.remove('dragging');\n//       draggedRowValue = null;\n//       draggedRowIndex = null;\n//     });\n\n//     row.addEventListener('dragover', e => {\n//       e.preventDefault();\n//     });\n\n//     row.addEventListener('dragenter', e => {\n//       e.preventDefault();\n//       if (draggedRowValue && draggedRowValue !== fieldValue) {\n//         row.classList.add('drag-over');\n//       }\n//     });\n\n//     row.addEventListener('dragleave', () => {\n//       row.classList.remove('drag-over');\n//     });\n\n//     row.addEventListener('drop', e => {\n//       e.preventDefault();\n//       row.classList.remove('drag-over');\n\n//       const targetRowValue = fieldValue;\n//       const targetRowIndex = globalIndex;\n\n//       if (draggedRowValue && targetRowValue && draggedRowValue !== targetRowValue) {\n//         console.log(`Swapping ${rowFieldName} ${draggedRowValue} (global: ${draggedRowIndex}) with ${targetRowValue} (global: ${targetRowIndex})`);\n\n//         try {\n//           // Use core engine method\n//           pivotEngine.swapDataRows(draggedRowIndex, targetRowIndex);\n//           renderTable();\n//         } catch (error) {\n//           console.error('Error during row swap operation:', error);\n//           // Fallback to manual swap\n//           swapGenericFieldValues(draggedRowIndex, targetRowIndex, rowFieldName, true);\n//           renderTable();\n//         }\n//       }\n//     });\n//   });\n// }\n\nfunction setupDragAndDrop() {\n  console.log('Setting up generic drag and drop');\n\n  // Get field names from configuration\n  const rowFieldName = pivotEngine.getRowFieldName();\n  const columnFieldName = pivotEngine.getColumnFieldName();\n\n  if (!rowFieldName || !columnFieldName) {\n    console.warn('Row or column field not configured for drag and drop');\n    return;\n  }\n\n  console.log(\n    `Setting up drag and drop for row field: ${rowFieldName}, column field: ${columnFieldName}`\n  );\n\n  // FIXED: Use the improved column drag setup\n  setupColumnDragAndDropFixed(columnFieldName);\n\n  // Row drag setup (keep existing)\n  setupRowDragAndDrop(rowFieldName);\n}\n\n// Add this new function to handle region/column swapping:\n// Keep the manual swap function as fallback:\n// function swapRegionsInEngine(fromIndex, toIndex) {\n//   const state = pivotEngine.getState();\n//   const currentRegions = getOrderedRegions(state);\n\n//   console.log(\n//     'Manual column swap - From index:',\n//     fromIndex,\n//     'To index:',\n//     toIndex\n//   );\n//   console.log('Current regions:', currentRegions);\n\n//   // Validate indices\n//   if (\n//     fromIndex < 0 ||\n//     toIndex < 0 ||\n//     fromIndex >= currentRegions.length ||\n//     toIndex >= currentRegions.length\n//   ) {\n//     console.error('Invalid indices for column swap:', fromIndex, toIndex);\n//     return;\n//   }\n\n//   if (fromIndex === toIndex) {\n//     console.log('Same column, no swap needed');\n//     return;\n//   }\n\n//   // Get the region names to swap\n//   const fromRegion = currentRegions[fromIndex];\n//   const toRegion = currentRegions[toIndex];\n\n//   if (!fromRegion || !toRegion) {\n//     console.error('Invalid regions for swap:', fromRegion, toRegion);\n//     return;\n//   }\n\n//   // Create swapped region order\n//   const swappedRegions = [...currentRegions];\n//   swappedRegions[fromIndex] = toRegion;\n//   swappedRegions[toIndex] = fromRegion;\n\n//   console.log('After manual swap - Regions:', swappedRegions);\n\n//   // Store the swapped region order in multiple places for persistence\n//   window.swappedRegionOrder = swappedRegions;\n\n//   // Also store in the engine state if possible\n//   if (pivotEngine.state) {\n//     pivotEngine.state.customRegionOrder = swappedRegions;\n//   }\n\n//   console.log(\n//     'Manual column swap completed. New region order:',\n//     swappedRegions\n//   );\n// }\n\n// // Keep the existing swapProductsInEngine function for rows:\n// function swapProductsInEngine(fromIndex, toIndex) {\n//   const state = pivotEngine.getState();\n//   const allUniqueProducts = [\n//     ...new Set(state.rawData.map(item => item.product)),\n//   ];\n\n//   console.log('Manual swap - From index:', fromIndex, 'To index:', toIndex);\n//   console.log('Before swap - Products:', allUniqueProducts);\n\n//   // Get the product names to swap\n//   const fromProduct = allUniqueProducts[fromIndex];\n//   const toProduct = allUniqueProducts[toIndex];\n\n//   if (!fromProduct || !toProduct) {\n//     console.error('Invalid products for swap:', fromProduct, toProduct);\n//     return;\n//   }\n\n//   // Create new data array with swapped product order\n//   const newData = [...state.rawData];\n\n//   // Create swapped product order\n//   const swappedProducts = [...allUniqueProducts];\n//   swappedProducts[fromIndex] = toProduct;\n//   swappedProducts[toIndex] = fromProduct;\n\n//   console.log('After swap - Products:', swappedProducts);\n\n//   // Sort data according to the new product order\n//   newData.sort((a, b) => {\n//     const aIndex = swappedProducts.indexOf(a.product);\n//     const bIndex = swappedProducts.indexOf(b.product);\n//     return aIndex - bIndex;\n//   });\n\n//   // Update filteredData to maintain consistency\n//   if (filteredData) {\n//     filteredData.sort((a, b) => {\n//       const aIndex = swappedProducts.indexOf(a.product);\n//       const bIndex = swappedProducts.indexOf(b.product);\n//       return aIndex - bIndex;\n//     });\n//   }\n\n//   // Create new engine with swapped data\n//   pivotEngine = new PivotEngine({\n//     ...config,\n//     data: newData,\n//   });\n\n//   console.log('Swap completed. New product order:', [\n//     ...new Set(pivotEngine.getState().rawData.map(item => item.product)),\n//   ]);\n// }\n\n// Add this function for manual category swapping:\n// function swapCategoriesInEngine(fromIndex, toIndex) {\n//   const state = pivotEngine.getState();\n//   const currentCategories = getOrderedCategories(state);\n\n//   console.log('Manual column swap - From index:', fromIndex, 'To index:', toIndex);\n//   console.log('Current categories:', currentCategories);\n\n//   // Validate indices\n//   if (fromIndex < 0 || toIndex < 0 || fromIndex >= currentCategories.length || toIndex >= currentCategories.length) {\n//     console.error('Invalid indices for column swap:', fromIndex, toIndex);\n//     return;\n//   }\n\n//   if (fromIndex === toIndex) {\n//     console.log('Same column, no swap needed');\n//     return;\n//   }\n\n//   // Get the category names to swap\n//   const fromCategory = currentCategories[fromIndex];\n//   const toCategory = currentCategories[toIndex];\n\n//   if (!fromCategory || !toCategory) {\n//     console.error('Invalid categories for swap:', fromCategory, toCategory);\n//     return;\n//   }\n\n//   // Create swapped category order\n//   const swappedCategories = [...currentCategories];\n//   swappedCategories[fromIndex] = toCategory;\n//   swappedCategories[toIndex] = fromCategory;\n\n//   console.log('After manual swap - Categories:', swappedCategories);\n\n//   // Store the swapped category order in multiple places for persistence\n//   window.swappedRegionOrder = swappedCategories;\n\n//   // Also store in the engine state if possible\n//   if (pivotEngine.state) {\n//     (pivotEngine.state).customRegionOrder = swappedCategories;\n//   }\n\n//   console.log('Manual column swap completed. New category order:', swappedCategories);\n// }\n\n// // Add this function for manual country swapping:\n// function swapCountriesInEngine(fromIndex, toIndex) {\n//   const state = pivotEngine.getState();\n//   const allUniqueCountries = [...new Set(state.rawData.map(item => item.country).filter(country => country))];\n\n//   console.log('Manual swap - From index:', fromIndex, 'To index:', toIndex);\n//   console.log('Before swap - Countries:', allUniqueCountries);\n\n//   // Get the country names to swap\n//   const fromCountry = allUniqueCountries[fromIndex];\n//   const toCountry = allUniqueCountries[toIndex];\n\n//   if (!fromCountry || !toCountry) {\n//     console.error('Invalid countries for swap:', fromCountry, toCountry);\n//     return;\n//   }\n\n//   // Create new data array with swapped country order\n//   const newData = [...state.rawData];\n\n//   // Create swapped country order\n//   const swappedCountries = [...allUniqueCountries];\n//   swappedCountries[fromIndex] = toCountry;\n//   swappedCountries[toIndex] = fromCountry;\n\n//   console.log('After swap - Countries:', swappedCountries);\n\n//   // Sort data according to the new country order\n//   newData.sort((a, b) => {\n//     const aIndex = swappedCountries.indexOf(a.country);\n//     const bIndex = swappedCountries.indexOf(b.country);\n//     return aIndex - bIndex;\n//   });\n\n//   // Update filteredData to maintain consistency\n//   if (filteredData) {\n//     filteredData.sort((a, b) => {\n//       const aIndex = swappedCountries.indexOf(a.country);\n//       const bIndex = swappedCountries.indexOf(b.country);\n//       return aIndex - bIndex;\n//     });\n//   }\n\n//   // Create new engine with swapped data\n//   pivotEngine = new PivotEngine({\n//     ...config,\n//     data: newData,\n//   });\n\n//   console.log('Swap completed. New country order:', [...new Set(pivotEngine.getState().rawData.map(item => item.country))]);\n// }\n\n// Generic function to manually swap field values (fallback)\nfunction swapGenericFieldValues(fromIndex, toIndex, fieldName, isRowField) {\n  const state = pivotEngine.getState();\n  const uniqueValues = pivotEngine.getUniqueFieldValues(fieldName);\n\n  console.log(\n    `Manual ${fieldName} swap - From index:`,\n    fromIndex,\n    'To index:',\n    toIndex\n  );\n  console.log(`Current ${fieldName} values:`, uniqueValues);\n\n  // Validate indices\n  if (\n    fromIndex < 0 ||\n    toIndex < 0 ||\n    fromIndex >= uniqueValues.length ||\n    toIndex >= uniqueValues.length\n  ) {\n    console.error(\n      `Invalid indices for ${fieldName} swap:`,\n      fromIndex,\n      toIndex,\n      'Available values:',\n      uniqueValues.length\n    );\n    return;\n  }\n\n  if (fromIndex === toIndex) {\n    console.log('Same index, no swap needed');\n    return;\n  }\n\n  // Get the values to swap\n  const fromValue = uniqueValues[fromIndex];\n  const toValue = uniqueValues[toIndex];\n\n  if (!fromValue || !toValue) {\n    console.error(`Invalid ${fieldName} values for swap:`, fromValue, toValue);\n    return;\n  }\n\n  console.log(`Swapping ${fieldName}: ${fromValue} <-> ${toValue}`);\n\n  // Create swapped value order\n  const swappedValues = [...uniqueValues];\n  swappedValues[fromIndex] = toValue;\n  swappedValues[toIndex] = fromValue;\n\n  console.log(`After manual swap - ${fieldName} values:`, swappedValues);\n\n  // Store the swapped order\n  const storageKey = isRowField ? 'swappedRowOrder' : 'swappedColumnOrder';\n  window[storageKey] = swappedValues;\n\n  // Also store in the engine state\n  if (pivotEngine.state) {\n    const stateKey = isRowField ? 'customRowOrder' : 'customColumnOrder';\n    pivotEngine.state[stateKey] = {\n      fieldName: fieldName,\n      order: swappedValues,\n    };\n  }\n\n  // For row fields, we need to reorder the actual data\n  if (isRowField) {\n    const dataToUse = state.data || state.rawData || filteredData;\n    const newData = [...dataToUse];\n\n    // Sort data according to the new value order\n    newData.sort((a, b) => {\n      const aIndex = swappedValues.indexOf(a[fieldName]);\n      const bIndex = swappedValues.indexOf(b[fieldName]);\n      return aIndex - bIndex;\n    });\n\n    // Update filteredData to maintain consistency\n    if (filteredData) {\n      filteredData.sort((a, b) => {\n        const aIndex = swappedValues.indexOf(a[fieldName]);\n        const bIndex = swappedValues.indexOf(b[fieldName]);\n        return aIndex - bIndex;\n      });\n    }\n\n    // Create new engine with swapped data\n    pivotEngine = new PivotEngine({\n      ...config,\n      data: newData,\n    });\n  }\n\n  console.log(`Manual ${fieldName} swap completed. New order:`, swappedValues);\n}\n\nexport function onSectionItemDrop(droppedFields) {\n  let droppedFieldsInSections = JSON.stringify({\n    rows: Array.from(droppedFields.rows),\n    columns: Array.from(droppedFields.columns),\n    values: Array.from(droppedFields.values),\n    filters: Array.from(droppedFields.filters),\n  });\n  const parsedDroppedFieldsInSections = JSON.parse(droppedFieldsInSections);\n\n  const transformedRows = parsedDroppedFieldsInSections.rows.map(rowField => {\n    return { uniqueName: rowField.toLowerCase(), caption: rowField };\n  });\n  const transformedColumns = parsedDroppedFieldsInSections.columns.map(\n    columnField => {\n      return { uniqueName: columnField.toLowerCase(), caption: columnField };\n    }\n  );\n  // const transformedValues=parsedDroppedFieldsInSections.values.map((valueField)=>{ return { uniqueName:valueField.toLowerCase(), caption:valueField}})\n  // const transformedFilters=parsedDroppedFieldsInSections.filters.map((filterField)=>{ return { uniqueName:filterField.toLowerCase(), caption:filterField}})\n\n  //TODO: for now only-applicable to rows and columns, will do the same for values and global filters in next iteration\n  pivotEngine.state.rows = transformedRows;\n  pivotEngine.state.columns = transformedColumns;\n\n  renderTable();\n}\n// Initialize everything when the DOM is loaded\n// Replace your initialization section at the bottom with this:\ndocument.addEventListener('DOMContentLoaded', () => {\n  // CRITICAL: Ensure we start with all the original data\n  console.log('Initializing with sampleData:', sampleData.length, 'items');\n\n  // Reset filteredData to ensure we have all data\n  filteredData = [...sampleData];\n\n  // Create PivotEngine instance with all data\n  pivotEngine = new PivotEngine({\n    ...config,\n    data: sampleData, // Use original sample data, not filtered\n  });\n\n  // Subscribe to state changes and re-render UI\n  pivotEngine.subscribe(state => {\n    renderTable();\n  });\n\n  console.log('Initial pivot engine state:', pivotEngine.getState());\n\n  // Initialize cell formatter - ADD THESE LINES\n  cellFormatter = new CellFormatter();\n  addFormattingStyles();\n\n  if (config.toolbar) {\n    createHeader(config);\n  }\n\n  // Add draggable styles\n  addDraggableStyles();\n\n  // Add controls HTML\n  addControlsHTML();\n\n  // Initialize UI\n  initializeFilters();\n  setupEventListeners();\n\n  setupCellSelection();\n\n  // CRITICAL: Set initial pagination with all sample data\n  updatePagination(sampleData, true);\n\n  window.cellFormatter = cellFormatter;\n\n  // Initial render (optional, since subscribe will call it immediately)\n  // renderTable();\n});\n"
    ],
    "mappings": "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I;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;IACD,OAAOwD,KAAK;EACd;;EAEA;EACAI,wBAAwBA,CAACJ,KAAK,EAAE;IAC9B;IACAA,KAAK,CACFS,aAAa,CAAC,mBAAmB,CAAC,CAClCC,gBAAgB,CAAC,OAAO,EAAE,MAAMV,KAAK,CAACW,MAAM,CAAC,CAAC,CAAC;IAClDX,KAAK,CACFS,aAAa,CAAC,eAAe,CAAC,CAC9BC,gBAAgB,CAAC,OAAO,EAAE,MAAMV,KAAK,CAACW,MAAM,CAAC,CAAC,CAAC;;IAElD;IACAX,KAAK,CAACS,aAAa,CAAC,cAAc,CAAC,CAACC,gBAAgB,CAAC,OAAO,EAAE,MAAM;MAClE,IAAI,CAACE,WAAW,CAAC,CAAC;MAClBZ,KAAK,CAACW,MAAM,CAAC,CAAC;IAChB,CAAC,CAAC;;IAEF;IACA,MAAME,MAAM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AAG,CAAC1B,SAAS,CAACT,MAAM,CAAC,WAAW,CAAC;IACnC,CAAC,CAAC;IAEFmC,GAAG,CAACpC,gBAAgB,CAAC,MAAM,EAAEa,CAAC,IAAI;MAChCA,CAAC,CAACgI,cAAc,CAAC,CAAC;MAClBzG,GAAG,CAAC1B,SAAS,CAACT,MAAM,CAAC,WAAW,CAAC;MAEjC,MAAMiJ,cAAc,GAAGhD,WAAW;MAElC,IAAI8C,eAAe,KAAK,IAAI,IAAIA,eAAe,KAAKE,cAAc,EAAE;QAClEtG,OAAO,CAACC,GAAG,CACR,0BAAyBmG,eAAgB,SAAQE,cAAe,EACnE,CAAC;QACD1F,eAAe,CAACwF,eAAe,EAAEE,cAAc,EAAEvG,OAAO,CAAC;QACzDY,kBAAkB,CAAC,CAAC;MACtB;IACF,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,SAAS4F,WAAWA,CAAA,EAAG;EACrB;EACA,IAAI,CAAClP,iBAAiB,IAAIC,eAAe,KAAK,KAAK,EAAE;IACnD0I,OAAO,CAACC,GAAG,CAAC,yBAAyB,CAAC;IACtCU,kBAAkB,CAAC,CAAC;IACpB;EACF;EAEA,IAAI;IACF;IACA4D,qBAAqB,CAAC,CAAC;IAEvB,MAAM/C,KAAK,GAAGrK,WAAW,CAACsK,QAAQ,CAAC,CAAC;IACpCzB,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAEuB,KAAK,CAAC;IAE3C,IAAI,CAACA,KAAK,CAACgF,aAAa,EAAE;MACxBxG,OAAO,CAACgB,KAAK,CAAC,6BAA6B,CAAC;M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A;AACA;AACA;AACA;;AAEA,SAASkS,kBAAkBA,CAAA,EAAG;EAC5B,MAAMC,OAAO,GAAG/S,QAAQ,CAACwB,aAAa,CAAC,OAAO,CAAC;EAC/CuR,OAAO,CAAC7S,SAAS,GAAI;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;EACHF,QAAQ,CAACgT,IAAI,CAACnP,WAAW,CAACkP,OAAO,CAAC;AACpC;;AAEA;;AAEA,SAASE,mBAAmBA,CAAA,EAAG;EAC7B,MAAMC,MAAM,GAAI;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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EA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASgK,gBAAgBA,CAAA,EAAG;EAC1BtJ,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAC;;EAE/C;EACA,MAAMoF,YAAY,GAAGlO,WAAW,CAACmO,eAAe,CAAC,CAAC;EAClD,MAAMJ,eAAe,GAAG/N,WAAW,CAACgO,kBAAkB,CAAC,CAAC;EAExD,IAAI,CAACE,YAAY,IAAI,CAACH,eAAe,EAAE;IACrClF,OAAO,CAACuF,IAAI,CAAC,sDAAsD,CAAC;IACpE;EACF;EAEAvF,OAAO,CAACC,GAAG,CACR,2CAA0CoF,YAAa,mBAAkBH,eAAgB,EAC5F,CAAC;;EAED;EACAqE,2BAA2B,CAACrE,eAAe,CAAC;;EAE5C;EACA6E,mBAAmB,CAAC1E,YAAY,CAAC;AACnC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,SAASwI,sBAAsBA,CAAChN,SAAS,EAAEC,OAAO,EAAE2E,SAAS,EAAEqI,UAAU,EAAE;EACzE,MAAMtM,KAAK,GAAGrK,WAAW,CAACsK,QAAQ,CAAC,CAAC;EACpC,MAAMkE,YAAY,GAAGxO,WAAW,CAACyO,oBAAoB,CAACH,SAAS,CAAC;EAEhEzF,OAAO,CAACC,GAAG,CACR,UAASwF,SAAU,qBAAoB,EACxC5E,SAAS,EACT,WAAW,EACXC,OACF,CAAC;EACDd,OAAO,CAACC,GAAG,CAAE,WAAUwF,SAAU,UAAS,EAAEE,YAAY,CAAC;;EAEzD;EACA,IACE9E,SAAS,GAAG,CAAC,IACbC,OAAO,GAAG,CAAC,IACXD,SAAS,IAAI8E,YAAY,CAAC5E,MAAM,IAChCD,OAAO,IAAI6E,YAAY,CAAC5E,MAAM,EAC9B;IACAf,OAAO,CAACgB,KAAK,CACV,uBAAsByE,SAAU,QAAO,EACxC5E,SAAS,EACTC,OAAO,EACP,mBAAmB,EACnB6E,YAAY,CAAC5E,MACf,CAAC;IACD;EACF;EAEA,IAAIF,SAAS,KAAKC,OAAO,EAAE;IACzBd,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC;IACzC;EACF;;EAEA;EACA,MAAMsK,SAAS,GAAG5E,YAAY,CAAC9E,SAAS,CAAC;EACzC,MAAM2J,OAAO,GAAG7E,YAAY,CAAC7E,OAAO,CAAC;EAErC,IAAI,CAACyJ,SAAS,IAAI,CAACC,OAAO,EAAE;IAC1BxK,OAAO,CAACgB,KAAK,CAAE,WAAUyE,SAAU,mBAAkB,EAAE8E,SAAS,EAAEC,OAAO,CAAC;IAC1E;EACF;EAEAxK,OAAO,CAACC,GAAG,CAAE,YAAWwF,SAAU,KAAI8E,SAAU,QAAOC,OAAQ,EAAC,CAAC;;EAEjE;EACA,MAAMH,aAAa,GAAG,CAAC,GAAG1E,YAAY,CAAC;EACvC0E,aAAa,CAACxJ,SAAS,CAAC,GAAG2J,OAAO;EAClCH,aAAa,CAACvJ,OAAO,CAAC,GAAGyJ,SAAS;EAElCvK,OAAO,CAACC,GAAG,CAAE,uBAAsBwF,SAAU,UAAS,EAAE4E,aAAa,CAAC;;EAEtE;EACA,MAAM0D,UAAU,GAAGD,UAAU,GAAG,iBAAiB,GAAG,oBAAoB;EACxE3N,MAAM,CAAC4N,UAAU,CAAC,GAAG1D,aAAa;;EAElC;EACA,IAAIlT,WAAW,CAACqK,KAAK,EAAE;IACrB,MAAMwM,QAAQ,GAAGF,UAAU,GAAG,gBAAgB,GAAG,mBAAmB;IACpE3W,WAAW,CAACqK,KAAK,CAACwM,QAAQ,CAAC,GAAG;MAC5BvI,SAAS,EAAEA,SAAS;MACpBC,KAAK,EAAE2E;IACT,CAAC;EACH;;EAEA;EACA,IAAIyD,UAAU,EAAE;IACd,MAAMrD,SAAS,GAAGjJ,KAAK,CAACnI,IAAI,IAAImI,KAAK,CAACzB,OAAO,IAAI3I,YAAY;IAC7D,MAAMsT,OAAO,GAAG,CAAC,GAAGD,SAAS,CAAC;;IAE9B;IACAC,OAAO,CAACpK,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAK;MACrB,MAAMmK,MAAM,GAAGN,aAAa,CAAC9G,OAAO,CAAChD,CAAC,CAACkF,SAAS,CAAC,CAAC;MAClD,MAAMmF,MAAM,GAAGP,aAAa,CAAC9G,OAAO,CAAC/C,CAAC,CAACiF,SAAS,CAAC,CAAC;MAClD,OAAOkF,MAAM,GAAGC,MAAM;IACxB,CAAC,CAAC;;IAEF;IACA,IAAIxT,YAAY,EAAE;MAChBA,YAAY,CAACkJ,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAK;QAC1B,MAAMmK,MAAM,GAAGN,aAAa,CAAC9G,OAAO,CAAChD,CAAC,CAACkF,SAAS,CAAC,CAAC;QAClD,MAAMmF,MAAM,GAAGP,aAAa,CAAC9G,OAAO,CAAC/C,CAAC,CAACiF,SAAS,CAAC,CAAC;QAClD,OAAOkF,MAAM,GAAGC,MAAM;MACxB,CAAC,CAAC;IACJ;;IAEA;IACAzT,WAAW,GAAG,IAAIH,WAAW,CAAC;MAC5B,GAAGE,MAAM;MACTmC,IAAI,EAAEqR;IACR,CAAC,CAAC;EACJ;EAEA1K,OAAO,CAACC,GAAG,CAAE,UAASwF,SAAU,6BAA4B,EAAE4E,aAAa,CAAC;AAC9E;AAEA,OAAO,SAAS4D,iBAAiBA,CAACC,aAAa,EAAE;EAC/C,IAAIC,uBAAuB,GAAGC,IAAI,CAACC,SAAS,CAAC;IAC3ClI,IAAI,EAAEyC,KAAK,CAAC0F,IAAI,CAACJ,aAAa,CAAC/H,IAAI,CAAC;IACpCwG,OAAO,EAAE/D,KAAK,CAAC0F,IAAI,CAACJ,aAAa,CAACvB,OAAO,CAAC;IAC1C4B,MAAM,EAAE3F,KAAK,CAAC0F,IAAI,CAACJ,aAAa,CAACK,MAAM,CAAC;IACxCC,OAAO,EAAE5F,KAAK,CAAC0F,IAAI,CAACJ,aAAa,CAACM,OAAO;EAC3C,CAAC,CAAC;EACF,MAAMC,6BAA6B,GAAGL,IAAI,CAACM,KAAK,CAACP,uBAAuB,CAAC;EAEzE,MAAMQ,eAAe,GAAGF,6BAA6B,CAACtI,IAAI,CAACgC,GAAG,CAACyG,QAAQ,IAAI;IACzE,OAAO;MAAEpH,UAAU,EAAEoH,QAAQ,CAAC9U,WAAW,CAAC,CAAC;MAAEyN,OAAO,EAAEqH;IAAS,CAAC;EAClE,CAAC,CAAC;EACF,MAAMC,kBAAkB,GAAGJ,6BAA6B,CAAC9B,OAAO,CAACxE,GAAG,CAClE2G,WAAW,IAAI;IACb,OAAO;MAAEtH,UAAU,EAAEsH,WAAW,CAAChV,WAAW,CAAC,CAAC;MAAEyN,OAAO,EAAEuH;IAAY,CAAC;EACxE,CACF,CAAC;EACD;EACA;;EAEA;EACA3X,WAAW,CAACqK,KAAK,CAAC2E,IAAI,GAAGwI,eAAe;EACxCxX,WAAW,CAACqK,KAAK,CAACmL,OAAO,GAAGkC,kBAAkB;EAE9CtI,WAAW,CAAC,CAAC;AACf;AACA;AACA;AACAvN,QAAQ,CAACoE,gBAAgB,CAAC,kBAAkB,EAAE,MAAM;EAClD;EACA4C,OAAO,CAACC,GAAG,CAAC,+BAA+B,EAAEhJ,UAAU,CAAC8J,MAAM,EAAE,OAAO,CAAC;;EAExE;EACA3J,YAAY,GAAG,CAAC,GAAGH,UAAU,CAAC;;EAE9B;EACAE,WAAW,GAAG,IAAIH,WAAW,CAAC;IAC5B,GAAGE,MAAM;IACTmC,IAAI,EAAEpC,UAAU,CAAE;EACpB,CAAC,CAAC;;EAEF;EACAE,WAAW,CAAC6T,SAAS,CAACxJ,KAAK,IAAI;IAC7B+E,WAAW,CAAC,CAAC;EACf,CAAC,CAAC;EAEFvG,OAAO,CAACC,GAAG,CAAC,6BAA6B,EAAE9I,WAAW,CAACsK,QAAQ,CAAC,CAAC,CAAC;;EAElE;EACA9J,aAAa,GAAG,IAAIqD,aAAa,CAAC,CAAC;EACnCiR,mBAAmB,CAAC,CAAC;EAErB,IAAI/U,MAAM,CAAC6X,OAAO,EAAE;IAClBhY,YAAY,CAACG,MAAM,CAAC;EACtB;;EAEA;EACA4U,kBAAkB,CAAC,CAAC;;EAEpB;EACAsB,eAAe,CAAC,CAAC;;EAEjB;EACAtU,iBAAiB,CAAC,CAAC;EACnByS,mBAAmB,CAAC,CAAC;EAErBkC,kBAAkB,CAAC,CAAC;;EAEpB;EACA/F,gBAAgB,CAACzQ,UAAU,EAAE,IAAI,CAAC;EAElCkJ,MAAM,CAACxI,aAAa,GAAGA,aAAa;;EAEpC;EACA;AACF,CAAC,CAAC",
    "ignoreList": []
  },
  "metadata": {},
  "sourceType": "module",
  "externalDependencies": []
}
